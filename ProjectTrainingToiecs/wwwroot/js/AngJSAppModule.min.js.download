!function(a,b,c){"use strict";function d(a,c){return b.equals(a.length,c.length)?c<a:a.length>c.length}function e(a){var b=a.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!b||4!==b.length)throw new Error("Invalid state ref '"+a+"'");return{state:b[1],paramExpr:b[3]||null}}function f(a,b,d,e){var f=k[a];f!==c&&f(),f=b.$on(d,e),k[a]=f}function h(a,c,d){return{restrict:"AE",replace:!0,scope:{},template:c.getTemplate({bootstrap2:'<ul class="breadcrumb"><li ng-repeat="step in steps" ng-switch="$last || !!step.abstract" ng-class="{active: $last}"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span><span class="divider" ng-hide="$last">/</span></li></ul>',bootstrap3:'<ol class="breadcrumb"><li ng-repeat="step in steps" ng-class="{active: $last}" ng-switch="$last || !!step.abstract"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span></li></ol>'}),templateUrl:c.getTemplateUrl(),link:{post:function(e){var g=[],h=function(){n(g),g=[];var d=c.$getLastViewScope();e.steps=c.getStatesChain(),b.forEach(e.steps,function(b){if(b.ncyBreadcrumb&&b.ncyBreadcrumb.label){var c=a(b.ncyBreadcrumb.label);b.ncyBreadcrumbLabel=c(d),m(g,c,d,b)}else b.ncyBreadcrumbLabel=b.name})};f("BreadcrumbDirective.$viewContentLoaded",d,"$viewContentLoaded",function(a){a.targetScope.ncyBreadcrumbIgnore||h()}),h()}}}}function i(a,b,c){return{restrict:"A",scope:{},template:b.getTemplateLast({default:"{{ncyBreadcrumbLabel}}"}),templateUrl:b.getTemplateLastUrl(),compile:function(d,e){var g=d.attr(e.$attr.ncyBreadcrumbLast);return g&&d.html(g),{post:function(d){var e=[],g=function(){n(e),e=[];var c=b.$getLastViewScope(),f=b.getLastStep();if(f)if(d.ncyBreadcrumbLink=f.ncyBreadcrumbLink,f.ncyBreadcrumb&&f.ncyBreadcrumb.label){var g=a(f.ncyBreadcrumb.label);d.ncyBreadcrumbLabel=g(c),m(e,g,c,d)}else d.ncyBreadcrumbLabel=f.name};f("BreadcrumbLastDirective.$viewContentLoaded",c,"$viewContentLoaded",function(a){a.targetScope.ncyBreadcrumbIgnore||g()}),g()}}}}}function j(a,c,d){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbChain}}",compile:function(e,g){var h=e.attr(g.$attr.ncyBreadcrumbText);h&&e.html(h);var i=e.attr(g.$attr.ncyBreadcrumbTextSeparator)||" / ";return{post:function(e){var g=[],h=function(a,c,d){b.forEach(l(c),function(b){var c=d.$watch(b,function(a,b){a!==b&&j()});a.push(c)})},j=function(){n(g),g=[];var d=c.$getLastViewScope(),f=c.getStatesChain(),j=[];b.forEach(f,function(b){if(b.ncyBreadcrumb&&b.ncyBreadcrumb.label){var c=a(b.ncyBreadcrumb.label);j.push(c(d)),h(g,c,d)}else j.push(b.name)}),e.ncyBreadcrumbChain=j.join(i)};f("BreadcrumbTextDirective.$viewContentLoaded",d,"$viewContentLoaded",function(a){a.targetScope.ncyBreadcrumbIgnore||j()}),j()}}}}}var k={},l=function(a){if(a.expressions)return a.expressions;var c=[];return b.forEach(a.parts,function(a){b.isFunction(a)&&c.push(a.exp)}),c},m=function(a,c,d,e){b.forEach(l(c),function(b){var f=d.$watch(b,function(){e.ncyBreadcrumbLabel=c(d)});a.push(f)})},n=function(a){b.forEach(a,function(a){a()})};h.$inject=["$interpolate","$breadcrumb","$rootScope"],i.$inject=["$interpolate","$breadcrumb","$rootScope"],j.$inject=["$interpolate","$breadcrumb","$rootScope"],b.module("ncy_angular_breadcrumb",["ui.router.state"]).provider("$breadcrumb",function(){var a={prefixStateName:null,template:"bootstrap3",templateUrl:null,templateLast:"default",templateLastUrl:null,includeAbstract:!1};this.setOptions=function(c){b.extend(a,c)},this.$get=["$state","$stateParams","$rootScope",function(b,g,h){var i=h;f("$Breadcrumb.$viewContentLoaded",h,"$viewContentLoaded",function(a){!a.targetScope.ncyBreadcrumbIgnore&&d(a.targetScope.$id,i.$id)&&(i=a.targetScope)});var k=function(c,d){for(var f,h,j=e(d),k=!1,l=!1,m=0,n=c.length;m<n;m+=1)if(c[m].name===j.state)return;(f=b.get(j.state)).ncyBreadcrumb&&(f.ncyBreadcrumb.force&&(k=!0),f.ncyBreadcrumb.skip&&(l=!0)),f.abstract&&!a.includeAbstract&&!k||l||(j.paramExpr&&(h=i.$eval(j.paramExpr)),f.ncyBreadcrumbLink=b.href(j.state,h||g||{}),f.ncyBreadcrumbStateRef=d,c.unshift(f))},l=function(a){var c=e(a),d=b.get(c.state);if(d.ncyBreadcrumb&&d.ncyBreadcrumb.parent){var g="function"==typeof d.ncyBreadcrumb.parent?d.ncyBreadcrumb.parent(i):d.ncyBreadcrumb.parent;if(g)return g}return function(a){var b=a.parent||(/^(.+)\.[^.]+$/.exec(a.name)||[])[1];return"object"==typeof b?b.name:b}(d)};return{getTemplate:function(b){return a.templateUrl?null:b[a.template]?b[a.template]:a.template},getTemplateUrl:function(){return a.templateUrl},getTemplateLast:function(b){return a.templateLastUrl?null:b[a.templateLast]?b[a.templateLast]:a.templateLast},getTemplateLastUrl:function(){return a.templateLastUrl},getStatesChain:function(c){for(var d=[],e=b.$current.self.name;e;e=l(e))if(k(d,e),c&&d.length)return d;return a.prefixStateName&&k(d,a.prefixStateName),d},getLastStep:function(){var a=this.getStatesChain(!0);return a.length?a[0]:c},$getLastViewScope:function(){return i}}}]}).directive("ncyBreadcrumb",h).directive("ncyBreadcrumbLast",i).directive("ncyBreadcrumbText",j)}(window,window.angular),angular.module("com.2fdevs.videogular",["ngSanitize"]).run(["$templateCache",function($templateCache){$templateCache.put("vg-templates/vg-media-video","<video></video>"),$templateCache.put("vg-templates/vg-media-audio","<audio></audio>"),Function.prototype.bind||(Function.prototype.bind=function(oThis){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply(this instanceof fNOP?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};return fNOP.prototype=this.prototype,fBound.prototype=new fNOP,fBound})}]),angular.module("com.2fdevs.videogular").constant("VG_STATES",{PLAY:"play",PAUSE:"pause",STOP:"stop"}).constant("VG_VOLUME_KEY","videogularVolume"),angular.module("com.2fdevs.videogular").controller("vgController",["$scope","$window","vgConfigLoader","vgFullscreen","VG_UTILS","VG_STATES","VG_VOLUME_KEY",function($scope,$window,vgConfigLoader,vgFullscreen,VG_UTILS,VG_STATES,VG_VOLUME_KEY){var currentTheme=null,isMetaDataLoaded=!1,hasStartTimePlayed=!1,isVirtualClip=!1;this.videogularElement=null,this.clearMedia=function(){this.mediaElement[0].src="",this.mediaElement[0].removeEventListener("canplay",this.onCanPlay.bind(this),!1),this.mediaElement[0].removeEventListener("loadedmetadata",this.onLoadMetaData.bind(this),!1),this.mediaElement[0].removeEventListener("waiting",this.onStartBuffering.bind(this),!1),this.mediaElement[0].removeEventListener("ended",this.onComplete.bind(this),!1),this.mediaElement[0].removeEventListener("playing",this.onStartPlaying.bind(this),!1),this.mediaElement[0].removeEventListener("play",this.onPlay.bind(this),!1),this.mediaElement[0].removeEventListener("pause",this.onPause.bind(this),!1),this.mediaElement[0].removeEventListener("volumechange",this.onVolumeChange.bind(this),!1),this.mediaElement[0].removeEventListener("playbackchange",this.onPlaybackChange.bind(this),!1),this.mediaElement[0].removeEventListener("timeupdate",this.onUpdateTime.bind(this),!1),this.mediaElement[0].removeEventListener("progress",this.onProgress.bind(this),!1),this.mediaElement[0].removeEventListener("seeking",this.onSeeking.bind(this),!1),this.mediaElement[0].removeEventListener("seeked",this.onSeeked.bind(this),!1),this.mediaElement[0].removeEventListener("error",this.onVideoError.bind(this),!1)},this.onRouteChange=function(){void 0!==this.clearMediaOnNavigate&&!0!==this.clearMediaOnNavigate||this.clearMedia()},this.onCanPlay=function(evt){this.isBuffering=!1,$scope.$parent.$digest($scope.vgCanPlay({$event:evt})),!hasStartTimePlayed&&(0<this.startTime||0===this.startTime)&&(this.seekTime(this.startTime),hasStartTimePlayed=!0)},this.onVideoReady=function(){this.isReady=!0,this.autoPlay=$scope.vgAutoPlay,this.playsInline=$scope.vgPlaysInline,this.nativeFullscreen=$scope.vgNativeFullscreen||!0,this.cuePoints=$scope.vgCuePoints,this.startTime=$scope.vgStartTime,this.virtualClipDuration=$scope.vgVirtualClipDuration,this.clearMediaOnNavigate=$scope.vgClearMediaOnNavigate||!0,this.currentState=VG_STATES.STOP,isMetaDataLoaded=!0,isVirtualClip=0<=this.startTime&&0<this.virtualClipDuration,VG_UTILS.supportsLocalStorage()&&this.setVolume(parseFloat($window.localStorage.getItem(VG_VOLUME_KEY)||"1")),$scope.vgConfig?vgConfigLoader.loadConfig($scope.vgConfig).then(this.onLoadConfig.bind(this)):$scope.vgPlayerReady({$API:this})},this.onLoadConfig=function(config){this.config=config,$scope.vgTheme=this.config.theme,$scope.vgAutoPlay=this.config.autoPlay,$scope.vgPlaysInline=this.config.playsInline,$scope.vgNativeFullscreen=this.config.nativeFullscreen,$scope.vgCuePoints=this.config.cuePoints,$scope.vgClearMediaOnNavigate=this.config.clearMediaOnNavigate,$scope.vgStartTime=this.config.startTime,$scope.vgVirtualClipDuration=this.config.virtualClipDuration,isVirtualClip=0<=$scope.vgStartTime&&0<$scope.vgVirtualClipDuration,$scope.vgPlayerReady({$API:this})},this.onLoadMetaData=function(evt){this.isBuffering=!1,this.onUpdateTime(evt)},this.onProgress=function(event){this.updateBuffer(event),$scope.$parent.$digest()},this.updateBuffer=function(event){event.target.buffered.length&&(this.buffered=event.target.buffered,this.bufferEnd=1e3*event.target.buffered.end(event.target.buffered.length-1),this.bufferEnd>this.totalTime&&(this.bufferEnd=this.totalTime))},this.onUpdateTime=function(event){var targetTime=1e3*event.target.currentTime;this.updateBuffer(event),event.target.duration!=1/0&&null!=event.target.duration&&null!=event.target.duration&&17976931348623157e292!=event.target.duration?(isVirtualClip?hasStartTimePlayed&&(event.target.currentTime<this.startTime||event.target.currentTime-this.startTime>this.virtualClipDuration)?this.onComplete():(this.currentTime=Math.max(0,targetTime-1e3*this.startTime),this.totalTime=1e3*this.virtualClipDuration,this.timeLeft=1e3*this.virtualClipDuration-this.currentTime):(this.currentTime=targetTime,this.totalTime=1e3*event.target.duration,this.timeLeft=1e3*(event.target.duration-event.target.currentTime)),this.isLive=!1):(this.currentTime=targetTime,this.isLive=!0);var targetSeconds=isVirtualClip?this.currentTime/1e3:event.target.currentTime,targetDuration=isVirtualClip?this.totalTime/1e3:event.target.duration;this.cuePoints&&this.checkCuePoints(targetSeconds),$scope.vgUpdateTime({$currentTime:targetSeconds,$duration:targetDuration}),"$apply"!=$scope.$$phase&&"$digest"!=$scope.$$phase&&$scope.$parent.$digest()},this.checkCuePoints=function(currentTime){for(var tl in this.cuePoints)for(var i=0,l=this.cuePoints[tl].length;i<l;i++){var cp=this.cuePoints[tl][i],currentSecond=parseInt(currentTime,10),start=parseInt(cp.timeLapse.start,10);cp.timeLapse.end||(cp.timeLapse.end=cp.timeLapse.start+1),currentTime<cp.timeLapse.end&&(cp.$$isCompleted=!1),cp.$$isDirty||currentSecond!==start||"function"!=typeof cp.onEnter||(cp.onEnter(currentTime,cp.timeLapse,cp.params),cp.$$isDirty=!0),currentTime>cp.timeLapse.start?(currentTime<cp.timeLapse.end&&(cp.onUpdate&&cp.onUpdate(currentTime,cp.timeLapse,cp.params),cp.$$isDirty||"function"!=typeof cp.onEnter||cp.onEnter(currentTime,cp.timeLapse,cp.params)),currentTime>=cp.timeLapse.end&&cp.onComplete&&!cp.$$isCompleted&&(cp.$$isCompleted=!0,cp.onComplete(currentTime,cp.timeLapse,cp.params)),cp.$$isDirty=!0):(cp.onLeave&&cp.$$isDirty&&cp.onLeave(currentTime,cp.timeLapse,cp.params),cp.$$isDirty=!1)}},this.onPlay=function(){this.setState(VG_STATES.PLAY),$scope.$parent.$digest()},this.onPause=function(){0==(isVirtualClip?this.currentTime:this.mediaElement[0].currentTime)?this.setState(VG_STATES.STOP):this.setState(VG_STATES.PAUSE),$scope.$parent.$digest()},this.onVolumeChange=function(){this.volume=this.mediaElement[0].volume,$scope.$parent.$digest()},this.onPlaybackChange=function(){this.playback=this.mediaElement[0].playbackRate,$scope.$parent.$digest()},this.onSeeking=function(event){$scope.vgSeeking({$currentTime:event.target.currentTime,$duration:event.target.duration})},this.onSeeked=function(event){$scope.vgSeeked({$currentTime:event.target.currentTime,$duration:event.target.duration})},this.seekTime=function(value,byPercent){var second;if(byPercent)isVirtualClip?(second=(value=Math.max(0,Math.min(value,100)))*this.virtualClipDuration/100,this.mediaElement[0].currentTime=this.startTime+second):(second=value*this.mediaElement[0].duration/100,this.mediaElement[0].currentTime=second);else if(isVirtualClip){var durationPercent=value/this.mediaElement[0].duration;second=hasStartTimePlayed?this.virtualClipDuration*durationPercent:0,this.mediaElement[0].currentTime=hasStartTimePlayed?this.startTime+second:this.startTime}else second=value,this.mediaElement[0].currentTime=second;this.currentTime=1e3*second},this.playPause=function(){this.mediaElement[0].paused?this.play():this.pause()},this.setState=function(newState){return newState&&newState!=this.currentState&&($scope.vgUpdateState({$state:newState}),this.currentState=newState),this.currentState},this.play=function(){this.mediaElement[0].play(),this.setState(VG_STATES.PLAY)},this.pause=function(){this.mediaElement[0].pause(),this.setState(VG_STATES.PAUSE)},this.stop=function(){try{this.mediaElement[0].pause();var targetTime=isVirtualClip?this.startTime:0;this.mediaElement[0].currentTime=targetTime,this.currentTime=targetTime,this.buffered=[],this.bufferEnd=0,this.setState(VG_STATES.STOP)}catch(e){return e}},this.toggleFullScreen=function(){vgFullscreen.isAvailable&&this.nativeFullscreen?this.isFullScreen?VG_UTILS.isMobileDevice()||vgFullscreen.exit():VG_UTILS.isMobileDevice()?VG_UTILS.isiOSDevice()?isMetaDataLoaded?this.enterElementInFullScreen(this.mediaElement[0]):(!0,this.play()):this.enterElementInFullScreen(this.mediaElement[0]):this.enterElementInFullScreen(this.videogularElement[0]):(this.isFullScreen?(this.videogularElement.removeClass("fullscreen"),this.videogularElement.css("z-index","auto")):(this.videogularElement.addClass("fullscreen"),this.videogularElement.css("z-index",VG_UTILS.getZIndex())),this.isFullScreen=!this.isFullScreen)},this.enterElementInFullScreen=function(element){vgFullscreen.request(element)},this.changeSource=function(newValue){$scope.vgChangeSource({$source:newValue})},this.setVolume=function(newVolume){newVolume=Math.max(Math.min(newVolume,1),0),$scope.vgUpdateVolume({$volume:newVolume}),this.mediaElement[0].volume=newVolume,this.volume=newVolume,VG_UTILS.supportsLocalStorage()&&$window.localStorage.setItem(VG_VOLUME_KEY,newVolume.toString())},this.setPlayback=function(newPlayback){$scope.vgUpdatePlayback({$playBack:newPlayback}),this.mediaElement[0].playbackRate=newPlayback,this.playback=newPlayback},this.updateTheme=function(value){var i,l,links=document.getElementsByTagName("link");if(currentTheme)for(i=0,l=links.length;i<l;i++)if(0<=links[i].outerHTML.indexOf(currentTheme)){links[i].parentNode.removeChild(links[i]);break}if(value){var headElem=angular.element(document).find("head"),exists=!1;for(i=0,l=links.length;i<l&&!(exists=0<=links[i].outerHTML.indexOf(value));i++);exists||headElem.append("<link rel='stylesheet' href='"+value+"'>"),currentTheme=value}},this.onStartBuffering=function(event){this.isBuffering=!0,$scope.$parent.$digest()},this.onStartPlaying=function(event){this.isBuffering=!1,$scope.$parent.$digest()},this.onComplete=function(event){$scope.vgComplete(),this.setState(VG_STATES.STOP),this.isCompleted=!0,isVirtualClip&&this.stop(),$scope.$parent.$digest()},this.onVideoError=function(event){$scope.vgError({$event:event})},this.addListeners=function(){this.mediaElement[0].addEventListener("canplay",this.onCanPlay.bind(this),!1),this.mediaElement[0].addEventListener("loadedmetadata",this.onLoadMetaData.bind(this),!1),this.mediaElement[0].addEventListener("waiting",this.onStartBuffering.bind(this),!1),this.mediaElement[0].addEventListener("ended",this.onComplete.bind(this),!1),this.mediaElement[0].addEventListener("playing",this.onStartPlaying.bind(this),!1),this.mediaElement[0].addEventListener("play",this.onPlay.bind(this),!1),this.mediaElement[0].addEventListener("pause",this.onPause.bind(this),!1),this.mediaElement[0].addEventListener("volumechange",this.onVolumeChange.bind(this),!1),this.mediaElement[0].addEventListener("playbackchange",this.onPlaybackChange.bind(this),!1),this.mediaElement[0].addEventListener("timeupdate",this.onUpdateTime.bind(this),!1),this.mediaElement[0].addEventListener("progress",this.onProgress.bind(this),!1),this.mediaElement[0].addEventListener("seeking",this.onSeeking.bind(this),!1),this.mediaElement[0].addEventListener("seeked",this.onSeeked.bind(this),!1),this.mediaElement[0].addEventListener("error",this.onVideoError.bind(this),!1)},this.init=function(){this.isReady=!1,this.isCompleted=!1,this.buffered=[],this.bufferEnd=0,this.currentTime=0,this.totalTime=0,this.timeLeft=0,this.isLive=!1,this.isFullScreen=!1,this.playback=1,this.isConfig=null!=$scope.vgConfig,this.mediaElement=[{play:function(){},pause:function(){},stop:function(){},addEventListener:function(){},removeEventListener:function(){}}],vgFullscreen.isAvailable&&(this.isFullScreen=vgFullscreen.isFullScreen()),this.updateTheme($scope.vgTheme),this.addBindings(),vgFullscreen.isAvailable&&document.addEventListener(vgFullscreen.onchange,this.onFullScreenChange.bind(this))},this.onUpdateTheme=function(newValue){this.updateTheme(newValue)},this.onUpdateAutoPlay=function(newValue){newValue&&!this.autoPlay&&(this.autoPlay=newValue,this.play(this))},this.onUpdateStartTime=function(newValue){if(newValue&&newValue!=this.startTime){this.mediaElement[0].currentTime=newValue,this.startTime=newValue,isVirtualClip=0<=this.startTime&&0<this.virtualClipDuration;var fakeEvent={target:this.mediaElement[0]};this.onUpdateTime(fakeEvent,!0)}},this.onUpdateVirtualClipDuration=function(newValue){if(newValue&&newValue!=this.virtualClipDuration){this.virtualClipDuration=newValue,isVirtualClip=0<=this.startTime&&0<this.virtualClipDuration;var fakeEvent={target:this.mediaElement[0]};this.onUpdateTime(fakeEvent,!0)}},this.onUpdatePlaysInline=function(newValue){this.playsInline=newValue},this.onUpdateNativeFullscreen=function(newValue){null==newValue&&(newValue=!0),this.nativeFullscreen=newValue},this.onUpdateCuePoints=function(newValue){this.cuePoints=newValue,this.checkCuePoints(this.currentTime)},this.onUpdateClearMediaOnNavigate=function(newValue){this.clearMediaOnNavigate=newValue},this.addBindings=function(){$scope.$watch("vgTheme",this.onUpdateTheme.bind(this)),$scope.$watch("vgAutoPlay",this.onUpdateAutoPlay.bind(this)),$scope.$watch("vgStartTime",this.onUpdateStartTime.bind(this)),$scope.$watch("vgVirtualClipDuration",this.onUpdateVirtualClipDuration.bind(this)),$scope.$watch("vgPlaysInline",this.onUpdatePlaysInline.bind(this)),$scope.$watch("vgNativeFullscreen",this.onUpdateNativeFullscreen.bind(this)),$scope.$watch("vgCuePoints",this.onUpdateCuePoints.bind(this)),$scope.$watch("vgClearMediaOnNavigate",this.onUpdateClearMediaOnNavigate.bind(this))},this.onFullScreenChange=function(event){this.isFullScreen=vgFullscreen.isFullScreen(),$scope.$parent.$digest()},$scope.$on("$destroy",this.clearMedia.bind(this)),$scope.$on("$routeChangeStart",this.onRouteChange.bind(this)),this.init()}]),angular.module("com.2fdevs.videogular").directive("vgCrossorigin",[function(){return{restrict:"A",require:"^videogular",link:{pre:function(scope,elem,attr,API){var crossorigin;scope.setCrossorigin=function(value){value?API.mediaElement.attr("crossorigin",value):API.mediaElement.removeAttr("crossorigin")},API.isConfig?scope.$watch(function(){return API.config},function(){API.config&&scope.setCrossorigin(API.config.crossorigin)}):scope.$watch(attr.vgCrossorigin,function(newValue,oldValue){crossorigin&&newValue==oldValue||!newValue?scope.setCrossorigin():(crossorigin=newValue,scope.setCrossorigin(crossorigin))})}}}}]),angular.module("com.2fdevs.videogular").directive("vgLoop",[function(){return{restrict:"A",require:"^videogular",link:{pre:function(scope,elem,attr,API){var loop;scope.setLoop=function(value){value?API.mediaElement.attr("loop",value):API.mediaElement.removeAttr("loop")},API.isConfig?scope.$watch(function(){return API.config},function(){API.config&&scope.setLoop(API.config.loop)}):scope.$watch(attr.vgLoop,function(newValue,oldValue){loop&&newValue==oldValue||!newValue?scope.setLoop():(loop=newValue,scope.setLoop(loop))})}}}}]),angular.module("com.2fdevs.videogular").directive("vgMedia",["$timeout","VG_UTILS","VG_STATES",function($timeout,VG_UTILS,VG_STATES){return{restrict:"E",require:"^videogular",templateUrl:function(elem,attrs){var vgType=attrs.vgType||"video";return attrs.vgTemplate||"vg-templates/vg-media-"+vgType},scope:{vgSrc:"=?",vgType:"=?"},link:function(scope,elem,attrs,API){var sources;attrs.vgType&&"video"!==attrs.vgType?attrs.vgType="audio":attrs.vgType="video",scope.onChangeSource=function(newValue,oldValue){sources&&newValue==oldValue||!newValue||(sources=newValue,API.currentState!==VG_STATES.PLAY&&(API.currentState=VG_STATES.STOP),API.sources=sources,scope.changeSource())},scope.changeSource=function(){if(angular.isArray(sources)){var canPlay="";if(API.mediaElement[0].canPlayType){for(var i=0,l=sources.length;i<l;i++)if("maybe"==(canPlay=API.mediaElement[0].canPlayType(sources[i].type))||"probably"==canPlay){API.mediaElement.attr("src",sources[i].src),API.mediaElement.attr("type",sources[i].type),API.changeSource(sources[i]);break}}else API.mediaElement.attr("src",sources[0].src),API.mediaElement.attr("type",sources[0].type),API.changeSource(sources[0])}else API.mediaElement.attr("src",sources),API.changeSource(sources);VG_UTILS.isMobileDevice()&&API.mediaElement[0].load(),$timeout(function(){!API.autoPlay||!VG_UTILS.isCordova()&&VG_UTILS.isMobileDevice()||API.play()}),""==canPlay&&API.onVideoError()},API.mediaElement=elem.find(attrs.vgType),API.sources=scope.vgSrc,API.addListeners(),API.onVideoReady(),scope.$watch("vgSrc",scope.onChangeSource),scope.$watch(function(){return API.sources},scope.onChangeSource),scope.$watch(function(){return API.playsInline},function(newValue,oldValue){newValue?API.mediaElement.attr("webkit-playsinline",""):API.mediaElement.removeAttr("webkit-playsinline")}),API.isConfig&&scope.$watch(function(){return API.config},function(){API.config&&(scope.vgSrc=API.config.sources)})}}}]),angular.module("com.2fdevs.videogular").directive("vgNativeControls",[function(){return{restrict:"A",require:"^videogular",link:{pre:function(scope,elem,attr,API){var controls;scope.setControls=function(value){value?API.mediaElement.attr("controls",value):API.mediaElement.removeAttr("controls")},API.isConfig?scope.$watch(function(){return API.config},function(){API.config&&scope.setControls(API.config.controls)}):scope.$watch(attr.vgNativeControls,function(newValue,oldValue){controls&&newValue==oldValue||!newValue?scope.setControls():(controls=newValue,scope.setControls(controls))})}}}}]),angular.module("com.2fdevs.videogular").directive("vgPreload",[function(){return{restrict:"A",require:"^videogular",link:{pre:function(scope,elem,attr,API){var preload;scope.setPreload=function(value){value?API.mediaElement.attr("preload",value):API.mediaElement.removeAttr("preload")},API.isConfig?scope.$watch(function(){return API.config},function(){API.config&&scope.setPreload(API.config.preload)}):scope.$watch(attr.vgPreload,function(newValue,oldValue){preload&&newValue==oldValue||!newValue?scope.setPreload():(preload=newValue,scope.setPreload(preload))})}}}}]),angular.module("com.2fdevs.videogular").directive("vgTracks",[function(){return{restrict:"A",require:"^videogular",link:{pre:function(scope,elem,attr,API){var tracks,isMetaDataLoaded=!1;scope.onLoadMetaData=function(){isMetaDataLoaded=!0,scope.updateTracks()},scope.updateTracks=function(){for(var oldTracks=API.mediaElement.children(),i=0,l=API.mediaElement[0].textTracks.length;i<l;i++)API.mediaElement[0].textTracks[i].mode="hidden";for(i=0,l=oldTracks.length;i<l;i++)oldTracks[i].remove&&oldTracks[i].remove();if(tracks)for(i=0,l=tracks.length;i<l;i++){var track=document.createElement("track");for(var prop in tracks[i])track[prop]=tracks[i][prop];track.addEventListener("load",scope.onLoadTrack.bind(scope,track)),API.mediaElement[0].appendChild(track)}},scope.onLoadTrack=function(track){for(var i=0,l=API.mediaElement[0].textTracks.length;i<l;i++)track.label==API.mediaElement[0].textTracks[i].label&&(track.default?API.mediaElement[0].textTracks[i].mode="showing":API.mediaElement[0].textTracks[i].mode="hidden");track.removeEventListener("load",scope.onLoadTrack.bind(scope,track))},scope.setTracks=function(value){tracks=value,API.tracks=value,isMetaDataLoaded?scope.updateTracks():API.mediaElement[0].addEventListener("loadedmetadata",scope.onLoadMetaData.bind(scope),!1)},API.isConfig?scope.$watch(function(){return API.config},function(){API.config&&scope.setTracks(API.config.tracks)}):scope.$watch(attr.vgTracks,function(newValue,oldValue){tracks&&newValue==oldValue||(scope.setTracks(newValue),console.log("sadasd"))},!0)}}}}]),angular.module("com.2fdevs.videogular").directive("videogular",[function(){return{restrict:"EA",scope:{vgTheme:"=?",vgAutoPlay:"=?",vgStartTime:"=?",vgVirtualClipDuration:"=?",vgPlaysInline:"=?",vgNativeFullscreen:"=?",vgClearMediaOnNavigate:"=?",vgCuePoints:"=?",vgConfig:"@",vgCanPlay:"&",vgComplete:"&",vgUpdateVolume:"&",vgUpdatePlayback:"&",vgUpdateTime:"&",vgUpdateState:"&",vgPlayerReady:"&",vgChangeSource:"&",vgSeeking:"&",vgSeeked:"&",vgError:"&"},controller:"vgController",controllerAs:"API",link:{pre:function(scope,elem,attr,controller){controller.videogularElement=angular.element(elem)}}}}]),angular.module("com.2fdevs.videogular").service("vgConfigLoader",["$http","$q","$sce",function($http,$q,$sce){this.loadConfig=function(url){var deferred=$q.defer();return $http({method:"GET",url:url}).then(function(response){for(var result=response.data,i=0,l=result.sources.length;i<l;i++)result.sources[i].src=$sce.trustAsResourceUrl(result.sources[i].src);deferred.resolve(result)},function(){deferred.reject()}),deferred.promise}}]),angular.module("com.2fdevs.videogular").service("vgFullscreen",["VG_UTILS",function(VG_UTILS){var element,polyfill=null,APIs={w3:{enabled:"fullscreenEnabled",element:"fullscreenElement",request:"requestFullscreen",exit:"exitFullscreen",onchange:"fullscreenchange",onerror:"fullscreenerror"},newWebkit:{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},oldWebkit:{enabled:"webkitIsFullScreen",element:"webkitCurrentFullScreenElement",request:"webkitRequestFullScreen",exit:"webkitCancelFullScreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},moz:{enabled:"mozFullScreen",element:"mozFullScreenElement",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",onchange:"mozfullscreenchange",onerror:"mozfullscreenerror"},ios:{enabled:"webkitFullscreenEnabled",element:"webkitFullscreenElement",request:"webkitEnterFullscreen",exit:"webkitExitFullscreen",onchange:"webkitfullscreenchange",onerror:"webkitfullscreenerror"},ms:{enabled:"msFullscreenEnabled",element:"msFullscreenElement",request:"msRequestFullscreen",exit:"msExitFullscreen",onchange:"MSFullscreenChange",onerror:"MSFullscreenError"}};for(var browser in APIs)if(APIs[browser].enabled in document){polyfill=APIs[browser];break}VG_UTILS.isiOSDevice()&&(polyfill=APIs.ios),this.isAvailable=null!=polyfill,polyfill&&(this.onchange=polyfill.onchange,this.onerror=polyfill.onerror,this.isFullScreen=function(){return element?null!=document[polyfill.element]||element.webkitDisplayingFullscreen:null!=document[polyfill.element]},this.exit=function(){document[polyfill.exit]()},this.request=function(elem){(element=elem)[polyfill.request]()})}]),angular.module("com.2fdevs.videogular").service("VG_UTILS",["$window",function($window){this.fixEventOffset=function($event){var matchedFF=navigator.userAgent.match(/Firefox\/(\d+)/i);if(matchedFF&&Number.parseInt(matchedFF.pop())<39){var style=$event.currentTarget.currentStyle||window.getComputedStyle($event.target,null),borderLeftWidth=parseInt(style.borderLeftWidth,10),borderTopWidth=parseInt(style.borderTopWidth,10),rect=$event.currentTarget.getBoundingClientRect(),offsetX=$event.clientX-borderLeftWidth-rect.left,offsetY=$event.clientY-borderTopWidth-rect.top;$event.offsetX=offsetX,$event.offsetY=offsetY}return $event},this.getZIndex=function(){for(var elementZIndex,zIndex=1,tags=document.getElementsByTagName("*"),i=0,l=tags.length;i<l;i++)zIndex<(elementZIndex=parseInt(window.getComputedStyle(tags[i])["z-index"]))&&(zIndex=elementZIndex+1);return zIndex},this.isMobileDevice=function(){return void 0!==window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")},this.isiOSDevice=function(){return navigator.userAgent.match(/ip(hone|ad|od)/i)&&!navigator.userAgent.match(/(iemobile)[\/\s]?([\w\.]*)/i)},this.isCordova=function(){return-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")},this.supportsLocalStorage=function(){try{var storage=$window.sessionStorage;return storage.setItem("videogular-test-key","1"),storage.removeItem("videogular-test-key"),"localStorage"in $window&&null!==$window.localStorage}catch(e){return!1}}}]),angular.module("com.2fdevs.videogular.plugins.overlayplay",[]).run(["$templateCache",function($templateCache){$templateCache.put("vg-templates/vg-overlay-play",'<div class="overlayPlayContainer" ng-click="onClickOverlayPlay()">                  <div class="iconButton" ng-class="overlayPlayIcon"></div>                </div>')}]).directive("vgOverlayPlay",["VG_STATES",function(VG_STATES){return{restrict:"E",require:"^videogular",scope:{},templateUrl:function(elem,attrs){return attrs.vgTemplate||"vg-templates/vg-overlay-play"},link:function(scope,elem,attr,API){scope.onChangeState=function(newState){switch(newState){case VG_STATES.PLAY:scope.overlayPlayIcon={play:!1,pause:!0};break;case VG_STATES.PAUSE:case VG_STATES.STOP:scope.overlayPlayIcon={play:!0,pause:!1}}},scope.onClickOverlayPlay=function(event){API.playPause()},scope.overlayPlayIcon={play:!0,pause:!1},scope.$watch(function(){return API.currentState},function(newVal,oldVal){scope.onChangeState(newVal)})}}}]),angular.module("com.2fdevs.videogular.plugins.controls",[]).run(["$templateCache",function($templateCache){$templateCache.put("vg-templates/vg-controls",'<div class="controls-container" ng-mousemove="onMouseMove()" ng-class="animationClass" ng-transclude></div>')}]).directive("vgControls",["$timeout","VG_STATES",function($timeout,VG_STATES){return{restrict:"E",require:"^videogular",transclude:!0,templateUrl:function(elem,attrs){return attrs.vgTemplate||"vg-templates/vg-controls"},scope:{vgAutohide:"=?",vgAutohideTime:"=?"},link:function(scope,elem,attr,API){var hideInterval,autoHideTime=2e3;scope.API=API,scope.onMouseMove=function(){scope.vgAutohide&&scope.showControls()},scope.setAutohide=function(value){value&&API.currentState==VG_STATES.PLAY?hideInterval=$timeout(scope.hideControls,autoHideTime):(scope.animationClass="",$timeout.cancel(hideInterval),scope.showControls())},scope.setAutohideTime=function(value){autoHideTime=value},scope.hideControls=function(){scope.animationClass="hide-animation"},scope.showControls=function(){scope.animationClass="show-animation",$timeout.cancel(hideInterval),scope.vgAutohide&&API.currentState==VG_STATES.PLAY&&(hideInterval=$timeout(scope.hideControls,autoHideTime))},API.isConfig?scope.$watch("API.config",function(){if(scope.API.config){var ahValue=scope.API.config.plugins.controls.autohide||!1,ahtValue=scope.API.config.plugins.controls.autohideTime||2e3;scope.vgAutohide=ahValue,scope.vgAutohideTime=ahtValue,scope.setAutohideTime(ahtValue),scope.setAutohide(ahValue)}}):(null!=scope.vgAutohide&&scope.$watch("vgAutohide",scope.setAutohide),null!=scope.vgAutohideTime&&scope.$watch("vgAutohideTime",scope.setAutohideTime)),scope.$watch(function(){return API.currentState},function(newVal,oldVal){scope.vgAutohide&&scope.showControls()})}}}]),angular.module("com.2fdevs.videogular.plugins.controls").run(["$templateCache",function($templateCache){$templateCache.put("vg-templates/vg-fullscreen-button",'<button class="iconButton" ng-click="onClickFullScreen()" ng-class="fullscreenIcon" aria-label="Toggle full screen" type="button"> </button>')}]).directive("vgFullscreenButton",[function(){return{restrict:"E",require:"^videogular",scope:{},templateUrl:function(elem,attrs){return attrs.vgTemplate||"vg-templates/vg-fullscreen-button"},link:function(scope,elem,attr,API){scope.onChangeFullScreen=function(isFullScreen){scope.fullscreenIcon={enter:!isFullScreen,exit:isFullScreen}},scope.onClickFullScreen=function(){API.toggleFullScreen()},scope.fullscreenIcon={enter:!0},scope.$watch(function(){return API.isFullScreen},function(newVal,oldVal){newVal!=oldVal&&scope.onChangeFullScreen(newVal)})}}}]),angular.module("com.2fdevs.videogular.plugins.controls").run(["$templateCache",function($templateCache){$templateCache.put("vg-templates/vg-play-pause-button",'<button class="iconButton" ng-click="onClickPlayPause()" ng-class="playPauseIcon" aria-label="Play/Pause" type="button"></button>')}]).directive("vgPlayPauseButton",["VG_STATES",function(VG_STATES){return{restrict:"E",require:"^videogular",scope:{},templateUrl:function(elem,attrs){return attrs.vgTemplate||"vg-templates/vg-play-pause-button"},link:function(scope,elem,attr,API){scope.setState=function(newState){switch(newState){case VG_STATES.PLAY:scope.playPauseIcon={pause:!0};break;case VG_STATES.PAUSE:case VG_STATES.STOP:scope.playPauseIcon={play:!0}}},scope.onClickPlayPause=function(){API.playPause()},scope.playPauseIcon={play:!0},scope.$watch(function(){return API.currentState},function(newVal,oldVal){scope.setState(newVal)})}}}]),angular.module("com.2fdevs.videogular.plugins.controls").run(["$templateCache",function($templateCache){$templateCache.put("vg-templates/vg-playback-button",'<button class="playbackValue iconButton" ng-click="onClickPlayback()">{{playback}}x</button>')}]).directive("vgPlaybackButton",[function(){return{restrict:"E",require:"^videogular",templateUrl:function(elem,attrs){return attrs.vgTemplate||"vg-templates/vg-playback-button"},scope:{vgSpeeds:"=?"},link:function(scope,elem,attr,API){scope.playback="1",scope.setPlayback=function(playback){scope.playback=playback,API.setPlayback(parseFloat(playback))},scope.onClickPlayback=function(){var playbackOptions=scope.vgSpeeds||["0.5","1","1.5","2"],nextPlaybackRate=playbackOptions.indexOf(scope.playback.toString())+1;nextPlaybackRate>=playbackOptions.length?scope.playback=playbackOptions[0]:scope.playback=playbackOptions[nextPlaybackRate],scope.setPlayback(scope.playback)},scope.$watch(function(){return API.playback},function(newVal,oldVal){newVal!=oldVal&&scope.setPlayback(newVal)})}}}]),angular.module("com.2fdevs.videogular.plugins.controls").run(["$templateCache",function($templateCache){$templateCache.put("vg-templates/vg-scrub-bar",'<div role="slider" aria-valuemax="{{ariaTime(API.totalTime)}}" aria-valuenow="{{ariaTime(API.currentTime)}}" aria-valuemin="0" aria-label="Time scrub bar" tabindex="0" ng-keydown="onScrubBarKeyDown($event)"></div><div class="container" ng-transclude></div>')}]).directive("vgScrubBar",["VG_STATES","VG_UTILS",function(VG_STATES,VG_UTILS){return{restrict:"E",require:"^videogular",transclude:!0,templateUrl:function(elem,attrs){return attrs.vgTemplate||"vg-templates/vg-scrub-bar"},scope:{vgThumbnails:"="},link:function(scope,elem,attr,API){var isSeeking=!1,isPlaying=!1,isPlayingWhenSeeking=!1,thumbnailsWidth=0,thumbWidth=0,slider=elem[0].querySelector("div[role=slider]");if(scope.thumbnails=!1,scope.thumbnailContainer={},scope.API=API,scope.onLoadThumbnails=function(event){thumbnailsWidth=event.path[0].naturalWidth,thumbWidth=thumbnailsWidth/100},scope.ariaTime=function(time){return Math.round(time/1e3)},scope.getOffset=function(event){for(var el=event.target,x=0;el&&!isNaN(el.offsetLeft);)x+=el.offsetLeft-el.scrollLeft,el=el.offsetParent;return event.clientX-x},scope.onScrubBarTouchStart=function($event){var touches=($event.originalEvent||$event).touches,touchX=scope.getOffset(touches[0]);isSeeking=!0,isPlaying&&(isPlayingWhenSeeking=!0),API.pause(),API.seekTime(touchX*API.mediaElement[0].duration/slider.scrollWidth),scope.$digest()},scope.onScrubBarTouchEnd=function($event){$event.originalEvent;isPlayingWhenSeeking&&(isPlayingWhenSeeking=!1,API.play()),isSeeking=!1,scope.$digest()},scope.onScrubBarTouchMove=function($event){var touches=($event.originalEvent||$event).touches,touchX=scope.getOffset(touches[0]);if(scope.vgThumbnails&&scope.vgThumbnails.length){var second=Math.round(touchX*API.mediaElement[0].duration/slider.scrollWidth),percentage=Math.round(100*second/(API.totalTime/1e3));scope.updateThumbnails(percentage)}isSeeking&&API.seekTime(touchX*API.mediaElement[0].duration/slider.scrollWidth),scope.$digest()},scope.onScrubBarTouchLeave=function(event){isSeeking=!1,scope.thumbnails=!1,scope.$digest()},scope.onScrubBarMouseDown=function(event){event=VG_UTILS.fixEventOffset(event),isSeeking=!0,isPlaying&&(isPlayingWhenSeeking=!0),API.pause(),API.seekTime(event.offsetX*API.mediaElement[0].duration/slider.scrollWidth),scope.$digest()},scope.onScrubBarMouseUp=function(event){isPlayingWhenSeeking&&(isPlayingWhenSeeking=!1,API.play()),isSeeking=!1,scope.$digest()},scope.onScrubBarMouseMove=function(event){if(scope.vgThumbnails&&scope.vgThumbnails.length){var second=Math.round(event.offsetX*API.mediaElement[0].duration/slider.scrollWidth),percentage=Math.round(100*second/(API.totalTime/1e3));scope.updateThumbnails(percentage)}isSeeking&&(event=VG_UTILS.fixEventOffset(event),API.seekTime(event.offsetX*API.mediaElement[0].duration/slider.scrollWidth)),scope.$digest()},scope.onScrubBarMouseLeave=function(event){isSeeking=!1,scope.thumbnails=!1,scope.$digest()},scope.onScrubBarKeyDown=function(event){var currentPercent=API.currentTime/API.totalTime*100;37===event.which||37===event.keyCode?(API.seekTime(currentPercent-5,!0),event.preventDefault()):39!==event.which&&39!==event.keyCode||(API.seekTime(currentPercent+5,!0),event.preventDefault())},scope.updateThumbnails=function(percentage){var bgPos=Math.round(thumbnailsWidth*percentage/100),thPos=slider.scrollWidth*percentage/100-thumbWidth/2;scope.thumbnailContainer={width:thumbWidth+"px",left:thPos+"px"},scope.thumbnails={"background-image":'url("'+scope.vgThumbnails+'")',"background-position":-bgPos+"px 0px"}},scope.setState=function(newState){if(!isSeeking)switch(newState){case VG_STATES.PLAY:isPlaying=!0;break;case VG_STATES.PAUSE:case VG_STATES.STOP:isPlaying=!1}},scope.onDestroy=function(){elem.unbind("touchstart",scope.onScrubBarTouchStart),elem.unbind("touchend",scope.onScrubBarTouchEnd),elem.unbind("touchmove",scope.onScrubBarTouchMove),elem.unbind("touchleave",scope.onScrubBarTouchLeave),elem.unbind("mousedown",scope.onScrubBarMouseDown),elem.unbind("mouseup",scope.onScrubBarMouseUp),elem.unbind("mousemove",scope.onScrubBarMouseMove),elem.unbind("mouseleave",scope.onScrubBarMouseLeave)},scope.$watch(function(){return API.currentState},function(newVal,oldVal){newVal!=oldVal&&scope.setState(newVal)}),scope.vgThumbnails){var thLoader=new Image;thLoader.onload=scope.onLoadThumbnails.bind(scope),thLoader.src=scope.vgThumbnails}VG_UTILS.isMobileDevice()?(elem.bind("touchstart",scope.onScrubBarTouchStart),elem.bind("touchend",scope.onScrubBarTouchEnd),elem.bind("touchmove",scope.onScrubBarTouchMove),elem.bind("touchleave",scope.onScrubBarTouchLeave)):(elem.bind("mousedown",scope.onScrubBarMouseDown),elem.bind("mouseup",scope.onScrubBarMouseUp),elem.bind("mousemove",scope.onScrubBarMouseMove),elem.bind("mouseleave",scope.onScrubBarMouseLeave)),scope.$on("destroy",scope.onDestroy.bind(scope))}}}]),angular.module("com.2fdevs.videogular.plugins.controls").directive("vgScrubBarCurrentTime",[function(){return{restrict:"E",require:"^videogular",link:function(scope,elem,attr,API){var percentTime=0;scope.onUpdateTime=function(newCurrentTime){"number"==typeof newCurrentTime&&API.totalTime?(percentTime=newCurrentTime/API.totalTime*100,elem.css("width",percentTime+"%")):elem.css("width",0)},scope.$watch(function(){return API.currentTime},function(newVal,oldVal){scope.onUpdateTime(newVal)})}}}]),angular.module("com.2fdevs.videogular.plugins.controls").directive("vgScrubBarBuffer",[function(){return{restrict:"E",require:"^videogular",link:function(scope,elem,attr,API){var percentTime=0;scope.onUpdateBuffer=function(newBuffer){"number"==typeof newBuffer&&API.totalTime?(percentTime=newBuffer/API.totalTime*100,elem.css("width",percentTime+"%")):elem.css("width",0)},scope.$watch(function(){return API.bufferEnd},function(newVal,oldVal){scope.onUpdateBuffer(newVal)})}}}]),angular.module("com.2fdevs.videogular.plugins.controls").directive("vgTimeDisplay",[function(){return{require:"^videogular",restrict:"E",link:function(scope,elem,attr,API){scope.currentTime=API.currentTime,scope.timeLeft=API.timeLeft,scope.totalTime=API.totalTime,scope.isLive=API.isLive,scope.$watch(function(){return API.currentTime},function(newVal,oldVal){scope.currentTime=newVal}),scope.$watch(function(){return API.timeLeft},function(newVal,oldVal){scope.timeLeft=newVal}),scope.$watch(function(){return API.totalTime},function(newVal,oldVal){scope.totalTime=newVal}),scope.$watch(function(){return API.isLive},function(newVal,oldVal){scope.isLive=newVal})}}}]),angular.module("com.2fdevs.videogular.plugins.controls").directive("vgVolume",["VG_UTILS",function(VG_UTILS){return{restrict:"E",link:function(scope,elem,attr){scope.onMouseOverVolume=function(){scope.$evalAsync(function(){scope.volumeVisibility="visible"})},scope.onMouseLeaveVolume=function(){scope.$evalAsync(function(){scope.volumeVisibility="hidden"})},scope.onDestroy=function(){elem.unbind("mouseover",scope.onScrubBarTouchStart),elem.unbind("mouseleave",scope.onScrubBarTouchEnd)},VG_UTILS.isMobileDevice()?elem.css("display","none"):(scope.volumeVisibility="hidden",elem.bind("mouseover",scope.onMouseOverVolume),elem.bind("mouseleave",scope.onMouseLeaveVolume)),scope.$on("destroy",scope.onDestroy.bind(scope))}}}]),angular.module("com.2fdevs.videogular.plugins.controls").run(["$templateCache",function($templateCache){$templateCache.put("vg-templates/vg-volume-bar",'<div class="verticalVolumeBar">              <div class="volumeBackground" ng-click="onClickVolume($event)" ng-mousedown="onMouseDownVolume()" ng-mouseup="onMouseUpVolume()" ng-mousemove="onMouseMoveVolume($event)" ng-mouseleave="onMouseLeaveVolume()">                <div class="volumeValue"></div>                <div class="volumeClickArea"></div>              </div>            </div>')}]).directive("vgVolumeBar",["VG_UTILS",function(VG_UTILS){return{restrict:"E",require:"^videogular",templateUrl:function(elem,attrs){return attrs.vgTemplate||"vg-templates/vg-volume-bar"},link:function(scope,elem,attr,API){var isChangingVolume=!1,volumeBackElem=angular.element(elem[0].getElementsByClassName("volumeBackground")),volumeValueElem=angular.element(elem[0].getElementsByClassName("volumeValue"));scope.onClickVolume=function(event){event=VG_UTILS.fixEventOffset(event);var volumeHeight=parseInt(volumeBackElem.prop("offsetHeight")),volValue=1-100*event.offsetY/volumeHeight/100;API.setVolume(volValue)},scope.onMouseDownVolume=function(){isChangingVolume=!0},scope.onMouseUpVolume=function(){isChangingVolume=!1},scope.onMouseLeaveVolume=function(){isChangingVolume=!1},scope.onMouseMoveVolume=function(event){if(isChangingVolume){event=VG_UTILS.fixEventOffset(event);var volumeHeight=parseInt(volumeBackElem.prop("offsetHeight")),volValue=1-100*event.offsetY/volumeHeight/100;API.setVolume(volValue)}},scope.updateVolumeView=function(value){value*=100,volumeValueElem.css("height",value+"%"),volumeValueElem.css("top",100-value+"%")},scope.onChangeVisibility=function(value){elem.css("visibility",value)},elem.css("visibility",scope.volumeVisibility),scope.$watch("volumeVisibility",scope.onChangeVisibility),scope.updateVolumeView(API.volume),scope.$watch(function(){return API.volume},function(newVal,oldVal){newVal!=oldVal&&scope.updateVolumeView(newVal)})}}}]),angular.module("com.2fdevs.videogular.plugins.controls").run(["$templateCache",function($templateCache){$templateCache.put("vg-templates/vg-mute-button",'<button type="button" class="iconButton" ng-class="muteIcon" ng-click="onClickMute()" ng-focus="onMuteButtonFocus()" ng-blur="onMuteButtonLoseFocus()" ng-mouseleave="onMuteButtonLeave()" ng-keydown="onMuteButtonKeyDown($event)" aria-label="Mute"></button>')}]).directive("vgMuteButton",[function(){return{restrict:"E",require:"^videogular",templateUrl:function(elem,attrs){return attrs.vgTemplate||"vg-templates/vg-mute-button"},link:function(scope,elem,attr,API){var isMuted=!1;scope.onClickMute=function(){isMuted?scope.currentVolume=scope.defaultVolume:(scope.currentVolume=0,scope.muteIcon={mute:!0}),isMuted=!isMuted,API.setVolume(scope.currentVolume)},scope.onMuteButtonFocus=function(){scope.volumeVisibility="visible"},scope.onMuteButtonLoseFocus=function(){scope.volumeVisibility="hidden"},scope.onMuteButtonLeave=function(){document.activeElement.blur()},scope.onMuteButtonKeyDown=function(event){var newVolume,currentVolume=null!=API.volume?API.volume:1;38===event.which||38===event.keyCode?(1<(newVolume=currentVolume+.05)&&(newVolume=1),API.setVolume(newVolume),event.preventDefault()):40!==event.which&&40!==event.keyCode||((newVolume=currentVolume-.05)<0&&(newVolume=0),API.setVolume(newVolume),event.preventDefault())},scope.onSetVolume=function(newVolume){scope.currentVolume=newVolume,(isMuted=0===scope.currentVolume)?0<newVolume&&(scope.defaultVolume=newVolume):scope.defaultVolume=newVolume;var percentValue=Math.round(100*newVolume);0==percentValue?scope.muteIcon={mute:!0}:0<percentValue&&percentValue<25?scope.muteIcon={level0:!0}:25<=percentValue&&percentValue<50?scope.muteIcon={level1:!0}:50<=percentValue&&percentValue<75?scope.muteIcon={level2:!0}:75<=percentValue&&(scope.muteIcon={level3:!0})},scope.defaultVolume=1,scope.currentVolume=scope.defaultVolume,scope.muteIcon={level3:!0},scope.onSetVolume(API.volume),scope.$watch(function(){return API.volume},function(newVal,oldVal){newVal!=oldVal&&scope.onSetVolume(newVal)})}}}]),angular.module("com.2fdevs.videogular.plugins.poster",[]).run(["$templateCache",function($templateCache){$templateCache.put("vg-templates/vg-poster",'<img ng-src="{{vgUrl}}" ng-class="API.currentState" role="presentation" alt="">')}]).directive("vgPoster",[function(){return{restrict:"E",require:"^videogular",scope:{vgUrl:"=?"},templateUrl:function(elem,attrs){return attrs.vgTemplate||"vg-templates/vg-poster"},link:function(scope,elem,attr,API){(scope.API=API).isConfig&&scope.$watch("API.config",function(){scope.API.config&&(scope.vgUrl=scope.API.config.plugins.poster.url)})}}}]),angular.module("videogular.texttrack",[]).directive("vgText",[function(){return{require:"^videogular",restrict:"E",scope:{textTracks:"=vgTextSrc"},template:'<span class=""></span><ul ng-show="selectorVisibility"><li ng-click="changeCaption()">Off</li><li ng-repeat="track in textTracks" ng-click="changeCaption(track)">{{track.label}}</li></ul>',controller:["$scope",function($scope){function setTrackHidden(track){return track.default=!1,track}function setTracksHidden(textTracks){textTracks.forEach(setTrackHidden)}$scope.changeCaption=function(selectedTextTrack){selectedTextTrack?function(textTracks,selectedTextTrack){setTracksHidden(textTracks),track=function(textTracks,selectedTextTrack){return _.find(textTracks,function(v){return v.srclang===selectedTextTrack.srclang})}(textTracks,selectedTextTrack),track.default=!0;var track}($scope.textTracks,selectedTextTrack):setTracksHidden($scope.textTracks)}}],link:function(scope,elem,attr,API){elem.bind("mouseover",function(){scope.selectorVisibility=!0,scope.$apply()}),elem.bind("mouseleave",function(){scope.selectorVisibility=!1,scope.$apply()}),scope.$watch("textTracks",function(newValue,oldValue){oldValue&&newValue==oldValue||elem.css("display",newValue?"table-cell":"none")})}}}]),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if((b=a.event.fix(g)).type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(j=m=-1*g.deltaY),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||n<f)&&(d(g,f=n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[1<=j?"floor":"ceil"](j/f),l=Math[1<=l?"floor":"ceil"](l/f),m=Math[1<=m?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120==0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var g=b||window.event,h=i.call(arguments,1),j=0,l=0,m=0,n=0,o=0,p=0;if((b=a.event.fix(g)).type="mousewheel","detail"in g&&(m=-1*g.detail),"wheelDelta"in g&&(m=g.wheelDelta),"wheelDeltaY"in g&&(m=g.wheelDeltaY),"wheelDeltaX"in g&&(l=-1*g.wheelDeltaX),"axis"in g&&g.axis===g.HORIZONTAL_AXIS&&(l=-1*m,m=0),j=0===m?l:m,"deltaY"in g&&(j=m=-1*g.deltaY),"deltaX"in g&&(l=g.deltaX,0===m&&(j=-1*l)),0!==m||0!==l){if(1===g.deltaMode){var q=a.data(this,"mousewheel-line-height");j*=q,m*=q,l*=q}else if(2===g.deltaMode){var r=a.data(this,"mousewheel-page-height");j*=r,m*=r,l*=r}if(n=Math.max(Math.abs(m),Math.abs(l)),(!f||n<f)&&(d(g,f=n)&&(f/=40)),d(g,n)&&(j/=40,l/=40,m/=40),j=Math[1<=j?"floor":"ceil"](j/f),l=Math[1<=l?"floor":"ceil"](l/f),m=Math[1<=m?"floor":"ceil"](m/f),k.settings.normalizeOffset&&this.getBoundingClientRect){var s=this.getBoundingClientRect();o=b.clientX-s.left,p=b.clientY-s.top}return b.deltaX=l,b.deltaY=m,b.deltaFactor=f,b.offsetX=o,b.offsetY=p,b.deltaMode=0,h.unshift(b,j,l,m),e&&clearTimeout(e),e=setTimeout(c,200),(a.event.dispatch||a.event.handle).apply(this,h)}}function c(){f=null}function d(a,b){return k.settings.adjustOldDeltas&&"mousewheel"===a.type&&b%120==0}var e,f,g=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],h="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],i=Array.prototype.slice;if(a.event.fixHooks)for(var j=g.length;j;)a.event.fixHooks[g[--j]]=a.event.mouseHooks;var k=a.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var c=h.length;c;)this.addEventListener(h[--c],b,!1);else this.onmousewheel=b;a.data(this,"mousewheel-line-height",k.getLineHeight(this)),a.data(this,"mousewheel-page-height",k.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var c=h.length;c;)this.removeEventListener(h[--c],b,!1);else this.onmousewheel=null;a.removeData(this,"mousewheel-line-height"),a.removeData(this,"mousewheel-page-height")},getLineHeight:function(b){var c=a(b),d=c["offsetParent"in a.fn?"offsetParent":"parent"]();return d.length||(d=a("body")),parseInt(d.css("fontSize"),10)||parseInt(c.css("fontSize"),10)||16},getPageHeight:function(b){return a(b).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e:e(jQuery,window,document)}(function(e){var o,a,n;o="function"==typeof define&&define.amd,a="undefined"!=typeof module&&module.exports,n="https:"==document.location.protocol?"https:":"http:",o||(a?require("jquery-mousewheel")(e):e.event.special.mousewheel||e("head").append(decodeURI("%3Cscript src="+n+"//cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.1.13/jquery.mousewheel.min.js%3E%3C/script%3E"))),function(){var t,o="mCustomScrollbar",a="mCS",n=".mCustomScrollbar",i={setTop:0,setLeft:0,axis:"y",scrollbarPosition:"inside",scrollInertia:950,autoDraggerLength:!0,alwaysShowScrollbar:0,snapOffset:0,mouseWheel:{enable:!0,scrollAmount:"auto",axis:"y",deltaFactor:"auto",disableOver:["select","option","keygen","datalist","textarea"]},scrollButtons:{scrollType:"stepless",scrollAmount:"auto"},keyboard:{enable:!0,scrollType:"stepless",scrollAmount:"auto"},contentTouchScroll:25,documentTouchScroll:!0,advanced:{autoScrollOnFocus:"input,textarea,select,button,datalist,keygen,a[tabindex],area,object,[contenteditable='true']",updateOnContentResize:!0,updateOnImageLoad:"auto",autoUpdateTimeout:60},theme:"light",callbacks:{onTotalScrollOffset:0,onTotalScrollBackOffset:0,alwaysTriggerOffsets:!0}},r=0,l={},s=window.attachEvent&&!window.addEventListener?1:0,c=!1,d=["mCSB_dragger_onDrag","mCSB_scrollTools_onDrag","mCS_img_loaded","mCS_disabled","mCS_destroyed","mCS_no_scrollbar","mCS-autoHide","mCS-dir-rtl","mCS_no_scrollbar_y","mCS_no_scrollbar_x","mCS_y_hidden","mCS_x_hidden","mCSB_draggerContainer","mCSB_buttonUp","mCSB_buttonDown","mCSB_buttonLeft","mCSB_buttonRight"],u={init:function(t){var t=e.extend(!0,{},i,t),o=f.call(this);if(t.live){var s=t.liveSelector||this.selector||n,c=e(s);if("off"===t.live)return void m(s);l[s]=setTimeout(function(){c.mCustomScrollbar(t),"once"===t.live&&c.length&&m(s)},500)}else m(s);return t.setWidth=t.set_width?t.set_width:t.setWidth,t.setHeight=t.set_height?t.set_height:t.setHeight,t.axis=t.horizontalScroll?"x":p(t.axis),t.scrollInertia=0<t.scrollInertia&&t.scrollInertia<17?17:t.scrollInertia,"object"!=typeof t.mouseWheel&&1==t.mouseWheel&&(t.mouseWheel={enable:!0,scrollAmount:"auto",axis:"y",preventDefault:!1,deltaFactor:"auto",normalizeDelta:!1,invert:!1}),t.mouseWheel.scrollAmount=t.mouseWheelPixels?t.mouseWheelPixels:t.mouseWheel.scrollAmount,t.mouseWheel.normalizeDelta=t.advanced.normalizeMouseWheelDelta?t.advanced.normalizeMouseWheelDelta:t.mouseWheel.normalizeDelta,t.scrollButtons.scrollType=g(t.scrollButtons.scrollType),h(t),e(o).each(function(){var o=e(this);if(!o.data(a)){o.data(a,{idx:++r,opt:t,scrollRatio:{y:null,x:null},overflowed:null,contentReset:{y:null,x:null},bindEvents:!1,tweenRunning:!1,sequential:{},langDir:o.css("direction"),cbOffsets:null,trigger:null,poll:{size:{o:0,n:0},img:{o:0,n:0},change:{o:0,n:0}}});var n=o.data(a),i=n.opt,l=o.data("mcs-axis"),s=o.data("mcs-scrollbar-position"),c=o.data("mcs-theme");l&&(i.axis=l),s&&(i.scrollbarPosition=s),c&&(i.theme=c,h(i)),v.call(this),n&&i.callbacks.onCreate&&"function"==typeof i.callbacks.onCreate&&i.callbacks.onCreate.call(this),e("#mCSB_"+n.idx+"_container img:not(."+d[2]+")").addClass(d[2]),u.update.call(null,o)}})},update:function(t,o){var n=t||f.call(this);return e(n).each(function(){var t=e(this);if(t.data(a)){var n=t.data(a),i=n.opt,r=e("#mCSB_"+n.idx+"_container"),l=e("#mCSB_"+n.idx),s=[e("#mCSB_"+n.idx+"_dragger_vertical"),e("#mCSB_"+n.idx+"_dragger_horizontal")];if(!r.length)return;n.tweenRunning&&Q(t),o&&n&&i.callbacks.onBeforeUpdate&&"function"==typeof i.callbacks.onBeforeUpdate&&i.callbacks.onBeforeUpdate.call(this),t.hasClass(d[3])&&t.removeClass(d[3]),t.hasClass(d[4])&&t.removeClass(d[4]),l.css("max-height","none"),l.height()!==t.height()&&l.css("max-height",t.height()),_.call(this),"y"===i.axis||i.advanced.autoExpandHorizontalScroll||r.css("width",x(r)),n.overflowed=y.call(this),M.call(this),i.autoDraggerLength&&S.call(this),b.call(this),T.call(this);var c=[Math.abs(r[0].offsetTop),Math.abs(r[0].offsetLeft)];"x"!==i.axis&&(n.overflowed[0]?s[0].height()>s[0].parent().height()?B.call(this):(G(t,c[0].toString(),{dir:"y",dur:0,overwrite:"none"}),n.contentReset.y=null):(B.call(this),"y"===i.axis?k.call(this):"yx"===i.axis&&n.overflowed[1]&&G(t,c[1].toString(),{dir:"x",dur:0,overwrite:"none"}))),"y"!==i.axis&&(n.overflowed[1]?s[1].width()>s[1].parent().width()?B.call(this):(G(t,c[1].toString(),{dir:"x",dur:0,overwrite:"none"}),n.contentReset.x=null):(B.call(this),"x"===i.axis?k.call(this):"yx"===i.axis&&n.overflowed[0]&&G(t,c[0].toString(),{dir:"y",dur:0,overwrite:"none"}))),o&&n&&(2===o&&i.callbacks.onImageLoad&&"function"==typeof i.callbacks.onImageLoad?i.callbacks.onImageLoad.call(this):3===o&&i.callbacks.onSelectorChange&&"function"==typeof i.callbacks.onSelectorChange?i.callbacks.onSelectorChange.call(this):i.callbacks.onUpdate&&"function"==typeof i.callbacks.onUpdate&&i.callbacks.onUpdate.call(this)),N.call(this)}})},scrollTo:function(t,o){if(void 0!==t&&null!=t){var n=f.call(this);return e(n).each(function(){var n=e(this);if(n.data(a)){var i=n.data(a),r=i.opt,l={trigger:"external",scrollInertia:r.scrollInertia,scrollEasing:"mcsEaseInOut",moveDragger:!1,timeout:60,callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},s=e.extend(!0,{},l,o),c=Y.call(this,t),d=0<s.scrollInertia&&s.scrollInertia<17?17:s.scrollInertia;c[0]=X.call(this,c[0],"y"),c[1]=X.call(this,c[1],"x"),s.moveDragger&&(c[0]*=i.scrollRatio.y,c[1]*=i.scrollRatio.x),s.dur=ne()?0:d,setTimeout(function(){null!==c[0]&&void 0!==c[0]&&"x"!==r.axis&&i.overflowed[0]&&(s.dir="y",s.overwrite="all",G(n,c[0].toString(),s)),null!==c[1]&&void 0!==c[1]&&"y"!==r.axis&&i.overflowed[1]&&(s.dir="x",s.overwrite="none",G(n,c[1].toString(),s))},s.timeout)}})}},stop:function(){var t=f.call(this);return e(t).each(function(){var t=e(this);t.data(a)&&Q(t)})},disable:function(t){var o=f.call(this);return e(o).each(function(){var o=e(this);o.data(a)&&(o.data(a),N.call(this,"remove"),k.call(this),t&&B.call(this),M.call(this,!0),o.addClass(d[3]))})},destroy:function(){var t=f.call(this);return e(t).each(function(){var n=e(this);if(n.data(a)){var i=n.data(a),r=i.opt,l=e("#mCSB_"+i.idx),s=e("#mCSB_"+i.idx+"_container"),c=e(".mCSB_"+i.idx+"_scrollbar");r.live&&m(r.liveSelector||e(t).selector),N.call(this,"remove"),k.call(this),B.call(this),n.removeData(a),$(this,"mcs"),c.remove(),s.find("img."+d[2]).removeClass(d[2]),l.replaceWith(s.contents()),n.removeClass(o+" _"+a+"_"+i.idx+" "+d[6]+" "+d[7]+" "+d[5]+" "+d[3]).addClass(d[4])}})}},f=function(){return"object"!=typeof e(this)||e(this).length<1?n:this},h=function(t){t.autoDraggerLength=!(-1<e.inArray(t.theme,["rounded","rounded-dark","rounded-dots","rounded-dots-dark"]))&&t.autoDraggerLength,t.autoExpandScrollbar=!(-1<e.inArray(t.theme,["rounded-dots","rounded-dots-dark","3d","3d-dark","3d-thick","3d-thick-dark","inset","inset-dark","inset-2","inset-2-dark","inset-3","inset-3-dark"]))&&t.autoExpandScrollbar,t.scrollButtons.enable=!(-1<e.inArray(t.theme,["minimal","minimal-dark"]))&&t.scrollButtons.enable,t.autoHideScrollbar=-1<e.inArray(t.theme,["minimal","minimal-dark"])||t.autoHideScrollbar,t.scrollbarPosition=-1<e.inArray(t.theme,["minimal","minimal-dark"])?"outside":t.scrollbarPosition},m=function(e){l[e]&&(clearTimeout(l[e]),$(l,e))},p=function(e){return"yx"===e||"xy"===e||"auto"===e?"yx":"x"===e||"horizontal"===e?"x":"y"},g=function(e){return"stepped"===e||"pixels"===e||"step"===e||"click"===e?"stepped":"stepless"},v=function(){var t=e(this),n=t.data(a),i=n.opt,r=i.autoExpandScrollbar?" "+d[1]+"_expand":"",l=["<div id='mCSB_"+n.idx+"_scrollbar_vertical' class='mCSB_scrollTools mCSB_"+n.idx+"_scrollbar mCS-"+i.theme+" mCSB_scrollTools_vertical"+r+"'><div class='"+d[12]+"'><div id='mCSB_"+n.idx+"_dragger_vertical' class='mCSB_dragger' style='position:absolute;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>","<div id='mCSB_"+n.idx+"_scrollbar_horizontal' class='mCSB_scrollTools mCSB_"+n.idx+"_scrollbar mCS-"+i.theme+" mCSB_scrollTools_horizontal"+r+"'><div class='"+d[12]+"'><div id='mCSB_"+n.idx+"_dragger_horizontal' class='mCSB_dragger' style='position:absolute;'><div class='mCSB_dragger_bar' /></div><div class='mCSB_draggerRail' /></div></div>"],s="yx"===i.axis?"mCSB_vertical_horizontal":"x"===i.axis?"mCSB_horizontal":"mCSB_vertical",c="yx"===i.axis?l[0]+l[1]:"x"===i.axis?l[1]:l[0],u="yx"===i.axis?"<div id='mCSB_"+n.idx+"_container_wrapper' class='mCSB_container_wrapper' />":"",f=i.autoHideScrollbar?" "+d[6]:"",h="x"!==i.axis&&"rtl"===n.langDir?" "+d[7]:"";i.setWidth&&t.css("width",i.setWidth),i.setHeight&&t.css("height",i.setHeight),i.setLeft="y"!==i.axis&&"rtl"===n.langDir?"989999px":i.setLeft,t.addClass(o+" _"+a+"_"+n.idx+f+h).wrapInner("<div id='mCSB_"+n.idx+"' class='mCustomScrollBox mCS-"+i.theme+" "+s+"'><div id='mCSB_"+n.idx+"_container' class='mCSB_container' style='position:relative; top:"+i.setTop+"; left:"+i.setLeft+";' dir='"+n.langDir+"' /></div>");var m=e("#mCSB_"+n.idx),p=e("#mCSB_"+n.idx+"_container");"y"===i.axis||i.advanced.autoExpandHorizontalScroll||p.css("width",x(p)),"outside"===i.scrollbarPosition?("static"===t.css("position")&&t.css("position","relative"),t.css("overflow","visible"),m.addClass("mCSB_outside").after(c)):(m.addClass("mCSB_inside").append(c),p.wrap(u)),w.call(this);var g=[e("#mCSB_"+n.idx+"_dragger_vertical"),e("#mCSB_"+n.idx+"_dragger_horizontal")];g[0].css("min-height",g[0].height()),g[1].css("min-width",g[1].width())},x=function(t){var o=[t[0].scrollWidth,Math.max.apply(Math,t.children().map(function(){return e(this).outerWidth(!0)}).get())],a=t.parent().width();return a<o[0]?o[0]:a<o[1]?o[1]:"100%"},_=function(){var t=e(this),o=t.data(a),n=o.opt,i=e("#mCSB_"+o.idx+"_container");if(n.advanced.autoExpandHorizontalScroll&&"y"!==n.axis){i.css({width:"auto","min-width":0,"overflow-x":"scroll"});var r=Math.ceil(i[0].scrollWidth);3===n.advanced.autoExpandHorizontalScroll||2!==n.advanced.autoExpandHorizontalScroll&&r>i.parent().width()?i.css({width:r,"min-width":"100%","overflow-x":"inherit"}):i.css({"overflow-x":"inherit",position:"absolute"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:Math.ceil(i[0].getBoundingClientRect().right+.4)-Math.floor(i[0].getBoundingClientRect().left),"min-width":"100%",position:"relative"}).unwrap()}},w=function(){var t=e(this),o=t.data(a),n=o.opt,i=e(".mCSB_"+o.idx+"_scrollbar:first"),r=oe(n.scrollButtons.tabindex)?"tabindex='"+n.scrollButtons.tabindex+"'":"",l=["<a href='#' class='"+d[13]+"' "+r+" />","<a href='#' class='"+d[14]+"' "+r+" />","<a href='#' class='"+d[15]+"' "+r+" />","<a href='#' class='"+d[16]+"' "+r+" />"],s=["x"===n.axis?l[2]:l[0],"x"===n.axis?l[3]:l[1],l[2],l[3]];n.scrollButtons.enable&&i.prepend(s[0]).append(s[1]).next(".mCSB_scrollTools").prepend(s[2]).append(s[3])},S=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=e("#mCSB_"+o.idx+"_container"),r=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")],l=[n.height()/i.outerHeight(!1),n.width()/i.outerWidth(!1)],c=[parseInt(r[0].css("min-height")),Math.round(l[0]*r[0].parent().height()),parseInt(r[1].css("min-width")),Math.round(l[1]*r[1].parent().width())],d=s&&c[1]<c[0]?c[0]:c[1],u=s&&c[3]<c[2]?c[2]:c[3];r[0].css({height:d,"max-height":r[0].parent().height()-10}).find(".mCSB_dragger_bar").css({"line-height":c[0]+"px"}),r[1].css({width:u,"max-width":r[1].parent().width()-10})},b=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=e("#mCSB_"+o.idx+"_container"),r=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")],l=[i.outerHeight(!1)-n.height(),i.outerWidth(!1)-n.width()],s=[l[0]/(r[0].parent().height()-r[0].height()),l[1]/(r[1].parent().width()-r[1].width())];o.scrollRatio={y:s[0],x:s[1]}},C=function(e,t,o){var a=o?d[0]+"_expanded":"",n=e.closest(".mCSB_scrollTools");"active"===t?(e.toggleClass(d[0]+" "+a),n.toggleClass(d[1]),e[0]._draggable=e[0]._draggable?0:1):e[0]._draggable||("hide"===t?(e.removeClass(d[0]),n.removeClass(d[1])):(e.addClass(d[0]),n.addClass(d[1])))},y=function(){var t=e(this),o=t.data(a),n=e("#mCSB_"+o.idx),i=e("#mCSB_"+o.idx+"_container"),r=null==o.overflowed?i.height():i.outerHeight(!1),l=null==o.overflowed?i.width():i.outerWidth(!1),s=i[0].scrollHeight,c=i[0].scrollWidth;return r<s&&(r=s),l<c&&(l=c),[r>n.height(),l>n.width()]},B=function(){var t=e(this),o=t.data(a),n=o.opt,i=e("#mCSB_"+o.idx),r=e("#mCSB_"+o.idx+"_container"),l=[e("#mCSB_"+o.idx+"_dragger_vertical"),e("#mCSB_"+o.idx+"_dragger_horizontal")];if(Q(t),("x"!==n.axis&&!o.overflowed[0]||"y"===n.axis&&o.overflowed[0])&&(l[0].add(r).css("top",0),G(t,"_resetY")),"y"!==n.axis&&!o.overflowed[1]||"x"===n.axis&&o.overflowed[1]){var s=dx=0;"rtl"===o.langDir&&(s=i.width()-r.outerWidth(!1),dx=Math.abs(s/o.scrollRatio.x)),r.css("left",s),l[1].css("left",dx),G(t,"_resetX")}},T=function(){var r,o=e(this),n=o.data(a),i=n.opt;n.bindEvents||(I.call(this),i.contentTouchScroll&&D.call(this),E.call(this),i.mouseWheel.enable&&function t(){r=setTimeout(function(){e.event.special.mousewheel?(clearTimeout(r),W.call(o[0])):t()},100)}(),P.call(this),U.call(this),i.advanced.autoScrollOnFocus&&H.call(this),i.scrollButtons.enable&&F.call(this),i.keyboard.enable&&q.call(this),n.bindEvents=!0)},k=function(){var t=e(this),o=t.data(a),n=o.opt,i=a+"_"+o.idx,r=".mCSB_"+o.idx+"_scrollbar",l=e("#mCSB_"+o.idx+",#mCSB_"+o.idx+"_container,#mCSB_"+o.idx+"_container_wrapper,"+r+" ."+d[12]+",#mCSB_"+o.idx+"_dragger_vertical,#mCSB_"+o.idx+"_dragger_horizontal,"+r+">a"),s=e("#mCSB_"+o.idx+"_container");n.advanced.releaseDraggableSelectors&&l.add(e(n.advanced.releaseDraggableSelectors)),n.advanced.extraDraggableSelectors&&l.add(e(n.advanced.extraDraggableSelectors)),o.bindEvents&&(e(document).add(e(!A()||top.document)).unbind("."+i),l.each(function(){e(this).unbind("."+i)}),clearTimeout(t[0]._focusTimeout),$(t[0],"_focusTimeout"),clearTimeout(o.sequential.step),$(o.sequential,"step"),clearTimeout(s[0].onCompleteTimeout),$(s[0],"onCompleteTimeout"),o.bindEvents=!1)},M=function(t){var o=e(this),n=o.data(a),i=n.opt,r=e("#mCSB_"+n.idx+"_container_wrapper"),l=r.length?r:e("#mCSB_"+n.idx+"_container"),s=[e("#mCSB_"+n.idx+"_scrollbar_vertical"),e("#mCSB_"+n.idx+"_scrollbar_horizontal")],c=[s[0].find(".mCSB_dragger"),s[1].find(".mCSB_dragger")];"x"!==i.axis&&(n.overflowed[0]&&!t?(s[0].add(c[0]).add(s[0].children("a")).css("display","block"),l.removeClass(d[8]+" "+d[10])):(i.alwaysShowScrollbar?(2!==i.alwaysShowScrollbar&&c[0].css("display","none"),l.removeClass(d[10])):(s[0].css("display","none"),l.addClass(d[10])),l.addClass(d[8]))),"y"!==i.axis&&(n.overflowed[1]&&!t?(s[1].add(c[1]).add(s[1].children("a")).css("display","block"),l.removeClass(d[9]+" "+d[11])):(i.alwaysShowScrollbar?(2!==i.alwaysShowScrollbar&&c[1].css("display","none"),l.removeClass(d[11])):(s[1].css("display","none"),l.addClass(d[11])),l.addClass(d[9]))),n.overflowed[0]||n.overflowed[1]?o.removeClass(d[5]):o.addClass(d[5])},O=function(t){var o=t.type,a=t.target.ownerDocument!==document&&null!==frameElement?[e(frameElement).offset().top,e(frameElement).offset().left]:null,n=A()&&t.target.ownerDocument!==top.document&&null!==frameElement?[e(t.view.frameElement).offset().top,e(t.view.frameElement).offset().left]:[0,0];switch(o){case"pointerdown":case"MSPointerDown":case"pointermove":case"MSPointerMove":case"pointerup":case"MSPointerUp":return a?[t.originalEvent.pageY-a[0]+n[0],t.originalEvent.pageX-a[1]+n[1],!1]:[t.originalEvent.pageY,t.originalEvent.pageX,!1];case"touchstart":case"touchmove":case"touchend":var i=t.originalEvent.touches[0]||t.originalEvent.changedTouches[0],r=t.originalEvent.touches.length||t.originalEvent.changedTouches.length;return t.target.ownerDocument!==document?[i.screenY,i.screenX,1<r]:[i.pageY,i.pageX,1<r];default:return a?[t.pageY-a[0]+n[0],t.pageX-a[1]+n[1],!1]:[t.pageY,t.pageX,!1]}},I=function(){function t(e,t,a,n){if(h[0].idleTimer=d.scrollInertia<233?250:0,o.attr("id")===f[1])var i="x",s=(o[0].offsetLeft-t+n)*l.scrollRatio.x;else var i="y",s=(o[0].offsetTop-e+a)*l.scrollRatio.y;G(r,s.toString(),{dir:i,drag:!0})}var o,n,i,r=e(this),l=r.data(a),d=l.opt,u=a+"_"+l.idx,f=["mCSB_"+l.idx+"_dragger_vertical","mCSB_"+l.idx+"_dragger_horizontal"],h=e("#mCSB_"+l.idx+"_container"),m=e("#"+f[0]+",#"+f[1]),p=d.advanced.releaseDraggableSelectors?m.add(e(d.advanced.releaseDraggableSelectors)):m,g=d.advanced.extraDraggableSelectors?e(!A()||top.document).add(e(d.advanced.extraDraggableSelectors)):e(!A()||top.document);m.bind("contextmenu."+u,function(e){e.preventDefault()}).bind("mousedown."+u+" touchstart."+u+" pointerdown."+u+" MSPointerDown."+u,function(t){if(t.stopImmediatePropagation(),t.preventDefault(),ee(t)){c=!0,s&&(document.onselectstart=function(){return!1}),L.call(h,!1),Q(r);var a=(o=e(this)).offset(),l=O(t)[0]-a.top,u=O(t)[1]-a.left,f=o.height()+a.top,m=o.width()+a.left;l<f&&0<l&&u<m&&0<u&&(n=l,i=u),C(o,"active",d.autoExpandScrollbar)}}).bind("touchmove."+u,function(e){e.stopImmediatePropagation(),e.preventDefault();var a=o.offset(),r=O(e)[0]-a.top,l=O(e)[1]-a.left;t(n,i,r,l)}),e(document).add(g).bind("mousemove."+u+" pointermove."+u+" MSPointerMove."+u,function(e){if(o){var a=o.offset(),r=O(e)[0]-a.top,l=O(e)[1]-a.left;if(n===r&&i===l)return;t(n,i,r,l)}}).add(p).bind("mouseup."+u+" touchend."+u+" pointerup."+u+" MSPointerUp."+u,function(){o&&(C(o,"active",d.autoExpandScrollbar),o=null),c=!1,s&&(document.onselectstart=null),L.call(h,!0)})},D=function(){function o(e){if(!te(e)||c||O(e)[2])t=0;else{C=b=0,d=t=1,y.removeClass("mCS_touch_action");var o=I.offset();u=O(e)[0]-o.top,f=O(e)[1]-o.left,z=[O(e)[0],O(e)[1]]}}function n(e){if(te(e)&&!c&&!O(e)[2]&&(T.documentTouchScroll||e.preventDefault(),e.stopImmediatePropagation(),(!C||b)&&d)){g=K();var t=M.offset(),o=O(e)[0]-t.top,a=O(e)[1]-t.left,n="mcsLinearOut";if(E.push(o),W.push(a),z[2]=Math.abs(O(e)[0]-z[0]),z[3]=Math.abs(O(e)[1]-z[1]),B.overflowed[0])var i=D[0].parent().height()-D[0].height(),r=0<u-o&&o-u>-i*B.scrollRatio.y&&(2*z[3]<z[2]||"yx"===T.axis);if(B.overflowed[1])var l=D[1].parent().width()-D[1].width(),h=0<f-a&&a-f>-l*B.scrollRatio.x&&(2*z[2]<z[3]||"yx"===T.axis);r||h?(U||e.preventDefault(),b=1):(C=1,y.addClass("mCS_touch_action")),U&&e.preventDefault(),w="yx"===T.axis?[u-o,f-a]:"x"===T.axis?[null,f-a]:[u-o,null],I[0].idleTimer=250,B.overflowed[0]&&s(w[0],R,n,"y","all",!0),B.overflowed[1]&&s(w[1],R,n,"x",L,!0)}}function i(e){if(!te(e)||c||O(e)[2])t=0;else{t=1,e.stopImmediatePropagation(),Q(y),p=K();var o=M.offset();h=O(e)[0]-o.top,m=O(e)[1]-o.left,E=[],W=[]}}function r(e){if(te(e)&&!c&&!O(e)[2]){d=0,e.stopImmediatePropagation(),C=b=0,v=K();var t=M.offset(),o=O(e)[0]-t.top,a=O(e)[1]-t.left;if(!(30<v-g)){var n="mcsEaseOut",i=(_=1e3/(v-p))<2.5,r=i?[E[E.length-2],W[W.length-2]]:[0,0];x=i?[o-r[0],a-r[1]]:[o-h,a-m];var u=[Math.abs(x[0]),Math.abs(x[1])];_=i?[Math.abs(x[0]/4),Math.abs(x[1]/4)]:[_,_];var f=[Math.abs(I[0].offsetTop)-x[0]*l(u[0]/_[0],_[0]),Math.abs(I[0].offsetLeft)-x[1]*l(u[1]/_[1],_[1])];w="yx"===T.axis?[f[0],f[1]]:"x"===T.axis?[null,f[1]]:[f[0],null],S=[4*u[0]+T.scrollInertia,4*u[1]+T.scrollInertia];var y=parseInt(T.contentTouchScroll)||0;w[0]=y<u[0]?w[0]:0,w[1]=y<u[1]?w[1]:0,B.overflowed[0]&&s(w[0],S[0],n,"y",L,!1),B.overflowed[1]&&s(w[1],S[1],n,"x",L,!1)}}}function l(e,t){var o=[1.5*t,2*t,t/1.5,t/2];return 90<e?4<t?o[0]:o[3]:60<e?3<t?o[3]:o[2]:30<e?8<t?o[1]:6<t?o[0]:4<t?t:o[2]:8<t?t:o[3]}function s(e,t,o,a,n,i){e&&G(y,e.toString(),{dur:t,scrollEasing:o,dir:a,overwrite:n,drag:i})}var d,u,f,h,m,p,g,v,x,_,w,S,b,C,y=e(this),B=y.data(a),T=B.opt,k=a+"_"+B.idx,M=e("#mCSB_"+B.idx),I=e("#mCSB_"+B.idx+"_container"),D=[e("#mCSB_"+B.idx+"_dragger_vertical"),e("#mCSB_"+B.idx+"_dragger_horizontal")],E=[],W=[],R=0,L="yx"===T.axis?"none":"all",z=[],P=I.find("iframe"),H=["touchstart."+k+" pointerdown."+k+" MSPointerDown."+k,"touchmove."+k+" pointermove."+k+" MSPointerMove."+k,"touchend."+k+" pointerup."+k+" MSPointerUp."+k],U=void 0!==document.body.style.touchAction&&""!==document.body.style.touchAction;I.bind(H[0],function(e){o(e)}).bind(H[1],function(e){n(e)}),M.bind(H[0],function(e){i(e)}).bind(H[2],function(e){r(e)}),P.length&&P.each(function(){e(this).bind("load",function(){A(this)&&e(this.contentDocument||this.contentWindow.document).bind(H[0],function(e){o(e),i(e)}).bind(H[1],function(e){n(e)}).bind(H[2],function(e){r(e)})})})},E=function(){function n(e,t,o){d.type=o&&i?"stepped":"stepless",d.scrollAmount=10,j(r,e,t,"mcsLinearOut",o?60:null)}var i,r=e(this),l=r.data(a),s=l.opt,d=l.sequential,u=a+"_"+l.idx,f=e("#mCSB_"+l.idx+"_container"),h=f.parent();f.bind("mousedown."+u,function(){t||i||(i=1,c=!0)}).add(document).bind("mousemove."+u,function(e){if(!t&&i&&(window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type&&document.selection.createRange().text)){var a=f.offset(),r=O(e)[0]-a.top+f[0].offsetTop,c=O(e)[1]-a.left+f[0].offsetLeft;0<r&&r<h.height()&&0<c&&c<h.width()?d.step&&n("off",null,"stepped"):("x"!==s.axis&&l.overflowed[0]&&(r<0?n("on",38):r>h.height()&&n("on",40)),"y"!==s.axis&&l.overflowed[1]&&(c<0?n("on",37):c>h.width()&&n("on",39)))}}).bind("mouseup."+u+" dragend."+u,function(){t||(i&&(i=0,n("off",null)),c=!1)})},W=function(){function t(t,a){if(Q(o),!z(o,t.target)){var r="auto"!==i.mouseWheel.deltaFactor?parseInt(i.mouseWheel.deltaFactor):s&&t.deltaFactor<100?100:t.deltaFactor||100,d=i.scrollInertia;if("x"===i.axis||"x"===i.mouseWheel.axis)var u="x",f=[Math.round(r*n.scrollRatio.x),parseInt(i.mouseWheel.scrollAmount)],h="auto"!==i.mouseWheel.scrollAmount?f[1]:f[0]>=l.width()?.9*l.width():f[0],m=Math.abs(e("#mCSB_"+n.idx+"_container")[0].offsetLeft),p=c[1][0].offsetLeft,g=c[1].parent().width()-c[1].width(),v="y"===i.mouseWheel.axis?t.deltaY||a:t.deltaX;else var u="y",f=[Math.round(r*n.scrollRatio.y),parseInt(i.mouseWheel.scrollAmount)],h="auto"!==i.mouseWheel.scrollAmount?f[1]:f[0]>=l.height()?.9*l.height():f[0],m=Math.abs(e("#mCSB_"+n.idx+"_container")[0].offsetTop),p=c[0][0].offsetTop,g=c[0].parent().height()-c[0].height(),v=t.deltaY||a;"y"===u&&!n.overflowed[0]||"x"===u&&!n.overflowed[1]||((i.mouseWheel.invert||t.webkitDirectionInvertedFromDevice)&&(v=-v),i.mouseWheel.normalizeDelta&&(v=v<0?-1:1),(0<v&&0!==p||v<0&&p!==g||i.mouseWheel.preventDefault)&&(t.stopImmediatePropagation(),t.preventDefault()),t.deltaFactor<5&&!i.mouseWheel.normalizeDelta&&(h=t.deltaFactor,d=17),G(o,(m-v*h).toString(),{dir:u,dur:d}))}}if(e(this).data(a)){var o=e(this),n=o.data(a),i=n.opt,r=a+"_"+n.idx,l=e("#mCSB_"+n.idx),c=[e("#mCSB_"+n.idx+"_dragger_vertical"),e("#mCSB_"+n.idx+"_dragger_horizontal")],d=e("#mCSB_"+n.idx+"_container").find("iframe");d.length&&d.each(function(){e(this).bind("load",function(){A(this)&&e(this.contentDocument||this.contentWindow.document).bind("mousewheel."+r,function(e,o){t(e,o)})})}),l.bind("mousewheel."+r,function(e,o){t(e,o)})}},R=new Object,A=function(t){var o=!1,a=!1,n=null;if(void 0===t?a="#empty":void 0!==e(t).attr("id")&&(a=e(t).attr("id")),!1!==a&&void 0!==R[a])return R[a];if(t){try{var i=t.contentDocument||t.contentWindow.document;n=i.body.innerHTML}catch(r){}o=null!==n}else{try{var i=top.document;n=i.body.innerHTML}catch(r){}o=null!==n}return!1!==a&&(R[a]=o),o},L=function(e){var t=this.find("iframe");if(t.length){var o=e?"auto":"none";t.css("pointer-events",o)}},z=function(t,o){var n=o.nodeName.toLowerCase(),i=t.data(a).opt.mouseWheel.disableOver;return-1<e.inArray(n,i)&&!(-1<e.inArray(n,["select","textarea"])&&!e(o).is(":focus"))},P=function(){var t,o=e(this),n=o.data(a),i=a+"_"+n.idx,r=e("#mCSB_"+n.idx+"_container"),l=r.parent(),s=e(".mCSB_"+n.idx+"_scrollbar ."+d[12]);s.bind("mousedown."+i+" touchstart."+i+" pointerdown."+i+" MSPointerDown."+i,function(o){c=!0,e(o.target).hasClass("mCSB_dragger")||(t=1)}).bind("touchend."+i+" pointerup."+i+" MSPointerUp."+i,function(){c=!1}).bind("click."+i,function(a){if(t&&(t=0,e(a.target).hasClass(d[12])||e(a.target).hasClass("mCSB_draggerRail"))){Q(o);var i=e(this),s=i.find(".mCSB_dragger");if(0<i.parent(".mCSB_scrollTools_horizontal").length){if(!n.overflowed[1])return;var c="x",u=a.pageX>s.offset().left?-1:1,f=Math.abs(r[0].offsetLeft)-u*(.9*l.width())}else{if(!n.overflowed[0])return;var c="y",u=a.pageY>s.offset().top?-1:1,f=Math.abs(r[0].offsetTop)-u*(.9*l.height())}G(o,f.toString(),{dir:c,scrollEasing:"mcsEaseInOut"})}})},H=function(){var t=e(this),o=t.data(a),n=o.opt,i=a+"_"+o.idx,r=e("#mCSB_"+o.idx+"_container"),l=r.parent();r.bind("focusin."+i,function(){var o=e(document.activeElement),a=r.find(".mCustomScrollBox").length;o.is(n.advanced.autoScrollOnFocus)&&(Q(t),clearTimeout(t[0]._focusTimeout),t[0]._focusTimer=a?17*a:0,t[0]._focusTimeout=setTimeout(function(){var e=[ae(o)[0],ae(o)[1]],a=[r[0].offsetTop,r[0].offsetLeft],s=[0<=a[0]+e[0]&&a[0]+e[0]<l.height()-o.outerHeight(!1),0<=a[1]+e[1]&&a[0]+e[1]<l.width()-o.outerWidth(!1)],c="yx"!==n.axis||s[0]||s[1]?"all":"none";"x"===n.axis||s[0]||G(t,e[0].toString(),{dir:"y",scrollEasing:"mcsEaseInOut",overwrite:c,dur:0}),"y"===n.axis||s[1]||G(t,e[1].toString(),{dir:"x",scrollEasing:"mcsEaseInOut",overwrite:c,dur:0})},t[0]._focusTimer))})},U=function(){var t=e(this),o=t.data(a),n=a+"_"+o.idx,i=e("#mCSB_"+o.idx+"_container").parent();i.bind("scroll."+n,function(){0===i.scrollTop()&&0===i.scrollLeft()||e(".mCSB_"+o.idx+"_scrollbar").css("visibility","hidden")})},F=function(){var t=e(this),o=t.data(a),n=o.opt,i=o.sequential,r=a+"_"+o.idx,l=".mCSB_"+o.idx+"_scrollbar",s=e(l+">a");s.bind("contextmenu."+r,function(e){e.preventDefault()}).bind("mousedown."+r+" touchstart."+r+" pointerdown."+r+" MSPointerDown."+r+" mouseup."+r+" touchend."+r+" pointerup."+r+" MSPointerUp."+r+" mouseout."+r+" pointerout."+r+" MSPointerOut."+r+" click."+r,function(a){function r(e,o){i.scrollAmount=n.scrollButtons.scrollAmount,j(t,e,o)}if(a.preventDefault(),ee(a)){var l=e(this).attr("class");switch(i.type=n.scrollButtons.scrollType,a.type){case"mousedown":case"touchstart":case"pointerdown":case"MSPointerDown":if("stepped"===i.type)return;c=!0,o.tweenRunning=!1,r("on",l);break;case"mouseup":case"touchend":case"pointerup":case"MSPointerUp":case"mouseout":case"pointerout":case"MSPointerOut":if("stepped"===i.type)return;c=!1,i.dir&&r("off",l);break;case"click":if("stepped"!==i.type||o.tweenRunning)return;r("on",l)}}})},q=function(){function t(t){function a(e,t){r.type=i.keyboard.scrollType,r.scrollAmount=i.keyboard.scrollAmount,"stepped"===r.type&&n.tweenRunning||j(o,e,t)}switch(t.type){case"blur":n.tweenRunning&&r.dir&&a("off",null);break;case"keydown":case"keyup":var l=t.keyCode?t.keyCode:t.which,s="on";if("x"!==i.axis&&(38===l||40===l)||"y"!==i.axis&&(37===l||39===l)){if((38===l||40===l)&&!n.overflowed[0]||(37===l||39===l)&&!n.overflowed[1])return;"keyup"===t.type&&(s="off"),e(document.activeElement).is(u)||(t.preventDefault(),t.stopImmediatePropagation(),a(s,l))}else if(33===l||34===l){if((n.overflowed[0]||n.overflowed[1])&&(t.preventDefault(),t.stopImmediatePropagation()),"keyup"===t.type){Q(o);var f=34===l?-1:1;if("x"===i.axis||"yx"===i.axis&&n.overflowed[1]&&!n.overflowed[0])var h="x",m=Math.abs(c[0].offsetLeft)-f*(.9*d.width());else var h="y",m=Math.abs(c[0].offsetTop)-f*(.9*d.height());G(o,m.toString(),{dir:h,scrollEasing:"mcsEaseInOut"})}}else if((35===l||36===l)&&!e(document.activeElement).is(u)&&((n.overflowed[0]||n.overflowed[1])&&(t.preventDefault(),t.stopImmediatePropagation()),"keyup"===t.type)){if("x"===i.axis||"yx"===i.axis&&n.overflowed[1]&&!n.overflowed[0])var h="x",m=35===l?Math.abs(d.width()-c.outerWidth(!1)):0;else var h="y",m=35===l?Math.abs(d.height()-c.outerHeight(!1)):0;G(o,m.toString(),{dir:h,scrollEasing:"mcsEaseInOut"})}}}var o=e(this),n=o.data(a),i=n.opt,r=n.sequential,l=a+"_"+n.idx,s=e("#mCSB_"+n.idx),c=e("#mCSB_"+n.idx+"_container"),d=c.parent(),u="input,textarea,select,datalist,keygen,[contenteditable='true']",f=c.find("iframe"),h=["blur."+l+" keydown."+l+" keyup."+l];f.length&&f.each(function(){e(this).bind("load",function(){A(this)&&e(this.contentDocument||this.contentWindow.document).bind(h[0],function(e){t(e)})})}),s.attr("tabindex","0").bind(h[0],function(e){t(e)})},j=function(t,o,n,i,r){function l(e){u.snapAmount&&(f.scrollAmount=u.snapAmount instanceof Array?"x"===f.dir[0]?u.snapAmount[1]:u.snapAmount[0]:u.snapAmount);var o="stepped"!==f.type,a=r||(e?o?p/1.5:g:1e3/60),n=e?o?7.5:40:2.5,s=[Math.abs(h[0].offsetTop),Math.abs(h[0].offsetLeft)],d=[10<c.scrollRatio.y?10:c.scrollRatio.y,10<c.scrollRatio.x?10:c.scrollRatio.x],m="x"===f.dir[0]?s[1]+f.dir[1]*(d[1]*n):s[0]+f.dir[1]*(d[0]*n),v="x"===f.dir[0]?s[1]+f.dir[1]*parseInt(f.scrollAmount):s[0]+f.dir[1]*parseInt(f.scrollAmount),x="auto"!==f.scrollAmount?v:m,_=i||(e?o?"mcsLinearOut":"mcsEaseInOut":"mcsLinear"),w=!!e;return e&&a<17&&(x="x"===f.dir[0]?s[1]:s[0]),G(t,x.toString(),{dir:f.dir[0],scrollEasing:_,dur:a,onComplete:w}),e?void(f.dir=!1):(clearTimeout(f.step),void(f.step=setTimeout(function(){l()},a)))}var c=t.data(a),u=c.opt,f=c.sequential,h=e("#mCSB_"+c.idx+"_container"),m="stepped"===f.type,p=u.scrollInertia<26?26:u.scrollInertia,g=u.scrollInertia<1?17:u.scrollInertia;switch(o){case"on":if(f.dir=[n===d[16]||n===d[15]||39===n||37===n?"x":"y",n===d[13]||n===d[15]||38===n||37===n?-1:1],Q(t),oe(n)&&"stepped"===f.type)return;l(m);break;case"off":clearTimeout(f.step),$(f,"step"),Q(t),(m||c.tweenRunning&&f.dir)&&l(!0)}},Y=function(t){var o=e(this).data(a).opt,n=[];return"function"==typeof t&&(t=t()),t instanceof Array?n=1<t.length?[t[0],t[1]]:"x"===o.axis?[null,t[0]]:[t[0],null]:(n[0]=t.y?t.y:t.x||"x"===o.axis?null:t,n[1]=t.x?t.x:t.y||"y"===o.axis?null:t),"function"==typeof n[0]&&(n[0]=n[0]()),"function"==typeof n[1]&&(n[1]=n[1]()),n},X=function(t,o){if(null!=t&&void 0!==t){var n=e(this),i=n.data(a),r=i.opt,l=e("#mCSB_"+i.idx+"_container"),s=l.parent(),c=typeof t;o||(o="x"===r.axis?"x":"y");var d="x"===o?l.outerWidth(!1)-s.width():l.outerHeight(!1)-s.height(),f="x"===o?l[0].offsetLeft:l[0].offsetTop,h="x"===o?"left":"top";switch(c){case"function":return t();case"object":var m=t.jquery?t:e(t);if(!m.length)return;return"x"===o?ae(m)[1]:ae(m)[0];case"string":case"number":if(oe(t))return Math.abs(t);if(-1!==t.indexOf("%"))return Math.abs(d*parseInt(t)/100);if(-1!==t.indexOf("-="))return Math.abs(f-parseInt(t.split("-=")[1]));if(-1!==t.indexOf("+=")){var p=f+parseInt(t.split("+=")[1]);return 0<=p?0:Math.abs(p)}if(-1!==t.indexOf("px")&&oe(t.split("px")[0]))return Math.abs(t.split("px")[0]);if("top"===t||"left"===t)return 0;if("bottom"===t)return Math.abs(s.height()-l.outerHeight(!1));if("right"===t)return Math.abs(s.width()-l.outerWidth(!1));if("first"!==t&&"last"!==t)return e(t).length?"x"===o?ae(e(t))[1]:ae(e(t))[0]:(l.css(h,t),void u.update.call(null,n[0]));var m=l.find(":"+t);return"x"===o?ae(m)[1]:ae(m)[0]}}},N=function(t){function n(t){function o(e,t){return function(){return t.apply(e,arguments)}}function a(){this.onload=null,e(t).addClass(d[2]),r(2)}if(e(t).hasClass(d[2]))r();else{var n=new Image;n.onload=o(n,a),n.src=t.src}}function i(){!0===c.advanced.updateOnSelectorChange&&(c.advanced.updateOnSelectorChange="*");var e=0,t=f.find(c.advanced.updateOnSelectorChange);return c.advanced.updateOnSelectorChange&&0<t.length&&t.each(function(){e+=this.offsetHeight+this.offsetWidth}),e}function r(e){clearTimeout(f[0].autoUpdate),u.update.call(null,l[0],e)}var l=e(this),s=l.data(a),c=s.opt,f=e("#mCSB_"+s.idx+"_container");return t?(clearTimeout(f[0].autoUpdate),void $(f[0],"autoUpdate")):void function o(){return clearTimeout(f[0].autoUpdate),0===l.parents("html").length?void(l=null):void(f[0].autoUpdate=setTimeout(function(){return c.advanced.updateOnSelectorChange&&(s.poll.change.n=i(),s.poll.change.n!==s.poll.change.o)?(s.poll.change.o=s.poll.change.n,void r(3)):c.advanced.updateOnContentResize&&(s.poll.size.n=l[0].scrollHeight+l[0].scrollWidth+f[0].offsetHeight+l[0].offsetHeight+l[0].offsetWidth,s.poll.size.n!==s.poll.size.o)?(s.poll.size.o=s.poll.size.n,void r(1)):!c.advanced.updateOnImageLoad||"auto"===c.advanced.updateOnImageLoad&&"y"===c.axis||(s.poll.img.n=f.find("img").length,s.poll.img.n===s.poll.img.o)?void((c.advanced.updateOnSelectorChange||c.advanced.updateOnContentResize||c.advanced.updateOnImageLoad)&&o()):(s.poll.img.o=s.poll.img.n,void f.find("img").each(function(){n(this)}))},c.advanced.autoUpdateTimeout))}()},Q=function(t){var o=t.data(a),n=e("#mCSB_"+o.idx+"_container,#mCSB_"+o.idx+"_container_wrapper,#mCSB_"+o.idx+"_dragger_vertical,#mCSB_"+o.idx+"_dragger_horizontal");n.each(function(){Z.call(this)})},G=function(t,o,n){function i(e){return s&&c.callbacks[e]&&"function"==typeof c.callbacks[e]}function l(){var e=[h[0].offsetTop,h[0].offsetLeft],o=[x[0].offsetTop,x[0].offsetLeft],a=[h.outerHeight(!1),h.outerWidth(!1)],i=[f.height(),f.width()];t[0].mcs={content:h,top:e[0],left:e[1],draggerTop:o[0],draggerLeft:o[1],topPct:Math.round(100*Math.abs(e[0])/(Math.abs(a[0])-i[0])),leftPct:Math.round(100*Math.abs(e[1])/(Math.abs(a[1])-i[1])),direction:n.dir}}var s=t.data(a),c=s.opt,d={trigger:"internal",dir:"y",scrollEasing:"mcsEaseOut",drag:!1,dur:c.scrollInertia,overwrite:"all",callbacks:!0,onStart:!0,onUpdate:!0,onComplete:!0},n=e.extend(d,n),u=[n.dur,n.drag?0:n.dur],f=e("#mCSB_"+s.idx),h=e("#mCSB_"+s.idx+"_container"),m=h.parent(),p=c.callbacks.onTotalScrollOffset?Y.call(t,c.callbacks.onTotalScrollOffset):[0,0],g=c.callbacks.onTotalScrollBackOffset?Y.call(t,c.callbacks.onTotalScrollBackOffset):[0,0];if(s.trigger=n.trigger,0===m.scrollTop()&&0===m.scrollLeft()||(e(".mCSB_"+s.idx+"_scrollbar").css("visibility","visible"),m.scrollTop(0).scrollLeft(0)),"_resetY"!==o||s.contentReset.y||(i("onOverflowYNone")&&c.callbacks.onOverflowYNone.call(t[0]),s.contentReset.y=1),"_resetX"!==o||s.contentReset.x||(i("onOverflowXNone")&&c.callbacks.onOverflowXNone.call(t[0]),s.contentReset.x=1),"_resetY"!==o&&"_resetX"!==o){if(!s.contentReset.y&&t[0].mcs||!s.overflowed[0]||(i("onOverflowY")&&c.callbacks.onOverflowY.call(t[0]),s.contentReset.x=null),!s.contentReset.x&&t[0].mcs||!s.overflowed[1]||(i("onOverflowX")&&c.callbacks.onOverflowX.call(t[0]),s.contentReset.x=null),c.snapAmount){var v=c.snapAmount instanceof Array?"x"===n.dir?c.snapAmount[1]:c.snapAmount[0]:c.snapAmount;o=function(e,t,o){return Math.round(e/t)*t-o}(o,v,c.snapOffset)}switch(n.dir){case"x":var x=e("#mCSB_"+s.idx+"_dragger_horizontal"),_="left",w=h[0].offsetLeft,S=[f.width()-h.outerWidth(!1),x.parent().width()-x.width()],b=[o,0===o?0:o/s.scrollRatio.x],y=p[1],B=g[1],T=0<y?y/s.scrollRatio.x:0,k=0<B?B/s.scrollRatio.x:0;break;case"y":var x=e("#mCSB_"+s.idx+"_dragger_vertical"),_="top",w=h[0].offsetTop,S=[f.height()-h.outerHeight(!1),x.parent().height()-x.height()],b=[o,0===o?0:o/s.scrollRatio.y],y=p[0],B=g[0],T=0<y?y/s.scrollRatio.y:0,k=0<B?B/s.scrollRatio.y:0}b[1]<0||0===b[0]&&0===b[1]?b=[0,0]:b[1]>=S[1]?b=[S[0],S[1]]:b[0]=-b[0],t[0].mcs||(l(),i("onInit")&&c.callbacks.onInit.call(t[0])),clearTimeout(h[0].onCompleteTimeout),J(x[0],_,Math.round(b[1]),u[1],n.scrollEasing),!s.tweenRunning&&(0===w&&0<=b[0]||w===S[0]&&b[0]<=S[0])||J(h[0],_,Math.round(b[0]),u[0],n.scrollEasing,n.overwrite,{onStart:function(){n.callbacks&&n.onStart&&!s.tweenRunning&&(i("onScrollStart")&&(l(),c.callbacks.onScrollStart.call(t[0])),s.tweenRunning=!0,C(x),s.cbOffsets=[c.callbacks.alwaysTriggerOffsets||w>=S[0]+y,c.callbacks.alwaysTriggerOffsets||w<=-B])},onUpdate:function(){n.callbacks&&n.onUpdate&&i("whileScrolling")&&(l(),c.callbacks.whileScrolling.call(t[0]))},onComplete:function(){if(n.callbacks&&n.onComplete){"yx"===c.axis&&clearTimeout(h[0].onCompleteTimeout);var e=h[0].idleTimer||0;h[0].onCompleteTimeout=setTimeout(function(){i("onScroll")&&(l(),c.callbacks.onScroll.call(t[0])),i("onTotalScroll")&&b[1]>=S[1]-T&&s.cbOffsets[0]&&(l(),c.callbacks.onTotalScroll.call(t[0])),i("onTotalScrollBack")&&b[1]<=k&&s.cbOffsets[1]&&(l(),c.callbacks.onTotalScrollBack.call(t[0])),s.tweenRunning=!1,h[0].idleTimer=0,C(x,"hide")},e)}}})}},J=function(e,t,o,a,n,i,r){function l(){S.stop||(x||m.call(),x=K()-v,s(),x>=S.time&&(S.time=x>S.time?x+f-(x-S.time):x+f-1,S.time<x+1&&(S.time=x+1)),S.time<a?S.id=h(l):g.call())}function s(){0<a?(S.currVal=function(e,t,o,a,n){switch(n){case"linear":case"mcsLinear":return o*e/a+t;case"mcsLinearOut":return e/=a,e--,o*Math.sqrt(1-e*e)+t;case"easeInOutSmooth":return(e/=a/2)<1?o/2*e*e+t:-o/2*(--e*(e-2)-1)+t;case"easeInOutStrong":return(e/=a/2)<1?o/2*Math.pow(2,10*(e-1))+t:(e--,o/2*(2-Math.pow(2,-10*e))+t);case"easeInOut":case"mcsEaseInOut":return(e/=a/2)<1?o/2*e*e*e+t:o/2*((e-=2)*e*e+2)+t;case"easeOutSmooth":return e/=a,-o*(--e*e*e*e-1)+t;case"easeOutStrong":return o*(1-Math.pow(2,-10*e/a))+t;case"easeOut":case"mcsEaseOut":default:var i=(e/=a)*e,r=i*e;return t+o*(.499999999999997*r*i+-2.5*i*i+5.5*r+-6.5*i+4*e)}}(S.time,_,b,a,n),w[t]=Math.round(S.currVal)+"px"):w[t]=o+"px",p.call()}e._mTween||(e._mTween={top:{},left:{}});var f,h,r=r||{},m=r.onStart||function(){},p=r.onUpdate||function(){},g=r.onComplete||function(){},v=K(),x=0,_=e.offsetTop,w=e.style,S=e._mTween[t];"left"===t&&(_=e.offsetLeft);var b=o-_;S.stop=0,"none"!==i&&null!=S.id&&(window.requestAnimationFrame?window.cancelAnimationFrame(S.id):clearTimeout(S.id),S.id=null),f=1e3/60,S.time=x+f,h=window.requestAnimationFrame?window.requestAnimationFrame:function(e){return s(),setTimeout(e,.01)},S.id=h(l)},K=function(){return window.performance&&window.performance.now?window.performance.now():window.performance&&window.performance.webkitNow?window.performance.webkitNow():Date.now?Date.now():(new Date).getTime()},Z=function(){var e=this;e._mTween||(e._mTween={top:{},left:{}});for(var t=["top","left"],o=0;o<t.length;o++){var a=t[o];e._mTween[a].id&&(window.requestAnimationFrame?window.cancelAnimationFrame(e._mTween[a].id):clearTimeout(e._mTween[a].id),e._mTween[a].id=null,e._mTween[a].stop=1)}},$=function(e,t){try{delete e[t]}catch(o){e[t]=null}},ee=function(e){return!(e.which&&1!==e.which)},te=function(e){var t=e.originalEvent.pointerType;return!(t&&"touch"!==t&&2!==t)},oe=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},ae=function(e){var t=e.parents(".mCSB_container");return[e.offset().top-t.offset().top,e.offset().left-t.offset().left]},ne=function(){var t=function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}();return!!t&&document[t]};e.fn[o]=function(t){return u[t]?u[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist"):u.init.apply(this,arguments)},e[o]=function(t){return u[t]?u[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void e.error("Method "+t+" does not exist"):u.init.apply(this,arguments)},e[o].defaults=i,window[o]=!0,e(window).bind("load",function(){e(n)[o](),e.extend(e.expr[":"],{mcsInView:e.expr[":"].mcsInView||function(t){var o,a,n=e(t),i=n.parents(".mCSB_container");if(i.length)return o=i.parent(),0<=(a=[i[0].offsetTop,i[0].offsetLeft])[0]+ae(n)[0]&&a[0]+ae(n)[0]<o.height()-n.outerHeight(!1)&&0<=a[1]+ae(n)[1]&&a[1]+ae(n)[1]<o.width()-n.outerWidth(!1)},mcsInSight:e.expr[":"].mcsInSight||function(t,o,a){var n,i,r,l,s=e(t),c=s.parents(".mCSB_container"),d="exact"===a[3]?[[1,0],[1,0]]:[[.9,.1],[.6,.4]];if(c.length)return n=[s.outerHeight(!1),s.outerWidth(!1)],r=[c[0].offsetTop+ae(s)[0],c[0].offsetLeft+ae(s)[1]],i=[c.parent()[0].offsetHeight,c.parent()[0].offsetWidth],r[0]-i[0]*(l=[n[0]<i[0]?d[0]:d[1],n[1]<i[1]?d[0]:d[1]])[0][0]<0&&0<=r[0]+n[0]-i[0]*l[0][1]&&r[1]-i[1]*l[1][0]<0&&0<=r[1]+n[1]-i[1]*l[1][1]},mcsOverflow:e.expr[":"].mcsOverflow||function(t){var o=e(t).data(a);if(o)return o.overflowed[0]||o.overflowed[1]}})})}()}),function(){"use strict";function ScrollBarsProvider(){this.defaults={scrollButtons:{enable:!0},axis:"yx"},$.mCustomScrollbar.defaults.scrollButtons=this.defaults.scrollButtons,$.mCustomScrollbar.defaults.axis=this.defaults.axis,this.$get=function(){return{defaults:this.defaults}}}function render(defaults,configuredDefaults,elem,scope){elem.mCustomScrollbar("destroy");var config={};for(var setting in scope.ngScrollbarsConfig&&(config=scope.ngScrollbarsConfig),defaults)if(defaults.hasOwnProperty(setting))switch(setting){case"scrollButtons":config.hasOwnProperty(setting)||(configuredDefaults.scrollButtons=defaults[setting]);break;case"axis":config.hasOwnProperty(setting)||(configuredDefaults.axis=defaults[setting]);break;default:config.hasOwnProperty(setting)||(config[setting]=defaults[setting])}elem.mCustomScrollbar(config)}function ScrollBarsDirective(ScrollBars){return{scope:{ngScrollbarsConfig:"=?",ngScrollbarsUpdate:"=?",ngScrollTo:"=?",element:"=?"},link:function(scope,elem,attrs){scope.elem=elem;var defaults=ScrollBars.defaults,configuredDefaults=$.mCustomScrollbar.defaults;scope.ngScrollbarsUpdate=function(){elem.mCustomScrollbar.apply(elem,arguments)},scope.$watch("ngScrollbarsConfig",function(newVal,oldVal){void 0!==newVal&&render(defaults,configuredDefaults,elem,scope)}),scope.$watch("ngScrollTo",function(newVal,oldVal){void 0!==newVal&&(elem.mCustomScrollbar("scrollTo",newVal),scope.ngScrollTo=void 0)}),render(defaults,configuredDefaults,elem,scope)}}}angular.module("ngScrollbars",[]).provider("ScrollBars",ScrollBarsProvider).directive("ngScrollbars",ScrollBarsDirective),ScrollBarsProvider.$inject=[],ScrollBarsDirective.$inject=["ScrollBars"]}();var AppDependencies=["ui.router","ncy_angular_breadcrumb","pascalprecht.translate","ab-base64","ui.bootstrap","ngSanitize","ngCookies","common","com.2fdevs.videogular","com.2fdevs.videogular.plugins.overlayplay","com.2fdevs.videogular.plugins.controls","com.2fdevs.videogular.plugins.poster","videogular.texttrack","ngScrollbars"];function getURLParam(name){for(var params=window.location.href.split("?")[1].split("&"),i=0;i<params.length;){var param_item=params[i].split("=");if(param_item[0]==name)return param_item[1];i++}return""}edns.mobile.isMobileDevice()?(AppDependencies.push("ngTouch"),window.supportedMobiles=!0,angular.element(document.querySelector("html")).addClass("supportedMobiles")):(window.supportedMobiles=!1,AppDependencies.push("ngTinyScrollbar"),angular.element(document.querySelector("html")).addClass("notSupportedMobiles"));var routerApp=angular.module("edoNewUX",AppDependencies);routerApp.config(["$translateProvider",function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"Languages/",suffix:".json?v=5"})}]),routerApp.config(["$sceDelegateProvider",function($sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["self","http://localhost:54822/**"])}]),routerApp.config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/login"),$stateProvider.state("Home",{url:"/home",views:{main:{templateUrl:"templates/home.html",controller:"homeCtrl"},"courseData@Home":{templateUrl:"templates/courseData.html?v=5.1",controller:"studentAssignedCtrl",controllerAs:"courseCtrl"},"marketing@Home":{templateUrl:"templates/promotions.html",controller:null}}}).state("Login",{url:"/login",views:{logins:{templateUrl:"templates/login.html"},loginHeader:{templateUrl:"templates/loginHeader.html",controller:"loginHeaderCtrl",controllerAs:"loginHeaderCtrl"}},loginHeader:!0}).state("optIn",{url:"/optIn",views:{optIn:{templateUrl:"templates/optIn.html",controller:"optInCtrl"}},loginHeader:!0}).state("preHome",{url:"/preHome/:beforeExtApp/:action",views:{preHome:{templateUrl:"templates/preHome.html",controller:"preHomeCtrl"}},params:{beforeExtApp:null,action:null}}).state("MyProgress",{url:"/MyProgress/Course/:courseId/Unit/:unitId?",views:{main:{templateUrl:"templates/myProgress.html?v=5.1",controller:"myProgressCtrl",controllerAs:"myProgressCtrl"},"courseStatistics@MyProgress":{templateUrl:"templates/courseStatistics.html?v=5.1"},"myProgressUnits@MyProgress":{templateUrl:"templates/myProgressUnits.html",controller:"myProgressUnitsCtrl",controllerAs:"myProgressUnitsCtrl"}}}).state("Community",{url:"/community",views:{main:{templateUrl:"templates/community.html",controller:"communityCtrl",controllerAs:"commCtrl"}},data:{displayName:"community"},ncyBreadcrumb:{label:"309"}}).state("Magazine",{url:"/magazine",topic:null,controller:"magazineCtrl",views:{main:{templateUrl:"templates/magazine.html"},"magazineContent@Magazine":{templateUrl:"templates/magazineHome.html"}},ncyBreadcrumb:{label:"304",parent:"Community"},data:{hideDictionaryOnClick:!0}}).state("Magazine.Archive",{url:"/archive/:year/:month",params:{year:null,month:null},controller:"magazineCtrl",views:{main:{templateUrl:"templates/magazine.html"},"magazineContent@Magazine":{templateUrl:"templates/magazineHome.html"}},ncyBreadcrumb:{label:"{{itemDate}}",parent:"Magazine"}}).state("Magazine.Topic",{url:"/topics/:topic",params:{topic:null,topicName:null},controller:"magazineCtrl",views:{main:{templateUrl:"templates/magazine.html"},"magazineContent@Magazine":{templateUrl:"templates/magazineHome.html"}},ncyBreadcrumb:{label:"{{currentTopicName}}",parent:"Magazine"}}).state("Magazine.Article",{url:"/article/:articleCode",controller:"magazineCtrl",views:{main:{templateUrl:"templates/magazine.html"},"magazineContent@Magazine":{templateUrl:"templates/magazineIssue.html",controller:"magazineArticleCtrl",controllerAs:"magazineArticleCtrl"}},params:{from:"article"},ncyBreadcrumb:{label:"{{ncyBreadcrumbLabel}}",parent:"Magazine"}}).state("Magazine.Topic.topArticle",{url:"/article/:articleCode",controller:"magazineCtrl",views:{main:{templateUrl:"templates/magazine.html"},"magazineContent@Magazine":{templateUrl:"templates/magazineIssue.html",controller:"magazineArticleCtrl",controllerAs:"magazineArticleCtrl"}},params:{from:"topic"},ncyBreadcrumb:{label:"{{ncyBreadcrumbLabel}}",parent:"Magazine.Topic"}}).state("Magazine.Archive.arcArticle",{url:"/article/:articleCode",controller:"magazineCtrl",views:{main:{templateUrl:"templates/magazine.html"},"magazineContent@Magazine":{templateUrl:"templates/magazineIssue.html",controller:"magazineArticleCtrl",controllerAs:"magazineArticleCtrl"}},params:{from:"archive"},ncyBreadcrumb:{label:"{{ncyBreadcrumbLabel}}",parent:"Magazine.Archive"}}).state("Magazine.SearchByTitle",{url:"/SearchByTitle/:words",params:{words:null},controller:"magazineCtrl",views:{main:{templateUrl:"templates/magazine.html"},"magazineContent@Magazine":{templateUrl:"templates/magazineHome.html"}},ncyBreadcrumb:{label:"{{words}}",parent:"Magazine"}}).state("TalkingIdioms",{url:"/TalkingIdioms",views:{main:{templateUrl:"templates/idioms.html"}},ncyBreadcrumb:{label:"477",parent:"Community"}}).state("VideoTutorials",{url:"/VideoTutorials/:videoCode",views:{main:{templateUrl:"templates/VideoTutorials.html"}},params:{videoCode:null}}).state("Games",{url:"/games",views:{main:{templateUrl:"templates/Community/Games/gamesIndexPage.html",controller:"gamesCtrl",controllerAs:"gamesCtrl"}},ncyBreadcrumb:{label:"494",parent:"Community"}}).state("WordSearch",{url:"/games/wordSearch",views:{main:{templateUrl:"templates/Community/Games/wordsearchIframe.html"}},ncyBreadcrumb:{label:"491",parent:"Games"}}).state("Snowman",{url:"/games/Snowman",views:{main:{templateUrl:"templates/Community/Games/snowmanIframe.html"}},ncyBreadcrumb:{label:"492",parent:"Games"}}).state("Crosswords",{url:"/games/Crosswords",views:{main:{templateUrl:"templates/Community/Games/crosswordsIframe.html"}},ncyBreadcrumb:{label:"497",parent:"Games"}}).state("DelayedLogin",{url:"/DelayedLogin",params:{GA:!1,secondsLeft:null,username:null,password:null,IID:null},views:{logins:{templateUrl:"templates/waitForLogin.html",controller:"DelayedLoginCtrl"}},loginHeader:!0}).state("SessionTimeout",{url:"/SessionTimeout",views:{logins:{templateUrl:"templates/waitForLogin.html",controller:"LoginStateCtrl"}},loginHeader:!0}).state("LoginFailed",{url:"/LoginFailed",views:{logins:{templateUrl:"templates/waitForLogin.html",controller:"LoginStateCtrl"}},loginHeader:!0})}]).config(["$compileProvider",function($compileProvider){$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}]).constant("clickEventName",!0===angular.element(document.querySelector("html")).hasClass("supportedMobiles")?"touchstart":"click").constant("supportedMobiles",!0===angular.element(document.querySelector("html")).hasClass("supportedMobiles")).config(["$breadcrumbProvider",function($breadcrumbProvider){$breadcrumbProvider.setOptions({templateUrl:"Templates/breadCrumbs.html"})}]),angular.element(document).ready(function(){if(document.documentMode)document.navigationRequested=((event=document.createEvent("HTMLEvents")).initEvent("NavigationRequested",!0,!0),event),document.navigationConfirmed=function(){var event=document.createEvent("HTMLEvents");return event.initEvent("NavigationConfirmed",!0,!0),event}();else{var navreq=new Event("NavigationRequested"),navcnf=new Event("NavigationConfirmed");document.navigationRequested=navreq,document.navigationConfirmed=navcnf}var event;angular.bootstrap(document,["edoNewUX"])});var bMobile=isMobile(),isHTML5Player=!0,MediaRoot=localStorage.getItem("resPathRoot");if(MediaRoot&&(MediaRoot=MediaRoot.replace('"',"").replace('"',"")+"/"),"undefined"===Root)var href=window.location.href,Root=href.substring(0,href.toLowerCase().indexOf("runtime"));function getContentLanguage(){return null!=GetCookie("Student")&&"-1"!=getCompositeCookie("Student","SID")?0==getCompositeCookie("Student","LangSupLevel")?"eng":getCompositeCookie("Student","Language"):"1"==GetCookie("PreviewMode")?0==getCompositeCookie("Community","InstLangSupLevel")?"eng":getCompositeCookie("Community","LanguageCode"):"eng"}function isMobile(){return null!=navigator.userAgent.match(/Android|iPad|iPhone|iPod/i)||void 0!==window.orientation||screen.width<=480}function isAppleMobile(){return null!=navigator.userAgent.match(/iPad|iPhone|iPod/i)||void 0!==window.orientation||screen.width<=480}function fsplayerAxNotify(strCommand,strFPName){if(!flagSeqPictHear||"eos"==strCommand){var mp,str_FPName=strFPName&&"undefined"!=strFPName?strFPName:getFSPName();if("eos"==strCommand&&isObjDefine()&&"Sequence Pictures"==obj.Subject)null!=(mp=getAppletMp(str_FPName))&&mp.EndOfStream(0);else if("eos"==strCommand&&isSRIdiomsOrUnknown())srcPlayFinished();else if(strApplN&&document.applets[strApplN])null!=(mp=getAppletMp(str_FPName))&&("eos"==strCommand&&"PracticeVSO"!=strApplN?mp.EndOfStream(0):"rsch"==strCommand?mp.ReadyStateChange(4):"psc"==strCommand&&mp.PlayStateChange(2,2))}}function isSROpen(){return cboxSROpen}var flagSeqPictHear=!1;function setSeqPicHear(newStat){isObjDefine()&&"Sequence Pictures"==obj.Subject&&strApplN&&document.applets[strApplN]&&"PracticeVSO"==strApplN&&(flagSeqPictHear=newStat)}function fssetAutostart(bValue,str_OName){var strPlName=str_OName||"MediaPlayer";try{document.all?window[strPlName].saf(bValue):document.embeds[strPlName].saf(bValue)}catch(e){}}function endOfStreamAx(){var applList=strApplN,mp=document.applets[applList].getPlayerForName("MediaPlayer");null!=mp&&mp.EndOfStream(0),objBtnState=0}function fsplayerNotifier(strCommand,strFPName){"1"==$("#"+strFPName).attr("spObj")&&$.event.trigger({type:"SPlayerMessage",message:arguments,time:new Date})}function useHTML5Player(playerObj){return playerObj.canPlayType&&(playerObj.canPlayType("audio/mpeg")||playerObj.canPlayType("video/mp4"))||bMobile}function stopOtherMediaRight2(audioPlayerId,srcFile){$.publish("stopAudioPlayer",{id:"PMediaPlayer",srcPlayerId:audioPlayerId,srcFile:srcFile}),$.publish("openSpeechNotify",{id:"srec",name:"stopSpeech"})}var g_spObj1=function(){function g_spObj(strID,bAutoStart,strMContainer){this.id=strID,this.bAuto=bAutoStart,this.strMContainer=strMContainer||"body",this.canplaythrough=!1,function(id,spContainer,objPL){if(objPL.id=null==objPL.id||null==objPL.id?id:objPL.id,1==$("#"+id).length)return bMobile&&enableAudio(document,$("#"+id)[0],"");var objSA=document.createElement("audio");function enableAudio(element,audio,onEnd){var callback=!1,click=!1;click=function(e){var forceStop=function(){audio.removeEventListener("play",forceStop,!1),audio.pause(),element.removeEventListener("touchstart",click,!1),onEnd&&onEnd()},progress=function(){audio.removeEventListener("canplaythrough",progress,!1),callback&&callback()};audio.addEventListener("play",forceStop,!1),audio.addEventListener("canplaythrough",progress,!1);try{var promise=audio.play();void 0!==promise&&promise.then(function(){}).catch(function(error){})}catch(e){callback=function(){callback=!1,audio.play()}}},element.addEventListener("touchstart",click,!1)}if($.subscribe("stopAudioPlayer",function(e,data){fsplayerNotifier("stopAudio",data.id)}),useHTML5Player(objSA))$(objSA).attr("id",id),$(objSA).attr("spObj","1"),$(spContainer).append(objSA),objSA.preload="auto",bMobile&&enableAudio(document,objSA,""),objSA.addEventListener("ended",function(e){objPL.bPart||fsplayerNotifier("eos",objPL.id)},!1),objSA.addEventListener("play",function(e){fsplayerNotifier("psc",objPL.id)},!1),objSA.addEventListener("durationchange",function(e){objPL.iProgress=objSA.duration,fsplayerNotifier("totalTime",objPL.id,objSA.duration)},!1),objSA.addEventListener("progress",function(){objPL.iProgress=0},!1),objSA.addEventListener("loadeddata",function(e){objPL.iProgress=100,fsplayerNotifier("rsch",objPL.id)},!1),objSA.addEventListener("timeupdate",function(e){fsplayerNotifier("timeUpdate",objPL.id,objSA.currentTime)},!1),objSA.addEventListener("canplaythrough",function(e){objPL.canplaythrough=!0},!0);else{var spFlashUrl=window.location.href.substring(0,href.toLowerCase().indexOf("runtime"))+"Runtime/",strFPF=isObjOriented()?"?a1="+(new Date).getTime():"",playString='<embed src="'+spFlashUrl+'sp_flash.swf" FlashVars="strFPName='+id+'" quality="high" bgcolor="#ffffff" width="0" height="0" id="'+id+'" name="'+id+'" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash" SWLIVECONNECT="true" pluginspage="http://www.macromedia.com/go/getflashplayer" spObj="1" />';-1!=window.navigator.userAgent.indexOf("MSIE")&&(playString=(playString='<OBJECT id="'+id+'" name="'+id+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" WIDTH="0" HEIGHT="0" MENU="FALSE" spObj="1">')+'<PARAM NAME="movie" VALUE="'+spFlashUrl+"sp_flash.swf"+strFPF+'"><PARAM NAME="menu" VALUE="false"><PARAM NAME="FlashVars" VALUE="strFPName='+id+'"><PARAM NAME="quality" VALUE="high"><PARAM NAME="bgcolor" VALUE=#FFFFFF><PARAM NAME="allowScriptAccess" VALUE="always">',playString+="</OBJECT>"),$(spContainer).append(playString)}}(this.id,this.strMContainer,this),this.bAudio=0<$("audio#"+strID).length,this.objSP=-1<navigator.appName.toLowerCase().indexOf("microsoft")||0<$("audio").length?document.getElementById(this.id):document.embeds[this.id],this.dTO_=-1,this.bPart=!1}return g_spObj.prototype.disposeEx=function(){this.stop(),$("#"+this.id).remove(),$.unsubscribe("btnTrackerPanelNotify"),$.unsubscribe("stopAudioPlayer")},g_spObj.prototype.setSelectedSE=function(from_tm,to_tm,nonSegmentedAudio){bMobile||(to_tm=(to_tm=bIE?parseFloat(to_tm):parseFloat(to_tm)>this.getDuration()?this.getDuration():to_tm,isNaN(to_tm)?this.getDuration():to_tm));try{this.bAudio?this.objSP.currentTime=parseFloat(from_tm):this.objSP.setFromTo(parseFloat(from_tm),parseFloat(to_tm))}catch(e){}this.bPart=void 0===nonSegmentedAudio||!nonSegmentedAudio,this.dTO_=to_tm},g_spObj.prototype.openNewFile=function(str_FName){var self=this;try{this.bAuto&&this.fssetAutostart(!0);var code=str_FName.replace(/^.*[\\\/]/,"");-1!=navigator.userAgent.indexOf("Firefox")&&"s"==code.substr(2,1)&&"p"==code.substr(6,1)&&this.bAudio,this.bAudio?this.objSP.src=str_FName:this.objSP.setFile(str_FName)}catch(e){setTimeout(function(){self.openNewFile(str_FName)},500)}},g_spObj.prototype.fssetAutostart=function(bValue){this.bAudio?this.objSP.autoplay=!0:this.objSP.saf(bValue)},g_spObj.prototype.play=function(start){var objSP_=this;stopOtherMediaRight2(objSP_.id,objSP_.objSP.src),this.bPart&&this.bAudio&&setTimeout(function(){!function checkSPPosition(objPL){objPL.bPart&&(objPL.objSP.currentTime+.2>=objPL.dTO_?(objPL.stop(),objPL.bPart=!1,objPL.dTO_=-1,fsplayerNotifier("eos",objPL.id)):setTimeout(function(){checkSPPosition(objPL)},200))}(objSP_)},500),this.bAudio?(objSP_.stop(),start&&(this.objSP.currentTime=0),setTimeout(function(){objSP_.objSP.play()},100)):this.objSP.playSound()},g_spObj.prototype.stop=function(){try{this.bAudio?this.objSP.pause():this.objSP.stopSound()}catch(e){}},g_spObj.prototype.getDuration=function(){var duration;return-1!=(duration=this.bAudio?this.objSP.duration:this.objSP.GetDurationFl())?this.bAudio?duration:duration/1e3:duration},g_spObj.prototype.hasError=function(){return!1},g_spObj.prototype.getPosition=function(){return this.bAudio?this.objSP.currentTime:this.objSP.GetPositionFl()},g_spObj.prototype.isActive=function(){return this.bAudio?!!this.objSP.canPlayType:!!this.objSP.getBytesTotalFl},g_spObj.prototype.getTotalBytes=function(){return this.bAudio?bMobile?100:isNaN(this.objSP.duration)?0:parseInt(this.objSP.duration):this.objSP.getBytesTotalFl()},g_spObj.prototype.getBytesLoaded=function(){var buffered;return this.bAudio&&!bMobile&&0<this.objSP.buffered.length&&(buffered=this.canplaythrough?this.objSP.duration:parseInt(this.objSP.buffered.end(this.objSP.buffered.length-1))),this.bAudio?bMobile?100:0<this.objSP.buffered.length?buffered:-1:this.objSP.getBytesLoadedFl()},g_spObj.prototype.reset=function(){var playbackRate=this.objSP.playbackRate;this.bAudio?(this.objSP.load(),0<$("#sl0slider").length&&$("#sl0slider").css("left","0px")):this.objSP.ResetFl(),this.objSP.playbackRate=playbackRate},g_spObj}();HTML5trackerAudio=function(media){$(media).on("loadedmetadata",function(){var totalTime=document.getElementById("total-time");null!=totalTime&&(totalTime.innerHTML=edns.utils.formatSecondsForMediaPlayer(media.duration));var playButton=document.getElementById("play-pause"),speakerButton=document.getElementById("speaker"),seekBar=document.getElementById("seek-bar"),volumeBar=document.getElementById("volume-bar");if(null!=playButton){var clickEvent="click";bMobile&&(clickEvent="touchstart"),$(playButton).off(clickEvent).bind(clickEvent,function(){$.publish("btnTrackerPanelNotify",{btnId:"playPause",media:media});var mediaPaused=media.paused;media.paused?playButton.className="layout__mediaPlayPause layout__mediaPlayPause--play":playButton.className="layout__mediaPlayPause layout__mediaPlayPause--pause",$.publish("trNotify",{name:"play",id:"syncAudioTracker",pos:0,paused:mediaPaused})}),null!=speakerButton&&$(speakerButton).off("click").bind("click",function(){$.publish("btnTrackerPanelNotify",{btnId:"mute",media:media}),$(volumeBar).toggleClass("hide")}),null!=seekBar&&seekBar.addEventListener("change",function(){var time=media.duration*(seekBar.value/100);$.publish("btnTrackerPanelNotify",{btnId:"seekBar",media:media,time:time})}),media.addEventListener("timeupdate",function(e){var value=100/media.duration*media.currentTime;null!=seekBar&&(seekBar.value=value);var playingTime=document.getElementById("playing-time");null!=playingTime&&(playingTime.innerHTML=edns.utils.formatSecondsForMediaPlayer(media.currentTime)),this.duration-this.currentTime<=.25&&setTimeout(function(){$("#seek-bar").val(0),$("#playing-time").html("00:00"),this.currentTime=0,media.end},.25)}),null!=seekBar&&seekBar.addEventListener("mousedown",function(){media.pause(),playButton.className="layout__mediaPlayPause layout__mediaPlayPause--play"}),null!=volumeBar&&volumeBar.addEventListener("change",function(){media.volume=volumeBar.value,0==volumeBar.value?(media.muted=!0,$(speakerButton).addClass("layout__mediaSpeaker--mute")):($(speakerButton).removeClass("layout__mediaSpeaker--mute"),media.muted=!1)})}})};var mediaLoader=function(){var mediaContainer,mediaContainerHeight,compressHeight,infoPanel,infoBar,infoPercent,finishedLoading,showPanel;function mediaLoader_(containerName,compressMediaHeight){infoPanel=$("#mediaLoadPanel"),infoBar=$("#mediaLoadProgressBar"),infoPercent=$("#mediaLoadProgressPercent"),mediaContainer=mediaContainer||"#trContainer",compressHeight=compressMediaHeight||0,showPanel=null!=containerName||null!=compressMediaHeight}return mediaLoader_.prototype.startLoading=function(){if(-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&0<$("#syncAudioPlayer").length){var loaderTimeout=setTimeout(function(){showPanel&&infoPanel.show(),infoPanel.hide(),clearInterval(loaderTimeout)},500);mediaContainerHeight=$(mediaContainer).height(),$(mediaContainer).height("33px"),finishedLoading=!0,$("#spkImgWrap, #trContainer, .bgImgContainerWrapper").show()}else showPanel&&infoPanel.show(),mediaContainerHeight=$(mediaContainer).height(),$(mediaContainer).height(compressHeight.toString()+"px"),finishedLoading=!1},mediaLoader_.prototype.showProgress=function(pLoad){if(0<infoPanel.length&&0<infoBar.length&&0<infoPercent.length){var nLoad=function(chkStr){try{return parseInt(chkStr)}catch(e){return 0}}(pLoad);if(99<nLoad){if(finishedLoading=!0,0==mediaContainerHeight){0<$(".layout__mediaControlsW").length&&$(mediaContainer).parent().find(".layout__mediaControlsW").height();mediaContainerHeight=$(mediaContainer).height()}return $(mediaContainer).css("height",""),mediaContainerHeight=$(mediaContainer).height()-3,$(mediaContainer).height(mediaContainerHeight),infoPanel.hide(),-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&setTimeout(function(){$("#spkImgWrap, #trContainer, .bgImgContainerWrapper").show()},4),$("#spkImgWrap, #trContainer, .bgImgContainerWrapper").show(),$(".learning__RAMediaResourceW").removeClass("learning__RAMediaResourceW--loadingMedia"),!0}return infoBar.css("width",nLoad.toString()+"%"),infoPercent.html(nLoad.toString()+" %"),!1}},mediaLoader_.prototype.isLoaded=function(){return finishedLoading},mediaLoader_}();function getTimeDelta(){if("undefined"==typeof startTime||isNaN(startTime))time=0;else var stopTime=new Date,time=Math.floor((stopTime-startTime)/1e3);return 0<time?time:0}var SrXmlResult=function(){var self;return function(xml,sentenceId){self=this;try{sentenceId="string"==typeof sentenceId?sentenceId:null;var res=$(xml);this.grammar=res.find("interpretation").addBack().attr("grammar"),this.sentenceScore=parseInt(res.find("interpretation").addBack().attr("score"))+1,this.sentence=res.find("instance").text(),this.scores=[],this.words=[],this.sentenceId=sentenceId,res.find('input[mode="speech"]').each(function(){self.scores.push(parseInt($(this).attr("score"))+1),self.words.push(this.nextSibling.nodeValue)})}catch(e){return null}}}(),JsonHandler=function(){var self;function jsonHandler(json,debug){(self=this).debug="boolean"==typeof debug&&debug;var errMsg="Unable to get json data!";if("string"==typeof json)try{this.data=JSON.parse(json)}catch(e){try{this.data=JSON.parse(localStorage.getItem(json))}catch(e){}null!==this.data&&"object"==typeof this.data||d(errMsg)}else"object"==typeof json?this.data=json:d(errMsg,!0)}function d(msg,crit){crit="boolean"==typeof crit&&crit,self.debug&&(console[crit?"error":"info"]("*** JsonHandler: "+msg),crit&&alert(msg))}return jsonHandler.prototype.get=function(jPath,defaultValue){jPath=void 0!==jPath?jPath:"",defaultValue=void 0!==defaultValue?defaultValue:null,this.debug&&d('getting path "'+jPath+'" with default value "'+defaultValue+'"');var parts=jPath.split("."),j=this.data;if(null===j||"object"!=typeof j)return d("Can not get path! Json object not initialized!",!0),null;for(var i=0;i<parts.length;i++){var arr=parts[i].match(/([^\[\]])+/g);if(0===arr.length)return defaultValue;var key=arr[0];if(!j.hasOwnProperty(key))return defaultValue;switch(arr.length){case 1:j=j[key];break;case 2:var index=arr[1];if(!(j[key]instanceof Array&&parseInt(index)<j[key].length))return defaultValue;j=j[key][index];break;default:return defaultValue}}return this.debug&&d('Path parsed, value found: "'+j+'"'),j},jsonHandler.prototype.set=function(jPath,value){try{for(var parts=jPath.split("."),prefix="this.data",key="",i=0,prev=null;i<parts.length;i++,prefix+="."+prev){var arr=parts[i].match(/([^\[\]])+/g),key=arr[0];switch(arr.length){case 1:eval(prefix)instanceof Object&&eval(prefix).hasOwnProperty(key)||(eval(prefix)[key]={}),prev=key;break;case 2:var index=arr[1];(!eval(prefix).hasOwnProperty(key)||!eval(prefix)[key]instanceof Array)&&(eval(prefix)[key]=[]);var len=eval(prefix)[key].length;if(len<=index)for(var j=len;j<=index;j++)eval(prefix)[key][j]={};prev=key+"["+index+"]"}}var lst=prefix.lastIndexOf(".");parts=prefix.substring(lst+1,prefix.length).match(/([^\[\]])+/g),1===parts.length?eval(prefix.substring(0,lst))[parts[0]]=value:eval(prefix.substring(0,lst))[parts[0]][parts[1]]=value}catch(e){d('Unable to set value "'+value+'" for json path "'+jPath+'"',!0)}},jsonHandler.prototype.getArray=function(jPath,defaultValue){var array=this.get(jPath,defaultValue);return array instanceof Array?array:[array]},jsonHandler.prototype.getJson=jsonHandler.prototype.toJson=function(){return this.data},jsonHandler.prototype.has=function(jPath){return this.debug&&d('Checking path "'+jPath+'" in json data: '+(null!==this.get(jPath)?"found":"not found")),null!==this.get(jPath)},jsonHandler.prototype.toString=jsonHandler.prototype.getString=function(){return JSON.stringify(this.data)},jsonHandler}();navigator.isWebRtcBrowser=function(){var IID,tem,ua,M,exceptions={"edo.engdis.com":["5230116"],"edonline.engdis.com":["5232252","5232515","5232516","5232550","5232108","5232517","5232518","5232536","5232253","5232547","5232507","5232519","5232520","5232548","5232521","5232522","5232508","5232523","5232524","5232525","5232526","5232415","5232416","5232417","5232527","5232101","5232107","5232537","5232100","5232540","5232528","5232105","5232111"],"ed.engdis.com":["5230116","5232448"],"edux.qa.com":["5270001"]};if(IID="undefined"==typeof getCompositeCookie?JSON.parse(localStorage.getItem("Community")).IID:getCompositeCookie("Community","IID"),exceptions.hasOwnProperty(location.hostname)&&0<=exceptions[location.hostname].indexOf(IID))return!1;if(navigator.getUserMedia||(navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia)){var who=(ua=navigator.userAgent,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[],/trident/i.test(M[1])?"IE "+((tem=/\brv[ :]+(\d+)/g.exec(ua)||[])[1]||""):"Chrome"===M[1]&&null!=(tem=ua.match(/\bOPR\/(\d+)/))?"Opera "+tem[1]:(M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(tem=ua.match(/version\/(\d+)/i))&&M.splice(1,1,tem[1]),M.join(" "))),name=who.split(" ")[0],ver=parseInt(who.split(" ")[1]);return"Chrome"==name&&23<=ver||"Firefox"==name&&22<=ver||"Opera"==name&&18<=ver}return!1}(),edns=edns||{},edns.browser=edns.browser||{},edns.browser.webRtc=function(){var webRtcClassName=navigator.isWebRtcBrowser?"hasWebRtc":"noWebRtc";$("html").addClass(webRtcClassName)}(),String.prototype.fileName=function(){var s=this.split(/[#\?]/,1)[0].replace(/\\/g,"/");return s=s.substring(s.lastIndexOf("/")+1),(/^(([^\.]+)(\.\w+)?)/.exec(s)||[])[1]||""};var g_srObj1=function(){function g_srObj(strID){this.id=strID,this.bMicConnected=null,this.bRec=!1,this.recorder={},function(id){if(navigator.isWebRtcBrowser)$.ajax({url:Root+"runtime/JavaScript/audioApi/WebAudioRecorder.min.js",type:"get",async:!1,success:function(data){},error:function(){Logger.Log("error","Unable to load WebAudioRecorder.min.js!")}}),$("body").prepend("<div id='srcont' style='position:absolute;left:55%;top:15%;z-index:1000'>"),$("#srcont").append('<audio src="" id="__audio_player"></audio>');else{if(id=id||"srec",1==$("#"+id).length)return;var bIE=-1!=window.navigator.userAgent.indexOf("MSIE")&&-1==window.navigator.userAgent.indexOf("MSIE 8.0")||isObjOriented(),strFPF="srec.swf"+(isObjOriented()?"?a1="+(new Date).getTime():""),strRecCont="";bIE?(strRecCont=strRecCont+'<OBJECT id="'+id+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" allowScriptAccess="sameDomain"  SWLIVECONNECT="true" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" WIDTH="215" HEIGHT="138" MENU="FALSE">',strRecCont=(strRecCont+='<param name="wmode" value="transparent">')+'<PARAM NAME="movie" VALUE="'+Root+"Runtime/"+strFPF+'"><PARAM NAME="menu" VALUE="false"><PARAM NAME="quality" VALUE="high"><PARAM NAME="bgcolor" VALUE=#FFFFFF><PARAM NAME="allowScriptAccess" VALUE="always">',strRecCont+="</OBJECT>"):strRecCont=strRecCont+'<embed src="'+Root+'Runtime/srec.swf" quality="high" wmode="transparent" style="position:absolute;left:150px;top:0px;" bgcolor="#ffffff" width="255" height="158" id="'+id+'" name="'+id+'" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash" SWLIVECONNECT="true" PLUGINSPAGE="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash"></embed>',$("body").prepend("<div id='srcont' style='position:absolute;left:55%;top:15%;z-index:1000'>"),$("#srcont").append(strRecCont)}}(strID),this.objSR=-1<(navigator.appName.toLowerCase().indexOf("microsoft")&&-1==window.navigator.userAgent.indexOf("MSIE 8.0"))||isObjOriented()?document.getElementById(this.id):document.embeds[this.id]}g_srObj.prototype.disposeEx=function(){this.bRec&&this.stopRecord(),navigator.isWebRtcBrowser?WebRecorder.Dispose():$("#srcont").remove()},g_srObj.prototype.initObj=function(){if(navigator.isWebRtcBrowser){WebRecorder.Init(function(){Logger.Log("Microphone access allowed"),$.event.trigger({type:"RecorderMessage",message:["MicEnable",!0],time:new Date})},function(){Logger.Log("Microphone access denied")})}else{var self=this;self.objSR&&self.objSR.initRecorder?(self.bMicConnected=self.objSR.initRecorder(),0==self.bMicConnected&&$.event.trigger({type:"RecorderMessage",message:["disconnected"],time:new Date})):setTimeout(function(){self.initObj()},500)}},g_srObj.prototype.initRTimeOut=function(iTimeOut,bEx){navigator.isWebRtcBrowser||(1==bEx?this.objSR.initRecTimeoutEx(iTimeOut):this.objSR.initRecTimeout(iTimeOut))},g_srObj.prototype.startRecord=function(strRN,duration,cb){navigator.isWebRtcBrowser?(this.bRec=!0,duration=void 0===duration?1e6:duration,cb="function"==typeof cb?cb:activateStep2,WebRecorder.Record(duration,cb,strRN)):(this.bRec=!0,this.objSR.startRecord(strRN))},g_srObj.prototype.stopRecord=function(cancel){navigator.isWebRtcBrowser?(this.bRec=!1,WebRecorder.Stop(cancel)):this.objSR.stopRecord()},g_srObj.prototype.playRecord=function(strRN){strRN=void 0!==strRN?strRN:0,navigator.isWebRtcBrowser?WebRecorder.Play(parseInt(strRN)):void 0===strRN?this.objSR.playRecord():this.objSR.playRecord(strRN)},g_srObj.prototype.sendRecord=function(strRN,strURL){if(navigator.isWebRtcBrowser){var bUpdateRecord=0;name="Upd";var url=strURL;name=name.replace(/[\[\]]/g,"\\$&");var results=new RegExp("[?&]"+name+"(=([^&#]*)|&|#|$)").exec(url);bUpdateRecord=results&&results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):0;var qd={};strURL.substr(strURL.indexOf("?")+1).split("&").forEach(function(item){var s=item.split("="),k=s[0],v=s[1]&&decodeURIComponent(s[1]);k in qd?qd[k].push(v):qd[k]=[v]}),WebRecorder.Send(bUpdateRecord,qd.resName)}else this.objSR.sendData(strRN,strURL)},g_srObj.prototype.stopRCSound=function(){navigator.isWebRtcBrowser?WebRecorder.Stop():this.objSR.stopRSound()},g_srObj.prototype.isMCConnected=function(){return this.bMicConnected},g_srObj.prototype.loadRData=function(strURI){if(!navigator.isWebRtcBrowser)return this.objSR.loadData(strURI)},g_srObj.prototype.playLRec=function(){if(!navigator.isWebRtcBrowser)return this.objSR.playLRecord();this.recorder.play()};var Logger={active:!0,levels:["log","info","warn","error","dir"],Log:function(){Logger.active&&("string"==typeof arguments[0]&&-1!==Logger.levels.indexOf(arguments[0])?console[Array.prototype.shift.apply(arguments)].apply(this,arguments):console.log.apply(this,arguments))}},WebRecorder={debug:!0,recorder:null,audioContext:null,recordings:null,recIndex:null,Config:{workerDir:Root+"runtime/JavaScript/audioApi/",numChannels:2,encoding:"mp3",options:{timeLimit:120,encodeAfterRecord:!(g_srObj.prototype.checkRecLimits=function(resName){$.ajax({url:"FUpLoad/chkSRRecLimit.aspx?OS=1&resName="+resName,cache:!1,dataType:"text",async:!1,success:function(data){var arrVal=data.split(",");$.event.trigger({type:"RecorderMessage",message:["checkRecLimits",arrVal],time:new Date})}})}),mp3:{bitRate:64}}},Callbacks:{onEncoderLoading:function(recorder,encoding){Logger.Log("Loading encoder for %s format...",encoding)},onEncoderLoaded:function(){Logger.Log("Encoder loaded OK"),"function"==typeof WebRecorder.onAllow&&WebRecorder.onAllow()},onTimeout:function(recorder){Logger.Log("Maximum recording time reached"),WebRecorder.recorder.finishRecording(),"function"==typeof WebRecorder.onRecordingComplete&&WebRecorder.onRecordingComplete()},onEncodingProgress:function(recorder,progress){},onEncodingCanceled:function(recorder){Logger.Log("Recording cancelled")},onComplete:function(recorder,blob){if(WebRecorder.recordings){var url=URL.createObjectURL(blob);$("#__audio_player").attr("src",url),Logger.Log("Recording completed"),Logger.Log(url),WebRecorder.recordings[WebRecorder.recIndex]=blob}},onError:function(recorder,message){Logger.Log("error","Encoder error: %s",message)}},Init:function(onAllow,onNoMic){WebRecorder.recIndex=0,WebRecorder.recordings=[],audioContext=new AudioContext,$("#__audio_player").remove(),$('<audio src="https://" id="__audio_player"></audio>').appendTo("body"),window.URL=window.URL||window.webkitURL,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia({audio:!0},function(stream){microphone=audioContext.createMediaStreamSource(stream),WebRecorder.recorder=new WebAudioRecorder(microphone,$.extend(WebRecorder.Callbacks,WebRecorder.Config)),WebRecorder.onAllow=onAllow},function(error){Logger.Log("Unable to get microphone: %s",error.name),onNoMic&&onNoMic()})},Record:function(duration,onRecordingComplete,recNo){recNo="number"==typeof recNo?recNo:0,WebRecorder.recorder?(Logger.Log("info","recNo: %s",recNo),duration=duration,Logger.Log("Recording started. Timeout: %s sec",duration),WebRecorder.recIndex=recNo,WebRecorder.onRecordingComplete=onRecordingComplete,WebRecorder.recorder.setOptions({timeLimit:duration}),WebRecorder.recorder.startRecording()):Logger.Log("error","Recorder not ready")},Stop:function(cancel){cancel="boolean"==typeof cancel&&cancel,Logger.Log("warn","Stop command fired"),WebRecorder.recorder?(WebRecorder.recorder.isRecording()&&WebRecorder.recorder[cancel?"cancelRecording":"finishRecording"](),cancel&&(WebRecorder.onRecordingComplete=null)):Logger.Log("error","Recorder not ready");var e=$("#__audio_player")[0];e.paused||(e.pause(),e.currentTime=0)},Play:function(index){index="number"==typeof index?index:0,Logger.Log("Playing record #%s",index);var audio=$("#__audio_player"),url=URL.createObjectURL(WebRecorder.recordings[index]);url!==audio.attr("src")&&URL.revokeObjectURL(audio.attr("src")),audio.attr("src",url),audio[0].onended=function(){Logger.Log("Playing ended"),$.event.trigger({type:"RecorderMessage",message:["EndOfStream"],time:new Date})},audio[0].currentTime=0,audio[0].play()},Send:function(bUpdateRecord,resName){Logger.Log("Send to teacher called");var data=new FormData,blob=WebRecorder.recordings[WebRecorder.recIndex];data.append("file",blob),data.append("SType","OS"),data.append("FType","mp3"),data.append("resName",resName),$.ajax({url:"FUpload/FUpload.aspx?Upd="+bUpdateRecord,type:"POST",data:data,contentType:!1,processData:!1,success:function(data){Logger.Log("Result: %s",data),"DONE!"==data?$.event.trigger({type:"RecorderMessage",message:["asxRespStatus",200],time:new Date}):$.event.trigger({type:"RecorderMessage",message:["asxRespStatus",0],time:new Date}),$.event.trigger({type:"RecorderMessage",message:["asxResp",data],time:new Date})},error:function(data){Logger.Log("error","Sending error"),$.event.trigger({type:"RecorderMessage",message:["asxRespStatus",0],time:new Date}),$.event.trigger({type:"RecorderMessage",message:["asxResp",data],time:new Date})}})},Dispose:function(){Logger.Log("Disposing resources"),WebRecorder.recorder&&WebRecorder.recorder.isRecording()&&WebRecorder.recorder.cancelRecording(),URL.revokeObjectURL($("#__audio_player").attr("src")),WebRecorder.recordings=null,WebRecorder.recIndex=null,$("#__audio_player").remove()}},activateStep2=function(){$(this).removeClass("rec"),$(".js_rec_redo, .js_rec_done").removeClass("hide"),$(".hl").removeClass("hl"),deactivate($(".js_step1")),activate($(".js_step2")).addClass("hl")};return g_srObj}();function fsRecorderNotifyer(){$.event.trigger({type:"RecorderMessage",message:arguments,time:new Date})}function checkUnitProgressState(compId,subCompId,oldProgress,mode,progress){if(null!=oldProgress)for(var arrComps=oldProgress.split("|"),i=0;arrComps&&i<arrComps.length;i++){var arrElems=arrComps[i].split(":");if(arrElems&&arrElems[0]==compId&&("1"==arrElems[1]||"3"==arrElems[1])){var arrSubComps=arrElems[2].split(",");if(arrSubComps)for(var j=0;j<arrSubComps.length;j++){var arrSubCompProgress=arrSubComps[j].split(".");if(arrSubCompProgress&&arrSubCompProgress[0]==subCompId)switch(mode){case"0":if(2<arrSubCompProgress.length)return arrSubCompProgress[2]="1",arrSubComps[j]=arrSubCompProgress.join("."),arrElems[2]=arrSubComps.join(","),arrComps[i]=arrElems.join(":"),arrComps.join("|");case"1":if(1<arrSubCompProgress.length)return arrSubCompProgress[1]=progress,arrSubComps[j]=arrSubCompProgress.join("."),arrElems[2]=arrSubComps.join(","),arrComps[i]=arrElems.join(":"),arrComps.join("|");case"2":if(2<arrSubCompProgress.length)return arrSubCompProgress[2]}}}}return-1}function getBgImgPath(codeLtr,folder,code,bCheckURL){var testUrl,componentSkill={a:"Alphabet",l:"Listening",r:"Reading",g:"Grammar",s:"Speaking",w:"Writing",v:"Vocabulary"}[codeLtr],resPath=MediaRoot+"Runtime/Graphics/"+componentSkill+"/"+folder+"/"+code+".jpg";if(bIE&&getIEVer()<10&&MediaRoot!=Root)return resPath;if(void 0!==bCheckURL&&bCheckURL){200!=(testUrl=resPath,jQuery.ajax({type:"HEAD",url:testUrl,async:!1}).status)&&(resPath=MediaRoot+"Runtime/Graphics/"+componentSkill+"/"+folder+"/"+code+"v.jpg")}return resPath}function updateTestTaken(){var newProgress=checkUnitProgressState(getCompositeCookie("Component","Id"),getCompositeCookie("Component","SCId"),getCompositeCookie("Unit","Progress"),"0","0");-1!=newProgress&&setCompositeCookie("Unit","Progress",newProgress)}var arrMPTypes=null;function initArrMPTypes(id){null==arrMPTypes&&(arrMPTypes=new Array);var oMPType=new Object;oMPType._id=id,oMPType._type="sound",arrMPTypes[arrMPTypes.length]=oMPType}var bFlashAuto=!1;function IsSRInstalled(){var SRPresent=getCompositeCookie("Media","SR");if(1!=SRPresent){try{var srObj=new ActiveXObject("MTWTools.SafeSRS");SRPresent=null!=srObj&&srObj.isSRAvailable?1:0,srObj=null}catch(Expt){SRPresent=0}1==SRPresent&&setCompositeCookie("Media","SR",1)}return SRPresent}function setFile(strFileName,strOName){var strMPOName=getMPObjName(strOName);if(getFPType(strOName))try{document.all?(bFlashAuto&&fssetAutostart(!0,strOName),window[strMPOName].setFile(strFileName)):(bFlashAuto&&fssetAutostart(!0,strOName),document.embeds[strMPOName].setFile(new String(strFileName).toString()))}catch(e){}else{var mpVObj=getMPCross(strMPOName);void 0===mpVObj&&(mpVObj=document.getElementById(strMPOName));var strFN=new String(strFileName).toString(),paths=strFN.split("/");paths[paths.length-1].split("."),paths[paths.length-2];try{mpVObj.openFile(strFN)}catch(e){setTimeout("setFile('"+strFileName+"','"+strOName+"')",500)}}}function getMPObjName(strOName){return strOName||"MediaPlayer"}function getFPType(strOName){if(null!=arrMPTypes&&strOName)for(var i=0;i<arrMPTypes.length;i++){var oMPType=arrMPTypes[i];if(oMPType._id==strOName.toString())return"video"!=oMPType._type}return!!(strOName&&-1<strOName.indexOf("PMediaPlayer"))}function getElementAbsolutePos(element){var res=new Object;if(res.x=0,res.y=0,null!==element)if(element.getBoundingClientRect){var scrollTop=f_scrollTop(),scrollLeft=f_scrollLeft(),box=element.getBoundingClientRect();res.x=box.left+scrollLeft,res.y=box.top+scrollTop}else{res.x=element.offsetLeft,res.y=element.offsetTop;for(var parentNode=element.parentNode,borderWidth=null;null!=offsetParent;){res.x+=offsetParent.offsetLeft,res.y+=offsetParent.offsetTop;var parentTagName=offsetParent.tagName.toLowerCase();if((__isIEOld&&"table"!=parentTagName||(__isFireFoxNew||__isChrome)&&"td"==parentTagName)&&(borderWidth=kGetBorderWidth(offsetParent),res.x+=borderWidth.left,res.y+=borderWidth.top),offsetParent!=document.body&&offsetParent!=document.documentElement&&(res.x-=offsetParent.scrollLeft,res.y-=offsetParent.scrollTop),!__isIE&&!__isOperaOld||__isIENew)for(;offsetParent!=parentNode&&null!==parentNode;)res.x-=parentNode.scrollLeft,res.y-=parentNode.scrollTop,(__isFireFoxOld||__isWebKit)&&(borderWidth=kGetBorderWidth(parentNode),res.x+=borderWidth.left,res.y+=borderWidth.top),parentNode=parentNode.parentNode;parentNode=offsetParent.parentNode,offsetParent=offsetParent.offsetParent}}return res}function f_scrollLeft(){return f_filterResults(window.pageXOffset?window.pageXOffset:0,document.documentElement?document.documentElement.scrollLeft:0,document.body?document.body.scrollLeft:0)}function f_scrollTop(){return f_filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}function f_filterResults(n_win,n_docel,n_body){var n_result=n_win||0;return n_docel&&(!n_result||n_docel<n_result)&&(n_result=n_docel),n_body&&(!n_result||n_body<n_result)?n_body:n_result}function isRTLMode(){var lang,support;return("heb"==(lang=null!=GetCookie("Student")&&"-1"!=getCompositeCookie("Student","SID")?(support=getCompositeCookie("Student","LangSupLevel"),getCompositeCookie("Student","Language")||language):(support=getCompositeCookie("Community","InstLangSupLevel"),getCompositeCookie("Community","InstLang")||"eng"))||"ara"==lang)&&3==support}function stopScroll(e){return $(".learning__IW").scrollTop(0),!1}function callService(type,paramData,url,funcOnSuccess,funcOnFail,cache,async,dType,contentType,noDObj){$.ajax({url:url,datatype:void 0===dType?"json":dType,data:paramData,type:type,cache:void 0===cache||cache,async:async||!0,contentType:contentType||"",error:function(x){funcOnFail(x)},success:function(jsondata){funcOnSuccess(void 0===dType||void 0!==contentType?!0===noDObj?jsondata:jsondata.d:jsondata)}})}function isObjOriented(chkMode){return-1<window.navigator.userAgent.indexOf("MSIE 8.0")}function getTLWindow(){var s_window=window;try{window.top.__access_test__=!0,s_window=window.top}catch(e){}return s_window}function getValueOrDefault(obj,defaultValue){return void 0!==obj?obj:void 0!==defaultValue?defaultValue:null}var getElementTotalPaddingMargin=function(el,boolHeight,boolWidth,Boolborder){var retVal=0;return!0===boolHeight&&(retVal+=getCssNumericVal(el,"padding-top")+getCssNumericVal(el,"padding-bottom")+getCssNumericVal(el,"margin-top")+getCssNumericVal(el,"margin-bottom"),!0===Boolborder&&(retVal+=getCssNumericVal(el,"border-top")+getCssNumericVal(el,"border-bottom")+getCssNumericVal(el,"border-top")+getCssNumericVal(el,"border-bottom"))),!0===boolWidth&&(retVal+=getCssNumericVal(el,"padding-left")+getCssNumericVal(el,"padding-right")+getCssNumericVal(el,"margin-left")+getCssNumericVal(el,"margin-right"),!0===Boolborder&&(retVal+=getCssNumericVal(el,"border-left")+getCssNumericVal(el,"border-right")+getCssNumericVal(el,"border-left")+getCssNumericVal(el,"border-right"))),retVal},XMLHttpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],xdPmRequest;function createCORSRequest(){var xhr=createXMLHTTPObject();return!bIE||10<getIEVer()||(xhr="undefined"!=typeof XDomainRequest?new XDomainRequest:null),xhr}function createXMLHTTPObject(){for(var xmlhttp=!1,i=0;i<XMLHttpFactories.length;i++){try{xmlhttp=XMLHttpFactories[i]()}catch(e){continue}break}return xmlhttp}function f1w(strV){document.write(strV)}function getReadyStateHandler(req,responseHandler,sequence,errorHandler){return function(){4==req.readyState&&(200==req.status?responseHandler(req,sequence):void 0!==errorHandler?errorHandler(req):0!=req.status&&alert("There was a problem retrieving the data:\n"+req.statusText))}}function loadData(url,processResponse,sequence,isAsync,errorHandler){var req=newXMLHttpRequest();req.onreadystatechange=getReadyStateHandler(req,processResponse,sequence,errorHandler);var async=!0;void 0!==isAsync&&0==isAsync&&(async=isAsync),req.open("GET",url,async),req.send()}function newXMLHttpRequest(){var xmlReq=!1;if(window.XMLHttpRequest)xmlReq=new XMLHttpRequest;else if(window.ActiveXObject)try{xmlReq=new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(e){try{xmlReq=new ActiveXObject("Microsoft.XMLHTTP")}catch(e1){alert("Unable to create an XMLHttpRequest with ActiveX")}}return xmlReq}function openFeedback(readyUnvisited,remainingSubmissions){AWEModal=edns.modalManager.custom({iFrameUrl:Root+"Runtime/AWE/DetailedFeedback.html?readyUnvisited="+readyUnvisited+"&remainingSubmissions="+remainingSubmissions,iFrameHeight:655,iFrameWidth:1024,okCallbackAsync:!0,windowClass:"eraterModal",disposeCallbackAfter:function(){setTimeout(function(){$.publish("practiceResize")},4)}})}function UTCToLocalTime(d){var timeOffset=-(new Date).getTimezoneOffset()/60;return d.setHours(d.getHours()+timeOffset),d}!function($){if(!($.subscribe||$.unsubscribe||$.publish)){var o=$({});$.subscribe=function(){o.on.apply(o,arguments)},$.unsubscribe=function(){o.off.apply(o,arguments)},$.publish=function(){o.trigger.apply(o,arguments)},$.whenall=function(arr){return $.when.apply($,arr)}}}(jQuery);var editor=function(){function editor_(initFn,selector,wordCount,customBT,maximumWords,styleSheet,onChangeFn){tinyMCE.init({selecteor:selector,mode:"textareas",theme:"advanced",theme_advanced_buttons1:"undo_,redo_,save_,separator,word_c",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",content_css:styleSheet,plugins:"maxlength, paste",paste_text_sticky:!0,paste_text_sticky_default:!0,maxlength:maximumWords,oninit:initFn,setup:function(ed){wordCount&&ed.addButton("word_c",{label:"Words : 0",image:!1,disabled:"true",onclick:function(evt){ed.focus(),evt.preventDefault()}}),ed.addButton("undo_",{title:"Undo",onclick:function(event){if(void 0!==onChangeFn&&!onChangeFn(event))return!1;ed.focus(),ed.execCommand("undo"),wordCountFix()}}),ed.addButton("redo_",{title:"Redo",onclick:function(event){if(void 0!==onChangeFn&&!onChangeFn(event))return!1;ed.focus(),ed.execCommand("redo"),wordCountFix()}}),$.each(customBT,function(){ed.addButton(this.name,{title:this.title,onclick:this.clickHandler})}),ed.onKeyUp.add(function(ed,l){wordCountFix()}),ed.onKeyDown.add(function(ed,event){return!(void 0!==onChangeFn&&!onChangeFn(event))&&("false"==ed.dom.select("body")[0].contentEditable&&13==event.keyCode?(event.preventDefault(),event.stopPropagation(),!1):void 0)})}})}return wordCountFix=function(){if("true"==tinyMCE.activeEditor.dom.select("body")[0].contentEditable&&$("span.mce_save_").removeClass("disable"),0<$(tinyMCE.selectedInstance.getContent()).text().length){var number=tinyMCE.selectedInstance.getContent().replace(/&nbsp;|<p>|<\/p>/g,"").replace(/\s/g,"^").match(/([a-zA-Z0-9\-]+)/g);$(".mceButtonLabel").html('<span class="wordsNumber">'+(number?number.length:0)+"</span><span>Words</span>")}else $(".mceButtonLabel").html('<span class="wordsNumber disable">0</span><span class="disable">Words</span>')},editor_.prototype.setContent=function(content){tinyMCE.selectedInstance.setContent(content),wordCountFix()},editor_.prototype.getContent=function(){return tinyMCE.selectedInstance.getContent({format:"text"}).replace("’","'")},editor_.prototype.getHtmlContent=function(){return tinyMCE.selectedInstance.getContent().replace("’","'")},editor_.prototype.disable=function(){$(tinyMCE.activeEditor.dom.select("body")[0]).addClass("disable"),tinyMCE.activeEditor.dom.select("body")[0].contentEditable=!1},editor_.prototype.enable=function(){$(tinyMCE.activeEditor.dom.select("body")[0]).removeClass("disable"),tinyMCE.activeEditor.dom.select("body")[0].contentEditable=!0},editor_.prototype.addClass=function(className){$(tinyMCE.activeEditor.dom.select("body")[0]).addClass(className)},editor_}();function setSeeText(itemCode,container){$.ajax({type:"GET",url:MediaRoot+"Runtime/Lessons/"+itemCode.substring(0,6)+".js",dataType:"script",cache:!0,async:!1,success:function(data){var resPath;(resPath=getResPath(getItemResources(itemCode,lesson)))&&$.ajax({type:"GET",url:MediaRoot+"Runtime/"+resPath,dataType:"script",cache:!0,async:!1,success:function(data){var textExplore=strExpl.textExp.replace("src='Graphics/","src='"+MediaRoot+"Runtime/Graphics/");$(container).html(getExternalWrapper(itemCode.substring(0,6),textExplore))}})},error:function(err){}})}function getItemResources(itemCode,lesson){var itemResources=lesson.Resources;return itemResources||($.each(lesson.steps,function(){$.each(this.tasks,function(){if(this.code==itemCode)return itemResources=lesson.resSets[this.resLink[0]].Resources,!0})}),itemResources)}function getResPath(resources){var textResPath=null;return $.each(resources,function(){0!=this.type||(textResPath=this.resPath)}),textResPath}function getExternalWrapper(strCode,strTxtExpl,isCCSeeText){if(0==strCode.indexOf("ccr"))return isCCSeeText&&(strTxtExpl="<div class='seeTxtContainer'>"+strTxtExpl+"</div>"),-1<strTxtExpl.indexOf("readingExploreWrapper--extAT")&&addClassToTextwrapper((strTxt=strTxtExpl,_.find([{wrapperClass:"article",class:"article"},{wrapperClass:"postcard",class:"email"},{wrapperClass:"letter",class:"letter"},{wrapperClass:"story",class:"story"},{wrapperClass:"notice",class:"notice"},{wrapperClass:"blank",class:"readingExploreWrapper--AT_Blank"}],function(v){return-1<strTxt.indexOf(v.class)}).wrapperClass)),strTxtExpl;var strTxt,readingTmplCode=strCode.charAt(3),arrRWrappers={a:"readingExploreWrapper article",s:"readingExploreWrapper story",n:"readingExploreWrapper notice",p:"readingExploreWrapper postcard",l:"readingExploreWrapper letter",d:"readingExploreWrapper notice"},arrRSWrappers={s:"readingExploreContentWrapper",a:"readingExploreContentWrapper"},strWrapper="";if(strCode){switch((strCode=strCode.toLowerCase()).charAt(2)){case"r":-1<strTxtExpl.toLowerCase().indexOf("readingexplorewrapper")||(strWrapper=readingTmplCode in arrRWrappers?arrRWrappers[readingTmplCode]:"readingExploreWrapper"+(-1<strTxtExpl.toLowerCase().indexOf("specialtemplat")?"":" notice")),addClassToTextwrapper(function(readingTmplCode,arrRWrappers,strTxtExpl){return readingTmplCode in arrRWrappers?isDefaultButNotNotice(strTxtExpl)?null:arrRWrappers[readingTmplCode].split(" ")[1]:null}(readingTmplCode,arrRWrappers,strTxtExpl));break;case"w":strWrapper=readingTmplCode in arrRWrappers&&"p"==readingTmplCode?arrRWrappers[readingTmplCode]:"readingExploreWrapper blank"}readingTmplCode in arrRSWrappers&&(strTxtExpl="<div class='"+arrRSWrappers[readingTmplCode]+"'>"+strTxtExpl+"</div>"),0<strWrapper.length&&(strTxtExpl=isDefaultButNotNotice(strTxtExpl)?"<div class='readingExploreWrapper'>"+strTxtExpl+"</div>":"<div class='"+strWrapper+"'>"+strTxtExpl+"</div>")}function isDefaultButNotNotice(strTxtExpl){return 0<strTxtExpl.indexOf("readingExploreTxtWrapper Ad")||0<strTxtExpl.indexOf("readingExploreTxtWrapper memo")}return strTxtExpl}function addClassToTextwrapper(className){$(".learning__RATextResourceW").addClass("readingW"),className&&$(".learning__RATextResourceW").addClass(className+"W")}function sendData(paramData,callBack,onError,isAsync){$.ajax({type:"POST",url:"WebApi/Communication/SendMessageToTeacher",contentType:"application/json; charset=utf-8",data:JSON.stringify(paramData),cache:!0,async:null!=isAsync&&isAsync,success:function(){callBack()},error:function(err){null!=onError&&onError(err)}})}if(void 0===edns)var edns={};function ConvertToDateFromSql(sqlDate){var time=sqlDate.substring(sqlDate.indexOf(" ")),dateParts=sqlDate.substring(0,sqlDate.indexOf(" ")).split("/"),tmp=dateParts[0];return dateParts[0]=dateParts[2],dateParts[2]=tmp,new Date(dateParts.join("/")+time)}function resouceWithImages_augmentImageResPath(resourceText,MediaRoot){var $resTxt=$("<div>"+resourceText+"</div>");function replaceBGPath(i,v){$(v).attr("style",$(v).attr("style").replace("Graphics/",MediaRoot+"Runtime/Graphics/"))}return $resTxt.find("img[src^='Graphics']").each(function(i,v){$(v).attr("src",$(v).attr("src").replace("Graphics/",MediaRoot+"Runtime/Graphics/"))}),$resTxt.find("div[class^='bgImg']").each(replaceBGPath),$resTxt.find("span.logo[style]").each(replaceBGPath),$resTxt.html()}void 0===edns.utils&&(edns.utils={}),edns.utils.formatSecondsForMediaPlayer=function(totalSec,optionalSeperator){totalSec=Math.round(totalSec),seperator=optionalSeperator||":";var seconds=totalSec%60;function paddZero(val){return val<10?"0"+val:val}return paddZero(parseInt(totalSec/60)%60)+seperator+paddZero(seconds)},Date.prototype.toWCFString||(Date.prototype.toWCFString=function(){var m=(this.getMonth()+1).toString(),d=this.getDate().toString();return this.getFullYear()+"-"+(1==m.length?"0"+m:m)+"-"+(1==d.length?"0"+d:d)+"T"+this.toTimeString().substring(0,8)+"Z"}),Date.prototype.toddmmyyyyString||(Date.prototype.toddmmyyyyString=function(){var m=(this.getMonth()+1).toString(),d=this.getDate().toString();return(1==d.length?"0"+d:d)+"/"+(1==m.length?"0"+m:m)+"/"+this.getFullYear()+" "+this.toTimeString().substring(0,8)}),Date.prototype.fromUtcToLocal||(Date.prototype.fromUtcToLocal=function(dateType){var copiedDate=new Date(this.getTime());return copiedDate.setMinutes(copiedDate.getMinutes()+-1*(new Date).getTimezoneOffset()),void 0!==dateType&&dateType?copiedDate:copiedDate.toddmmyyyyString()}),String.prototype.ReplaceHtmlToASCII||(String.prototype.ReplaceHtmlToASCII=function(){return this.replace(/&#(\d+);/g,function(m,n){return String.fromCharCode(n)})});var srWin=null,srMode="Exp";-1!=location.search.indexOf("Idioms")&&(srMode="Idioms");var srpBtnPlayState=!1,vocId;function getCBWin(){for(var objIFR=$("IFRAME"),i=0;i<objIFR.length;i++){var objLocRef=objIFR[i].src.toLowerCase();if(-1<objLocRef.indexOf("speechrecognition.html")||-1<objLocRef.indexOf("srpanel.aspx")||-1<objLocRef.indexOf("asrpanel.htm"))return objIFR[i].contentWindow}return null}function setPronunciation(strSourceText,strKey){strSourceText=unescape(strSourceText);var strKeyBegin="<"+strKey+">",strKeyEnd="</"+strKey+">",srWin=getCBWin();try{null!=srWin&&null!=srWin.document&&null!=srWin.document.applets.SRShell&&srWin.document.applets.SRShell.isActive()||null!=srWin&&null!=srWin.document&&srWin.setParameters?(strPronoun="1",strWithVideo="1",srWin.setParameters(strSourceText,strKeyBegin,strKeyEnd,'<span STYLE="CURSOR: pointer" class="spanPronoun" onclick="spanClick();">',"</span>",strPronoun,strWithVideo)):setTimeout("setPronunciation('"+escape(strSourceText)+"','"+strKey+"')",300)}catch(e){setTimeout("setPronunciation('"+escape(strSourceText)+"','"+strKey+"')",300)}}function setSRMode(mode){void 0!==mode&&""!=mode&&(srMode=mode)}function openIdiomsSRPanel(){if(bIE&&!IsSRInstalled()&&!isIE64bit())return downloads(),!1;if(!$("#openIdiomSRPanel"))return!1;srMode="Idioms",cboxSROpen=!0;var panelPath=$("#openIdiomSRPanel").attr("href").fileName();return $("#openIdiomSRPanel").attr("href",$("#openIdiomSRPanel").attr("href").replace(panelPath,navigator.isWebRtcBrowser?"ASRPanel.htm":bIE?"SRPanel.aspx":"speechRecognition.html")),!bIE||IsSRInstalled()||isIE64bit()?($("#openIdiomSRPanel").click(),!0):(downloads(),!1)}function openSRPanel(xloc,yloc,mode,id,resName){return!bIE||IsSRInstalled()||isIE64bit()?(2<arguments.length&&""!=mode&&(srMode=mode),document.getElementById("open_prn")&&isPressed("open_prn")&&(mode="Pronunciation"),!!openSRPanelCBox&&openSRPanelCBox(mode,void 0,resName)):(downloads(),!1)}function closeSRPanel(){return null==srWin||srWin.closed||(srWin.opener=null,srWin.close()),!(srWin=null)}function isLetter(c){return"a"<=c&&c<="z"||"A"<=c&&c<="Z"}function isDigit(c){return"0"<=c&&c<="9"}function isLetterOrDigit(c){return isLetter(c)||isDigit(c)}function stripInitialSymbols(sText){var i=0;for(i=0;i<sText.length&&!isLetterOrDigit(sText.charAt(i))&&'"'!=sText.charAt(i)&&"'"!=sText.charAt(i);i++);return sText.substring(i,sText.length)}function cleanText(sText){var cCurrChar,i,iFirstIndex=0,iLastIndex=sText.length-1;for(i=0;i<sText.length;i++)if(" "<(cCurrChar=sText.charAt(i))&&cCurrChar<="z"){iFirstIndex=i;break}var diacriticSymbols=["é","â"];for(i=sText.length-1;0<=i;i--)if(" "<(cCurrChar=sText.charAt(i))&&cCurrChar<="z"||-1<diacriticSymbols.indexOf(cCurrChar)){iLastIndex=i+1;break}return sText.substring(iFirstIndex,iLastIndex)}function setSoundPlayer4Idiom(filePath){try{var srWinP=getCBWin();null!=srWinP&&null!=srWinP.document&&srWinP.setSP4Idiom?(srWinP.setSP4Idiom(filePath),srWinP.focus()):setTimeout("setSoundPlayer4Idiom('"+filePath+"')",300)}catch(e){setTimeout("setSoundPlayer4Idiom('"+filePath+"')",300)}}function setTextSR(strT){strT=cleanText(strT);strT=unescape(strT);try{var srWinP=getCBWin();null!=srWinP&&null!=srWinP.document&&null!=srWinP.document.applets.SRShell&&srWinP.document.applets.SRShell.isActive()||null!=srWinP&&null!=srWinP.document&&srWinP.setText?(2<arguments.length?("Alphabet"==srWinP.parent.skill&&(strT="<CENTER><SEGMENT NUM=1 STYLENUM=11>"+strT+"</SEGMENT>"),3<arguments.length?srWinP.setText(strT,arguments[1],arguments[2],arguments[3]):srWinP.setText(strT,arguments[1],arguments[2])):srWinP.setText(strT,arguments[1]),srWinP.focus()):3<arguments.length?setTimeout("setTextSR('"+escape(strT)+"','"+arguments[1]+"','"+arguments[2]+"','"+arguments[3]+"')",300):2<arguments.length?setTimeout("setTextSR('"+escape(strT)+"','"+arguments[1]+"','"+arguments[2]+"')",300):setTimeout("setTextSR('"+escape(strT)+"','"+arguments[1]+"')",300)}catch(e){2<arguments.length?setTimeout("setTextSR('"+escape(strT)+"','"+arguments[1]+"','"+arguments[2]+"')",300):setTimeout("setTextSR('"+escape(strT)+"','"+arguments[1]+"')",300)}}function srcPlayFinished(){var srWinP=getCBWin();"Idioms"==srMode?null!=srWinP&&srpBtnPlayState&&srWinP.srcPlayFinished():null!=srWinP&&srWinP.srcPlayFinished()}function srpBtnClicked(btnName,btnState){"Exp"==srMode?"community"==window.top.name?parent.onBtnClicked(btnName,btnState):onBtnClicked(btnName,btnState):"Idioms"==srMode?null!=parent&&(1==btnState?(srpBtnPlayState=!0,parent.playIdiomSR()):(srpBtnPlayState=!1,parent.stopIdiomSR())):"Vocabulary"==srMode?doSound(btnState):"VocabularyExt"==srMode&&null!=parent&&parent.hear(vocId,btnState,"SR")}function setCTrEnabled(bEnable){null!=document.applets.CTracker&&document.applets.CTracker.setEnabled(bEnable)}function srpClosed(){if(0<$("#audio_remote").length&&$("#audio_remote")[0].pause(),"Exp"==srMode){if(window.isPressed){var strSRPopen=$("#open_srp").hasClass("selected")?"open_srp":"pf";window.onBtnClicked(strSRPopen)}}else"Idioms"==srMode?SRPClosed():"VocabularyExt"==srMode&&(srMode="Exp",null!=parent&&(parent.hear(vocId,!1,"SR"),parent.SRPClosed()))}function finishSRPanel(){null==srWin||srWin.closed||null==srWin.document||(srWin.opener=null,srWin.close()),srWin=null}function IsSRInstalled(){var bSRpresent;if(1!=(bSRpresent=getCompositeCookie("Media","SR"))){try{var srObj;bSRpresent=null!=(srObj=new ActiveXObject("MTWTools.SafeSRS"))&&srObj.isSRAvailable?1:0}catch(Expt){bSRpresent=0}1==bSRpresent&&setCompositeCookie("Media","SR",1)}return bSRpresent}var SR_Score=function(){var wlContainer,slContainer;function SRScore(_wlContainer,_slContainer){wlContainer=void 0!==_wlContainer?_wlContainer:null,slContainer=void 0!==_slContainer?_slContainer:null,$("#wlScoreTmpl").length<1&&$("<script/>",{type:"text/html",id:"wlScoreTmpl",text:'<div class="srSentenceWLfeedback" id="">{{each(i, score) wlArray}}<span class="${score.class}">${score.word}</span> {{/each}}</div>'}).appendTo(document.body),$("#slScoreTmpl").length<1&&$("<script/>",{type:"text/html",id:"slScoreTmpl",text:'<div class="left"><div class="scoreRangeWrapper">${score}</div><div class="scoreExpWrapper">${translate[scoreExplanation]}</div></div><div class="right"><span class="scoreSquares${scoreId}"></span></div>'}).appendTo(document.body)}function parseSentence(txt,scores){for(var words=txt.match(/(\d+[,.]{1}\d+|[^ ,.!?_+=@#&*()\-–\"\\\/])+/gi),out=[],out_index=0,add=function(score,length){out[out_index++]='<span class="'+getClassByWlFormula(score)+'">'+txt.substr(0,length)+"</span>",txt=txt.substr(length)},i=0,start=0;i<words.length;i++){var len=words[i].length;0<(start=txt.indexOf(words[i]))&&add(-1,start),add(scores[i],len)}return""!==txt&&add(-1,txt.length),out}function getClassByWlFormula(score){switch(score){case 1:case 2:case 3:return"failed";case 4:case 5:case 6:return"success";default:return"punctuations"}}function fixSpecialGrammars(grammarId,scores){if(void 0===grammarId)return scores;if(grammarId=grammarId.toUpperCase(),specialGrammars.hasOwnProperty(grammarId))for(var i=0;i<specialGrammars[grammarId].length;i++){var left=specialGrammars[grammarId][i].L-i-1,right=specialGrammars[grammarId][i].R-i-1;scores[left]=Math.round((scores[left]+scores[right])/2),scores.splice(right,1)}return scores}SRScore.prototype.getWLHtml=function(text,scores,grammarId){wlContainer&&$(wlContainer).empty();var html=parseSentence(text,fixSpecialGrammars(grammarId,scores)).join("");return wlContainer&&$(wlContainer).html(html),html},SRScore.prototype.highlightTextWL=function(sentence,grammarId){try{var words,fullText=$(wlContainer).text(),scores=[],wordsObj=new JsonHandler(sentence);words=null===wordsObj.data?sentence.split(" "):wordsObj.getArray("word");for(var i=0;i<words.length;i++)scores[i]=words[i].score;var out=parseSentence(fullText,fixSpecialGrammars(grammarId,scores));$(wlContainer).html(out.join(""))}catch(ex){alert("WL highlight exception! Error: "+ex.message),console.log(ex.message)}},SRScore.prototype.getWords=function(){return $(wlContainer).text().match(/(\d+[,.]{1}\d+|[^ ,.!?_+=@#&*()\-–\"\\\/])+/gi)},SRScore.prototype.setFail=function(){var text=$(wlContainer).text();$(wlContainer).empty();var wlArray=[{word:text,class:getClassByWlFormula(1)}];$("#wlScoreTmpl").tmpl({wlArray:wlArray}).appendTo(wlContainer)},SRScore.prototype.getFailHtml=function(text){return'<span class="'+getClassByWlFormula(1)+'">'+text+"</span>"},SRScore.prototype.clearWLHtml=function(){var txt=$(wlContainer).text();""!=txt&&$(wlContainer).empty().html(txt)},SRScore.prototype.getSLHtml=function(level){$(slContainer).empty();var slJson={score:function(level){switch(level){case 1:return"0%-16%";case 2:return"17%-33%";case 3:return"34%-50%";case 4:return"51%-66%";case 5:return"67%-83%";case 6:return"84%-100%"}}(level),scoreId:level,scoreExplanation:251+level-1};$("#slScoreTmpl").tmpl(slJson).appendTo(slContainer)},SRScore.prototype.clearSLHtml=function(){$(slContainer).empty()};var specialGrammars={A2SOES_1:[{L:7,R:9}],A2SOES_4:[{L:3,R:5},{L:16,R:18}],A2LOAD01_30:[{L:10,R:12}]};return SRScore}(),ScriptLoader=function(){var self;function scriptLoader(scripts){scripts=scripts instanceof Array?scripts:[],this.deferred=[],this.queue=scripts,this.inProgress=!1,this.isLoaded=!1,self=this}function loadContent(path,async){return getTLWindow().$.ajax({url:path,dataType:path.endsWith(".css")?"text":"script",cache:!1,async:async,success:function(data){if(path.endsWith(".css")){var temp=$("<style>"+data+"</style>").appendTo("head");$('<link type="text/css" rel="stylesheet" href="'+path+'" />').appendTo("head").on("load",function(){temp.remove()})}console.log("SCRIPT "+path+" LOADED")},error:function(data){console.error("SCRIPT "+path+" NOT LOADED")}})}return scriptLoader.prototype.add=function(path){this.queue.push(path)},scriptLoader.prototype.load=function(async){async="boolean"==typeof async&&async,this.inProgress=!0;for(var i=0;i<this.queue.length;i++)this.deferred.push(loadContent(this.queue[i],async));return this.getDeferred().done(function(){self.inProgress=!1,self.isLoaded=!0})},scriptLoader.prototype.getDeferred=function(){return $.whenall(this.deferred)},scriptLoader.prototype.isInProgress=function(){return this.inProgress},scriptLoader.prototype.isLoaded=function(){return this.isLoaded},scriptLoader}();getTLWindow().developerMode=!1,getTLWindow().SR=getTLWindow().SR||{debug:void 0!==getTLWindow().developerMode&&getTLWindow().developerMode,PM:{initCallback:null,startRecognitionCompleted:null,speechStarted:null,recognitionCompleted:null,recognizerReady:null,beforeMicAllow:null,micAllowed:null,context:null,recordings:{},uiInitialized:!1,Init:function(context,initCallback,startRecognitionCompleted,speechStarted,recognitionCompleted,recognizerReady,beforeMicAllow,micAllowed,compCode){SR.PM.uiInitialized=!1,SR.PM.context=context,SR.PM.initCallback=initCallback,SR.PM.startRecognitionCompleted=startRecognitionCompleted,SR.PM.speechStarted=speechStarted,SR.PM.recognitionCompleted=recognitionCompleted,SR.PM.recognizerReady=recognizerReady,SR.PM.beforeMicAllow=beforeMicAllow,SR.PM.micAllowed=micAllowed,void 0!==compCode&&""!==compCode&&(SR.Engine.API.compCode=compCode),SR.Engine.SetCurrentEngine()},Recognize:function(gid,text){SR.Engine.API.Recognize(gid,SR.Engine.Filter(text))},Stop:function(cleanup){SR.Engine.API.Stop(cleanup),!0===cleanup&&(this.context=null)},StopPlaying:function(){var el=$("#audio_remote")[0];el&&(el.pause(),el.currentTime=0)},Hear:function(id){SR.Engine.API.Hear(id)},Send:function(){SR.Engine.API.Send.apply(this,arguments)}},Engine:{SetCurrentEngine:function(){var SR_ENGINE=parseInt(new JsonHandler(localStorage.getItem("Community")).get("SpeechRecognitionEngineName"));switch(SR_ENGINE){case 0:case 1:SR_ENGINE="VERTO";break;case 2:SR_ENGINE="SPEAKINGPAL";break;case 3:SR_ENGINE="HTML5RECORDER"}SR_ENGINE=SR.ENGINES.hasOwnProperty(SR_ENGINE)?SR_ENGINE:new JsonHandler(sessionStorage.getItem("InstitutionsData")).get("SR_ENGINE","VERTO"),SR.Console.Log("SR => Institution engine is: "+SR_ENGINE),SR.ENGINES.hasOwnProperty(SR_ENGINE)?(!0!==SR.Engine.extended&&(!0!==SR.Console.createOnce&&$.extend(!0,SR.Console,SR.Templates.ConsoleTemplate),$.extend(!0,SR.Engine.API,SR.ENGINES[SR_ENGINE]),$.extend(!0,SR.Engine.KeepAlive,SR.Templates.KeepAliveTemplate),SR.Engine.extended=!0),SR.CODES=SR.Engine.API.CODES,SR.Engine.API.Init()):console.error("Engine "+SR_ENGINE+" not found")},reportTransaction:function(additionalParams,optionalParamsQS){console.warn("reportTransaction is deprecated!")},ReportTransactionLight:function(additionalParams){console.warn("ReportTransactionLight is deprecated")},Filter:function(s){if("string"!=typeof s||s.length<=0||"comp_code"===s)return s;SR.Console.Log("SR: Filter: Before: "+s);for(var sf=(s=s.replace("¾","three_quarters").replace("½","one_half").replace("° "," degrees")).match(/(\d+[,.]{1}\d+|[^ ,.!?+=@#&*()\-–\"\\\/:;])+/gi).join(" ").toLowerCase(),words=(sf=sf.replace(/é/g,"e").replace(/â/g,"a")).split(" "),i=0;i<words.length;i++)words[i]=words[i].replace(/^[\']+|[\']+$/g,"");return sf=words.join(" "),SR.Console.Log("SR: Filter: After: "+sf),sf},KeepAlive:{Start:function(){},Stop:function(){}},InitClientDetails:function(){window.clientDetails||function(window){var screenSize="";screen.width&&(width=screen.width?screen.width:"",height=screen.height?screen.height:"",screenSize+=width+" x "+height);var nameOffset,verOffset,ix,nVer=navigator.appVersion,nAgt=navigator.userAgent,browser=navigator.appName,version=""+parseFloat(navigator.appVersion),majorVersion=parseInt(navigator.appVersion,10);-1!=(verOffset=nAgt.indexOf("Edge"))?(browser="Edge",version=nAgt.substring(verOffset+5),-1!=(verOffset=nAgt.indexOf("Version"))&&(version=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("Opera"))?(browser="Opera",version=nAgt.substring(verOffset+6),-1!=(verOffset=nAgt.indexOf("Version"))&&(version=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("OPR"))?(browser="Opera",version=nAgt.substring(verOffset+4)):-1!=(verOffset=nAgt.indexOf("MSIE"))?(browser="Microsoft Internet Explorer",version=nAgt.substring(verOffset+5)):-1!=(verOffset=nAgt.indexOf("Chrome"))?(browser="Chrome",version=nAgt.substring(verOffset+7)):-1!=(verOffset=nAgt.indexOf("Safari"))?(browser="Safari",version=nAgt.substring(verOffset+7),-1!=(verOffset=nAgt.indexOf("Version"))&&(version=nAgt.substring(verOffset+8))):-1!=(verOffset=nAgt.indexOf("Firefox"))?(browser="Firefox",version=nAgt.substring(verOffset+8)):-1!=nAgt.indexOf("Trident/")?(browser="Microsoft Internet Explorer",version=nAgt.substring(nAgt.indexOf("rv:")+3)):(nameOffset=nAgt.lastIndexOf(" ")+1)<(verOffset=nAgt.lastIndexOf("/"))&&(browser=nAgt.substring(nameOffset,verOffset),version=nAgt.substring(verOffset+1),browser.toLowerCase()==browser.toUpperCase()&&(browser=navigator.appName)),-1!=(ix=version.indexOf(";"))&&(version=version.substring(0,ix)),-1!=(ix=version.indexOf(" "))&&(version=version.substring(0,ix)),-1!=(ix=version.indexOf(")"))&&(version=version.substring(0,ix)),majorVersion=parseInt(""+version,10),isNaN(majorVersion)&&(version=""+parseFloat(navigator.appVersion),majorVersion=parseInt(navigator.appVersion,10));var mobile=/Mobile|mini|Fennec|Android|iP(ad|od|hone)/.test(nVer),cookieEnabled=!!navigator.cookieEnabled;void 0!==navigator.cookieEnabled||cookieEnabled||(document.cookie="testcookie",cookieEnabled=-1!=document.cookie.indexOf("testcookie"));var os="-",clientStrings=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var id in clientStrings){var cs=clientStrings[id];if(cs.r.test(nAgt)){os=cs.s;break}}var osVersion="-";switch(/Windows/.test(os)&&(osVersion=/Windows (.*)/.exec(os)[1],os="Windows"),os){case"Mac OS X":osVersion=/Mac OS X ((10|11)[\.\_\d]+)/.exec(nAgt)[1];break;case"Android":osVersion=/Android ([\.\_\d]+)/.exec(nAgt)[1];break;case"iOS":osVersion=(osVersion=/OS (\d+)_(\d+)_?(\d+)?/.exec(nVer))[1]+"."+osVersion[2]+"."+(0|osVersion[3])}var flashVersion="no check";if("undefined"!=typeof swfobject){var fv=swfobject.getFlashPlayerVersion();flashVersion=0<fv.major?fv.major+"."+fv.minor+" r"+fv.release:"-"}var tem,ua=navigator.userAgent,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];/trident/i.test(M[1])&&(M=["IE/"+((tem=/\brv[ :]+(\d+)/g.exec(ua)||[])[1]||""),"IE",tem[1]||""]),"Chrome"===M[1]&&null!=(tem=ua.match(/\bOPR\/(\d+)/))&&(M=["Opera/"+tem[1],"Opera",tem[1]]),M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(tem=ua.match(/version\/(\d+)/i))&&M.splice(1,1,tem[1]),window.clientDetails={screen:screenSize,browser:browser,browserVersion:version,browserMajorVersion:majorVersion,mobile:mobile,os:os,osVersion:osVersion,cookies:cookieEnabled,flashVersion:flashVersion,bitness:-1!==navigator.userAgent.indexOf("WOW64")||-1!==navigator.userAgent.indexOf("Win64")?"x64":"x32"}}(window)},API:{EngineName:"Unknown",scriptsLoaded:!1,Init:function(){SR.Console.Warn("Method not implemented!")},Recognize:function(){SR.Console.Warn("Method not implemented!")},Stop:function(){SR.Console.Warn("Method not implemented!")},Send:function(){SR.Console.Warn("Method not implemented!")},Hear:function(){SR.Console.Warn("Method not implemented!")},Recognizing:function(){SR.Console.Warn("Method not implemented!")},GetServer:function(){SR.Console.Warn("Method not implemented!")},GetServerFull:function(){SR.Console.Warn("Method not implemented!")},Play:function(url){0===url.indexOf("blob:https://")&&(window.URL||window.webkitURL).revokeObjectURL($("#audio_remote").attr("src")),SR.Console.Log("Playing "+url),0==$("#audio_remote").length&&$("body").prepend('<audio id="audio_remote" autoplay="autoplay"></audio>'),void 0===SR.PM.recordings[url]&&(SR.PM.recordings[url]=url),$("#audio_remote").attr("src","").attr("src",url)},LoadScripts:function(){console.log("Loading..."),new ScriptLoader(SR.Engine.API.scripts).load(!1),SR.Engine.API.scriptsLoaded=!0,console.log("Loaded ok")},GetCodeDescription:function(code){return SR.Console.Warn("Method not implemented!"),code},Callbacks:{initCallback:function(){SR.PM.initCallback.call(null===SR.PM.context?this:SR.PM.context,arguments[0],SR.Engine.API.GetCodeDescription(arguments[0]," (Error code: "+arguments[1]+")"))},startRecognitionCompleted:function(){SR.PM.startRecognitionCompleted.call(null===SR.PM.context?this:SR.PM.context,arguments[0],SR.Engine.API.GetCodeDescription(arguments[0]," (Error code: "+arguments[0]+")"))},speechStarted:function(){SR.PM.speechStarted.apply(null===SR.PM.context?this:SR.PM.context,arguments)},recognitionCompleted:function(reason,result){SR.PM.recognitionCompleted(reason,new JsonHandler(result))},recognizerReady:function(){SR.PM.recognizerReady.apply(null===SR.PM.context?this:SR.PM.context,arguments)},beforeMicAllow:function(){SR.PM.beforeMicAllow.apply(null===SR.PM.context?this:SR.PM.context,arguments)},micAllowed:function(){SR.PM.micAllowed.apply(null===SR.PM.context?this:SR.PM.context,arguments)}},CODES:{SUCCESS:0,START_RECOGNITION_COMPLETED:1,SPEECH_STARTED:2,READY_TO_START_RECOGNITION:3,NO_INPUT:4,NO_MATCH:5,WAITING_FOR_MIC:-1,MIC_NOT_FOUND:-10,MIC_DENY_PRESSED:-11}}},ENGINES:{SIPML:{EngineName:"SIPML"},VERTO:{EngineName:"VERTO",Init:function(){alert("Verto is deprecated!")}},SPEAKINGPAL:{EngineName:"SPEAKINGPAL",Init:function(){SR.Console.Info("SR Engine is: SPEAKINGPAL"),this.scriptsLoaded||(this.LoadScripts(),SR.Engine.InitClientDetails(),this.ModifyLogsIoLogger()),"undefined"==typeof SP&&(SP=getTLWindow().SP),SR.Console.Info("Checking for missing words..."),SR.ENGINES.SPEAKINGPAL.LoadMissingWords().done(function(data){SR.Engine.API.missingWords?(SR.Console.Info("Missing words found:"),SR.Console.Info(SR.Engine.API.missingWords)):SR.Console.Info("Missing words not found"),SP.Init(SR.Engine.API.Callbacks.initCallback,SR.Engine.API.Callbacks.startRecognitionCompleted,SR.Engine.API.Callbacks.speechStarted,SR.Engine.API.Callbacks.recognitionCompleted,SR.Engine.API.Callbacks.recognizerReady,SR.Engine.API.Callbacks.beforeMicAllow,SR.Engine.API.Callbacks.micAllowed)}).fail(function(){SR.Console.Error("Unable to get missing words data file!")})},Recognize:function(ccode,text){SR.Engine.API.currentGrammar=SR.Engine.API.GetGrammar(ccode.toUpperCase(),text),void 0!==text&&-1<SR.Engine.API.currentGrammar.s.indexOf("[")&&"comp_code"!==text&&(SR.Engine.API.currentSentence=SR.Engine.Filter(text)),SP.Recognize(SR.Engine.API.currentGrammar.s,SR.Engine.API.currentGrammar.d,SR.Engine.API.currentGrammar.t)},Callbacks:{initCallback:function(code,message){code!==SR.CODES.SUCCESS&&code!==SR.CODES.WAITING_FOR_MIC&&SR.Engine.reportTransaction({errorCode:code,score:-1}),SR.PM.initCallback.call(null===SR.PM.context?this:SR.PM.context,code,SR.Engine.API.GetCodeDescription(code," (Error code: "+code+")"))},recognitionCompleted:function(reason,result){if(SR.Engine.API.Score=result.sentenceScore,SR.Engine.API.Reason=reason,void 0!==SR.Engine.API.currentSentence&&(SR.Engine.API.currentSentence!==result.sentence&&(reason="nomatch"),delete SR.Engine.API.currentSentence),result.type=SR.Engine.API.currentGrammar.t,result.type===SR.Engine.API.GRAMMAR_TYPE.BRANCH_DIALOG){var index=SR.Engine.API.currentGrammar.parts.indexOf(result.sentence);result.answer_id=-1===index?(reason="nomatch",index):index+1}var json=new JsonHandler(result),params={};params.grammarText=SR.Engine.API.EngineName,params.score=json.get("sentenceScore"),isNaN(params.score)&&(params.score=-1),params.audioFile="-",SR.Console.Log("Report transaction parameters:"),SR.Console.Log(params),SR.Engine.reportTransaction(params),SR.PM.recognitionCompleted(reason,new JsonHandler(result))}},Stop:function(){SP.Stop(),SR.Engine.API.currentGrammar=null},Recognizing:function(){SR.Console.Log("Recognizing...")},Hear:function(id){SR.Console.Log("Play recording: Request issued for: "+id);SP.Hear(id).done(function(url){SR.Console.Log("Hear: Got results: "+url),SR.Engine.API.Play(url)}).fail(function(){SR.Console.Error("Hear failed")})},Send:function(qs,callback){for(var id=null,parts=qs.split("&"),i=0;i<parts.length;i++)if(parts[i].startsWith("file=")){id=parts[i].replace("file=","");break}SR.Console.Log("#1: Calling hear to store mp3 file"),SP.Hear(id).done(function(_url){SR.Console.Log("#1: File saved ok: "+_url),SR.Console.Log("#2: Calling persistRecording to get a link"),SP.Send(id).done(function(url){SR.Console.Log("#2: Recording copied ok: "+url),parts[i]="file="+url,SR.Console.Log("#3: Sending link to FUpload"),$.ajax({type:"GET",url:("FUpload/FUpLoad.aspx"+parts.join("&")).replace("SType=RC","SType=SP")}).done(function(){SR.Console.Log("#3: Sent ok"),callback&&callback({code:"0"})}).fail(function(){SR.Console.Error("#3: cannot upload the link!"),callback&&callback({code:"-1"})})}).fail(function(){SR.Console.Error("#2 failed: cannot persist recording!"),callback&&callback({code:"-1"})})}).fail(function(){SR.Console.Error("#1 failed: cannot get recording url!"),callback&&callback({code:"-1"})})},LoadScripts:function(){console.log("Loading...");var loader=new ScriptLoader(SR.debug?SR.Engine.API.debugScripts:SR.Engine.API.scripts);SR.debug&&(window.spApiDebugAudio=!0),loader.load(!1),SR.Engine.API.scriptsLoaded=!0,console.log("Loaded ok")},ModifyLogsIoLogger:function(){var logzIologger=SpApi.prototype.getLogger();logzIologger.log=function(){SR.Console.Info("Using modified logger (logs.io)");var logOld=logzIologger.log;return function(){return arguments[0].StudentId=getCompositeCookie("Student","StudentID"),new RegExp("InitSuccess|ClientSessionPrepared|ClientConnectionNetIssue|NotSupportedError|ClientUnauthorized|ClientConnectionRefused|InitCompleted|MediaDeviceNotSupported|DevicesNotFoundError|NotAllowedError|NotFoundError|NotReadableError|PermissionDeniedError|PermissionDismissedError|ClientRecognitionFailed|MicDisabled|NoGrammar|AudioCaptureError|TrackStartError").test(arguments[0].message)&&(arguments[0].bitness=window.clientDetails.bitness,arguments[0].browser=window.clientDetails.browser,arguments[0].browserMajorVersion=window.clientDetails.browserMajorVersion,arguments[0].browserVersion=window.clientDetails.browserVersion,arguments[0].mobile=window.clientDetails.mobile,arguments[0].os=window.clientDetails.os,arguments[0].osVersion=window.clientDetails.osVersion),new RegExp("ClientRecognitionCompleted|ClientRecognitionFailed").test(arguments[0].message)&&(arguments[0].Score=SR.Engine.API.Score,arguments[0].Reason=SR.Engine.API.Reason),logOld.apply(this,arguments)}}()},scripts:[Root+"runtime/Programmers/Scripts/SpeakingPal-v2/logger.js",Root+"runtime/Programmers/Scripts/SpeakingPal-v2/spapi-all-edu-new-log.js",Root+"runtime/Programmers/Scripts/SpeechRecognition/SpeakingPal.js"],debugScripts:[Root+"runtime/Programmers/Scripts/SpeakingPal-v2/logger.js",Root+"runtime/Programmers/Scripts/SpeakingPal-v2/spapi-all-edu-new-log.js",Root+"runtime/Programmers/Scripts/SpeechRecognition/SpeakingPal.js"],GetServer:function(){return SR.Engine.API.ExternalAmazonServerSR1},LocalServer:"10.1.0.138",ExternalAmazonServerSR1:"asr-edu.speakingpal.com",CODES:{SUCCESS:500,START_RECOGNITION_COMPLETED:501,SPEECH_STARTED:502,WAITING_FOR_MIC:501,MIC_NOT_FOUND:502,MIC_DENY_PRESSED:503,MIC_DIALOG_DISMISSED:504,MIC_UNKNOWN_ERROR:505,INIT_ILLEGAL_PARAMS:506,INIT_FAILED:507,INIT_INVALID_TOKEN:508,UNAUTHORIZED:509,TOO_MANY_AUTH_FAILURES:510,ERROR_GETTING_TICKET:511,WEBSOCKET_NOT_SUPPORTED:999,PREPARE_ERROR:998,PREPARE_UNSUPPORTED:997},GetCodeDescription:function(code,suffix){switch(code){case SR.CODES.SUCCESS:case SR.CODES.START_RECOGNITION_COMPLETED:return"";case SR.CODES.SPEECH_STARTED:return SR.debug&&console.log(">>> SPEECH"),"";case SR.CODES.NO_INPUT:case SR.CODES.NO_MATCH:return"";case SR.CODES.WAITING_FOR_MIC:return translate[191];case SR.CODES.MIC_NOT_FOUND:return translate[1006]+suffix;case SR.CODES.MIC_DENY_PRESSED:return translate[1003]+suffix;case SR.CODES.MIC_DIALOG_DISMISSED:return translate[1166]+suffix;case SR.CODES.MIC_UNKNOWN_ERROR:return translate[1004]+suffix;case SR.CODES.INIT_ILLEGAL_PARAMS:return translate[1164]+suffix;case SR.CODES.INIT_FAILED:return translate[1165]+suffix;case SR.CODES.INIT_INVALID_TOKEN:case SR.CODES.UNAUTHORIZED:return"";case SR.CODES.TOO_MANY_AUTH_FAILURES:return translate[1162]+suffix;case SR.CODES.ERROR_GETTING_TICKET:return translate[1163]+suffix;case SR.CODES.WEBSOCKET_NOT_SUPPORTED:return"";case SR.CODES.PREPARE_ERROR:return translate[1165]+suffix;case SR.CODES.PREPARE_UNSUPPORTED:return translate[204]+suffix}},LoadMissingWords:function(){var url=JSON.parse(localStorage.getItem("resPathRoot"))+"/Runtime/Content/SR/"+SR.Engine.API.compCode+".js",exists=200===$.ajax({url:url,type:"HEAD",cache:!0,async:!1}).status;return SR.Console.Log("Missing words url: "+url+", file exists: "+exists?"true":"false"),exists?$.ajax({url:url,type:"GET",dataType:"script"}):$.Deferred().resolve()},GRAMMAR_TYPE:{DEFAULT:1,BRANCH_DIALOG:2},GetGrammar:function(grammar,text){var obj=null!==SR.Engine.API.missingWords&&void 0!==SR.Engine.API.missingWords[grammar]?SR.Engine.API.missingWords[grammar]:{};return{s:text=void 0!==obj.s?obj.s:text,d:void 0!==obj.d?obj.d:SR.Engine.API.CalculateDuration(text),t:obj.t,parts:obj.parts}},CalculateDuration:function(text){var duration=text.split(/[\s_]+/).length;return 5<duration?duration:5},missingWords:null,currentGrammar:null},HTML5RECORDER:{EngineName:"HTML5RECORDER",Init:function(){this.scriptsLoaded||this.LoadScripts(),"undefined"==typeof WR&&(WR=getTLWindow().WR),WR.Init(SR.Engine.API.Callbacks.initCallback,SR.Engine.API.Callbacks.startRecognitionCompleted,SR.Engine.API.Callbacks.speechStarted,SR.Engine.API.Callbacks.recognitionCompleted,SR.Engine.API.Callbacks.recognizerReady,SR.Engine.API.Callbacks.beforeMicAllow,SR.Engine.API.Callbacks.micAllowed)},Recognize:function(gid,text){var duration=text.split(/[\s_]+/).length;WR.Record(gid,text,5<duration?duration:5,0)},Stop:function(cancel){WR.Stop(cancel)},Hear:function(id){SR.Engine.API.Play((window.URL||window.webkitURL).createObjectURL(WR.Play(id)))},Send:function(qs,cb){WR.Send(qs,cb)},scripts:[Root+"runtime/Programmers/scripts/WebRecorder/WebRecorder.js",Root+"runtime/JavaScript/audioApi/WebAudioRecorder.min.js"],GetCodeDescription:function(code,suffix){switch(code){case SR.CODES.SUCCESS:return"";case SR.CODES.WAITING_FOR_MIC:return translate[191];case SR.CODES.WEBRTC_NOT_SUPPORTED:case SR.CODES.UNKNOWN:case SR.CODES.MIC_DENY_PRESSED:return translate[1003]+suffix;case SR.CODES.MIC_NOT_FOUND:return translate[1006]+suffix;case SR.CODES.MIC_UNKNOWN_ERROR:case SR.CODES.START_RECOGNITION_COMPLETED:return"";default:return"Unknown error code! "+suffix}}}},Templates:{KeepAliveTemplate:{fireAfter:12e4,timer:null,Start:function(){null===SR.Engine.KeepAlive.timer?(SR.Engine.KeepAlive.timer=setInterval(function(){SR.Console.Trace("SR KEEP-ALIVE: Fire!"),SR.Engine.API.KeepAlive()},SR.Engine.KeepAlive.fireAfter),SR.Console.Info("SR KEEP-ALIVE: Activated")):SR.Console.Log("SR KEEP-ALIVE: Keep-alive already running")},Stop:function(){null!==SR.Engine.KeepAlive.timer&&(clearInterval(SR.Engine.KeepAlive.timer),SR.Engine.KeepAlive.timer=null,SR.Console.Info("SR KEEP-ALIVE: Keep-alive stopped"))}},ConsoleTemplate:{createOnce:!0,logLevel:1,Trace:function(){0===SR.Console.logLevel&&console.log.apply(this,arguments)},Log:function(){SR.Console.logLevel<=1&&console.log.apply(this,arguments)},Info:function(){SR.Console.logLevel<=2&&console.info.apply(this,arguments)},Warn:function(){SR.Console.logLevel<=3&&console.warn.apply(this,arguments)},Error:function(){SR.Console.logLevel<=4&&console.error.apply(this,arguments)}}},Console:{logLevel:5,Trace:function(){},Log:function(){},Info:function(){},Warn:function(){},Error:function(){}}};var FinalView=function(){var _self,ccText,hearAllText,playText,wrapper,player_COMPUTER=!0,player_HUMAN=!1;function finalView(data,spObj,isVideo,cbFunc){_self=this,ccText=translate[159],hearAllText=translate[160],playText=translate[152],this.json=new JsonHandler(data),this.target=null,this.index=0,this.spObj=spObj,this.altObj=null,this.altPlaying=!1,this.isVideo=isVideo,void 0!==cbFunc&&(this.cbFunc=cbFunc),wrapper='<div class="jq_template interactImproveYourself"><div class="questionInstructionsWrapper"> <div class="questionInstructions">'+ccText+'</div> </div> <div class="answersWrapper speakingInteract improveYourself"> <div class="speakingInteractPanelsWrapper"> <div class="recordingPanelWrapper finalViewContainer"></div> <div class="speakingInteractButtonWrapper"> <div class="buttonWrapper startAgainWrapper left"> <a class="button startAgain"> <span>Restart</span> </a> </div> <div class="buttonWrapper continueWrapper disable"> <a class="button continue hearall">'+hearAllText+"</a> </div> </div> </div> </div></div>",'<div class="recordingPanelSentenceWrapper"><div class="recordingPanelSentence "><div class="sentenceWrapper"><div class="recordingPanelSentenceText">{{html $item.setText($item)}}</div></div><div class="recordPanelWrapper"><div class="RecordButtonWrapper {{html $item.setMicrophone($item)}}"><a class="panelButton recordIcon"></a></div></div></div></div>',$("#fwWrapper").length<1&&($('<script type="text/html" id="fwWrapper">'+wrapper+"<\/script>").appendTo(document.body),$('<script type="text/html" id="fwItem"><div class="recordingPanelSentenceWrapper"><div class="recordingPanelSentence "><div class="sentenceWrapper"><div class="recordingPanelSentenceText">{{html $item.setText($item)}}</div></div><div class="recordPanelWrapper"><div class="RecordButtonWrapper {{html $item.setMicrophone($item)}}"><a class="panelButton recordIcon"></a></div></div></div></div><\/script>').appendTo(document.body))}function ready(){$(".jq_template .button.hearall").unbind().click(_self.hearAllClick).parent().removeClass("disable")}return finalView.prototype.render=function(t){this.target=t,$(this.target).css("position","relative"),$(".interactStage1Wrapper").addClass("interactStage1Wrapper--offscreen"),$(".questionInstructionsWrapper").addClass("questionInstructionsWrapper--offscreen"),0<$(".interactImproveYourself").length&&$(".interactImproveYourself").remove(""),$(this.target).find("#pmContainer").append($("#fwWrapper").tmpl(this.json)),$("#fwItem").tmpl(this.json.get("data.interact"),{setText:function(item){var j=new JsonHandler(item.data);if(j.get("player")!=player_HUMAN)return j.get("text");var srScore=new SR_Score(null,null),txt=j.get("text",""),scores=j.get("score",[]),gr=j.get("grammar","");return 0<scores.length?srScore.getWLHtml(txt,scores,gr):srScore.getFailHtml(txt)},setMicrophone:function(item){return new JsonHandler(item.data).get("player",player_COMPUTER)==player_COMPUTER?" hide":""}}).appendTo($(this.target).find(".jq_template .finalViewContainer")),$(".jq_template .recordIcon:visible").each(function(){$(this).click(function(){if(!$(this).parent().hasClass("disable")){_self.altPlaying=!0,_self.improveYourselfIndex=$(this).closest(".recordingPanelSentenceWrapper").index(),$.subscribe("improve_ready",_self.sendFirstRecording);var grammar=_self.json.get("data.interact["+_self.improveYourselfIndex+"].grammar").substring(1);openSRPanelCBox("improve",grammar.toLowerCase().split("_")[0],grammar.toLowerCase().split("_")[0]),setTextSR(_self.json.get("data.interact["+_self.improveYourselfIndex+"].text"),grammar.split("_")[1])}})}),$(".jq_template .startAgain:visible").click(function(){_self.reset()}),$.subscribe("recorderNotify",this.improveHearCb),$.subscribe("colorbox_cleanup",function(){_self.stopPlayer(),delete _self.improveYourselfIndex,_self.altPlaying=!1}),$.subscribe("cbox_exit",this.improveResults),$.subscribe("vpNotifyEx",function(e,data){!function(data){if(0==data.length)return;switch(data.name){case"EOS":_self.altPlaying?_self.improveHearCb(null,{btnName:"stop"}):_self.nextTurn(player_HUMAN)}}(data)}),$(document).on("SPlayerMessage",function(e){!function(data){if(0==data.length)return;switch(data[0]){case"eos":if(_self.altPlaying)_self.improveHearCb(null,{btnName:"stop"});else{try{_self.spObj.fssetAutostart(!1)}catch(e){}_self.nextTurn(player_HUMAN)}}}(e.message)}),$.publish("practiceResize"),ready()},finalView.prototype.sendFirstRecording=function(){$.unsubscribe("improve_ready");var transmitData=new JsonHandler(_self.json.get("data.interact["+_self.improveYourselfIndex+"]",{}));$.publish("improve_send_recording",transmitData)},finalView.prototype.improveHearCb=function(e,data){switch(data.btnName){case"srp_play":data.isBtnPressed?_self.playComputer():_self.stopPlayer();break;case"stop":$.publish("play_ended"),_self.stopPlayer()}},finalView.prototype.improveResults=function(e,data){if(void 0!==_self.improveYourselfIndex){var i=_self.improveYourselfIndex;try{_self.json.data.data.interact[i].sound=data.srContent,_self.json.data.data.interact[i].score=data.wlScore,_self.json.data.data.interact[i].sentenceScore=data.slScore;var srScore=new SR_Score(null,null),base="data.interact["+i+"]",html=srScore.getWLHtml(_self.json.get(base+".text",""),_self.json.get(base+".score",[]),_self.json.get(base+".grammar",""));$(".recordingPanelSentenceWrapper").eq(i).find(".recordingPanelSentenceText").html(html),delete _self.improveYourselfIndex,_self.improveHearCb(null,{btnName:"stop"})}catch(e){console.error("Final view: Error updating JSON data! Error text: "+e.message)}}},finalView.prototype.reset=function(){$(this.target).find(".interactImproveYourself").remove(),$(this.target).find(".interactStage1Wrapper--offscreen").removeClass("interactStage1Wrapper--offscreen"),$(this.target).find(".questionInstructionsWrapper--offscreen").removeClass("questionInstructionsWrapper--offscreen"),$(".startAgain").trigger("click"),void 0!==this.cbFunc&&this.cbFunc()},finalView.prototype.canContinue=function(){return this.json.has("data.interact["+_self.index+"]")},finalView.prototype.nextTurn=function(who){_self.highlightIndex(),_self.canContinue()?who===player_COMPUTER?_self.playComputer():_self.playHuman():_self.stop()},finalView.prototype.playComputer=function(){var externalPlay=void 0!==this.improveYourselfIndex,mp3=this.json.get("data.interact["+(externalPlay?this.improveYourselfIndex:this.index)+"].mp3",!1);if(mp3)try{this.spObj.reset(),this.spObj.fssetAutostart(!0),this.spObj.openNewFile(mp3)}catch(e){console.error("Final view: error opening mp3 file! Error text: "+e.message)}else{var segments=this.json.getArray("data.interact["+(externalPlay?this.improveYourselfIndex:this.index)+"].segments"),altsound=this.json.get("data.interact["+(externalPlay?this.improveYourselfIndex:this.index)+"].altsound",!1);try{altsound?this.altObj.setSelectedSE(segments[0],segments[1]):this.isVideo?this.spObj.setSelectedSEWN(segments[0],segments[1]):this.spObj.setSelectedSE(segments[0],segments[1])}catch(e){console.error("Final view: can not set specified segment! Error: "+e.message)}try{altsound?this.altObj.play():this.spObj.play()}catch(e){console.error("Final view: play failed! Error: "+e.message)}}!externalPlay&&this.index++},finalView.prototype.playHuman=function(){0==$("#audio_remote").length&&$("body").prepend('<audio id="audio_remote" autoplay="autoplay"></audio>');var path=this.json.get("data.interact["+this.index+"].sound",null);null===path?(this.index++,this.audioEndedPlay()):(path.endsWith(".mp3")?(path=SR.Engine.API.GetServerFull()+path,$("#audio_remote").prop("src",path)):SR.Engine.API.Hear(path),$("#audio_remote").unbind().bind("ended",this.audioEndedPlay),this.index++)},finalView.prototype.highlightIndex=function(){this.index<$(".jq_template .recordingPanelSentenceWrapper").length?($(".jq_template .recordingPanelSentenceWrapper").eq(this.index).addClass("hl").siblings().removeClass("hl"),$(".recordingPanelWrapper ").animate({scrollTop:$(".jq_template .recordingPanelSentenceWrapper").eq(this.index).position().top-83},200)):$(".jq_template .recordingPanelSentenceWrapper").removeClass("hl")},finalView.prototype.audioEndedPlay=function(){setTimeout(function(){_self.nextTurn(player_COMPUTER)},100)},finalView.prototype.hearAllClick=function(){$(".jq_template .startAgain:visible").unbind().parent().addClass("disable"),$(".jq_template .button.hearall").unbind().parent().addClass("disable"),$(".jq_template .questionInstructions").text(playText),$(".jq_template .recordIcon:visible").each(function(){$(this).parent().addClass("disable")});var who=_self.json.get("data.interact[0].player",null);null!==who?setTimeout(function(){_self.nextTurn(who)},100):console.error("FINAL VIEW ERROR: Speaking person is unknown, can not continue")},finalView.prototype.stop=function(){this.index=0,$("#audio_remote").remove();try{this.stopPlayer(),this.spObj.fssetAutostart(!1)}catch(e){}$(".jq_template .startAgain:visible").click(function(){_self.reset()}).parent().removeClass("disable"),$(".jq_template .recordIcon:visible").each(function(){$(this).parent().removeClass("disable")}),ready(),$(".jq_template .recordingPanelSentenceWrapper").removeClass("hl"),$(".jq_template .questionInstructions").text(ccText)},finalView.prototype.stopPlayer=function(){try{_self.spObj.stop(!0),_self.altObj&&_self.altObj.stop(!0)}catch(e){}},finalView.prototype.setAlternativePlayer=function(obj){null===this.altObj&&(this.altObj=obj)},finalView.prototype.dispose=function(){$(document).off("SPlayerMessage"),$.unsubscribe("vpNotifyEx"),$.unsubscribe("recorderNotify"),$.unsubscribe("colorbox_cleanup"),$.unsubscribe("cbox_exit")},finalView}();!function(angular){angular.module("edoNewUX").factory("progressService",["$http","COMMON","storageService",function($http,COMMON,storageService){return{getUserUnassignedUnitsLessons:function(courseId){var finalUrl=COMMON.SERVICE_URL+"GetUserUnassignedUnitsLessons/"+courseId;return $http.get(finalUrl)},getDefaultCourseProgress:function(){var urlBase=COMMON.SERVICE_URL;return $http.get(urlBase+"CourseTree/GetDefaultCourseProgress")},getCourseProgress:function(courseId){var urlBase=COMMON.SERVICE_URL;return $http.get(urlBase+"CourseTree/GetCourseProgress/"+courseId)},getEmptyProgressCourse:function(courseId){var urlBase=COMMON.SERVICE_URL;return $http.get(urlBase+"CourseTree/GetEmptyProgressCourse/"+courseId)},getWidgetData:function(courseId,studentId){var urlBase=COMMON.SERVICE_URL;return $http.get(urlBase+"Progress/GetTimeInCourse/"+courseId)},getCourseTestsResults:function(courseId){var urlBase=COMMON.SERVICE_URL;return $http.get(urlBase+"AssessmentsDescriptor/GetSpecCourseTestsResult/"+courseId)},getUserNodeProgress:function(nodes,courseId){var urlBase=COMMON.SERVICE_URL;return $http.post(urlBase+"CourseTree/GetUserNodeProgress/"+courseId,nodes)}}}])}(angular),function(angular){angular.module("edoNewUX").factory("magazineService",["$http","COMMON",function($http,COMMON){var urlBase=COMMON.SERVICE_URL+"magazineArticle/";return{GetArticleGlossary:function(articleId){return $http({cache:!0,url:urlBase+"GetArticleGlossary/"+articleId,method:"GET"})},GetArticleNumberOfQuestions:function(articleId){return $http({cache:!0,url:urlBase+"GetArticleNumberOfQuestions/"+articleId,method:"GET"})},GetArticleByCode:function(articleCode,curLevel,referrer){return $http({cache:!0,url:urlBase+("GetArticleByCode/"+articleCode+"/"+curLevel+"/"+referrer),method:"GET"})},GetArticleOpenQuestions:function(articleCode,curLevel){return $http({cache:!0,url:urlBase+"GetArticleOpenQuestions/"+articleCode+"/"+curLevel,method:"GET"})},GetArticleQuestion:function(articleId,sequence){return $http({cache:!0,url:urlBase+"GetArticleQuestion/"+articleId+"/"+sequence,method:"GET"})},GetMainArticle:function(curLevel){var finalUrl=urlBase+"GetMainArticle/"+curLevel;return $http.get(finalUrl)},GetCurrentArticleListByLevel:function(curLevel,mainCode){var finalUrl=urlBase+"GetCurrentArticleListByLevel/"+curLevel+"/"+mainCode;return $http.get(finalUrl)},GetTotalArticles:function(curLevel,topicId){var finalUrl=urlBase+"GetTotalArticles/"+curLevel+"/"+topicId;return $http.get(finalUrl)},GetArticlesByTopic:function(curLevel,topicId,fromRecord,pageSize){return $http({cache:!0,url:urlBase+"GetArticlesByTopic/"+curLevel+"/"+topicId+"/"+fromRecord+"/"+pageSize,method:"GET"})},GetArticlesInMonth:function(curLevel,sMonth,sYear){return $http({cache:!0,url:urlBase+"GetArticlesInMonth/"+curLevel+"/"+sMonth+"/"+sYear,method:"GET"})},GetIssues:function(){return $http({cache:!0,url:urlBase+"GetIssues",method:"GET"})},GetArticlesBySearchWordInTitle:function(curLevel,word){return $http({cache:!0,url:urlBase+"GetArticlesBySearchWordInTitle/"+curLevel+"/"+word,method:"GET"})}}}])}(angular),function(angular){angular.module("edoNewUX").service("defaultViewService",["NODE_TYPE_CONSTANT",function(NODE_TYPE_CONSTANT){var unusedUnits=[],findDefaultNode=function(node,parentNode){return node.IsDone||node.IsLocked||beInUnusedArray(node)?node.Sequence<parentNode.Children.length?findDefaultNode(parentNode.Children[node.Sequence],parentNode):findHole(parentNode):node},findHole=function(node){for(var i=0;i<node.Children.length;i++)if(!node.Children[i].IsDone&&!node.Children[i].IsLocked)return node.Children[i]},beInUnusedArray=function(node){for(var array=node.CourseNodeType==NODE_TYPE_CONSTANT.UNIT?unusedUnits:[],i=0;i<array.length;i++)if(array[i]==node.NodeId)return!0;return!1},findChildByType=function(object,type,compared,val){for(var result,i=0;i<object.Children.length;i++)if(object.Children[i].CourseNodeType!=type){if(void 0!==(result=findChildByType(object.Children[i],type,compared,val)))return result}else if(object.Children[i][compared]==val)return{node:object.Children[i],parent:object}};this.getDefaultView=function(courseJson){this.course=courseJson.CourseProgressTree,this.continueTaskId=courseJson.LastTaskId;var lastProgress=0==courseJson.CurrentLessonId||this.course.IsDone?findChildByType(this.course,NODE_TYPE_CONSTANT.LESSON,"IsLocked",!1):findChildByType(this.course,NODE_TYPE_CONSTANT.LESSON,"NodeId",courseJson.CurrentLessonId),currentLesson=lastProgress.node,currentUnit=lastProgress.parent;if(this.course.IsDone)return{unit:currentUnit,lesson:currentLesson};var defaultLesson=findDefaultNode(currentLesson,currentUnit);if(defaultLesson)return{unit:currentUnit,lesson:defaultLesson};for(var i=0;i<this.course.Children.length&&null==defaultLesson&&(unusedUnits.push(currentUnit.NodeId),null!=(currentUnit=findDefaultNode(currentUnit,this.course)));i++)defaultLesson=findDefaultNode(currentUnit.Children[0],currentUnit);if(defaultLesson)return{unit:currentUnit,lesson:defaultLesson};var firstNode=findChildByType(this.course,NODE_TYPE_CONSTANT.LESSON,"IsLocked",!1);return{unit:firstNode.parent,lesson:firstNode.node}}}])}(angular),function(angular){angular.module("edoNewUX").service("unitsAdditionalReadingService",["$q","$http","$rootScope","storageService","$state","applicationVariablesBL",function($q,$http,$rootScope,storageService,$state,applicationVariablesBL){var PATH="/Runtime/Metadata/Courses/",FILENAME="magazineArticlesInUnits.json",InstitutionProperty="MagazineArticlesInEdUnits",statsRoot=$rootScope.root,statsPath="/images/Homepage/Units/magazineArticlesInUnitsCounter.gif";return{getReadingsForCourseAsync:function(courseId){var defer;if(defer=$q.defer(),storageService.get("Community",InstitutionProperty)){var cachedData=sessionStorage.getItem("magazineArticlesInUnits");(cachedData=cachedData?JSON.parse(cachedData):cachedData)?defer.resolve(getUARForCourse(cachedData,courseId)):function(){var defer;return defer=$q.defer(),applicationVariablesBL.get(["ResPathRoot"]).then(function(data){var url=data.ResPathRoot+PATH+FILENAME;$http.get(url).success(function(data){defer.resolve(data)}).error(function(data){console.log("Failed to get additional readings json file."),defer.resolve(null)})}),defer.promise}().then(function(data){data&&(sessionStorage.setItem("magazineArticlesInUnits",JSON.stringify(data)),defer.resolve(getUARForCourse(data,courseId)))})}else defer.resolve(null);return defer.promise},gotoMagazineArticle:function(courseId,unitId,code){(function(courseId,unitId,code){var url=statsRoot+statsPath,params="?"+function(courseId,unitId,code){var res=[];return res.push([["CourseId"],[courseId]]),res.push([["UnitId"],[unitId]]),res.push([["Code"],[code]]),res.push([["IID"],[storageService.get("Community","IID")]]),res.push([["StudentID"],[storageService.get("Student","StudentID")]]),res.map(function(v){return v.join("=")}).join("&")}(courseId,unitId,code);$http.get(url+params,{cache:!1,headers:{"Cache-Control":"no-cache"}})})(courseId,unitId,code),storageService.set("Student",null,"LevelTemp"),function(code){$state.go("Magazine.Article",{articleCode:code,from:"enrichment"})}(code)},clean:function(){sessionStorage.removeItem("magazineArticlesInUnits")}};function getUARForCourse(data,courseId){return _.find(data,function(courseAR){return courseAR.courseId===courseId})}}])}(angular),function(angular){angular.module("edoNewUX").service("courseDataService",["$q","defaultViewService","storageService","activityService","unitsAdditionalReadingService","$filter","$http","COURSE_CONSTANT","COMMON",function($q,defaultViewService,storageService,activityService,unitsAdditionalReadingService,$filter,$http,COURSE_CONSTANT,COMMON){var courseService=this;function gotoLAShared(){localStorage.removeItem("TestEnv"),edns.navigator.removeLAGotoPath()}function savePopupRefs(){for(var openpopupsLocal=[],i=0;i<openPopups.length;i++)if(openPopups[i]&&!openPopups[i].closed){var popupName="";try{null==(popupName=openPopups[i].name)?openPopups[i].close():openpopupsLocal.push(popupName)}catch(err){openPopups[i].close()}}localStorage.setItem("openpopups",JSON.stringify(openpopupsLocal))}courseService.setCourseData=function(courseRoot){var course,courseTree;courseService.courseRoot=courseRoot,courseService.course=courseRoot.CourseProgressTree,courseService.courseProgress=calcVisualProgress(courseService.course.Progress,!0,!1),courseService.setCourseNodeData("courseProgress",courseService.courseProgress),courseService.testScores=courseService.course.Grade,courseService.setCourseNodeData("testScores",courseService.course.Grade),course=courseService.course,edns.courseMetadata.setUnitObjectives(course).then(function(data){course=data}),function(course){edns.courseMetadata.setUnitTests(course).then(function(data){course=data})}(courseService.course),courseTree=courseService.course,unitsAdditionalReadingService.getReadingsForCourseAsync(courseTree.NodeId).then(function(courseAR){courseAR&&(courseTree.Children=courseTree.Children.map(function(unit){var MA=_.find(courseAR.units,function(unitAR){return unit.NodeId===unitAR.unitId});return MA&&(unit.Metadata.AdditionalReadings=MA.magazineArticles),unit}))})},courseService.setDefaultView=function(){var defaultView=defaultViewService.getDefaultView(courseService.courseRoot);courseService.unit=defaultView.unit,courseService.lesson=defaultView.lesson,defaultViewService.continueTaskId},courseService.goToLesson=function(lesson,unitLocked){lesson=null==lesson?courseService.lesson:lesson,!0!==unitLocked&&!0!==lesson.IsLocked&&(courseService.saveCourseToLocalStorage(),storageService.set("Unit",lesson.ParentNodeId,"UnitId"),storageService.set("Component",lesson.NodeId,"Id"),storageService.session.set("LAContinueTaskId",{TaskId:defaultViewService.continueTaskId}),DelCookie("Lesson"),DelCookie("Component"),savePopupRefs(),activityService.lessonChange(lesson.NodeId),setTimeout(function(){gotoLAShared(),window.location=storageService.session.get("InstitutionsData","learningAsAng")?"Runtime/learningArea.html?v=5":"Runtime/Template.html"},50))},courseService.goToUnitReflection=function(unit,unitLocked){unit=unit||courseService.unit;!0!==unitLocked&&(courseService.saveCourseToLocalStorage(),storageService.set("loadUnitReflection",unit.NodeId,"UnitId"),DelCookie("Lesson"),DelCookie("Component"),savePopupRefs(),activityService.unitChange(unit.NodeId),setTimeout(function(){gotoLAShared(),window.location=storageService.session.get("InstitutionsData","learningAsAng")?"Runtime/learningArea.html?v=5":"Runtime/Template.html"},50))},courseService.getButtonText=function(nodeProgress){switch(nodeProgress){case 0:return $filter("translate")("30");case 1:return $filter("translate")("112");default:return $filter("translate")("6")}},courseService.setCourseNodeData=function(dataName,value){courseService.course[dataName]=value},courseService.storageCourse=function(){storageService.set("Course",JSON.stringify(courseService.course),"CourseJson",!0)},courseService.getLockedNodesIds=function(node){return node.IsLocked?[{ParticleId:node.NodeId,NodeType:node.CourseNodeType}]:node.Children.filter(function(childNode){if(childNode.IsLocked)return childNode}).map(function(childNode){return{ParticleId:childNode.NodeId,NodeType:childNode.CourseNodeType}})},courseService.getUnitObjectives=function(){var resPathURL=storageService.get("resPathRoot");return $http.get(resPathURL+"/"+COURSE_CONSTANT.COURSE_META_PATH+courseService.course.NodeId+".json")},courseService.getUnitsFromToeic=function(toeicCourseId){var toeicURL=storageService.get("toeicInformation","toeicServicesURL"),toeicSessionKey=storageService.get("toeicInformation","toeicSessionKey");return toeicURL+="/LearningService.svc/script/GetUnits",$http.get(toeicURL+"?courseId="+toeicCourseId,{headers:{"Edusoft-SessionKey":toeicSessionKey}})},courseService.saveCourseToLocalStorage=function(){storageService.set("Course",courseService.course.NodeId,"CourseId"),courseService.storageCourse()},courseService.calcVisualProgress=calcVisualProgress,courseService.updateUnitTestGrade=function(unitTestId,grade){edns.courseMetadata.updateUnitTestGrade(courseService.course.NodeId,unitTestId,grade);var units=courseService.course.Children.map(function(unit){return unit.Metadata.UnitTest.testId==unitTestId&&(unit.Metadata.UnitTest.grade=grade),unit});courseService.course.Children=units},courseService.getUnitReflectionState=function(course){var defer=$q.defer(),urlBase=COMMON.SERVICE_URL,apiFucionName="UnitReflection/GetUnitReflectionsState/"+courseService.course.NodeId;return $http.get(urlBase+apiFucionName).success(function(data){if(void 0===data.indexOf){var res=course.Children.map(function(unit,i){return void 0!==data[unit.NodeId]&&(unit.Metadata.reflectionState=function(value){switch(value){case 0:return"48";case 1:return"46";default:return"47"}}(data[unit.NodeId])),unit});course.Children=res}else console.log('Failed to get "GetUnitReflectionState" data');defer.resolve(course)}).error(function(data){console.log('Failed to get "GetUnitReflectionState" data'),defer.resolve(null)}),defer.promise}}])}(angular),function(angular){angular.module("edoNewUX").service("loginService",["$rootScope","storageService","authService","activityService","USERSTATE","$filter","langService","$state","userInfo","whiteLabelService","edSettingsService",function($rootScope,storageService,authService,activityService,USERSTATE,$filter,langService,$state,userInfo,whiteLabelService,edSettingsService){var loginData,studentRole=function(communityData){if(!knownErrors(loginData.StudentID)){if(0<loginData.StudentID){if(setValidStudent(),userInfo.updateCommunity(communityData),"1"!=getCompositeCookie("Community","PostLogInActivity"))return $state.go("preHome",{beforeExtApp:!0}),!0;function StopExecution(){Error.apply(this,arguments),this.name="StopExecution"}throw StopExecution.prototype=Object.create(Error.prototype),window.location.replace(Root+"D111/PLA"),new StopExecution("Stop further js execution")}alert("***********\n"+$filter("translate")("38")+"\n***********")}return!1},teacherRole=function(communityData){tmsHost,loginData.StudentID,GetInstitutionRoute();var exitLink=storageService.get("Community","link");return exitLink&&"&exitLink="+exitLink,"&edDomain="+document.location.origin,0<loginData.StudentID?(storageOnBoardingStates(loginData),removeUnnessesuryValues(loginData),storageService.set("Student",loginData),storageService.set("Activity",loginData.SessionID,"SessionID"),localStorage.removeItem("LessonSessionID"),localStorage.removeItem("TLlessonID"),localStorage.removeItem("TLcourseID"),userInfo.updateCommunity(communityData),$state.go("preHome",{beforeExtApp:!0}),!0):(knownErrors(loginData.StudentID)||alert("***********\n"+$filter("translate")("38")+"\n***********"),!1)},knownErrors=function(userId){var hasError=!0;switch(userId){case USERSTATE.USER_LOGGEDIN:alert($filter("translate")("34"));break;case USERSTATE.TOO_MANY_USERS:alert($filter("translate")("35"));break;case USERSTATE.SERVICE_FAILED:alert($filter("translate")("36"));break;case USERSTATE.PLT_NOT_ALLOWED:alert("Placement Test is not allowed");break;case USERSTATE.INACTIVE_LICENSE:alert($filter("translate")("37"));break;default:hasError=!1}return hasError},userLoggedInState=function(afterTryAuthenticate,retryObj){if(retryObj){var onHardLoginResultBound=function($rootScope,afterTryAuthenticate,userName,password,IID,result){if(result.data){var authData=userInfo.getAuthData(result.data);null!==authData&&authData.token&&(token=authData.token)&&edns.appToken.set(token),null!==authData&&!0!==authData.doneOptIn?($rootScope.userCredentials={username:userName,password:password,IID:IID},$rootScope.showOptIn=!0,$state.go("optIn")):afterTryAuthenticate(userName,password,IID)(result)}var token}.bind(this,$rootScope,afterTryAuthenticate,retryObj.userName,retryObj.password,retryObj.IID),hardlogoutBound=function(retryObj,onHardLoginResultCB){edns.vendors.google.analytics.sendCustomEvent("force_login",{action:"confirm"}),authService.forceLogin(retryObj.IID,retryObj.userName,retryObj.password,retryObj.CommunityVersion).then(function(result){onHardLoginResultCB(result)})}.bind(this,retryObj,onHardLoginResultBound),OnHardLogoutModalConfirmBound=function(edSettingsService,hardlogout){"ext"==getCompositeCookie("tempStudent","cookieSource")?edSettingsService.initAPIs().then(hardlogout):hardlogout()}.bind(this,edSettingsService,hardlogoutBound),hardLogoutModalOptions={okBtnText:$filter("translate")("1366"),cancelBtnText:$filter("translate")("321"),okCallbackAfter:OnHardLogoutModalConfirmBound,cancelCallbackAfter:onAbortHardLogin,closeCallbackAfter:onAbortHardLogin};whiteLabelService.getWhiteLabel().then(function(wl){var confirmTxt=$filter("translate")("1365",{productName:wl.productName});edns.modalManager.confirm(confirmTxt,hardLogoutModalOptions)})}else $state.go("LoginFailed",{},{location:!1});function onAbortHardLogin(){edns.vendors.google.analytics.sendCustomEvent("force_login",{action:"cancel"}),$state.go("LoginFailed",{},{location:!1})}},storageOnBoardingStates=function(data){var onBoardingStates={};angular.forEach(data.onBoardingState,function(area){onBoardingStates[area.AreaId]=area.ShowState}),storageService.set("onBoarding",JSON.stringify(onBoardingStates),"states",!0)},removeUnnessesuryValues=function(data){delete data.onBoardingState,delete data.TTO,delete data.SeeAnswers},GetInstitutionRoute=function(){var s=document.location.href;return(s=s.replace(s.substr(s.indexOf("#")),"")).substring(s.lastIndexOf("/")+1)},setValidStudent=function(studentData){loginData=void 0===studentData?loginData:studentData,isExtLogin()&&(loginData.LoginType="Ext",storageService.DelCookie("tempStudent")),storageOnBoardingStates(loginData),removeUnnessesuryValues(loginData),storageService.set("Student",loginData,void 0,null!=studentData),localStorage.removeItem("LessonSessionID"),localStorage.removeItem("TLlessonID"),localStorage.removeItem("TLcourseID"),localStorage.removeItem("Scheduler"),storageService.set("Activity",loginData.SessionID,"SessionID");var communityVer=storageService.get("Community").CommunityVersion;activityService.login(loginData.SessionID,storageService.get("Student","StudentID"),loginData.UserName,communityVer),$rootScope.isLogedin=!0,langService.setLang(),"0"==getCompositeCookie("Student","RCD")?showRCD="0":showRCD="1",sessionStorage.setItem("checkBadLogoutAlert",!0)},afterTryAuthenticate=function(userName,password,IID){var loginService=this;return function(result){if($rootScope.showSystemCheck=!0,$rootScope.showLoginViews=!1,storageService.set("logedInOnce",!0),null===result.data.UserInfo)$rootScope.exit(),alert("***********\n"+$filter("translate")("23")+"\n***********"),$rootScope.login&&($rootScope.login.userName="",$rootScope.login.password=""),$rootScope.loginForm&&($rootScope.loginForm.userName.$touched=!1,$rootScope.loginForm.password.$touched=!1);else{var communityVer=storageService.get("Community").CommunityVersion;loginService.login(result.data.UserInfo,{userName:userName,password:password,IID:IID,CommunityVersion:communityVer},result.data.InstitutionInfo)?null!==result.data.UserInfo&&result.data.UserInfo.Token&&edns.appToken.set(result.data.UserInfo.Token):$rootScope.exit()}}},afterTryAuthenticateBound=afterTryAuthenticate.bind(this),userLoggedInStateBound=userLoggedInState.bind(this,afterTryAuthenticateBound),isExtLogin=function(){return"ext"==getCompositeCookie("tempStudent","cookieSource")||"Ext"==storageService.get("Student","LoginType")};this.setValidStudent=setValidStudent,this.login=function(data,retryObj,community){if(loginData=data,parseInt(loginData.StudentID)<=parseInt(USERSTATE.USER_LOGGEDIN_SECONDS)){var afterTryAuthenticateBound=afterTryAuthenticate.bind(this);return userLoggedInState(afterTryAuthenticateBound,retryObj),!0}switch(loginData.UserType){case"a":case"da":case"su":case"ca":case"sp":case"t":return teacherRole(community);case"s":return studentRole(community);default:return alert("***********\n"+$filter("translate")("39")+"\n***********"),!1}},this.tryAuthenticate=function(userName,password,IID){return loginService=this,function(userName,password,IID,afterLoginCB){var communityVer=storageService.get("Community").CommunityVersion;authService.login(userName,password,IID,communityVer).then(function(result){afterLoginCB&&afterLoginCB(result)})}},this.afterTryAuthenticate=afterTryAuthenticate,this.isExtLogin=isExtLogin,this.setTempStudentSource=function(source){storageService.set("tempStudent",$.extend($rootScope.userCredentials,{cookieSource:source}))},this.userLoggedInStateBound=userLoggedInStateBound}])}(angular),function(angular){angular.module("edoNewUX").service("loginHeaderBLService",["$q","storageService","loginHeaderDALService",function($q,storageService,loginHeaderDALService){var IID=storageService.get("Community","IID"),isGettingLoginHeaderData=!1,loginHeaderDataDeferred=[],url=null,title=null,link=null;return{getHeaderData:function(){var defer=$q.defer();if(null!=url){var headerData={Url:url,Title:title,Link:link};defer.resolve(headerData)}else if(loginHeaderDataDeferred.push(defer),!isGettingLoginHeaderData){isGettingLoginHeaderData=!0;var onGetLoginHeaderDataBound=function(defer,res){if(res.data&&res.data){var loginHeader=res.data;url=loginHeader.Url,title=loginHeader.Title,link=loginHeader.Link,loginHeaderDataDeferred.forEach(function(deferredCB){deferredCB.resolve(loginHeader)})}else defer.resolve(null);loginHeaderDataDeferred=[],isGettingLoginHeaderData=!1}.bind(this,defer);loginHeaderDALService.getLoginHeaderData(IID).then(onGetLoginHeaderDataBound)}return defer.promise}}}])}(angular),function(angular){angular.module("edoNewUX").service("loginHeaderDALService",["COMMON","$http",function(COMMON,$http){var urlBase=COMMON.SERVICE_URL+"AppSettings/";return{getLoginHeaderData:function(IID){var url=urlBase+"login-header/";return $http.get(url)}}}])}(angular),function(angular){angular.module("edoNewUX").factory("objFuncService",[function(){return{hasValuesInObj:hasValuesInObj}}])}(angular),function(angular){angular.module("edoNewUX").factory("timeUtils",[function(){return{ConvertSecondsToHours:function(secondTime){var hours=parseInt(secondTime/60/60),minutes=Math.ceil(secondTime/60%60);return(hours=hours<10?"0"+hours:hours)+":"+(minutes=minutes<10?"0"+minutes:minutes)}}}])}(angular),function(angular){angular.module("common").factory("promotionService",["$http","COMMON",function($http,COMMON){return{GetPromtionSlides:function(institutionId){var urlBase=COMMON.SERVICE_URL+"Promotion/";return $http({cache:!0,url:urlBase+"GetPromotionSlides/"+institutionId,method:"GET"})},GetMagazineSlides:function(institutionId){var urlBase=COMMON.SERVICE_URL+"Promotion/";return $http({cache:!0,url:urlBase+"GetMagazineSlides",method:"GET"})},GetTotalArticles:function(curLevel,topicId){var finalUrl=COMMON.SERVICE_URL+"Promotions/"+"GetTotalArticles/"+curLevel+"/"+topicId;return Root&&(finalUrl=Root+finalUrl),$http.get(finalUrl)}}}])}(angular),window.angular.module("common").factory("promotionServiceBL",["$http","$q","promotionService","COMMON","storageService","applicationVariablesBL",function($http,$q,promotionService,COMMON,storageService,applicationVariablesBL){var IID=JSON.parse(localStorage.getItem("Community")).IID,_attachHttpRef=localStorage.getItem("attachHttpRef"),resPath=localStorage.getItem("resPathRoot");return{getAllSlides:function(){var defer=$q.defer();return applicationVariablesBL.get(["ResPathRoot"]).then(function(data){resPath=data.ResPathRoot.replace('"',"").replace('"',"")+"/",promotionService.GetMagazineSlides(IID).then(function(defer,resPath){return function(result){var magSlides=result.data.map(function(v){return v.src=resPath+"/"+v.src,v});addPromtionSlides(defer,magSlides)}}(defer,resPath))}),defer.promise}};function addPromtionSlides(defer,magSlides){promotionService.GetPromtionSlides(IID).then(function(defer,availableSlides,resPath,_attachHttpRef){return function(result){if(""!=result.data){var promotionData=result.data,promotionsArr=function(promotionData){var arr=[];return _.forIn(promotionData,function(slides){_.forIn(slides,function(slide){0!=slide.display&&arr.push(slide)})}),arr}(promotionData),boundAddSlidePath=addSlide.bind(this,resPath),boundAddSlidePathRef=addSlide.bind(this,resPath,_attachHttpRef);-1<promotionsArr.filter(hasCustomImage).length?attachHttpRef().then(function(attachHttpRef){console.log("resloved",attachHttpRef);var boundAddSlidePathRefUpdated=boundAddSlidePath.bind(null,attachHttpRef);avilImages=promotionsArr.map(boundAddSlidePathRefUpdated),defer.resolve(availableSlides.concat(avilImages))}):(avilImages=promotionsArr.map(boundAddSlidePathRef),defer.resolve(availableSlides.concat(avilImages)))}else defer.resolve(availableSlides)}}(defer,magSlides,resPath,_attachHttpRef))}function hasCustomImage(slide){return slide.imageType&&"custom"===slide.imageType}function addSlide(resPath,attachHttpRef,slide){return slide.fromTMS=!0,"promotion"===slide.templateName?(slide.typeTitle=slide.subTitle,slide.Title=slide.Title):(slide.typeTitle=slide.Title,slide.Title=slide.subTitle),slide.imageType&&"custom"===slide.imageType?slide.src=attachHttpRef+slide.src:slide.src=resPath+"/"+slide.src,slide}function attachHttpRef(){var urlBase,defer=$q.defer();return _attachHttpRef?setTimeout(function(){defer.resolve(_attachHttpRef)},4):(urlBase=COMMON.SERVICE_URL+"Promotion/",$http({cache:!0,url:urlBase+"GetPromotionCustomImageRoot/",method:"GET"})).then(function(res){_attachHttpRef=res.data,200===res.status?localStorage.setItem("attachHttpRef",_attachHttpRef):console.error("Error in GetPromotionCustomImageRoot API."),defer.resolve(_attachHttpRef)}),defer.promise}}]),window.angular.module("edoNewUX").factory("idiomsService",["$http","COMMON","storageService",function($http,COMMON,storageService){var currLevel;return{getIdiomsByLevel:function(level){var finalUrl=COMMON.SERVICE_URL+"Idiom/GetIdiomsByLevel/"+level;return $http.get(finalUrl)},getIdiom:function(idiomCode,level){var finalUrl=COMMON.SERVICE_URL+"Idiom/GetIdiom/"+idiomCode+"/"+level;return $http.get(finalUrl)},setLevel:function(level){currLevel=level?parseInt(level,10):Number(storageService.get("Student","Level"))},getCurrentLevel:function(){return currLevel}}}]),window.angular.module("edoNewUX").factory("videoTutorialsService",["$http","$q","storageService",function($http,$q,storageService){return{getVideosAndStudentLangs:function(crossDomain,uid){var IID,finalUrl,defer=$q.defer();return $q.all([function(){var finalUrl,defer=$q.defer();return(finalUrl=edns.mediaHost.getMediaHost().videoHost+"/Runtime/EDStudentVideos/metadata/videoTutorials.json",$http.get(finalUrl)).then(function(res){var data=res.data,visible=data.items.filter(function(v){var shouldHide=v.hide&&v.hide.some(function(iProp){var istPropsValues,instProp,istPropsValue=(istPropsValues=[{propId:"35",get:function(){return edns.testEnvironment.testEnvInLA}}],instProp=iProp.instProp,istPropsValues.find(function(prop){return prop.propId===instProp.propId}).get()),conditionPassed=function(operators,instProp,istPropsValue){return operators.find(function(v){return instProp.operatorId===v.id}).check(instProp.value,istPropsValue)}([{id:"1",check:function(a,b){return a===b}},{id:"2",check:function(a,b){return a!==b}}],iProp.instProp,istPropsValue);return conditionPassed});return!shouldHide});data.items=visible,defer.resolve(data)}),defer.promise}(),(IID=storageService.get("Community","IID"),finalUrl="WebApi/UserProfile/GetUserLanguages/"+IID,$http.get(finalUrl))]).then(function(results){defer.resolve({videos:results[0],langs:results[1].data})}),defer.promise}}}]),function(angular){angular.module("edoNewUX").service("TOEICBLService",["storageService","$http",function(storageService,$http){this.mapEdUserIdInToeic=function(edUserId){if(edns.toeic.isToeic){var toeicInformation=storageService.get("toeicInformation");if(!toeicInformation.edUserMappedInToeic){var toeicURL=toeicInformation.toeicServicesURL+"/",config={headers:{"Edusoft-SessionKey":toeicInformation.toeicSessionKey}};$http.get(toeicURL+"LoginService.svc/script/MapEdUser?toeicSessionKey="+toeicInformation.toeicSessionKey+"&edUserId="+edUserId,config)}}}}])}(angular),function(angular){var storage=window.sessionStorage;try{storage.setItem("testPrivateMode","1"),storage.removeItem("testPrivateMode")}catch(error){alert("English Discoveries Online cannot properly load if your web browser is set to Private Browsing mode.\n Please check your browser settings, turn off Private Browsing, and try again.")}angular.module("edoNewUX").run(["$rootScope","$state","$http","$location","$cookieStore","whiteLabelService","storageService","applicationVariablesBL",function($rootScope,$state,$http,$location,$cookieStore,whiteLabelService,storageService,applicationVariablesBL){var communityCookie=storageService.getCookieAsJSON("Community");$rootScope.displayed="hide",null!=communityCookie&&("/login"==$location.path()&&0<$("#siteLogin__OldHeaderOW").length?communityCookie.oldBanner=!0:communityCookie.oldBanner=!1,storageService.set("Community",communityCookie,void 0,!0),null!=communityCookie&&communityCookie.domain&&("https:"==location.protocol?$rootScope.root="https://"+communityCookie.domain:$rootScope.root="http://"+communityCookie.domain)),whiteLabelService.getWhiteLabel(),applicationVariablesBL.get(["ResPathRoot","ClassicEdoURL","TmsHost"]).then(function(data){localStorage.setItem("ClassicEdoURL",data.ClassicEdoURL),window.resPathRoot=data.ResPathRoot,localStorage.setItem("resPathRoot",'"'+window.resPathRoot+'"'),window.tmsHost=data.TmsHost})}]).controller("mainCtrl",["$scope","$location","$rootScope","authService","langService","storageService","whiteLabelService","objFuncService","loginService","TOEICBLService","unitsAdditionalReadingService","edSettingsService","institutionService",function($scope,$location,$rootScope,authService,langService,storageService,whiteLabelService,objFuncService,loginService,TOEICBLService,unitsAdditionalReadingService,edSettingsService,institutionService){var extLoginSucceeded;$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState){"home"===toState.name.toLowerCase()&&("login"==fromState.name.toLowerCase()||"prehome"==fromState.name.toLowerCase()||extLoginSucceeded||"optin"==fromState.name.toLowerCase())&&(storageService.set("Community",storageService.getCookieAsJSON("Community"),void 0,!0),$rootScope.$emit("loginSucceeded"),$rootScope.loginSucceededSiteNav=!0,extLoginSucceeded=!1)});var onStateChangeToLoginStart=function(toState){if($rootScope.currentPage=toState.name.toLowerCase(),$rootScope.isLogedin=!1,null===localStorage.getItem("Student")||GetCookie("PreviewMode"))authService.logout().then(function(){$rootScope.$broadcast("userLogout"),edns.appToken.remove(),storageService.DelCookie("PreviewMode"),storageService.DelCookie("Student"),storageService.DelCookie("Course"),storageService.DelCookie("Component"),storageService.remove("Scheduler"),storageService.remove("onBoarding"),storageService.remove("Community","link"),storageService.session.remove("InstitutionsData"),storageService.remove("viewVersionMessage"),storageService.remove("Activity"),storageService.remove("acuityZoomSchedule"),sessionStorage.removeItem("TabID"),edns.practice.userAnswers.remove(),unitsAdditionalReadingService.clean(),window.newVersionmsg=null});else{var viewBeforeSystemCheck=localStorage.getItem("viewBeforeSystemCheck");"/home"==viewBeforeSystemCheck&&(localStorage.removeItem("viewBeforeSystemCheck"),!0!==(localStorage.getItem("Student")&&"s"!==storageService.get("Student","UserType")&&"login"===toState.name.toLowerCase())&&$location.path(viewBeforeSystemCheck))}$rootScope.displayed="",function(){window.openPopups||(window.openPopups=[]),window.syschekModal||(window.syschekModal=[]);var openpopups=localStorage.getItem("openpopups");if(openpopups){openpopups=JSON.parse(openpopups);for(var i=0;i<openpopups.length;i++){var newWin=window.open("",openpopups[i],"width=...");window.openPopups.push(newWin)}}if(window.dicWin&&window.dicWin.close(),window.openPopups&&0<window.openPopups.length)for(i=0;i<window.openPopups.length;i++)window.openPopups[i].close();localStorage.setItem("openpopups","")}(),localStorage.setItem("closed","true"),langService.setLang()};$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if("login"===toState.name.toLowerCase())null==$rootScope.currentPage?edSettingsService.initAPIs().then(function(result){var url=$location.$$absUrl.replace($location.$$protocol+"://","").split("#")[0];url.split("/")[0],url.split("/")[1],onStateChangeToLoginStart(toState)}):onStateChangeToLoginStart(toState);else{$rootScope.currentPage=toState.name.toLowerCase();var toParamsHasValues=toParams&&(0===toParams.secondsLeft||!!toParams.secondsLeft);"delayedlogin"!==toState.name.toLowerCase()||toParamsHasValues||($rootScope.showLoginViews=!0);var loginType=getCompositeCookie("tempStudent","cookieSource");if("delayedlogin"===toState.name.toLowerCase()&&"ext"==loginType&&($rootScope.showLoginViews=!0),"optin"===toState.name.toLowerCase())return void($rootScope.showOptIn=!0);"prehome"!==toState.name.toLowerCase()&&authService.isLoggedIn().then(function(result){if(result.data){$(document).off("contextmenu").on("contextmenu",handleRightClick);var localStorageStudent=storageService.get("Student"),studentCookie=storageService.getCookieAsJSON("Student");switch($.isEmptyObject(localStorageStudent)||studentCookie&&localStorageStudent.StudentID!=studentCookie.StudentID?(extLoginSucceeded=!0,studentCookie&&(studentCookie.onBoardingState=studentCookie.onBoardingState?JSON.parse(studentCookie.onBoardingState):{},storageService.set("Student","","onBoardingState"),loginService.setValidStudent(studentCookie),TOEICBLService.mapEdUserIdInToeic(storageService.get("Student").StudentID))):"1"==storageService.getCookie("Student","StudentPlatform")&&storageService.set("Student","1","StudentPlatform"),whiteLabelService.getWhiteLabel().then(function(wl){wl.featureFlags&&"true"==wl.featureFlags.noTeacher&&storageService.set("Student","0","HasTeacher")}),storageService.remove("PreviewMode"),storageService.remove("ViewTestResultsMode"),storageService.remove("compTestSequence"),storageService.set("Community",storageService.getCookieAsJSON("Community").CEFR,"CEFR",!0),$rootScope.isLogedin=!0,$rootScope.displayed="hide",$rootScope.isStudentRole="1"!=storageService.get("Student","StudentPlatform"),$rootScope.currentPage){case"home":null==localStorage.getItem("viewBeforeSystemCheck")&&localStorage.setItem("viewBeforeSystemCheck","/"+$rootScope.currentPage);break;default:localStorage.removeItem("viewBeforeSystemCheck")}$rootScope.$broadcast("studentCookieReady")}else""===result.data&&"/SessionTimeout"!=$location.path()&&"/DelayedLogin"!=$location.path()&&$location.path("/login")},function(){$location.path("/login")}),langService.setLang()}}),$rootScope.exit=function(){$rootScope.isLogedin=!1,$location.path("/login")},$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParame){var string;event.currentScope&&event.currentScope.currentPage&&edns.vendors.google.analytics.sendPageView((string=event.currentScope.currentPage).charAt(0).toUpperCase()+string.slice(1),toParams)}),$rootScope.$on("navLoaded",function(e,args){"home"===$rootScope.currentPage&&($rootScope.$emit("navStatus",{opened:!0}),$rootScope.$emit("HPLoaded"))}),$.subscribe("closeNCNavigateModal",function(){$rootScope.$broadcast("closeNCNavigateModal")}),$scope.$on("edEmitAfterRender",function(event,data){data&&"dictionary"===data.loadedEl&&edns.dictionary.onDocReady()})}])}(angular),function(angular){angular.module("edoNewUX").controller("homeCtrl",["$rootScope","$scope","$filter","$modal",function($rootScope,$scope,$filter,$modal){var str,unsub_showSystemCheck=$rootScope.$on("showSystemCheck",function(){!function(){if($rootScope.showSystemCheck){$rootScope.showSystemCheck=!1;0<$(".home__IW").length?$(".home__IW"):$("body");var modalOptions={iFrameUrl:"Runtime/SysCheck/SysCheck.htm?PW=0",modalType:"custom",modalId:"sysCheckAlert",iFrameHeight:100,iFrameWidth:450,confirmRow:!0,okBtnText:$filter("translate")("312"),showOkBtn:!0,confirmRow:!0,windowClass:"rtlAware layout__alertModal sysCheckAlert",modalWrapperClass:"sysCheckAlertW hide",closeCallbackAfter:afterDismiss,okCallbackAfter:afterDismiss};function afterDismiss(){$rootScope.$broadcast("checkSysAlertCookie")}window.syschekModal=edns.modalManager.custom(modalOptions)}}()});if($scope.$on("$destroy",function(){unsub_showSystemCheck()}),window.addEventListener(edns.browser.eventNames.onBeforeunloadEventName,function(event){for(var i=0;i<openPopups.length;i++)if(openPopups[i]&&!openPopups[i].closed)try{null==openPopups[i].name&&openPopups[i].close()}catch(err){openPopups[i].close()}}),$rootScope.actionEnc){var action=JSON.parse((str=$rootScope.actionEnc,decodeURIComponent(escape(window.atob(str)))));if($rootScope.isLogedin)openModal(this,$rootScope,action);else{var openModalBound=openModal.bind(this,this,$rootScope,action);$rootScope.$on("studentCookieReady",openModalBound)}function openModal(ctrl,$rootScope,action){var contentFileName=$rootScope.root+action.url,modalCssWrapperName=action.modalCssClass;ctrl.NCNavigateModal=ctrl.actionModal=$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalIframeTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware ModalForContentInIframeW "+modalCssWrapperName,backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalContent:contentFileName,iFrameWidth:action.modalWidth,iFrameHeight:action.modalHeight}}}}),$rootScope.$on("closeNCNavigateModal",ctrl.NCNavigateModal.close)}}}])}(angular),function(angular){angular.module("edoNewUX").controller("studentAssignedCtrl",["$rootScope","$scope","$http","$q","COURSE_CONSTANT","progressService","storageService","$filter","$translate","courseDataService","assessmentsBLTOEICService","schedulerService",function($rootScope,$scope,$http,$q,COURSE_CONSTANT,progressService,storageService,$filter,$translate,courseDataService,assessmentsBLTOEICService,schedulerService){var scope=$scope;scope.studentAssigned=!0;var bEventFired=!1;function bindCourse(res){var data=res.data;courseDataService.setCourseData(data),schedulerService.addLockReason(data.CourseProgressTree,schedulerService.elementTypes.Unit).then(function(){!function(data){scope.$broadcast("courseLoaded"),courseDataService.setDefaultView(),scope.$broadcast("unitsLoaded"),scope.studentAssigned=!(0===data.length),assessmentsBLTOEICService.isToeic&&(assessmentsBLTOEICService.setLastProgressCourseId(data.CourseId),storageService.get("toeicInformation").userTests||assessmentsBLTOEICService.GetUserTests(assessmentsBLTOEICService.getAssignedCourses()).then(function(tests){tests.data.d&&storageService.set("toeicInformation",tests.data.d,"userTests")}))}(data)})}$rootScope.$on("$translateChangeSuccess",function(){0==bEventFired&&(scope.studentAutoAssignedCBPT=$translate.instant("28"),bEventFired=!0)}),0==bEventFired&&$translate("28").then(function(translatedValue){bEventFired=!0,scope.studentAutoAssignedCBPT=translatedValue}),scope.GrammarId=COURSE_CONSTANT.COURSE_GRAMMAR,$rootScope.unAssigned=!scope.studentAssigned,scope.bindDefaultCourse=function(){progressService.getDefaultCourseProgress().then(bindCourse)},scope.bindSpecificCourse=function(courseId){progressService.getCourseProgress(courseId).then(bindCourse)},scope.bindCourseNoProgress=function(courseId){progressService.getEmptyProgressCourse(courseId).then(bindCourse)}}])}(angular),angular.module("edoNewUX").controller("bootstrapCarouselCtrl",["$scope","$rootScope","assignmentServiceBL","$filter","$timeout","COURSE_CONSTANT","storageService","courseDataService","activityService","sitenavNotificationsService","schedulerService","authService","applicationVariablesBL",function($scope,$rootScope,assignmentServiceBL,$filter,timeout,COURSE_CONSTANT,storageService,courseDataService,activityService,sitenavNotificationsService,schedulerService,authService,applicationVariablesBL){var ctrl=this,scope=$scope;ctrl.addItalicsForToefl=edns.toefl.addItalicsForToefl;var originalCoursesNames,inRefresh=ctrl.courseLoaded=!1,areas={home:1},getCourses=function(){applicationVariablesBL.get(["ResPathRoot"]).then(function(data){resPath=data.ResPathRoot.replace('"',"").replace('"',"")+"/",assignmentServiceBL.getCourses($rootScope.isStudentRole,setAssignedCourses,void 0)})};function emitAssignedCourses(){(originalCoursesNames=originalCoursesNames||ctrl.availableImages)&&(originalCoursesNames=originalCoursesNames.map(function(v,i){return _.pick(v,["CourseId","courseName","coursePlan","IsLocked","lockReason","LicenseExpiration"])}),courseDataService.course&&(originalCoursesNames=originalCoursesNames.map(function(v,i){return v.current=v.CourseId==courseDataService.course.NodeId,v})),$rootScope.$broadcast("assignedCourses",{courses:originalCoursesNames}))}function setAssignedCourses(res){if(assignedCourses=res.data.AssignedCourses?res.data.AssignedCourses:res.data,0===assignedCourses.length)return scope.$parent.studentAssigned=!1,saveCourses([]),void $rootScope.$emit("unAssigned");$rootScope.$emit("loadOnboarding",areas[$rootScope.currentPage]),bindCourses(assignedCourses),saveCourses(assignedCourses),res.data.testAssignmentsCount&&0<res.data.testAssignmentsCount&&sitenavNotificationsService.siteNav.set("assessments").addCount(res.data.testAssignmentsCount),void 0!==res.data.hasDateCondition&&schedulerService.setHasDateConditionFlag(res.data.hasDateCondition)}function bindCourses(data,courseId){ctrl.availableImages=data,$rootScope.isStudentRole?(courseId?scope.$parent.bindSpecificCourse(courseId):scope.$parent.bindDefaultCourse(),emitAssignedCourses()):courseId?scope.$parent.bindCourseNoProgress(courseId):scope.$parent.bindCourseNoProgress(data[0].CourseId)}function saveCourses(data){storageService.set("Courses",data)}$rootScope.isLogedin?getCourses():$rootScope.$on("studentCookieReady",function(){getCourses()}),$scope.$on("completedTest",function(e,args){if("CT"==args.testType){switch(args.testStatus){case"-1":case"-3":break;case"0":getCourses()}edns.scheduler.userHasPlan()&&getCourses()}else getCourses()}),$scope.$on("navigateToCourse",function(e,data){var id,courseIndex,before,after,newAI;id=data.CourseId,courseIndex=_.findIndex(ctrl.availableImages,function(v){return v.CourseId===id}),before=ctrl.availableImages.slice(0,courseIndex),after=ctrl.availableImages.slice(courseIndex),newAI=Array.prototype.concat(after,before),inRefresh=!0,bindCourses(newAI,id)});var arr=[];scope.$parent.$on("courseLoaded",function(e){if(ctrl.courseLoaded=!0,!ctrl.slides||!equalArrays(ctrl.slides,ctrl.availableImages,"CourseId")||inRefresh){inRefresh=!1,ctrl.slides=null,arr=[];var hasCEFR="1"==storageService.get("Community","CEFR"),currCourseIndx=ctrl.availableImages.length;angular.forEach(ctrl.availableImages,function(val,ind){if(val.CourseId==courseDataService.course.NodeId||currCourseIndx<ind){var picture=val.PictureId?val.PictureId:val.CourseId,slide={CourseId:val.CourseId,PictureId:picture,CEFRName:hasCEFR&&val.CEFRName?val.CEFRName:null};val.CourseId==courseDataService.course.NodeId&&(slide.src=COURSE_CONSTANT.COURSE_IMAGES_PATH+picture+".jpg",currCourseIndx=ind),this.push(slide)}},arr);for(var i=0;i<currCourseIndx;i++){var picture=ctrl.availableImages[i].PictureId?ctrl.availableImages[i].PictureId:ctrl.availableImages[i].CourseId;arr.push({CourseId:ctrl.availableImages[i].CourseId,PictureId:picture,CEFRName:hasCEFR&&ctrl.availableImages[i].CEFRName?ctrl.availableImages[i].CEFRName:null})}1<arr.length&&(arr[1].src=COURSE_CONSTANT.COURSE_IMAGES_PATH+arr[1].PictureId+".jpg",arr[arr.length-1].src=COURSE_CONSTANT.COURSE_IMAGES_PATH+arr[arr.length-1].PictureId+".jpg"),ctrl.slides=arr,ctrl.coursesIndex=0,ctrl.currentIndex=0}ctrl.courseName=courseDataService.course.Name,localStorage.setItem("CourseName",courseDataService.course.Name),ctrl.doneCourse=courseDataService.course.IsDone,activityService.courseChange(courseDataService.course.NodeId)}),scope.$parent.$on("updateFailed",function(e){ctrl.courseName="",ctrl.unitSequence="",ctrl.unitName="",ctrl.lessonName="",alert($filter("translate")("44"))});var equalArrays=function(arr1,arr2,key){if(arr1.length!=arr2.length)return!1;var tempArr=[];return arr1.forEach(function(item1){arr2.filter(function(item2){return item1[key]==item2[key]}).length&&tempArr.push(item1)}),tempArr.length==arr1.length};scope.$parent.$on("unitsLoaded",function(e){if(ctrl.unitSequence="Unit "+courseDataService.unit.Sequence,ctrl.unitName=courseDataService.unit.Name.trim(),courseDataService.lesson.Metadata.Skill==scope.$parent.GrammarId&&-1==courseDataService.lesson.Metadata.Subject.indexOf(COURSE_CONSTANT.IGNORED_SUBJECT)?ctrl.lessonName=courseDataService.lesson.Metadata.Subject+": "+courseDataService.lesson.Name:ctrl.lessonName=courseDataService.lesson.Name,ctrl.buttonText=courseDataService.getButtonText(courseDataService.course.Progress),ctrl.goToLesson=courseDataService.goToLesson,sessionStorage.getItem("checkBadLogoutAlert")){var studentID=storageService.get("Student","StudentID");authService.checkLogout(studentID).then(function(result){if(0==result.data){var text=$filter("translate")("396"),obtnText=$filter("translate")("312");edns.modalManager.alert(text,{okBtnText:obtnText,modalWrapperClass:"modalW_alert--aboveOB"})}sessionStorage.removeItem("checkBadLogoutAlert")})}emitAssignedCourses()}),scope.$parent.$on("languageUpdated",function(e){timeout(function(){ctrl.unitSequence="Unit "+courseDataService.unit.Sequence,ctrl.unitName=courseDataService.unit.Name.trim(),ctrl.lessonName=courseDataService.lesson.Metadata.Skill==scope.$parent.GrammarId?courseDataService.lesson.Metadata.Subject+": "+courseDataService.lesson.Name:courseDataService.lesson.Name,ctrl.buttonText=courseDataService.getButtonText(courseDataService.course.Progress),ctrl.goToLesson=courseDataService.goToLesson,scope.$apply()},150)}),scope.resizeCarouselTexts=function(){var _resizeCourseName=function(){if($(".BSslide.active .carouselPathCourseName .textFitted").css("margin-top"),$(".BSslide.active .carouselPathCourseName").css("width",$(".BSslide.active .carouselCaptions").innerWidth()+"px"),textFit($(".BSslide.active .carouselPathCourseName"),{maxFontSize:70}),void 0!==$(".BSslide.active .carouselPathCourseName .textFitted")){var marginTop=($(".BSslide.active .carouselPathCourseName").height()-$(".BSslide.active .carouselPathCourseName .textFitted").height())/2;$(".BSslide.active .carouselPathCourseName .textFitted").css("margin-top",marginTop)}},_resizeCoursePath=function(){if($(".BSslide.active .carouselPathW .textFitted").css("margin-top"),$(".BSslide.active .carouselPathW").css("width",$(".BSslide.active .carouselCaptions").innerWidth()+"px"),textFit($(".BSslide.active .carouselPathW"),{maxFontSize:23}),void 0!==$(".BSslide.active .carouselPathW .textFitted")){var marginTop=($(".BSslide.active .carouselPathW").height()-$(".BSslide.active .carouselPathW .textFitted").height())/2;$(".BSslide.active .carouselPathW .textFitted").css("margin-top",marginTop)}};$(document).ready(function(){$(".BSslide.active .carouselPathCourseName").css("height",$(".BSslide.active .carouselPathCourseName").innerHeight()+"px"),$(".BSslide.active .carouselPathCourseName").css("width",$(".BSslide.active .carouselCaptions").innerWidth()+"px"),$(".BSslide.active .carouselPathW").css("height",$(".BSslide.active .carouselPathW").innerHeight()+"px"),$(".BSslide.active .carouselPathW").css("width",$(".BSslide.active .carouselCaptions").innerWidth()+"px"),_resizeCoursePath(),_resizeCourseName(),$(window).bind("resize",function(e){window.resizeCarouselTextsEvt,$(window).resize(function(){_resizeCoursePath(),_resizeCourseName(),clearTimeout(window.resizeCarouselTextsEvt),window.resizeCarouselTextsEvt=setTimeout(function(){_resizeCoursePath(),_resizeCourseName()},100)})})})},ctrl.onSlideChanged=function(nextSlide,direction){switch(direction){case"next":ctrl.courseLoaded=!1,timeout(function(){ctrl.coursesIndex=ctrl.coursesIndex+1>=ctrl.availableImages.length?0:ctrl.coursesIndex+1,$rootScope.isStudentRole?scope.$parent.bindSpecificCourse(ctrl.slides[ctrl.coursesIndex].CourseId):scope.$parent.bindCourseNoProgress(ctrl.slides[ctrl.coursesIndex].CourseId),ctrl.currentIndex+1>=ctrl.slides.length-1?ctrl.currentIndex=0:ctrl.currentIndex++,ctrl.currentIndex+1<=ctrl.slides.length-1?ctrl.slides[ctrl.currentIndex+1].src=COURSE_CONSTANT.COURSE_IMAGES_PATH+arr[ctrl.currentIndex+1].PictureId+".jpg":ctrl.slides[0].src=COURSE_CONSTANT.COURSE_IMAGES_PATH+arr[0].PictureId+".jpg"},200);break;case"prev":ctrl.courseLoaded=!1,timeout(function(){ctrl.coursesIndex=0<ctrl.coursesIndex?ctrl.coursesIndex-1:ctrl.slides.length-1,$rootScope.isStudentRole?scope.$parent.bindSpecificCourse(ctrl.slides[ctrl.coursesIndex].CourseId):scope.$parent.bindCourseNoProgress(ctrl.slides[ctrl.coursesIndex].CourseId),ctrl.currentIndex-1<0?ctrl.currentIndex=ctrl.slides.length:ctrl.currentIndex--,ctrl.currentIndex-1<0==0?ctrl.slides[ctrl.currentIndex-1].src=COURSE_CONSTANT.COURSE_IMAGES_PATH+arr[ctrl.currentIndex-1].PictureId+".jpg":ctrl.slides[ctrl.slides.length-1].src=COURSE_CONSTANT.COURSE_IMAGES_PATH+arr[ctrl.slides.length-1].PictureId+".jpg"},200)}}}]),angular.module("edoNewUX").controller("unitsCtrl",["$scope","$http","$rootScope","$document","clickEventName","supportedMobiles","COURSE_CONSTANT","$filter","storageService","schedulerService","courseDataService","activityService","unitsAdditionalReadingService","$timeout","$modal",function($scope,$http,$rootScope,$document,clickEventName,supportedMobiles,COURSE_CONSTANT,$filter,storageService,schedulerService,courseDataService,activityService,unitsAdditionalReadingService,timeout,$modal){var ctrl=this,scope=$scope;ctrl.showUnitHandle=-1,ctrl.course=$scope.course,ctrl.toeicFailTexts={messageTxt:$filter("translate")("1213"),btnTxt:$filter("translate")("312")},window.openPopups||(window.openPopups=[]);var openpopups=localStorage.getItem("openpopups");if(openpopups){openpopups=JSON.parse(openpopups);for(var i=0;i<openpopups.length;i++){var newWin=window.open("",openpopups[i],"width=...");window.openPopups.push(newWin)}}function bindUnits(){courseDataService.course&&(ctrl.units=courseDataService.course.Children,ctrl.hover=!1,ctrl.unitColorLength=12,ctrl.cssPercentage=function(val){return{width:calcVisualProgress(val,!0,!0)+"%"}},ctrl.buttonText=courseDataService.getButtonText(courseDataService.unit.Progress),ctrl.state.additionalContentOpenIdx=-1)}window.explWin=null,scope.$parent.$on("updateStarted",function(e){}),scope.$parent.$on("unitsLoaded",function(e){bindUnits(),localStorage.removeItem("DoneItems")}),scope.$parent.$on("languageUpdated",function(e){timeout(function(){bindUnits()},100)}),ctrl.goToLesson=courseDataService.goToLesson,scope.$parent.$on("updateFailed",function(e){ctrl.units={}}),ctrl.currentUnit=function(unit,$index){return unit.NodeId===courseDataService.unit.NodeId&&!(!0===unit.IsLocked)&&unit.Progress<1&&(void 0===$index||ctrl.state.hover==$index||ctrl.state.selected==$index)},ctrl.unitBackgroundImage=function(NodeId,ordinal){return{background:"transparent url("+COURSE_CONSTANT.COURSE_UNIT_IMAGES_PATH+NodeId+".jpg?ordinal="+(ordinal+1)+")"}},ctrl.loadingUnits=!1,ctrl.calcCssProgress=function(progress,locked){if(void 0!==locked)return"home__courseListItemProgress--locked"},ctrl.state={selected:-1,lessonsListIdx:-1,hover:-1,dontHideUnit:-1,lessonListScroll:!1,additionalContentOpenIdx:-1},ctrl.stopProp=function(event){event&&event.stopPropagation?event.stopPropagation():(event=window.event).cancelBubble=!0},ctrl.stopPropAndMouseEnter=function($event,state,$index){$event&&$event.stopPropagation?$event.stopPropagation():($event=window.event).cancelBubble=!0,supportedMobiles&&ctrl.state.dontHideUnit<0&&ctrl.mouseEnter(state,$index)},ctrl.statusClick=function($index,$event,uProgress,uIsLocked,uIsCurrentUnit,source,state){supportedMobiles&&state.selected!==$index?ctrl.stopPropAndMouseEnter($event,state,$index):uIsCurrentUnit&&!1===uIsLocked&&1!==uProgress&&"status"===source?ctrl.goToLesson():ctrl.toggleLessons($index,$event,source)},ctrl.toggleLessons=function($index,$event,source){ctrl.state.lessonsListIdx==$index?(ctrl.state.lessonsListIdx=-1,ctrl.state.selected=-1):ctrl.showLessons($index,$event),$rootScope.$broadcast("toggleLessons")},ctrl.showLessons=function($index,$event){if(ctrl.state.selected=$index,ctrl.state.lessonsListIdx=$index,ctrl.state.hover=-1,$event&&$event.stopPropagation?$event.stopPropagation():($event=window.event).cancelBubble=!0,-1<$index){activityService.unitChange(ctrl.units[$index].NodeId);var notSubmittedTest=storageService.get("toeicInformation","notSubmittedTest");notSubmittedTest&&(courseDataService.updateUnitTestGrade(notSubmittedTest,null),storageService.remove("toeicInformation","notSubmittedTest"))}},$rootScope.showLessons=ctrl.showLessons,$rootScope.setUnitHandle=function(idx){ctrl.showUnitHandle=idx},ctrl.hideLessons=function(){if(!(0<$(".OBOpen").length)&&ctrl.state){if(supportedMobiles&&-1<ctrl.state.dontHideUnit)return void scope.$apply(function(){ctrl.state.dontHideUnit=-1});scope.$apply(function(){ctrl.state.selected=-1,ctrl.state.lessonsListIdx=-1,ctrl.state.hover=-1,ctrl.state.additionalContentOpenIdx=-1,supportedMobiles&&(ctrl.state.dontHideUnit=-1)})}},ctrl.scrollbarOptions=scrollbarOptions={axis:"y",autoHideScrollbar:!1,alwaysShowScrollbar:1,autoExpandScrollbar:!0,advanced:{autoUpdateTimeout:5e3,updateOnContentResize:!0,autoUpdateTimeout:0,updateOnImageLoad:!1},scrollButtons:{enable:!1},mouseWheel:{enable:!0}},$document.bind(clickEventName,function($event){ctrl.hideLessons()}),ctrl.mouseEnter=function(state,$index){ctrl.state.hover=$index,supportedMobiles&&(ctrl.state.selected=$index,ctrl.state.lessonsListIdx=-1)},ctrl.mouseLeave=function(state,$index){ctrl.state.hover=-1},ctrl.getUnitProgressTitle=function(progress){return $filter("translate")("114").replace("<val>",calcVisualProgress(progress,!0,!1))},ctrl.progressIcon={locked:!1,icon:"notStarted",title:""},ctrl.openUnitInfo=function(unitId,e){e.stopPropagation(),courseDataService.saveCourseToLocalStorage();$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalIframeTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware ModalForContentInIframeW unitInfoModal",backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalContent:($rootScope.root.endsWith("/")?$rootScope.root:$rootScope.root+"/")+"runtime/unitInfo.html?unitId="+unitId.toString(),iFrameWidth:990,iFrameHeight:613}}}})},ctrl.openUnitTest=function(unitId,unitTestId,$index,$event){edns.toeic.gotoUnitTest(unitTestId,courseDataService.course.Metadata.ToeicId,ctrl.toeicFailTexts),ctrl.state.lessonsListIdx=-1,ctrl.state.selected=-1},ctrl.openTestResults=function(unitTestId,$index,$event){edns.toeic.gotoUnitTestResultsReview(unitTestId,courseDataService.course.Metadata.ToeicId,ctrl.toeicFailTexts),ctrl.state.lessonsListIdx=-1,ctrl.state.selected=-1},ctrl.getSkillName=function(lessonMetadata){return edns.courseMetadata.getSkillName(lessonMetadata)},$rootScope.$on("toeicUnitTestSubmitted",function(e,args){courseDataService.updateUnitTestGrade(args.testId,args.grade)}),ctrl.toggleAdditionalContent=function($index,$event){ctrl.state.additionalContentOpenIdx=ctrl.state.additionalContentOpenIdx!==$index?$index:-1,-1!==ctrl.state.additionalContentOpenIdx&&(console.log(ctrl.state.additionalContentOpenIdx),setTimeout(function(){$($event.srcElement.closest(".home__courseListIW")).mCustomScrollbar("scrollTo","bottom")},4))},ctrl.gotoMagazineArticle=function(unitId,code,$event){var courseId=ctrl.units.find(function(v){return v.NodeId===unitId}).ParentNodeId;unitsAdditionalReadingService.gotoMagazineArticle(courseId,unitId,code)},ctrl.unitHasUnitObjectives=edns.unitObjectives.unitHasUnitObjectives,ctrl.openUnitObjectives=function(unit,e){e.stopPropagation(),courseDataService.saveCourseToLocalStorage();var unitObjectiveId=unit.Metadata.BaseEdusoftUnitId||unit.NodeId;$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalIframeTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware ModalForContentInIframeW unitObjectivesModal",backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalContent:($rootScope.root.endsWith("/")?$rootScope.root:$rootScope.root+"/")+"runtime/UnitObjectives/unitObjectives.html?unitId="+unitObjectiveId.toString(),iFrameWidth:990,iFrameHeight:613}}}})}}]),function(angular){function communityCtrl($rootScope,$scope,$state,$rootScope,institutionService,siteNavService,storageService,$modal){storageService.set("Student",null,"LevelTemp");var vm=this;$rootScope.showCommunity=!0;var rootUrl=localStorage.getItem("ClassicEdoURL");window.openPopups||(window.openPopups=[]),vm.rootUrl=rootUrl;0<$(".home__IW").length?$(".home__IW"):$("body");vm.changeStates=function(url,winName){if("Magazine"==url||"TalkingIdioms"==url||"Games"==url)$state.go(url);else{siteNavService.tabsManager(url,winName);siteNavService.goToOldSite(url,winName,"")}},$scope.$parent.$on("InstitutionsDataLoaded",function(e){!function(displayCommunityBlocksArray){var displayTeacherData=!0;$rootScope.isStudentRole||(displayTeacherData=!1);vm.arrCItems=[{tid:"ct1_Forum",winName:"Forum",link:"forum/forumsHome.aspx",cssClass:"community__IPSecItem_forum",image:rootUrl+"Runtime/Context/NewLF/Community/forum.gif",cap:{v:"479",t:"0"},tit:{v:"474",t:"1"},display:displayTeacherData,btnTxt:"6"},{tid:"ct2_Magazine",winName:"Magazine",link:"Magazine",cssClass:"community__IPSecItem_magazine",image:rootUrl+"Runtime/Context/NewLF/Community/magazine.gif",cap:{v:"478",t:"1"},tit:{v:"473",t:"1"},display:!0,btnTxt:"6"},{tid:"Games",winName:"Games",link:"Games",cssClass:"community__IPSecItem_games",image:rootUrl+"Runtime/Context/NewLF/Community/WordZone.gif",cap:{v:"494",t:"1"},tit:{v:"495",t:"1"},display:!0,btnTxt:"6"},{tid:"ct6_Idioms",winName:"Idioms",link:"TalkingIdioms",cssClass:"community__IPSecItem_idioms",image:rootUrl+"Runtime/Context/NewLF/Community/idioms.gif",cap:{v:"477",t:"1"},tit:{v:"480",t:"1"},display:!0,btnTxt:"6"}];for(var i=0;i<vm.arrCItems.length;i++)displayCommunityBlocksArray&&angular.forEach(displayCommunityBlocksArray.displayCommunity,function(value,key){vm.arrCItems[i].tid==key&&0==value&&vm.arrCItems.splice(i,1)}),vm.arrCItems[i]&&0==vm.arrCItems[i].display&&vm.arrCItems.splice(i,1);vm.cmmItems=vm.arrCItems}(storageService.session.get("InstitutionsData"))}),institutionService.setData()}angular.module("edoNewUX").controller("communityCtrl",communityCtrl),communityCtrl.$inject=["$rootScope","$scope","$state","$rootScope","institutionService","siteNavService","storageService","$modal"]}(window.angular),window.angular.module("edoNewUX").controller("magazineCtrl",["$scope","$state","$rootScope","magazineService","storageService","$modal","$filter","$stateParams",function($scope,$state,$rootScope,magazineService,storageService,$modal,$filter,$stateParams){var ctrl=this,scope=$scope,closeModalTimeout=500;function activate(from){$scope.topicId=$stateParams.topicId,ctrl.topicsModalOpen=!1,ctrl.stateName=$state.current.name,ctrl.showLoadMore=!1,ctrl.cssName="",setCurrentLevel(),function(){if("Magazine.Article"!==$state.current.name&&$state.params.viewMode)ctrl.viewMode.current=parseInt($state.params.viewMode,10);else switch($state.current.name){case"Magazine":case"Magazine.Archive":ctrl.viewMode.current=1;break;case"Magazine.Topic":ctrl.viewMode.current=2;break;case"Magazine.Article":case"Magazine.Topic.topArticle":case"Magazine.Archive.arcArticle":ctrl.viewMode.current=3;break;case"Magazine.SearchByTitle":ctrl.viewMode.current=4,ctrl.searchWord=$state.params.words}}(),ctrl.onChangeCurrentLevel=onChangeCurrentLevel,1===ctrl.viewMode.current?(ctrl.cssName="magazine__main--archive",!ctrl.issues||ctrl.issues.length<2?magazineService.GetIssues().then(function(result){ctrl.issues=result.data,"Magazine.Archive"!==$state.current.name?ctrl.item=$.extend({},ctrl.issues[0]):setItemFromStateParams(),goToArticleByMonth()}):($state.is("Magazine.Archive")?setItemFromStateParams():ctrl.item=$.extend({},ctrl.issues[0]),goToArticleByMonth(),resetTopic())):2===ctrl.viewMode.current&&$state.params.topic?(ctrl.cssName="magazine__main--topic",ctrl.goToIssueByTopic($state.params.topic)):3===ctrl.viewMode.current&&$state.params.articleCode?ctrl.cssName="magazine__main--article":4===ctrl.viewMode.current&&$state.params.words&&(ctrl.cssName="magazine__main--search",magazineService.GetIssues().then(function(result){ctrl.issues=result.data,ctrl.item=$.extend({},ctrl.issues[0]),ctrl.getArticlesBySearchWordInTitle(ctrl.searchWord),resetTopic()}))}function setItemFromStateParams(){ctrl.item={},ctrl.item.Month=$state.params.month,ctrl.item.Year=$state.params.year,ctrl.item.Date=ctrl.monthNamesDic[ctrl.item.Month]+" "+ctrl.item.Year,scope.itemDate=ctrl.item.Date}function setCurrentLevel(fromMyProfile){$state.params.level?ctrl.currentLevel=parseInt($state.params.level,10):storageService.get("Student","LevelTemp")&&!fromMyProfile?ctrl.currentLevel=Number(storageService.get("Student","LevelTemp")):(storageService.set("Student",null,"LevelTemp"),ctrl.currentLevel=Number(storageService.get("Student","Level")))}function onChangeCurrentLevel(levelId){ctrl.currentLevel=levelId,ctrl.currentTopic&&ctrl.currentTopic.index&&(ctrl.currentTopic.index=null),storageService.set("Student",levelId,"LevelTemp"),1===ctrl.viewMode.current?ctrl.goToArticleByMonth():2===ctrl.viewMode.current?(ctrl.goToIssueByTopic(),$state.go("Magazine.Topic")):4===ctrl.viewMode.current&&ctrl.getArticlesBySearchWordInTitle($state.params.words)}function goToArticleByMonth(){setTimeout(function(){$("body").removeClass("archivePagerModal--open")},closeModalTimeout),magazineService.GetArticlesInMonth(ctrl.currentLevel,ctrl.item.Month,ctrl.item.Year).then(function(result){ctrl.Articles=result.data})}function resetTopic(){ctrl.currentTopic={id:-1},ctrl.currentTopic.index=null}function setArticleDate(item){var itemDateArray=item.PublicationDate.split("/");item.Month=parseInt(itemDateArray[1],10),item.Year=parseInt(itemDateArray[2],10)}function getArticlesByTopic(topicId,fromRecord,numberOfRecords){magazineService.GetArticlesByTopic(ctrl.currentLevel,topicId,fromRecord,numberOfRecords).then(function(result){ctrl.showLoadMore=!0,ctrl.Articles=16<=fromRecord?ctrl.Articles.concat(result.data):result.data,ctrl.topicAllRowsCount=ctrl.Articles[0].countAllRows,ctrl.Articles.length==ctrl.Articles[0].countAllRows&&(ctrl.showLoadMore=!1),ctrl.Articles.map(setArticleDate);var currentTopic=ctrl.topics.filter(function(item){return item.id===topicId});ctrl.currentTopic=currentTopic[0],scope.currentTopicName=ctrl.currentTopic.name,2!==ctrl.viewMode.current&&(ctrl.viewMode.current=2,$state.go("Magazine.Topic")),ctrl.item=ctrl.item||{},ctrl.item.Month=ctrl.Articles[0].Month,ctrl.item.Year=ctrl.Articles[0].Year})}window.openPopups||(window.openPopups=[]),$rootScope.currentPage,ctrl.viewMode={1:"magByDate",2:"magByTopic",3:"magArticle",4:"searchByTitle"},ctrl.resPath=localStorage.getItem("resPathRoot").replace('"',"").replace('"',"")+"/",ctrl.topics=[{id:7,name:"World",cssClass:"world"},{id:3,name:"Business",cssClass:"business"},{id:6,name:"Science & Technology",cssClass:"scienceAndTechnology"},{id:9,name:"Environment",cssClass:"environment"},{id:4,name:"Lifestyle",cssClass:"lifestyle"},{id:5,name:"Arts & Entertainment",cssClass:"artsAndEntertainment"},{id:2,name:"Sport",cssClass:"sport"},{id:1,name:"Health",cssClass:"health"},{id:8,name:"General Interest",cssClass:"generalInterest"},{id:10,name:"Education",cssClass:"education"}],ctrl.currentTopic={id:-1},ctrl.goToIssueByTopic=function(topicId){if(ctrl.currentTopic.id!=topicId)if(topicId=topicId||ctrl.currentTopic.id,topicId=parseInt(topicId,10),void 0!==ctrl.modalTopic&&(ctrl.modalTopic.close(),setTimeout(function(){$("body").removeClass("topicsPagerModal--open")},closeModalTimeout),ctrl.topicsModalOpen=!1),parseInt($state.params.topic,10)!==topicId){var topic=ctrl.topics.find(function(v){return v.id===topicId}),topicName=topic?topic.name:"";$state.go("Magazine.Topic",{topic:topicId,topicName:topicName})}else ctrl.viewMode.current=2,getArticlesByTopic($state.params.topic=topicId,1,15)},ctrl.goToArticleByMonth=goToArticleByMonth,ctrl.setCurrentLevel=setCurrentLevel,ctrl.getArticlesBySearchWordInTitle=function(words){edns.vendors.google.analytics.sendCustomEvent("magazine_searchWordInTitle",words),ctrl.searchPhrase=words,magazineService.GetArticlesBySearchWordInTitle(ctrl.currentLevel,words).then(function(result){ctrl.showLoadMore=!1,ctrl.Articles=result.data,ctrl.searchAllRowsCount=result.data.length,0<ctrl.searchAllRowsCount?(ctrl.Articles.forEach(setArticleDate),ctrl.item=ctrl.item||{},ctrl.item.Month=ctrl.Articles[0].Month,ctrl.item.Year=ctrl.Articles[0].Year):ctrl.item=ctrl.issues[0]})},ctrl.searchPhrase="",$scope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){(toState.name!==$state.current.name||toState.name===$state.current.name&&toParams&&JSON.stringify(toParams)!==JSON.stringify(fromParams))&&activate()}),activate(),$scope.$parent.$on("communityUpdate",function(event,args){ctrl.setCurrentLevel(!0)}),ctrl.goToArticle=function(ArticleCode){$state.params={articleCode:ArticleCode,year:ctrl.item.Year,month:ctrl.item.Month,level:ctrl.currentLevel,topic:ctrl.currentTopic.id,viewMode:ctrl.viewMode.current},$state.go("Magazine.Article",$state.params)},ctrl.monthNamesDic={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"},ctrl.monthNamesDic.getKeyByValue=function(value){for(var prop in this)if(this.hasOwnProperty(prop)&&this[prop]===value)return prop},$scope.readMoreTopics=function(){topicId=ctrl.currentTopic.id;var fromRecord=16;ctrl.currentTopic.index?(ctrl.currentTopic.index=ctrl.currentTopic.index+15,fromRecord=ctrl.currentTopic.index):ctrl.currentTopic.index=fromRecord,getArticlesByTopic(topicId,fromRecord,15)},ctrl.openArchive=function(){var modalOptions={templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalTmpl.html",controller:"ModalInstanceCtrl",size:"sm",windowClass:"rtlAware magazineArchiveModal magazineArchiveModal--opening",backdrop:!0,keyboard:!1,resolve:{pageParams:function(){return{modalContent:$rootScope.root+"/Templates/magazineArchivePicker.html",controller:"magazineArchivePicker",modalWidth:330,modalHeight:330,modalOpenerCtrl:ctrl}}}};function openModalAsLayer(modalOptions){var archiveModalInstance=$modal.open(modalOptions);return archiveModalInstance.result.then(function(){},function(){setTimeout(function(){$("body").removeClass("archivePagerModal--open")},closeModalTimeout)}),archiveModalInstance}ctrl.calendar?ctrl.archiveModalInstance=openModalAsLayer(modalOptions):function(){function makeCalendar(){ctrl.firstIssue=ctrl.issues[ctrl.issues.length-1],ctrl.lastIssue=ctrl.issues[0];var yearsObj={years:{}};yearsObj.length=parseInt(ctrl.lastIssue.Year)-parseInt(ctrl.firstIssue.Year)+1;for(var i=ctrl.lastIssue.Year;i>=ctrl.firstIssue.Year;i--){yearsObj.years[i.toString()]={},yearsObj.years[i.toString()].months={},yearsObj.years[i.toString()].name=i.toString();for(var ii=1;ii<13;ii++)yearsObj.years[i].months[ii.toString()]={exist:!1,index:ii}}return yearsObj}function zipCalandarAndIssues(){ctrl.issues.map(function(v){ctrl.calendar.years[v.Year].months[v.Month].exist=!0,ctrl.calendar.years[v.Year].months[v.Month].date=v.Date})}void 0===ctrl.issues?magazineService.GetIssues().then(function(result){ctrl.issues=result.data,ctrl.calendar=makeCalendar(),zipCalandarAndIssues(),ctrl.archiveModalInstance=openModalAsLayer(modalOptions)}):(ctrl.calendar=makeCalendar(),zipCalandarAndIssues(),ctrl.archiveModalInstance=openModalAsLayer(modalOptions))}()},ctrl.toggleTopic=function(){if(ctrl.topicsModalOpen)ctrl.modalTopic.close(),setTimeout(function(){$("body").removeClass("topicsPagerModal--open")},closeModalTimeout),ctrl.topicsModalOpen=!ctrl.topicsModalOpen;else{var modalTopic=function(modalOptions){var topicsModalInstance=$modal.open(modalOptions);return topicsModalInstance.result.then(function(){},function(){setTimeout(function(){$("body").removeClass("topicsPagerModal--open")},closeModalTimeout),ctrl.topicsModalOpen=!ctrl.topicsModalOpen}),ctrl.topicsModalOpen=!ctrl.topicsModalOpen,topicsModalInstance}({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalTmpl.html",controller:"ModalInstanceCtrl",size:"sm",windowClass:"magazinTopicModal magazinTopicModal--opening",backdrop:!0,keyboard:!1,resolve:{pageParams:function(){return{modalContent:$rootScope.root+"/Templates/magazineTopicPicker.html",controller:"magazineTopicPicker",modalWidth:440,modalHeight:490,modalOpenerCtrl:ctrl}}}});modalTopic.result.then(function(){},function(){setTimeout(function(){$("body").removeClass("topicsPagerModal--open")},closeModalTimeout)}),ctrl.modalTopic=modalTopic}},ctrl.searchByWord=function(){var words=ctrl.searchWord.trim();words.length<3?edns.modalManager.alert($filter("translate")("1567"),{okBtnText:$filter("translate")("6")}):$state.go("Magazine.SearchByTitle",{words:words})},ctrl.onSearchByWordKeyUp=function($event){13===$event.keyCode&&ctrl.searchByWord()}}]),window.angular.module("edoNewUX").controller("magazineArchivePickerCtrl",["$scope","$state",function($scope,$state){var vm=this;function positionModal(){$("body").addClass("archivePagerModal--open");var elLeft=$(".magazine__navByDateLinkW").position().left+$(".magazine__navByDateLinkW").width()/2-$(".modal-content").width()/2,elTop=$(".magazine__navByDateLinkW").position().top+$(".magazine__navByDateLinkW").outerHeight(!0)+15-$("html").scrollTop()-$("body").scrollTop();$(".modal-content").css({left:elLeft+"px",top:elTop+"px"}),$(".magazineArchiveModal--opening").removeClass("magazineArchiveModal--opening")}vm.yearCarouselLeftPosition=0,vm.selectedYear=null,vm.selectedMonth=null,vm.updateYearCarousel=function(year){year=parseInt(year);var elmPos=parseInt(vm.lastIssue.Year)===year?3:2,initialPos=85*(vm.calendar.length-elmPos)*-1;vm.yearCarouselLeftPosition=initialPos+85*(parseInt(vm.lastIssue.Year)-year),vm.yearCarouselLeftPosition=0<vm.yearCarouselLeftPosition?0:vm.yearCarouselLeftPosition},vm.selectIssue=function(monthIdx,selectable){!0===selectable&&(vm.selectedYear=vm.currentYear,vm.selectedMonth=monthIdx)},vm.modalOpenerCtrl=$scope.modalOpenerCtrl,vm.calendar=vm.modalOpenerCtrl.calendar,vm.firstIssue=$.extend({},vm.modalOpenerCtrl.issues[vm.modalOpenerCtrl.issues.length-1]),vm.lastIssue=$.extend({},vm.modalOpenerCtrl.issues[0]);var month,year,lazyPositionArchiveModal=debounce(positionModal,50);$(window).off("resize",lazyPositionArchiveModal).on("resize",lazyPositionArchiveModal),$scope.$on("$destroy",function(){$(window).off("resize",lazyPositionArchiveModal)}),positionModal(),month=vm.modalOpenerCtrl.item.Month,year=vm.modalOpenerCtrl.item.Year,vm.currentYear=year,vm.updateYearCarousel(year),vm.selectIssue(parseInt(month,10),!0),vm.updateYear=function(year){(year>=parseInt(vm.firstIssue.Year)&&year<=parseInt(vm.lastIssue.Year)?year:parseInt(vm.currentYear))!==parseInt(vm.currentYear)&&(vm.updateYearCarousel(year),vm.currentYear=year)},vm.moveYear=function(diff){vm.updateYear(parseInt(vm.currentYear)+diff)},vm.setYear=function(year){vm.currentYear=year,vm.updateYearCarousel(year)},vm.navToIssue=function(){vm.selectedYear==vm.currentYear&&(vm.modalOpenerCtrl.item.Month=vm.selectedMonth.toString(),vm.modalOpenerCtrl.item.Year=vm.selectedYear,vm.modalOpenerCtrl.item.Date=vm.monthNamesDic[vm.selectedMonth]+" "+vm.selectedYear,$scope.modalOpenerCtrl.archiveModalInstance.close(),$state.go("Magazine.Archive",{year:vm.modalOpenerCtrl.item.Year,month:vm.modalOpenerCtrl.item.Month}))},vm.monthNamesDic={1:"January",2:"February",3:"March",4:"April",5:"May",6:"June",7:"July",8:"August",9:"September",10:"October",11:"November",12:"December"}}]),window.angular.module("edoNewUX").controller("magazineTopicPickerCtrl",["$scope",function($scope){function positionModal(){$("body").addClass("topicsPagerModal--open");var buttonTextCenterX=$(".magazine__navByTopicW")[0].getBoundingClientRect().left+$(".magazine__navByTopicW").width()/2,elTop=$(".magazine__navByTopicW").position().top+$(".magazine__navByTopicW").outerHeight(!0)-$("html").scrollTop()-$("body").scrollTop()+9,elLeft=buttonTextCenterX-$(".topicpicker__topics").width()/2;$(".modal-content").css({left:elLeft+7+"px",top:elTop+2+"px"}),$(".magazinTopicModal--opening").removeClass("magazinTopicModal--opening")}this.modalOpenerCtrl=$scope.modalOpenerCtrl,positionModal();var lazyPositionTopicsModal=debounce(positionModal,50);$(window).off("resize",lazyPositionTopicsModal).on("resize",lazyPositionTopicsModal),$scope.$on("$destroy",function(){$(window).off("resize",lazyPositionTopicsModal)})}]),window.angular.module("edoNewUX").controller("magazineArticleCtrl",["$scope","$state","$rootScope","magazineService","storageService","$modal","$filter",function($scope,$state,$rootScope,magazineService,storageService,$modal,$filter){var ctrl=this,scope=$scope;function getArticleByCode(){magazineService.GetArticleByCode($state.params.articleCode,ctrl.magCtrl.currentLevel,ctrl.referrer[$state.params.from]).then(function(result){ctrl.Article=result.data,ctrl.magCtrl.item=ctrl.magCtrl.item||{},ctrl.magCtrl.item.Date=ctrl.Article.PublicationDateString,ctrl.magCtrl.item.Year=ctrl.Article.PublicationDateString.split(" ")[1],ctrl.magCtrl.item.Month=ctrl.magCtrl.monthNamesDic.getKeyByValue(ctrl.Article.PublicationDateString.split(" ")[0]),$scope.ncyBreadcrumbLabel=ctrl.Article.Title,$rootScope.$emit("edArticalScroll"),magazineService.GetArticleNumberOfQuestions(ctrl.Article.ArticleId).then(function(result){ctrl.MCQ_numberOfQuestion=result.data,$scope.GetArticleQuestion(1),$rootScope.$emit("edArticalScroll")}),magazineService.GetArticleGlossary(ctrl.Article.ArticleId).then(function(result){ctrl.glossArray=result.data,ctrl.Article.ArticleText=function(glossArr,originalText){if(void 0!==glossArr){var pText,i,j,charCode,sInd,eInd,word,found,spanToAdd,SpanText='<span class="kw" ng-click="magazineArticleCtrl.openGloss($event)">',SpanText2='<span class="kw" ng-click="magazineArticleCtrl.openGloss($event)">',cnt=0,cnt1=0,first=!0,words=(pText=originalText).split(" "),sGloss=new Array,cGloss=new Array;for(i=glossArr.length-1;0<=i;i--)-1==glossArr[i].indexOf(" ")?sGloss[cnt++]=glossArr[i].toLowerCase():cGloss[cnt1++]=glossArr[i].toLowerCase();if(0<sGloss.length){for(i=0;i<words.length;i++){for(found=!1,word=words[i].toLowerCase(),j=0;j<sGloss.length;j++)if(-1!=(sInd=word.indexOf(sGloss[j]))){found=!0;break}if(found){if(0<sInd&&97<=(charCode=word.charCodeAt(sInd-1))&&charCode<=122)continue;if((eInd=sInd+sGloss[j].length)<word.length&&97<=(charCode=word.charCodeAt(eInd))&&charCode<=122)continue;first?first=!(spanToAdd=SpanText2):spanToAdd=SpanText,words[i]=words[i].substring(0,sInd)+spanToAdd+words[i].substring(sInd,eInd)+"</span>"+words[i].substr(eInd)}}pText=words.join(" ")}if(0<cGloss.length)for(i=0;i<cGloss.length;i++){var tInd=0,tText="",lText=pText.toLowerCase();for(sInd=0,eInd=lText.indexOf(cGloss[i]);-1!=eInd;)first?first=!(spanToAdd=SpanText2):spanToAdd=SpanText,tInd=eInd+cGloss[i].length,tText+=pText.substring(sInd,eInd)+spanToAdd+pText.substring(eInd,tInd)+"</span>",sInd=tInd,eInd=lText.indexOf(cGloss[i],sInd);pText=tText+=pText.substr(tInd)}return pText}}(result.data,ctrl.Article.ArticleText),$rootScope.$emit("edArticalScroll")})}),magazineService.GetArticleOpenQuestions($state.params.articleCode,ctrl.magCtrl.currentLevel).then(function(result){ctrl.openQuestions=result.data,$rootScope.$emit("edArticalScroll")})}function onChangeCurrentLevel(levelId,$rootScope){ctrl.magCtrl.currentLevel=levelId,storageService.set("Student",levelId,"LevelTemp"),getArticleByCode()}ctrl.referrer={null:0,article:1,topic:2,archive:3,enrichment:4,promotion:5},$scope.$on("$stateChangeSuccess",function(){if(ctrl.magCtrl=$scope.$parent.magCtrl,$rootScope.currentPage,ctrl.magCtrl.viewMode.current=3,$state.params.viewMode=3,ctrl.largeFont=!1,ctrl.keyWordsVisible=!1,ctrl.magCtrl.onChangeCurrentLevel=onChangeCurrentLevel,$state.params&&void 0!==$state.params.month&&(scope.itemDate=ctrl.magCtrl.monthNamesDic[$state.params.month]+" "+$state.params.year),$state.params&&void 0!==$state.params.topic){var topicId=parseInt($state.params.topic,10),currentTopic=ctrl.magCtrl.topics.filter(function(item){return item.id===topicId});ctrl.currentTopic=currentTopic[0],$scope.currentTopicName=ctrl.currentTopic.name}$state.params.level?onChangeCurrentLevel(parseInt($state.params.level,10)):onChangeCurrentLevel(ctrl.magCtrl.currentLevel)}),window.openPopups||(window.openPopups=[]),ctrl.showKeyWords=function(){ctrl.keyWordsVisible=!ctrl.keyWordsVisible},ctrl.openGloss=function($event){if(ctrl.keyWordsVisible){word=$event.currentTarget.textContent;var url="ClassicEDO/Runtime/Common/glossWindow.html?article="+ctrl.Article.ArticleId+"&word="+word;if(window.openPopups){window.openPopups.push(window.open(url,"Glossary","width=200,height=300,left=20,top=20"));var currentLevel=getCompositeCookie("Student","LevelTemp")||getCompositeCookie("Student","Level"),gaParams=Object.assign($state.params,{word:word,stateName:$state.current.name,currentLevel:currentLevel});edns.vendors.google.analytics.sendCustomEvent("magazine_openGlossary",gaParams)}}},$scope.GetArticleQuestion=function(sequence){sequence>ctrl.MCQ_numberOfQuestion||sequence<1||(ctrl.sequence=sequence,magazineService.GetArticleQuestion(ctrl.Article.ArticleId,ctrl.sequence).then(function(result){result.data.al.map(function(item){item.userAns=null}),ctrl.MCQ=result.data,ctrl.clearAnswers()}))},ctrl.setAnswer=function(answer){ctrl.MCQ.selected=answer;var currentLevel=getCompositeCookie("Student","LevelTemp")||getCompositeCookie("Student","Level"),gaParams=Object.assign($state.params,{currentLevel:currentLevel,stateName:$state.current.name,answer:ctrl.MCQ.selected.text});edns.vendors.google.analytics.sendCustomEvent("magazine_practice_clickAnswer",gaParams)},ctrl.checkAnswers=function(){if(!0!==ctrl.showCorrectAnswer&&ctrl.MCQ.selected&&(ctrl.showCheckAnswer=!ctrl.showCheckAnswer,!1===ctrl.showCheckAnswer&&0==ctrl.MCQ.selected.state&&(ctrl.MCQ.selected=null),ctrl.showCheckAnswer)){var currentLevel=getCompositeCookie("Student","LevelTemp")||getCompositeCookie("Student","Level"),gaParams=Object.assign($state.params,{currentLevel:currentLevel,stateName:$state.current.name,answer:ctrl.MCQ.selected.text});edns.vendors.google.analytics.sendCustomEvent("magazine_practice_checkAnswer",gaParams)}},ctrl.seeAnswers=function(){if(!0!==ctrl.showCheckAnswer&&(!0===ctrl.showCorrectAnswer?ctrl.clearAnswers():ctrl.showCorrectAnswer=!0,ctrl.showCorrectAnswer)){var currentLevel=getCompositeCookie("Student","LevelTemp")||getCompositeCookie("Student","Level"),gaParams=Object.assign($state.params,{currentLevel:currentLevel,stateName:$state.current.name});edns.vendors.google.analytics.sendCustomEvent("magazine_practice_seeAnswer",gaParams)}},ctrl.clearAnswers=function(){ctrl.showCorrectAnswer=null,ctrl.showCheckAnswer=!1,ctrl.MCQ.selected=null},ctrl.isMcqDisabled=function(){return!0===ctrl.showCheckAnswer||!0===ctrl.showCorrectAnswer},ctrl.showAnswerCorrect=function(answer){return answer===ctrl.MCQ.selected&&1==answer.state&&!0===ctrl.showCheckAnswer},ctrl.showAnswerIncorrect=function(answer){return answer===ctrl.MCQ.selected&&0==answer.state&&!0===ctrl.showCheckAnswer},ctrl.isChecked=function(answer){return 1==answer.state&&!0===ctrl.showCorrectAnswer||answer===ctrl.MCQ.selected&&null===ctrl.showCorrectAnswer},ctrl.isFirstQuestion=function(){return 1==ctrl.sequence},ctrl.isLastQuestion=function(){return ctrl.sequence===ctrl.MCQ_numberOfQuestion},ctrl.enlargeFont=function(enlarge){ctrl.largeFont=enlarge,$rootScope.$emit("edArticalScroll")},$scope.$on("communityUpdate",function(event,args){getArticleByCode()})}]),window.angular.module("edoNewUX").controller("idiomsCtrl",["$scope","$rootScope","idiomsService","storageService","$modal","$sce",function($scope,$rootScope,idiomsService,storageService,$modal,$sce){var idiomsAudioPlayer,ctrl=this,scope=$scope;function onChangeCurrentLevel(levelId){idiomsService.setLevel(levelId),ctrl.currentLevel=idiomsService.getCurrentLevel(),idiomsService.getIdiomsByLevel(ctrl.currentLevel).then(function(result){ctrl.idioms=result.data,ctrl.idiomClick(result.data[0].Code,result.data[0].Text)})}ctrl.selectedIdiom={text:"",code:""},ctrl.isMobile=bMobile,ctrl.isWebRtcBrowser=navigator.isWebRtcBrowser,ctrl.videogularAPI=null,onChangeCurrentLevel(),ctrl.onChangeCurrentLevel=onChangeCurrentLevel,ctrl.config={preload:"auto",sources:[],theme:{url:"Vendors/plugins/videogular/styles/themes/default/videogular.css"}},ctrl.onPlayerReady=function(API){ctrl.videogularAPI=API},ctrl.idiomClick=function(idiomCode,idiomText){ctrl.videogularAPI.stop(),idiomsService.getIdiom(idiomCode,ctrl.currentLevel).then(function(result){ctrl.selectedIdiom={text:idiomText,code:idiomCode},ctrl.explanation=result.data.Explanation,ctrl.context=result.data.Context,ctrl.config.sources=[{src:$sce.trustAsResourceUrl(edns.mediaHost.getMediaHost().videoHost+"/Runtime/Media/Idioms/mp4video/"+ctrl.selectedIdiom.code+".mp4"),type:"video/mp4"}],$rootScope.$emit("edArticalScroll")})},ctrl.hearIdiom=function(){idiomsAudioPlayer.openNewFile(edns.mediaHost.getMediaHost().soundHost+"/Runtime/Media/Idioms/sound/"+ctrl.selectedIdiom.code+".mp3"),scope.play()},ctrl.openRecordPanel=function(){if(bIE&&!IsSRInstalled()&&!isIE64bit())return downloads(),!1;$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalIframeTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware ModalForContentInIframeW ModalflexWidth recordYourselfModal",backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalContent:$rootScope.root+"/Runtime/"+(navigator.isWebRtcBrowser?"ASRPanel.htm?Mode=Idioms":bIE?"SRPanel.aspx?Mode=Idioms":"speechRecognition.html?Mode=Idioms"),iFrameWidth:620,iFrameHeight:400}}}}),setTextSR(ctrl.selectedIdiom.text,"Content/Idioms/"+ctrl.selectedIdiom.code+"_wfd.zip",ctrl.selectedIdiom.code+".wfd",ctrl.selectedIdiom.code.substring(4)),setSoundPlayer4Idiom(storageService.get("resPathRoot")+"/Runtime/Media/Idioms/sound/"+ctrl.selectedIdiom.code+".mp3")},ctrl.closenRecordPanel=function(){ctrl.recordPanelModal.close()},scope.play=function(){idiomsAudioPlayer.play()},scope.stop=function(){idiomsAudioPlayer.stop()},$scope.$parent.$on("communityUpdate",function(event,args){ctrl.onChangeCurrentLevel()}),idiomsAudioPlayer=new g_spObj1("IdiomsMediaPlayer",!0),ctrl.isItemCurrent=function(item){return item.Code===ctrl.selectedIdiom.code}}]),window.angular.module("edoNewUX").controller("videoTutorialsCtrl",["$scope","$sce","$timeout","$state","videoTutorialsService",function($scope,$sce,$timeout,$state,videoTutorialsService){var ctrl=this;ctrl.selectedItem={filename:""},ctrl.isMobile=bMobile,ctrl.videogularAPI=null,ctrl.mediaPath=edns.mediaHost.getMediaHost().videoHost+"/Runtime/EDStudentVideos/",ctrl.crossOrigin=isSeperatedResources()?"'anonymous'":"",ctrl.defaultConfig={sources:[]},ctrl.videoplayer={config:{preload:"auto",theme:{url:"Vendors/plugins/videogular/styles/themes/default/videogular.css"}}},ctrl.items=[],ctrl.itemsPageLength=3,ctrl.itemsPageIdx=-1,ctrl.canGoPageBackArrow=!1,ctrl.canGoPageNextArrow=!1;var langMap=null,currentLangLong=sharedGetLang(),defaultLangCode="en";function moveCurrentPage(direction){ctrl.itemsPageIdx+=direction,updateCanGoArrow()}function updateCanGoArrow(){ctrl.canGoPageBackArrow=ctrl.canGoPageBack(),ctrl.canGoPageNextArrow=ctrl.canGoPageNext()}function isSeperatedResources(){return!(-1<ctrl.mediaPath.toLowerCase().indexOf(location.host.toLowerCase()))}ctrl.createPlayer=!0,ctrl.videoCode=$state.params.videoCode,function(crossOrigin){var userId=JSON.parse(localStorage.getItem("Student")).StudentID;videoTutorialsService.getVideosAndStudentLangs(crossOrigin,userId).then(function(result){var items,filename,pageIdx,langMapData,studentLangs;-1<result.videos.items.length&&(ctrl.items=_.chunk(result.videos.items,ctrl.itemsPageLength),langMapData=result.videos.langMap,studentLangs=result.langs,(langMap=Object.entries(langMapData).filter(function(v){return v[1]===defaultLangCode||-1<studentLangs.findIndex(function(vv){return vv==v[0]})}))[currentLangLong]&&langMap[currentLangLong],ctrl.videoCode?(ctrl.itemsPageIdx=(items=ctrl.items,filename=ctrl.videoCode,items.forEach(function(v,i){v.find(function(vv){return vv.filename===filename})&&(pageIdx=i)}),pageIdx),ctrl.selectItem(ctrl.videoCode)):(ctrl.itemsPageIdx=0,ctrl.selectItem(ctrl.items[ctrl.itemsPageIdx][0].filename)),updateCanGoArrow())})}(isSeperatedResources()),ctrl.onPlayerReady=function(API){ctrl.videogularAPI=API},ctrl.itemListClick=function(item){ctrl.isItemCurrent(item)||ctrl.selectItem(item.filename)},ctrl.selectItem=function(filename){ctrl.videogularAPI.stop(),ctrl.createPlayer=!1,$timeout(function(){var itemConfig;ctrl.createPlayer=!0,ctrl.selectedItem=_.find(ctrl.items[ctrl.itemsPageIdx],function(item){return item.filename==filename}),ctrl.selectedItem.config=Object.assign({},ctrl.defaultConfig,((itemConfig={sources:[],tracks:[]}).sources.push({src:$sce.trustAsResourceUrl(ctrl.mediaPath+"videos/"+ctrl.selectedItem.filename+".mp4"),type:"video/mp4"}),itemConfig.tracks=ctrl.selectedItem.subtitles.filter(function(v){return-1<langMap.findIndex(function(vv){return vv[1]===v.srclang})}).map(function(v){return Object.assign({},v,{src:$sce.trustAsResourceUrl(ctrl.mediaPath+"subtitles/"+ctrl.selectedItem.filename+"_"+v.srclang+".vtt"),kind:"captions"})}),itemConfig.posterUrl=ctrl.mediaPath+"poster/"+ctrl.selectedItem.filename+".jpg",itemConfig))},4)},ctrl.tryPageBack=function(){ctrl.canGoPageBack()&&moveCurrentPage(-1)},ctrl.tryPageNext=function(){ctrl.canGoPageNext()&&moveCurrentPage(1)},ctrl.canGoPageBack=function(){return-1<ctrl.itemsPageIdx-1},ctrl.canGoPageNext=function(){return ctrl.itemsPageIdx+1<ctrl.items.length},ctrl.isItemCurrent=function(item){return item.filename===ctrl.selectedItem.filename}}]),window.angular.module("edoNewUX").controller("gamesCtrl",["$scope","$state","storageService",function($scope,$state,storageService){var ctrl=this;function setCurrentLevel(fromMyProfile){storageService.get("Student","LevelTemp")&&!fromMyProfile?ctrl.currentLevel=Number(storageService.get("Student","LevelTemp")):(storageService.set("Student",null,"LevelTemp"),ctrl.currentLevel=Number(storageService.get("Student","Level")))}ctrl.calcCommunityHeightFn=function(){var $gamesEl=$(".games__indexpage");if($gamesEl.css({height:""}),$gamesEl.outerHeight(!0)+parseInt($(".siteTmpl__footer").outerHeight(!0))<$(window).height()){var gamesNewH=$(document).height()-parseInt($(".siteTmpl__footer").outerHeight(!0))-parseInt($gamesEl.css("margin-top"));$gamesEl.css({height:gamesNewH+"px"})}},setCurrentLevel(),ctrl.games=[{link:"Crosswords",cssClass:"community__IPSecItem_crossword",cap:{v:"497",t:"1"},tit:{v:"498",t:"1"},btnTxt:"496"},{link:"Snowman",cssClass:"community__IPSecItem_snowman",cap:{v:"492",t:"1"},tit:{v:"493",t:"1"},btnTxt:"496"},{link:"WordSearch",cssClass:"community__IPSecItem_wordsearch",cap:{v:"491",t:"1"},tit:{v:"499",t:"1"},btnTxt:"496"}],ctrl.changeStates=function(stateName){$state.go(stateName)},ctrl.onChangeCurrentLevel=function(levelId){ctrl.currentLevel=levelId,storageService.set("Student",levelId,"LevelTemp")},$scope.$on("communityUpdate",function(event,args){setCurrentLevel(!0)})}]),window.angular.module("edoNewUX").controller("WidgetStatisticsCtrl",["$scope","assessmentsService","progressService","assessmentsBLSharedService","$filter","storageService","courseDataService","$state","COURSE_TEST_TYPE_CONSTANT",function($scope,assessmentsService,progressService,assessmentsBLSharedService,$filter,storageService,courseDataService,$state,COURSE_TEST_TYPE_CONSTANT){var ctrl=this,scope=$scope;ctrl.widgetCount=3,ctrl.widgetsClosed=!0,ctrl.state="Home",ctrl.widgetCounts={standard:3,edTests:0,gradebook:0,licence:0},ctrl.toeic=edns.toeic,ctrl.addItalicsForToefl=edns.toefl.addItalicsForToefl,ctrl.hideTestScore=assessmentsBLSharedService.isHideTestScore(),ctrl.countwidgets=function(){var total=_.map(ctrl.widgetCounts,function(val,key){return val});return _.reduce(total,function(sum,n){return sum+n},0)};var setStatisticsData=function(){ctrl.courseName=ctrl.course.Name,ctrl.courseIsLocked=ctrl.course.isLocked,ctrl.calculatedCompletion=courseDataService.course.courseProgress,ctrl.TestScores=courseDataService.course.testScores},setTimeOnTask=function(){var ArrayToT=courseDataService.course.timeOnTask.split(":");ctrl.TimeOnTask__hours=ArrayToT[0],ctrl.TimeOnTask__minutes=ArrayToT[1]};ctrl.getCompletionText=function(obj){var CompletionText=$filter("translate")("12");return CompletionText=CheckLengthAndSetTooltip(CompletionText,CompletionText,32)},$scope.getCompletionText=ctrl.getCompletionText,ctrl.getTestScoreText=function(obj){var TestScore=$filter("translate")("11");return TestScore=CheckLengthAndSetTooltip(TestScore,TestScore,32)},$scope.getTestScoreText=ctrl.getTestScoreText,$scope.getTimeOnTaskText=function(obj){var TimeOnTaskText=$filter("translate")("10");return TimeOnTaskText=CheckLengthAndSetTooltip(TimeOnTaskText,TimeOnTaskText,32)},ctrl.getGradebookTotalGrades=function(){assessmentsService.getGradebookTotalGrades(storageService.get("Student","StudentID"),courseDataService.course.NodeId).then(function(result){result.data&&(courseDataService.setCourseNodeData("gradebookTotalGrades",result.data),setGradebookTotalGrades(),ctrl.addGradebookToWidgetsCount())})};var setGradebookTotalGrades=function(){ctrl.gradebookTotalGrades=getFormattedGradebookData(courseDataService.course.gradebookTotalGrades)},getFormattedGradebookData=function(gradebookData){var typesToTransCodeMapper={159:{tooltip:"1176",cssClass:"writing"},160:{tooltip:"1177",cssClass:"speaking"},161:{tooltip:"1178",cssClass:"zoom"},1:{tooltip:"1176",cssClass:"writing"},3:{tooltip:"1177",cssClass:"speaking"},2:{tooltip:"1178",cssClass:"zoom"},4:{tooltip:"1176",cssClass:"writing"},6:{tooltip:"1177",cssClass:"speaking"},5:{tooltip:"1178",cssClass:"zoom"}};return gradebookData.map(function(val){var text=$filter("translate")(typesToTransCodeMapper[val.GradeBookTypeId].tooltip);return val.text=CheckLengthAndSetTooltip(text,text,32),$.extend(val,typesToTransCodeMapper[val.GradeBookTypeId])})};function CheckLengthAndSetTooltip(Toolip,Str,MyLen){var RetStr;if(-1<(RetStr=Str.length>MyLen&&-1!=MyLen?(RetStr=Str.slice(0,MyLen),Str.slice(MyLen,MyLen.length),"<span  title='"+Toolip+"'>"+RetStr+" &hellip;</span>"):"<span  title='"+Toolip+"'>"+Str+"</span>").indexOf("''")){for(;-1<(RetStr=RetStr.replace("''","'")).indexOf("''"););return RetStr}return RetStr}function getWidgetData(){progressService.getWidgetData(courseDataService.course.NodeId,JSON.parse(localStorage.getItem("Student")).StudentID).then(function(result){var TimeOnTask=result.data;courseDataService.setCourseNodeData("timeOnTask",function(secondTime){var result="00:00";if(null!=secondTime){var hours=parseInt(secondTime/60/60),minutes=Math.ceil(secondTime/60%60);result=(hours=hours<10?"0"+hours:hours)+":"+(minutes=minutes<10?"0"+minutes:minutes)}return result}(TimeOnTask)),setTimeOnTask()}),function(){if(ctrl.toeic.isToeic){var toeicEDCoursesMappers=storageService.get("toeicInformation").toeicEDCoursesMappers,courseMap=_.find(toeicEDCoursesMappers,{edId:ctrl.course.NodeId}),licDate=courseMap.expirationDate.match(/\d+/g)[0];date=licDate,ctrl.licenceExpirationDate=$filter("date")(date,"MMM dd, yyyy"),ctrl.licenceExpirationHour=$filter("date")(date,"HH:mm"),ctrl.addToeicToWidgetsCount()}var date}()}ctrl.getWritingText=function(obj){var TestScore=$filter("translate")("1176");return TestScore=CheckLengthAndSetTooltip(TestScore,TestScore,32)},$scope.getWritingText=ctrl.getWritingText,ctrl.getSpeakingText=function(obj){var TestScore=$filter("translate")("1177");return TestScore=CheckLengthAndSetTooltip(TestScore,TestScore,32)},$scope.getSpeakingText=ctrl.getSpeakingText,ctrl.getZoomText=function(obj){var TestScore=$filter("translate")("1178");return TestScore=CheckLengthAndSetTooltip(TestScore,TestScore,32)},$scope.getZoomText=ctrl.getZoomText,ctrl.addGradebookToWidgetsCount=function(){ctrl.widgetCounts.gradebook=ctrl.gradebookTotalGrades.length},ctrl.addToeicToWidgetsCount=function(){ctrl.widgetCounts.licence=1},$state.is("MyProgress")?(ctrl.state="MyProgress",$scope.$watch(function(){return $scope.$parent.myProgressCtrl.course},function(newVal,oldVal){void 0===newVal||newVal.timeOnTask||(ctrl.course=newVal,setStatisticsData(),getWidgetData(),progressService.getCourseTestsResults(ctrl.course.NodeId).then(function(results){results.data.map(function(result){switch(parseInt(result.TestType)){case COURSE_TEST_TYPE_CONSTANT.MIDTERM:ctrl.midtermTestScore=result.Score;break;case COURSE_TEST_TYPE_CONSTANT.FINAL:ctrl.finalTestScore=result.Score}}),ctrl.testResults=results.data,ctrl.widgetCounts.testResults=results.data.length,ctrl.widgetsClosed=!1}),ctrl.getGradebookTotalGrades())},!0)):scope.$parent.$on("unitsLoaded",function(e){ctrl.course=courseDataService.course,setStatisticsData(),getWidgetData()})}]),angular.module("edoNewUX").controller("LoginPageCtrl",["$scope","$rootScope","authService","$filter","storageService","$modal","$state","authServiceBL",function($scope,$rootScope,authService,$filter,storageService,$modal,$state,authServiceBL){if(!0!==storageService.get("logedInOnce")){var showSelfRegistration=storageService.get("Community","SR");switch(showSelfRegistration){case"False":showSelfRegistration=!1;break;case"True":showSelfRegistration=!0;break;default:showSelfRegistration=!1}$scope.showSelfRegistration=showSelfRegistration}function alertOnNoCommunityData(){if((community=storageService.get("Community"))&&community.IID)return!1;function reloadPage(){edns.vendors.google.analytics.sendCustomEvent("iid_not_found_alert"),location.reload()}return edns.modalManager.alert($filter("translate")("1568"),{okBtnText:$filter("translate")("1569"),okCallbackAfter:reloadPage,cancelCallbackAfter:reloadPage,closeCallbackAfter:reloadPage}),!0;var community}$scope.submit=function(){if(alertOnNoCommunityData())return!1;var userName=$scope.loginForm.userName.$modelValue,password=$scope.loginForm.password.$modelValue,regDigitOrLetters=/^[a-zA-Z0-9]+$/;if(!regDigitOrLetters.test(userName)||!regDigitOrLetters.test(password)||""===password||""===userName)return!1;authServiceBL.login(userName,password)},$scope.forgotPassword=function(){$modal.open({templateUrl:$rootScope.root+"/Templates/forgotPassword.html",controller:"forgotPasswordCtrl as forgotCtrl",size:"lg",backdrop:"static",keyboard:!1,windowClass:"rtlAware forgotPasswordModal",resolve:{pageParams:function(){return{}}}})},$scope.SelfRegistration=function(){window.open("ClassicEDO/Runtime/Register.aspx","selfRegistration","width=450,height=510")},$.publish("loginLoaded")}]),angular.module("edoNewUX").controller("loginHeaderCtrl",["$sce","loginHeaderBLService",function($sce,loginHeaderBLService){var ctrl=this;function onGetHeaderData(data){-1<data.Link.trim().length&&(ctrl.link=data.Link,ctrl.title=$sce.trustAsHtml(data.Title))}ctrl.link="",loginHeaderBLService.getHeaderData().then(onGetHeaderData)}]),angular.module("edoNewUX").controller("optInCtrl",["$scope","$rootScope","$state","$modal","loginService","authService","storageService","edSettingsService",function($scope,$rootScope,$state,$modal,loginService,authService,storageService,edSettingsService){var privacyStatementOptInData,ctrl=this,headerHeight=$(".siteLogin__header").outerHeight(),lazySetContainerHeight=debounce(setContainerHeight,40),isExtLogin=!1,extLoginReturnUrl=null;function openOptInModal(){ctrl.modalInstance=$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware privacyStatementModal",backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalTitle:"",modalContent:$rootScope.root+"/Templates/optIn/privacyStatement.html",controller:"privacyStatementCtrl.js",modalWidth:620,modalHeight:415}}}}),ctrl.modalInstance.result.then(onModalClose,onModalDismissed)}function onModalClose(){privacyStatementOptInData&&privacyStatementOptInData.agree?authService.setOptIn($rootScope.userCredentials.username,$rootScope.userCredentials.password,$rootScope.userCredentials.IID).then(function(result){loginService.tryAuthenticate()($rootScope.userCredentials.username,$rootScope.userCredentials.password,$rootScope.userCredentials.IID,function(result){ctrl.pltURL=getCompositeCookie("tempStudent","PLTLink"),loginService.afterTryAuthenticate($rootScope.userCredentials.userName,$rootScope.userCredentials.password,$rootScope.userCredentials.IID)(result),$rootScope.showOptIn=!1,$rootScope.userCredentials=null,ctrl.pltURL&&window.open(ctrl.pltURL)})}):!0!==isExtLogin?goToLogin():($rootScope.userCredentials=null,extLoginReturnUrl?window.location.href=extLoginReturnUrl:(window.close(),goToLogin()))}function goToLogin(){$rootScope.showOptIn=!1,$state.go("Login")}function onPrivacyStatementOptIn(event,data){privacyStatementOptInData=data,ctrl.modalInstance.close()}function onModalDismissed(){}function setContainerHeight(){var viewportHeight=document.documentElement.clientHeight,footerHeight=$(".siteTmpl__footer").height();$(".siteTmpl__optIn").css({height:viewportHeight-(headerHeight+footerHeight)+"px","margin-top":headerHeight})}$rootScope.showOptIn=!0,window.onbeforeunload=function(event){storageService.DelCookie("stateBeforeLogin")},function(isExtLogin,userCredentials){$rootScope.userCredentials||($rootScope.userCredentials=storageService.getCookieAsJSON("tempStudent")),isExtLogin?extLoginReturnUrl=getCompositeCookie("Community","link"):loginService.setTempStudentSource("optIn")}(isExtLogin=loginService.isExtLogin(),$rootScope.userCredentials),$(window).off("resize",lazySetContainerHeight).on("resize",lazySetContainerHeight),$scope.$on("edEmitAfterRender",setContainerHeight),$rootScope.$on("privacyStatementOptIn",onPrivacyStatementOptIn),$scope.$on("$destroy",function(){$(window).off("resize",lazySetContainerHeight)}),isExtLogin?edSettingsService.initAPIs().then(openOptInModal):openOptInModal()}]),angular.module("edoNewUX").controller("privacyStatementCtrl",["$scope","$rootScope","$state","$modal","$translate","$filter","$http",function($scope,$rootScope,$state,$modal,$translate,$filter,$http){var ctrl=this;ctrl.agree=!1;!function(tagsByL10nKeys,messageL10Key){$http.get($rootScope.root+"/footerConfig.json").then(function(response){$scope.linksData=ctrl.linksData=function(links,tagsByL10nKeys){var extLinks=links.filter(function(item){return"4"===item.text||"5"===item.text});return extLinks.forEach(function(v,i){v=$.extend(v,tagsByL10nKeys[v.text])}),extLinks}(response.data.links,tagsByL10nKeys),$scope.community=JSON.parse(localStorage.getItem("Community")),ctrl.messageText=function(messageL10Key,linksData){return function(i10nMessage,linksData){var newI10nMessage=i10nMessage;return linksData.forEach(function(value,idx){var item,attr=' id="optInPrivacyStatement__messageLink--'+(item=value).link+'" class="optInPrivacyStatement__messageLink optInPrivacyStatement__messageLink--'+item.link+'" ng-click=\'show($event, "'+item.link+"\", ctrl.linksData)' ng-href='#' target='_top' ";newI10nMessage=(newI10nMessage=newI10nMessage.replace("<"+value.l10nTag+">","<"+value.htmlTag+" "+attr+">")).replace("</"+value.l10nTag+">","</"+value.htmlTag+">"),i10nMessage=newI10nMessage}),newI10nMessage}($filter("translate")(messageL10Key),linksData)}(messageL10Key,$scope.linksData)})}({4:{l10nTag:"legal",htmlTag:"a",link:"LegalNotices"},5:{l10nTag:"priv",htmlTag:"a",link:"PrivacyStatement"}},"1170"),ctrl.onCancel=function(e){e.preventDefault(),$scope.$emit("privacyStatementOptIn",{agree:!1})},ctrl.onContinue=function(e){e.preventDefault(),!0===ctrl.agree&&$scope.$emit("privacyStatementOptIn",{agree:ctrl.agree})},ctrl.toggleAgree=function(e){ctrl.agree=!ctrl.agree},$scope.show=function($event,link,linksData){$event.stopPropagation(),$event.preventDefault();var notice_title=linksData.filter(function(item){return item.link==link})[0].text;$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"footerModal",resolve:{pageParams:function(){return{modalTitle:$filter("translate")(notice_title),modalContent:$rootScope.root+"/Localization/"+link+"/"+$scope.community.InstLang+"/"+link+".htm"}}}})}}]),angular.module("edoNewUX").controller("preHomeCtrl",["$scope","$rootScope","$state","$stateParams","$filter","$modal","storageService","activityService","COMMON","TOEICBLService","applicationVariablesBL","authServiceBL","edSettingsService",function($scope,$rootScope,$state,$stateParams,$filter,$modal,storageService,activityService,COMMON,TOEICBLService,applicationVariablesBL,authServiceBL,edSettingsService){function gotoTMS(){$rootScope.gotoTMS=!0;var s,loginData=storageService.get("Student"),TMSUrl="http://"+tmsHost+"Login/LoginChecker.aspx?UserId=";if("Ext"!=loginData.LoginType){var sessionId=storageService.get("Activity","SessionID");loginData=storageService.get("Student");activityService.login(sessionId,storageService.get("Student","StudentID"),loginData.userName),TMSUrl+=loginData.StudentID+"&From=Login&hostName="+(s=(s=document.location.href).replace(s.substr(s.indexOf("#")),"")).substring(s.lastIndexOf("/")+1);var exitLink=storageService.get("Community","link");exitLink&&(TMSUrl+="&exitLink="+exitLink)}else{var student=storageService.get("Student"),commLinkCookie=student.commLink;TMSUrl+=student.StudentID+"&From=Login&hostName="+student.hostName+"&exitLink="+(commLinkCookie||"closeTMS")}TMSUrl+="&edDomain="+document.location.origin,document.location=TMSUrl+"&token="+localStorage.getItem("EDAPPToken")}function gotoNC(){location.href=$rootScope.root+"/NCView/SHN"}this.doInit=!0,null!==$state.params.beforeExtApp&&this.doInit&&("true"===$state.params.beforeExtApp?function(){var loginType=getCompositeCookie("Student","LoginType");"Ext"==loginType&&function(){var UserType=getCompositeCookie("Student","UserType");if(storageService.set("Student",UserType,"UserType"),authServiceBL.setToken(getCompositeCookie("Student","Token")),"s"!=UserType){var StudentID=getCompositeCookie("Student","StudentID");storageService.set("Student",StudentID,"StudentID");var hostName=getCompositeCookie("Community","Name");storageService.set("Student",hostName,"hostName");var commLink=getCompositeCookie("Community","link");storageService.set("Student",commLink,"commLink")}}();var extL10n=sharedTranslateLanguageCode(window.sharedGetLang());storageService.set("extL10n",extL10n),"Ext"==loginType?edSettingsService.initAPIs().then(function(){gotoNC()}):gotoNC()}():($rootScope.showPreHome=!1,function(){switch(loginData=storageService.get("Student"),loginData.UserType){case"a":case"da":case"su":case"ca":case"sp":case"t":window.tmsHost?gotoTMS():applicationVariablesBL.get(["TmsHost"]).then(function(data){window.tmsHost=data.TmsHost,gotoTMS()});break;case"s":$state.params.action?-1<$state.params.action.indexOf("edNavigate=")&&(actionEnc=$state.params.action.replace("edNavigate=",""),(action=JSON.parse((str=actionEnc,decodeURIComponent(escape(window.atob(str)))))).isModal?($rootScope.actionEnc=actionEnc,$state.go("Home")):location.href=location.href.split("preHome")[0]+action.url):$state.go("Home");break;default:function onUnknownUserType(){onUnknownUserTypeListener(),alert("***********\n"+$filter("translate")("39")+"\n***********"),$state.go("Login")}var onUnknownUserTypeListener;console.log("unknown user."),$.get("/images/logInfo.gif?continueToApp&StudentID="+loginData.StudentID+"&cStuidentID="+getCompositeCookie("Student","StudentID")+"&extType="+loginData.LoginType+"&stl="+localStorage.length+"&iid="+getCompositeCookie("Community","IID")+"&cStuidentFN="+getCompositeCookie("Student","FName"),{_:$.now()}),"39"==$filter("translate")("39")?onUnknownUserTypeListener=$rootScope.$on("$translateChangeEnd",onUnknownUserType):onUnknownUserType()}var actionEnc,action,str}()),this.doInit=!1)}]),window.angular.module("edoNewUX").controller("forgotPasswordCtrl",["$scope","$rootScope","$filter","$modalInstance","storageService","authService","storageService",function($scope,$rootScope,$filter,$modalInstance,storageService,authService,storageService){var ctrl=this;ctrl.invalidUsername=null,ctrl.noEmail=null,ctrl.invalidUsernameVal="",ctrl.messageTitle=$filter("translate")("24"),ctrl.message=$filter("translate")("403"),ctrl.actionBtnText=$filter("translate")("104"),ctrl.IID=storageService.get("Community","IID"),ctrl.submit=function(){!0!==ctrl.submitted?authService.sendForgottenPassword(ctrl.userName,ctrl.IID).then(function(result){var errorTypes_success=0,errorTypes_invalidUsername=1,errorTypes_noEmail=2;switch(result.data){case errorTypes_success:ctrl.messageTitle=$filter("translate")("404"),ctrl.message=$filter("translate")("401"),ctrl.actionBtnText=$filter("translate")("312"),ctrl.submitted=!0;break;case errorTypes_invalidUsername:ctrl.invalidUsernameVal=ctrl.userName,ctrl.invalidUsername=!0,ctrl.submitted=!1;break;case errorTypes_noEmail:ctrl.messageTitle="",ctrl.message=$filter("translate")("402"),ctrl.actionBtnText=$filter("translate")("312"),ctrl.noEmail=!0,ctrl.submitted=!0}}):ctrl.close()},ctrl.close=function(){$modalInstance.close()}}]),angular.module("edoNewUX").controller("headerCtrl",["$scope","authService","$rootScope","$filter","$location","$document","clickEventName","$modal","$state","storageService","whiteLabelService","applicationVariablesBL",function($scope,authService,$rootScope,$filter,$location,$document,clickEventName,$modal,state,storageService,whiteLabelService,applicationVariablesBL){var ctrl=this;function isCustomLogo(){return"1"==storageService.get("Community","CustomLoggedInLogo")}$scope.closeMenuEventName=clickEventName,$scope.userMenuVisible=!1,$rootScope.oldEdoModalOpened=!1,localStorage.setItem("closed","false"),ctrl.productLogoAlt=isCustomLogo()?"":$filter("translate")($filter("whiteLabel")("26")),ctrl.productLogoCustom=function(){if(isCustomLogo()){var resPathRoot=storageService.get("resPathRoot")+"/",IID=storageService.get("Community","IID");return resPathRoot+"institutions/"+IID+"/CustomLoggedinLogo.png"}}(),$scope.toggleUserMenu=function($event){$scope.userMenuVisible=!$scope.userMenuVisible,$event&&$event.stopPropagation?$event.stopPropagation():($event=window.event).cancelBubble=!0},whiteLabelService.getWhiteLabel().then(function(wl){ctrl.productLogo=wl.productLogo}),$scope.closeUserMenu=function($event){$scope.isEventInside("home__userProfileImg",$event)||$scope.userMenuVisible&&($scope.userMenuVisible=!1,$scope.$apply())},$document.bind($scope.closeMenuEventName,function($event){$scope.closeUserMenu($event)}),$scope.isEventInside=function(elID,event){var el=document.getElementById(elID);if(el){var elClientRect=el.getBoundingClientRect(),elCoords={x:0,y:0};return elCoords.x=elClientRect.left,elCoords.y=elClientRect.top,event.pageX>=elCoords.x&&event.pageX<=elCoords.x+el.clientWidth&&event.pageY>=elCoords.y&&event.pageY<=elCoords.y+el.clientHeight}},$scope.logout=function(){var loginUrl=Root+storageService.get("Community","alias")+"#/login";window.top.postMessage("closeModal","*"),rootScope.isLogedin=!1,scope.siteNavigate(loginUrl)};var confirmLogoutInTestEH=function(event){frBox=new FrameBoxObj("MsgPage.html?saveState=no&url=false&test=no",320,210,function(){window.TempTest=!1,window.location.href=event.data.url})};$scope.siteNavigate=function(url){1==window.InTest?($(document).off("NavigationConfirmed",confirmLogoutInTestEH),$(document).on("NavigationConfirmed",{url:url},confirmLogoutInTestEH),-1!==url.indexOf("login")&&document.dispatchEvent(document.navigationRequested)):(document.dispatchEvent(document.navigationRequested),$(document).on("NavigationConfirmed",function(){window.location.href=url}))},$rootScope.firstName=JSON.parse(localStorage.getItem("Student")).FName,$scope.showStudyPlanner=function($event,scope){$rootScope.$broadcast("CloseAllModals");var userId=getCompositeCookie("Student","StudentID"),userType=getCompositeCookie("Student","UserType");applicationVariablesBL.get(["ClassicEdoURL"]).then(function(data){localStorage.setItem("ClassicEdoURL",data.ClassicEdoURL);$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalIframeTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware ModalForContentInIframeW ModalflexWidth studyPlanerModal",backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalTitle:"Study Planner",modalContent:localStorage.getItem("ClassicEdoURL")+"Runtime/StudyPlaner/miniReport.aspx?UserId="+userId+"&UserType="+userType,iFrameWidth:260,iFrameHeight:230}}}})})},$scope.showMyProfile=function($event,scope){$rootScope.$broadcast("CloseAllModals");$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalIframeTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware ModalForContentInIframeW myProfileModal",backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalTitle:"MyProfile",modalContent:$rootScope.root+"Runtime/MyProfile/MyProfile.html",modalWidth:530,modalHeight:650}}}});$scope.toggleUserMenu($event),$scope.$watch(function(){return angular.element(document.querySelector("body")).attr("class")},function(){angular.element(document.querySelector(".myProfileModal")).length<1?angular.element(document.querySelector("body")).removeClass("modal-myProfile"):angular.element(document.querySelector("body")).addClass("modal-myProfile")})}}]),angular.module("edoNewUX").controller("bootstrapPromotionCtrl",["$scope","promotionServiceBL","siteNavService","$state","storageService",function($scope,promotionServiceBL,siteNavService,$state,storageService){$scope.GoToOldUxPage=function(address,winName,articleCode){siteNavService.tabsManager(address,winName);urlParmeters="?articleCode="+articleCode+"&mode=Issue&prevState=Home",localStorage.setItem("bFromPromtion",!0),siteNavService.goToOldSite(address,winName,urlParmeters)},$scope.goToMag=function(articleCode,slideUrl,fromTMS){fromTMS?slideUrl&&window.open(slideUrl,"_blank").focus():(storageService.set("Student",null,"LevelTemp"),$state.go("Magazine.Article",{articleCode:articleCode,from:"promotion"}))},promotionServiceBL.getAllSlides().then(function(result){$scope.availableImages=result;var arr=angular.copy($scope.availableImages);$scope.myInterval=15e3,$scope.slides=arr})}]),function(angular){angular.module("edoNewUX").controller("allUnitsBarCtrl",["$scope","$filter","courseDataService","$state","$rootScope",function($scope,$filter,courseDataService,$state,$rootScope){var ctrl=this;$scope.$parent.$on("courseLoaded",function(e){ctrl.unitColorLength=12,ctrl.getUnitProgressTitle=function(progress){return $filter("translate")("113").replace("<val>",progress)},ctrl.course=courseDataService.course,ctrl.courseProgress=courseDataService.courseProgress,ctrl.progressArr=ctrl.course.Children.map(function(v){return v.Progress})}),ctrl.gotoProgress=function(){$rootScope.isStudentRole?(courseDataService.storageCourse(),$state.go("MyProgress",{courseId:ctrl.course.NodeId})):edns.modalManager.alert($filter("translate")("513"),{okBtnText:$filter("translate")("6")})}}])}(angular),angular.module("edoNewUX").controller("DelayedLoginCtrl",["storageService","$stateParams","loginService","objFuncService",function(storageService,$stateParams,loginService,objFuncService){window.onbeforeunload=function(event){storageService.DelCookie("stateBeforeLogin")};var paramsHasValues=objFuncService.hasValuesInObj($stateParams),paramsHasValues2=$stateParams&&(0===$stateParams.secondsLeft||!!$stateParams.secondsLeft);if(!paramsHasValues||!paramsHasValues2){var retryObj=storageService.getCookieAsJSON("tempStudent");retryObj.CommunityVersion=storageService.get("Community").CommunityVersion,retryObj.userName=retryObj.username,delete retryObj.username,loginService.userLoggedInStateBound(retryObj)}}]),angular.module("edoNewUX").controller("LoginStateCtrl",["$scope","$rootScope","authService","$interval","USERSTATE","$filter","langService","storageService","$stateParams","$state","$window","loginService","$location",function($scope,$rootScope,authService,$interval,USERSTATE,$filter,langService,storageService,$stateParams,$state,$window,loginService,$location){switch($scope.loginStateSelector=$state.current.name,$scope.loginStateType="waitToLogoutResult",$scope.loginStateSelector){case"LoginFailed":case"SessionTimeout":$rootScope.showLoginViews=!0}$scope.goToLogin=function(){if(loginService.isExtLogin()){function onLogoff(){function goToBeforeLoginPage(){var exitLink=storageService.get("TestEnv","ReturnLink")||storageService.get("Community","link");edns.appToken.remove(),storageService.clearAll(!0),exitLink?window.location.href=exitLink:window.close()}$rootScope.$broadcast("userLogout"),edns.toeic.isToeic?edns.toeic.logoff().then(goToBeforeLoginPage):goToBeforeLoginPage()}authService.logout().then(onLogoff,onLogoff)}else $.isEmptyObject(storageService.get("PreviewMode"))&&$rootScope.isStudentRole?($rootScope.showOptIn=!1,$rootScope.showLoginViews=!1,$state.go("Login")):window.close()},$scope.getHeader=function(){switch($scope.loginStateSelector){case"LoginFailed":return $filter("translate")("391");case"SessionTimeout":return $filter("translate")("393")}},$scope.getMessage=function(){switch($scope.loginStateSelector){case"LoginFailed":return $filter("translate")("392");case"SessionTimeout":return $filter("translate")("394")}}}]),window.angular.module("edoNewUX").controller("myProgressCtrl",["$timeout","courseDataService","storageService","progressService","assessmentsBLTOEICService","schedulerService","$rootScope","$scope","$document","$filter","$state","STEP_TYPE_CONSTANT","NODE_TYPE_CONSTANT",function($timeout,courseDataService,storageService,progressService,assessmentsBLTOEICService,schedulerService,$rootScope,$scope,$document,$filter,$state,STEP_TYPE_CONSTANT,NODE_TYPE_CONSTANT){var ctrl=this;ctrl.scope=$scope,ctrl.openAllUnits=!1,ctrl.isPrintingNow=!1,ctrl.unitIdsNotRendered=[],ctrl.unitOpenedId=null,ctrl.bMobile=bMobile,ctrl.isCourseDDLOpen=!1,ctrl.showAllCourses=!0,ctrl.courseId=null,ctrl.isToeic=!1,ctrl.finalTestResultsTOEIC=[],ctrl.addItalicsForToefl=edns.toefl.addItalicsForToefl,ctrl.unitId=null,ctrl.scope.itemOpen="";var scrollMinWidth=1200,$scrollItem=$(".myProgress__coursesW");function getCourseProgress(courseId){progressService.getCourseProgress(courseId).then(function(res){res.data&&res.data.CourseProgressTree&&(ctrl.course=res.data.CourseProgressTree,ctrl.courses=storageService.get("Courses"),ctrl.showAllCourses||(ctrl.courses=ctrl.courses.filter(function(v){return v.CourseId==ctrl.course.NodeId}),tryGetSchedulerCourses()),setCurrentCourse(),courseDataService.setCourseData(res.data))})}function showLessons(){var unitsArr=ctrl.course.Children,nodesToAdd=[];unitsArr.forEach(function(unit,i){unit.Children[0].Children.length<1&&nodesToAdd.push(ctrl.getUnitParam(unit))}),0!=nodesToAdd.length?ctrl.getUnitsUserTree(nodesToAdd,addMissingStepsToTree):setPrintMode()}function addMissingStepsToTree(results){for(var i=0;i<results.data.length;i++)for(var j=0;j<ctrl.course.Children.length;j++)if(ctrl.course.Children[j].NodeId===results.data[i].NodeId){ctrl.course.Children[j].Children=results.data[i].Children;break}courseDataService.course=ctrl.course,storageService.set("Course","CourseJson",JSON.stringify(ctrl.course)),setPrintMode()}function setCurrentCourse(){ctrl.courses=ctrl.courses.map(function(v){return v.current=v.CourseId==ctrl.course.NodeId,v}),tryGetSchedulerCourses()}$rootScope.navOpened=!1,function(state){if(state.params&&state.params.courseId){var lastProgressCourse=courseDataService.course?courseDataService.course:JSON.parse(storageService.get("Course","CourseJson"));lastProgressCourse.NodeId===state.params.courseId?(ctrl.course=lastProgressCourse,ctrl.courseId=ctrl.course.NodeId,ctrl.courses=storageService.get("Courses"),ctrl.showAllCourses||(ctrl.courses=ctrl.courses.filter(function(v){return v.CourseId==lastProgressCourse.NodeId}),tryGetSchedulerCourses()),setCurrentCourse()):(getCourseProgress(state.params.courseId),ctrl.courseId=state.params.courseId)}else{var lastProgressCourse=ctrl.getLastCourseProgress();getCourseProgress(lastProgressCourse.NodeId),ctrl.courseId=lastProgressCourse.NodeId}assessmentsBLTOEICService.isToeic&&(ctrl.isToeic=!0,assessmentsBLTOEICService.GetCourseResultsRange(ctrl.courseId).then(function(testsRes){testsRes.data.d&&(ctrl.finalTestResultsTOEIC=assessmentsBLTOEICService.formatUserTestsRes(testsRes.data.d))})),$state.params&&$state.params.unitId&&(ctrl.unitId=$state.params.unitId)}($state),ctrl.showLessons=showLessons;var setPrintMode=function(){ctrl.unitIdsNotRendered=ctrl.course.Children.filter(function(v){return ctrl.unitOpenedId!==v.NodeId}).map(function(v,i){return v.NodeId}),ctrl.openAllUnits=!0};$scope.$on("edEmitAfterRender",function(event,data){ctrl.openAllUnits&&data&&"myProgress_lessonRendered"==data.type&&(ctrl.unitIdsNotRendered=ctrl.unitIdsNotRendered.filter(function(v){return v!==data.unitId}),data.callback())}),$scope.$on("myProgress_unitOpened",function(event,data){ctrl.unitOpenedId=data.unitId});var scrollToCurrentCourseListener=$rootScope.$on("myProgressCtrlCoursesPreRender",function(event,data){$timeout(function(){$(".myProgress__coursesW").mCustomScrollbar("scrollTo",$(".home__studentWidgetIW--widgetsOpened"))},400)}),schedulerListener=$rootScope.$on("scheduler",function(event,data){data&&data.refreshAfterExecUserPlan&&edns.modalManager.alert($filter("translate")("1300"),{okBtnText:$filter("translate")("1169"),okCallbackAfter:function(){$state.go("Home")}})});$scope.$on("$destroy",function(){schedulerListener(),scrollToCurrentCourseListener()}),ctrl.tryPrint=function(){0===ctrl.unitIdsNotRendered.length&&ctrl.openAllUnits&&!ctrl.isPrintingNow&&(ctrl.isPrintingNow=!0,$timeout(function(){window.print(),ctrl.openAllUnits=!1,ctrl.isPrintingNow=!1},500))},ctrl.printClick=function(){ctrl.isPrintingNow||(ctrl.openAllUnits=!0,showLessons())},ctrl.getUnitParam=function(unit){var lockedNodes=courseDataService.getLockedNodesIds(unit);return{ParticleId:unit.NodeId,NodeType:NODE_TYPE_CONSTANT.UNIT,LockedNodes:lockedNodes,particleHasProgress:0<unit.Progress[0],lowestNodeType:NODE_TYPE_CONSTANT.STEP}},ctrl.getUnitsUserTree=function(units,promise){progressService.getUserNodeProgress(units,ctrl.course.NodeId).then(promise)},ctrl.gotoCourse=function(id){$state.go("MyProgress",{courseId:id})},ctrl.toggleDDL=function($event,item){ctrl.scope.itemOpen=ctrl.scope.itemOpen!==item?item:"",$event.stopPropagation()},ctrl.scope.closeDDL=function(){"courseList"==ctrl.scope.itemOpen&&(ctrl.scope.itemOpen="",ctrl.scope.$apply())},$document.on("click",ctrl.scope.closeDDL);var lazyUpdateScroll=debounce(function(){window.innerWidth<=scrollMinWidth?$scrollItem.mCustomScrollbar("destroy"):$scrollItem.mCustomScrollbar(ctrl.scope.scrollbarOptions)},40);function tryGetSchedulerCourses(){schedulerService.addCoursesInPlans(ctrl.courses).then(function(data){ctrl.courses=data})}$(window).on("resize",lazyUpdateScroll),$scope.$on("$destroy",function(){$(window).off("resize",lazyUpdateScroll),$document.off("click",ctrl.scope.closeDDL)}),ctrl.scope.scrollbarOptions=scrollbarOptions={axis:"y",autoHideScrollbar:!1,alwaysShowScrollbar:1,autoExpandScrollbar:!0,scrollButtons:{enable:!1},advanced:{autoUpdateTimeout:5e3,updateOnContentResize:!0,autoUpdateTimeout:0,updateOnImageLoad:!1},mouseWheel:{enable:!0},theme:"onLightBackground"},ctrl.viewToeicFullReport=function(userTestId,courseId,testId){iframeUrl=assessmentsBLTOEICService.showCourseTestFullReport(userTestId,courseId,testId)},ctrl.viewToeicTestResults=function(testId,courseId,$event){$event&&$event.preventDefault(),assessmentsBLTOEICService.viewToeicTestResults(testId,courseId)},ctrl.resize_parentWidthFn=function(){return"absolute"==$(".myProgress__statsToeicTestScore").css("position")?$(".myProgress__statsToeicTestLinks").width():$(".home__studentWidgetToeicFinalTest").width()},ctrl.gotoCourseIf=function(courseId,event,listCat,currentCourse,canNavigate){!currentCourse&&canNavigate&&ctrl.gotoCourse(courseId)}}]),window.angular.module("edoNewUX").controller("myProgressUnitsCtrl",["courseDataService","storageService","schedulerService","$rootScope","$scope","$filter","STEP_TYPE_CONSTANT","NODE_TYPE_CONSTANT","COURSE_CONSTANT",function(courseDataService,storageService,schedulerService,$rootScope,$scope,$filter,STEP_TYPE_CONSTANT,NODE_TYPE_CONSTANT,COURSE_CONSTANT){var ctrl=this;ctrl.scope=$scope,ctrl.course=$scope.myProgressCtrl.course,ctrl.unitColorLength=12,ctrl.openAllUnits=!1;var selectedUnit,unitOpenId=null,breakPointWidth=1200;ctrl.toeicFailTexts={messageTxt:$filter("translate")("1213"),btnTxt:$filter("translate")("312")},$rootScope.navOpened=!1,ctrl.isHideUnitReflectionsByInst=edns.unitReflections.isHideUnitReflectionsByInst,ctrl.augmentUnit=function(){ctrl.course.Children=schedulerService.TEMP_addFakeSchedulerData(ctrl.course.Children)},$scope.$watch(function(){return $scope.$parent.myProgressCtrl.course},function(newVal,oldVal){void 0!==newVal&&(void 0!==oldVal&&oldVal.NodeId===newVal.NodeId||(schedulerService.addLockReason(newVal,schedulerService.elementTypes.Unit).then(function(){ctrl.course=newVal,$scope.$parent.myProgressCtrl.unitId&&ctrl.showLesson($scope.$parent.myProgressCtrl.unitId)}),ctrl.isHideUnitReflectionsByInst||courseDataService.getUnitReflectionState(newVal).then(function(res){res&&(ctrl.course=res)})))},!0),ctrl.lessonsVisible=function(nodeId){return!!$scope.myProgressCtrl.openAllUnits||nodeId===unitOpenId},ctrl.getLessonName=function(lesson){return(lesson.Metadata.Skill==COURSE_CONSTANT.COURSE_GRAMMAR&&-1==lesson.Metadata.Subject.indexOf(COURSE_CONSTANT.IGNORED_SUBJECT)?lesson.Metadata.Subject+": ":"")+lesson.Name},ctrl.showLesson=function(nodeId){if(unitOpenId===nodeId)return unitOpenId=null,void ctrl.scope.$emit("myProgress_unitOpened",{unitId:null});selectedUnit=ctrl.course.Children.filter(function(node){return node.NodeId==nodeId})[0];var notSubmittedTest=storageService.get("toeicInformation","notSubmittedTest");notSubmittedTest&&(courseDataService.updateUnitTestGrade(notSubmittedTest,null),storageService.remove("toeicInformation","notSubmittedTest")),ctrl.scope.$emit("myProgress_unitOpened",{unitId:nodeId}),0<selectedUnit.Children[0].Children.length?unitOpenId=nodeId:$scope.myProgressCtrl.getUnitsUserTree([$scope.myProgressCtrl.getUnitParam(selectedUnit)],switchUnit)};var switchUnit=function(res){var userUnitTree;if(userUnitTree=res.data[0]){var unitsArr=ctrl.course.Children;unitsArr[_.findIndex(unitsArr,function(v){return v.NodeId===selectedUnit.NodeId})].Children=userUnitTree.Children;var indexOfUnitinCtrl=_.findIndex(ctrl.course.Children,function(v){return v.NodeId===selectedUnit.NodeId});ctrl.course.Children[indexOfUnitinCtrl].Children=userUnitTree.Children,unitOpenId=userUnitTree.NodeId}};function savePopupRefs(){window.openPopups||(window.openPopups=[]),window.syschekModal||(window.syschekModal=[]);var openpopups=localStorage.getItem("openpopups");if(openpopups){openpopups=JSON.parse(openpopups);for(var i=0;i<openpopups.length;i++){var newWin=window.open("",openpopups[i],"width=...");window.openPopups.push(newWin)}}}ctrl.getCompTestGrade=function(steps){var testStep=steps.filter(function(step){return step.Name==STEP_TYPE_CONSTANT.TEST});return 0<!testStep.length?$filter("translate")("511"):null!=testStep[0].Grade?testStep[0].Grade+"%":""},ctrl.getStepClass=function(progress){return 1===progress?"myProgress__unitLesson_stepProgressIW--done":0<progress&&progress<1?"myProgress__unitLesson_stepProgressIW--inProgress":0===progress?"myProgress__unitLesson_stepProgressIW--notStarted":void 0},ctrl.getProgressTitle=function(progress){return 1===progress?$filter("translate")("46"):0<progress&&progress<1?$filter("translate")("47"):0===progress?$filter("translate")("48"):void 0},ctrl.getUnitProgressTitle=function(progress){return $filter("translate")("114").replace("<val>",courseDataService.calcVisualProgress(progress,!0,!1))},ctrl.calcVisualProgress=function(progress){return courseDataService.calcVisualProgress(progress,!0,!1)},ctrl.gotoLesson=function(lesson,isUnitLocked){savePopupRefs(),courseDataService.goToLesson(lesson,isUnitLocked)},ctrl.gotoUnitReflection=function(unit){savePopupRefs(),courseDataService.goToUnitReflection(unit,unit.IsLocked)};var checkResize=function(){Math.max(document.documentElement.clientWidth,window.innerWidth||0)<=breakPointWidth?$(".myProgress__coursesW").mCustomScrollbar("disable",!0):$(".myProgress__coursesW").mCustomScrollbar("update")};$(window).off("resize",checkResize).on("resize",checkResize),$scope.$on("$destroy",function(){$(window).off("resize",checkResize)}),ctrl.openUnitTest=function(unitId,unitTestId){edns.toeic.gotoUnitTest(unitTestId,courseDataService.course.Metadata.ToeicId,ctrl.toeicFailTexts),unitOpenId=null},ctrl.openTestResults=function(unitTestId){edns.toeic.gotoUnitTestResultsReview(unitTestId,courseDataService.course.Metadata.ToeicId,ctrl.toeicFailTexts),unitOpenId=null},ctrl.getSkillName=function(lessonMetadata){return edns.courseMetadata.getSkillName(lessonMetadata)},$rootScope.$on("toeicUnitTestSubmitted",function(e,args){courseDataService.updateUnitTestGrade(args.testId,args.grade)}),ctrl.unitHasReflections=edns.unitReflections.unitHasReflections}]),window.angular.module("edoNewUX").directive("edEmitAfterRender",function(){return{restrict:"A",scope:{edEmitAfterRender:"="},link:function($scope,element,attrs){attrs.edEmitAfterRender&&$scope.edEmitAfterRender&&$scope.$emit("edEmitAfterRender",$scope.edEmitAfterRender)}}}),window.angular.module("edoNewUX").directive("edoLoginheader",["$rootScope","loginHeaderBLService",function($rootScope,loginHeaderBLService){function toggleLoginHeader(event,toState,toParams,fromState,fromParams){toState.loginHeader&&!0===toState.loginHeader&&loginHeaderBLService.getHeaderData().then(onGetHeaderData)}function onGetHeaderData(data){setTimeout(function(){1<data.Url.trim().length?$(".siteLogin__header").css({"background-image":'url("'+data.Url+'")',visibility:"visible"}):$(".siteLogin__header").css({"background-image":""}).css({visibility:"visible"})},4)}return{restrict:"A",controller:["$state",function($state){this.$state=$state}],link:function($scope,$element,$attrs,ctrl){$rootScope.unregister=$rootScope.unregister||$rootScope.$on("$stateChangeStart",toggleLoginHeader),0<ctrl.$state.current.name.length&&toggleLoginHeader(0,ctrl.$state.current)}}}]);var myApp=angular.module("edoNewUX");myApp.directive("onCarouselChange",["$parse",function($parse){return{require:"carousel",link:function(scope,element,attrs,carouselCtrl){var fn=$parse(attrs.onCarouselChange),origSelect=carouselCtrl.select;carouselCtrl.select=function(nextSlide,direction){return nextSlide!==this.currentSlide&&fn(scope,{nextSlide:nextSlide,direction:direction}),origSelect.apply(this,arguments)}}}}]),window.angular.module("edoNewUX").directive("edLockIcon",["schedulerService",function(schedulerService){return{restrict:"E",replace:!1,scope:{data:"=data"},controllerAs:"edLockIconCtrl",bindToController:!0,templateUrl:"templates/lockIcon.html",controller:["$scope","$document","$window",function($scope,$document,$window){var progress,circleDiameter,radius,ctrl=this;if(ctrl.circleDiameter=41.38,ctrl.hasTimeMeasure=!1,ctrl.lockReason=$scope.edLockIconCtrl.data.popoverData.lockReason,ctrl.lockReason&&(ctrl.isTimeBased=schedulerService.isTimeBased(ctrl.lockReason),ctrl.showCircleProgress=ctrl.isTimeBased&&!0===ctrl.lockReason.displayMeasuresArray,ctrl.showCircleProgress)){var remainingPercentageProgressBar=schedulerService.getVisualProgress(ctrl.lockReason,null,95);progress=remainingPercentageProgressBar,circleDiameter=ctrl.circleDiameter,radius=circleDiameter/2,ctrl.gapLength=Math.ceil(2*Math.PI*radius),ctrl.dashLength=progress/100*ctrl.gapLength,ctrl.displayProgress=0<ctrl.dashLength}}]}}]),function(angular){angular.module("edoNewUX").directive("edPopover",["$rootScope","$modal","$document","$window",function($rootScope,$modal,$document){return{restrict:"A",replace:!1,scope:{data:"=edPopover"},controllerAs:"edPopoverCtrl",bindToController:!0,link:function($scope,el,attrs){if($scope.edPopoverCtrl.data.enabled){$rootScope.popoverOpened=null;var openEventName=edns.mobile.isMobileDevice()?edns.browser.eventNames.clickEventName_mobileAll_touchStart:"mouseenter",closeEventName=edns.mobile.isMobileDevice()?edns.browser.eventNames.clickEventName_mobileAll_touchStart:"mouseleave";$(el).on(openEventName,showPopover),edns.mobile.isMobileDevice()?$(window).on(closeEventName,closePopover):$(el).on(closeEventName,closePopover),$scope.$on("$destroy",function(){$(el).off(openEventName,showPopover),$(window).off(closeEventName,closePopover)}),$scope.edPopoverCtrl.data.uid=Date.now()+"_"+$scope.edPopoverCtrl.data.unitIndex}function closePopover(e){setTimeout(function(e){$scope.edPopoverCtrl.lockPopover&&$scope.edPopoverCtrl.lockPopover.close()},0)}function showPopover(e){$(e.srcElement).blur(),e.stopPropagation(),e.preventDefault(),null===$rootScope.popoverOpened&&($rootScope.popoverOpened=$scope.edPopoverCtrl.data.unitIndex,$scope.edPopoverCtrl.convertModalToPopover($document),$scope.edPopoverCtrl.displayPopover($scope.edPopoverCtrl.data,$document))}},controller:["$scope","$document","$window",function($scope,$document,$window){var ctrl=this;function removeCssClass(a){ctrl.body.removeClass("modal-open--popover modal-open--popover--overflowAuto"),ctrl.isAnotherModalOpen||ctrl.body.removeClass("modal-open"),$rootScope.popoverOpened=null}function setPopoverPosition(){$(".popover").position({my:ctrl.data.my,at:ctrl.data.at,of:ctrl.data.of,using:function(obj,info){!function(obj,info,arrowDirection,flippedArrow,unitIndex){var el=angular.element(info.element.element);(function(el,obj){el.css({left:obj.left+"px",top:obj.top+"px"})})(el,obj),function(el){el.removeClass("popover--top popover--bottom popover--left popover--right popover--flippedVertical popover--flippedHorizontal")}(el),function(el,info,arrowDirection,flippedArrow){var vPos=info.vertical,hPos=arrowDirection.h,flippedClass=flippedArrow?" popover--filppedArrow":" popover--nonFilppedArrow";el.addClass("popover--"+vPos+" popover--"+hPos+flippedClass)}(el,info,arrowDirection,flippedArrow)}(obj,info,ctrl.data.arrowDirection,ctrl.data.flippedArrow,ctrl.data.unitIndex)}})}ctrl.data.enabled&&(ctrl.$document=$document,ctrl.body=$document.find("body").eq(0),ctrl.isAnotherModalOpen=0<$document.find(".modal").length,ctrl.displayPopover=function(data){ctrl.data=data,ctrl.windowClass=ctrl.data.lockReason.measures?"LockPopover--extended":"LockPopover--text",ctrl.lockPopover=$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalTmpl.html",controller:"ModalInstanceCtrl",windowClass:"rtlAware popover "+ctrl.windowClass,backdrop:!1,resolve:{pageParams:function(){return{disableScroll:!0,data:ctrl.data,modalContent:$rootScope.root+"/Templates/lockPopover.html",controller:"lockPopoverCtrl"}}}});var boundPositionPopover=ctrl.positionPopover.bind(null,ctrl.data.unitIndex);ctrl.lockPopover.opened.then(boundPositionPopover),ctrl.lockPopover.result.then(removeCssClass,removeCssClass,removeCssClass)},ctrl.convertModalToPopover=function($document){ctrl.isAnotherModalOpen||ctrl.body.addClass("modal-open modal-open--popover--overflowAuto")},ctrl.positionPopover=function(unitIndex){setTimeout(function(){setPopoverPosition()},0),angular.element($window).bind("resize",setPopoverPosition)},$scope.$on("$destroy",function(){angular.element($window).unbind("resize",setPopoverPosition),removeCssClass()}))}]}}])}(window.angular);var myApp=angular.module("edoNewUX");myApp.directive("edoStopProp",function(){return{controller:["$scope","$element","$attrs",function($scope,$element,$attrs){$element.bind("touchstart",function(event){$element.attr("data-edo-stop-prop");$scope.$apply(function(){$scope.unitsCtrl.stopProp(event)})})}]}}),myApp.directive("edoDonthide",function(){return{controller:["$scope","$element","$attrs",function($scope,$element,$attrs){$element.bind("touchstart",function(event){$scope.unitsCtrl.state.dontHideUnit=$scope.$index,$scope.$apply()})}]}}),myApp.directive("edoTranlateTooltip",["$interpolate","$filter",function($interpolate,$filter){return{restrict:"A",scope:{tooltip:"="},link:function(scope,element,attrs){"true"==scope.$parent.lesson.IsLocked&&attrs.$set("title",$filter("translate")("43"))}}}]),myApp.directive("edoProgressTitle",["$interpolate","$filter",function($interpolate,$filter){return{restrict:"A",scope:{title:"="},link:function(scope,element,attrs){var title="",progress=scope.$parent.lesson.Progress;0==progress?title=$filter("translate")("48"):0<progress&&progress<1?title=$filter("translate")("47"):1==progress&&(title=$filter("translate")("46")),1==scope.$parent.lesson.IsLocked&&(title+=", "+$filter("translate")("49")),element.attr("title",title)}}}]),myApp.directive("edoUnitProgressTitle",["$interpolate","$filter",function($interpolate,$filter){return{restrict:"A",scope:{title:"="},link:function(scope,element,attrs){var progress=scope.$parent.unit.Progress,title=$filter("translate")("114").replace("<val>",calcVisualProgress(progress,!0,!1));element.attr("title",title)}}}]),myApp.directive("edoPostRenderLesson",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attrs){$timeout(scope.unitsCtrl.lessonArrows,0)}}}]),myApp.directive("edoPostRenderUnitTitle",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attrs){$timeout(function(){textFit(element,{maxFontSize:16.8,minFontSize:13});var txtBefore=element.text();$(element).dotdotdot(),txtBefore!==element.text()&&element.attr("title",txtBefore)},0)}}}]),myApp.directive("edoUnitGotolessonTooltip",["$interpolate","$filter",function($interpolate,$filter){return{restrict:"A",scope:{tooltip:"="},link:function(scope,element,attrs){var uProgress=scope.$parent.unit.Progress,uIsLocked=scope.$parent.unit.IsLocked;scope.$parent.unitsCtrl.currentUnit(scope.$parent.unit,void 0)&&!1===uIsLocked&&1!==uProgress?0===uProgress?attrs.$set("title",$filter("translate")("407")):attrs.$set("title",$filter("translate")("406")):attrs.$set("title",$filter("translate")("405"))}}}]),function(angular){var myApp=window.angular.module("edoNewUX");myApp.directive("edoClickorTouch",[function(){return function(scope,element,attr){element.on("touchstart",function(event){scope.$apply(function(){scope.$eval(attr.myTouchstart)})})}}]),myApp.directive("stopEvent",function(){return{restrict:"A",link:function(scope,element,attr){element.bind(scope.closeMenuEventName,function($event){$event&&$event.stopPropagation?$event.stopPropagation():($event=window.event,$evente.cancelBubble=!0)})}}}),myApp.directive("edoPositionUsermenu",function(){return{restrict:"A",link:function(scope,element,attr){if(!0===scope.userMenuVisible){$(".home__userDataMenuW").css("top",$(".home__userBar").position().top+$(".home__userBar").outerHeight(!0)+16+"px")}}}})}(),window.angular.module("edoNewUX").directive("edCommSiteLevel",["$rootScope","$state",function($rootScope,$state){return{restrict:"E",replace:!0,templateUrl:"Templates/communitySiteLevel.html",scope:{currentLevel:"=currentlevel",changelevel:"&"},controllerAs:"commSiteLevel",bindToController:!0,controller:["$rootScope","$state",function($rootScope,$state){var commSiteLevel=this;commSiteLevel.$rootScope=$rootScope,commSiteLevel.levels=[{id:1,name:"Basic",title:"72"},{id:2,name:"Intermediate",title:"74"},{id:3,name:"Advanced",title:"71"}],commSiteLevel.setSeperator=function(levelId){commSiteLevel.magazine__navLevelsShowSeperator=4-levelId==2?0:4-levelId},commSiteLevel.setSeperator(commSiteLevel.currentLevel),commSiteLevel.changeLevel=function($state){return function(levelId){commSiteLevel.changelevel()(levelId,commSiteLevel.$rootScope),commSiteLevel.setSeperator(levelId);var gaParams=Object.assign($state.params,{levelId:levelId,stateName:$state.current.name});edns.vendors.google.analytics.sendCustomEvent("magazine_changeLevel",gaParams)}}($state)}]}}]),window.angular.module("edoNewUX").directive("edWidthByRatio",[function(){return{restrict:"A",link:function(scope,element,attrs){function resizeMagImages(element){element=element.length?element:$(".magazine__articleItemImage");var magImageSize={width:496,height:402};magImageSize.ratio=magImageSize.height/magImageSize.width;var newHeight=Math.floor($(element[0]).width()*magImageSize.ratio);element.ready(function(){$(".magazine__articleItemImage").css("height",newHeight+"px")})}0<element.length&&(void 0===$(element[0]).attr("style")||1<$(element[0]).attr("style").indexOf("height"))&&resizeMagImages(element),$(window).on("resize",resizeMagImages),scope.$on("$destroy",function(){$(window).off("resize",resizeMagImages)})}}}]),window.angular.module("edoNewUX").directive("edArticalScroll",["$timeout","$rootScope",function($timeout,$rootScope){return{restrict:"A",link:{post:function(scope,el,attrs){var calcScrolls;switch(attrs.edArticalScroll){case"magArticle":calcScrolls=function(){var $outerEl,bodyHeight,outerElHeight,topElsHeight,leftHeight,rightHeight,$targetElLeft,$targetElRight;function addScroll(bToLeft,bToRight){bToLeft&&$targetElLeft.css("height",leftHeight+"px"),bToRight&&$targetElRight.css("height",rightHeight+"px")}$targetElLeft=$(".magazine__articleIW"),$targetElRight=$(".magazine__articlePracticeIW"),$targetElLeft.css("height",""),$targetElRight.css("height",""),$outerEl=$(".magazine__main"),bodyHeight=$(window).height(),outerElHeight=bodyHeight-parseInt($outerEl.css("margin-top"),10),$outerEl.css("height",outerElHeight+"px"),outerElHeight-=parseInt($outerEl.css("padding-bottom"),10),topElsHeight=[".community__breadCrumbsW",".magazine__navLevels",".magazine__header"].map(function(val){return $(val).height()}).reduce(function(a,b){return a+b}),leftHeight=outerElHeight-topElsHeight-$(".magazine__articleTools").height(),rightHeight=outerElHeight-topElsHeight-$(".magazine__articlePager").height()-$(".magazine__articlePracticeTools").outerHeight(),$targetElLeft.height()>leftHeight||$targetElRight.height()>rightHeight?($(".magazine__articlePracticeIW").css("height",rightHeight+"px"),$(".magazine__articleIW").css("height",leftHeight+"px"),addScroll(!0,!0)):($outerEl.css("height",""),$(".magazine__article").height()>$(".magazine__practice").height()?(rightHeight=$(".magazine__article").height()-$(".magazine__articlePager").height()-$(".magazine__articlePracticeTools").outerHeight(),addScroll(!1,!0)):(leftHeight=$(".magazine__practice").height()-$(".magazine__articleTools").height(),rightHeight=$targetElRight.height(),addScroll(!0,!1)))};break;case"talkingIdioms":calcScrolls=function(){var $targetElLeft=$(".idioms__listW"),$targetElRight=$(".idioms__idiomDetailsW"),subtractRight=$(".idioms__sectionHeader--idioms__idiomDetails").height()+parseInt($(".idioms__idiomExplOW").css("margin-top"));$targetElLeft.css("height",$targetElRight.height()-subtractRight+"px")};break;default:return void console.warn("edArticalScroll directive requires a valid attribute value.")}$timeout(function(){calcScrolls()},500),$rootScope.lazy_calcScrolls||($rootScope.lazy_calcScrolls=debounce(calcScrolls,15),$(window).on("resize",$rootScope.lazy_calcScrolls),$rootScope.calcScrollsEvtOff=$rootScope.$on("edArticalScroll",function(){$rootScope.lazy_calcScrolls()}),$rootScope.calcScrollsOnStateChangeEvtOff=$rootScope.$on("$stateChangeSuccess",$rootScope.lazy_calcScrolls)),scope.$on("$destroy",function(){$(window).off("resize",$rootScope.lazy_calcScrolls),$rootScope.lazy_calcScrolls=null,$rootScope.calcScrollsEvtOff(),$rootScope.calcScrollsOnStateChangeEvtOff()}),"magArticle"===attrs.edArticalScroll&&scope.$watch(function(){return el[0].childNodes.length},function(newValue,oldValue){newValue!==oldValue&&$timeout(function(){calcScrolls()},500)})}}}}]),window.angular.module("edoNewUX").directive("edCommunityIndexBoxes",["$rootScope",function($rootScope){return{restrict:"E",templateUrl:"templates/Community/communityIndexBoxes.html",replace:!0,scope:{boxitems:"=",navigate:"&"},controllerAs:"boxesCtrl",bindToController:!0,controller:["$scope",function($scope){this.cmmItems=this.boxitems,this.cssUiColumns=3===this.boxitems.length||4<this.boxitems.length?"community__indexpageSecItemW--columns3":"community__indexpageSecItemW--columns2"}]}}]),window.angular.module("edoNewUX").directive("edGamesHeight",["$timeout","$rootScope",function($timeout,$rootScope){return{restrict:"A",link:{post:function(scope,el,attrs){var calcHeight;function calcHeight(){var iframeHeight=$(window).height()-parseInt($(attrs.edGamesHeight).css("margin-top"))-$(".community__breadCrumbsW").outerHeight();$(el).css("height",iframeHeight+"px").attr("height",iframeHeight)}$timeout(function(){calcHeight()},500),$rootScope.lazy_calcHeight||($rootScope.lazy_calcHeight=debounce(calcHeight,15),$(window).on("resize",$rootScope.lazy_calcHeight)),scope.$on("$destroy",function(){$(window).off("resize",$rootScope.lazy_calcHeight),$rootScope.lazy_calcHeight=null})}}}}]),window.angular.module("edoNewUX").directive("edCommunityHeight",["$timeout","$rootScope",function($timeout,$rootScope){return{restrict:"A",scope:{edresizefunc:"&"},link:{post:function(scope,el,attrs){var calcCommunityHeight=scope.edresizefunc();$timeout(function(){calcCommunityHeight()},500),$rootScope.lazy_calcCommunityHeight||($rootScope.lazy_calcCommunityHeight=debounce(calcCommunityHeight,150),$(window).on("resize",$rootScope.lazy_calcCommunityHeight),$rootScope.communityHeightEvtOff=$rootScope.$on("edCommunityHeight",function(){$rootScope.lazy_calcCommunityHeight()})),scope.$on("$destroy",function(){$(window).off("resize",$rootScope.lazy_calcCommunityHeight),$rootScope.communityHeightEvtOff(),$rootScope.lazy_calcCommunityHeight=null})}}}}]),window.angular.module("edoNewUX").directive("edDynamicHtml",["$compile",function($compile){return{restrict:"A",replace:!0,link:function(scope,ele,attrs){scope.$watch(attrs.edDynamicHtml,function(html){ele.html(html),$compile(ele.contents())(scope)})}}}]),window.angular.module("edoNewUX").directive("edProgressBar",[function(){return{restrict:"E",replace:!0,templateUrl:"Templates/progressBar.html",scope:{progress:"=",outerIndex:"=unitcolorindex",progressTitleFn:"&progresstitlefn"},controllerAs:"progressBarCtrl",bindToController:!0,controller:["$scope",function($scope){var ctrl=this;function activate(){ctrl.progressObjs=[],ctrl.progress instanceof Array==0?ctrl.progress=[ctrl.progress]:ctrl.outerIndex&&(ctrl.byOuterIdx=!0),ctrl.progress.forEach(function(v,idx){ctrl.progressObjs.push({val:v,cssClass:function(idx){return"utils__unitColors_Unit"+(ctrl.outerIndex?ctrl.outerIndex%ctrl.unitColorLength+1:idx%ctrl.unitColorLength+1)+"_Sub2-fill"}(idx)})}),ctrl.progressTitle=ctrl.progressTitleFn()}ctrl.unitColorLength=12,activate(),$scope.$watch(function(){return ctrl.progress},function(newVal,oldVal){oldVal!==newVal&&activate()},!0),ctrl.calcVisualProgress=function(progress){return calcVisualProgress(progress,!0,!0)},ctrl.itemWidth=function(val){return 1<ctrl.progress.length?val/ctrl.progress.length*100:ctrl.calcVisualProgress(100*val)}}]}}]),window.angular.module("edoNewUX").directive("edHideDictionary",function(){return{restrict:"A",link:{post:function($scope,el,attrs){var state={};$scope.$root.$on("$stateChangeSuccess",function(e,toState){state=toState}),el.bind("click touchEnd",function($event){state&&state.data&&state.data.hideDictionaryOnClick&&hideDictionary($event)})}}}}),angular.module("edoNewUX").directive("edSimpleTooltipInner",function(){return{restrict:"E",replace:!0,templateUrl:"templates/edSimpletooltip.html"}}).directive("edSimpleTooltip",["$compile","$window",function($compile,$window){return{scope:{tooltipTitle:"@edSimpleTooltip",placement:"@edSimpleTooltipPlacement"},link:function(scope,element,attr){var tooltip=$compile("<ed-simple-tooltip-inner></ed-simple-tooltip-inner>")(scope),openEventName=edns.mobile.isMobileDevice()?edns.browser.eventNames.clickEventName_mobileAll_touchStart:"mouseenter",closeEventName=edns.mobile.isMobileDevice()?edns.browser.eventNames.clickEventName_mobileAll_touchStart:"mouseleave";function closeSimpleTooltip(e){edns.mobile.isMobileDevice()&&element[0]===e.srcElement||scope.$apply(hide)}function show(){var position,ttWidth,ttHeight,ttPosition;switch(scope.placement=scope.placement||"top",tooltip.css({top:0,left:0,display:"block"}),element.after(tooltip),position={width:element.prop("offsetWidth"),height:element.prop("offsetHeight"),top:element.prop("offsetTop"),left:element.prop("offsetLeft")},ttWidth=tooltip.prop("offsetWidth"),ttHeight=tooltip.prop("offsetHeight"),scope.placement){case"right":ttPosition={top:position.top+position.height/2-ttHeight/2+"px",left:position.left+position.width+"px"};break;case"bottom":ttPosition={top:position.top+position.height+"px",left:position.left+position.width/2-ttWidth/2+"px"};break;case"left":ttPosition={top:position.top+position.height/2-ttHeight/2+"px",left:position.left-ttWidth+"px"};break;default:ttPosition={top:position.top-ttHeight+"px",left:position.left+position.width/2-ttWidth/2+"px"}}tooltip.css(ttPosition),scope.isOpen=!0}function hide(){scope.isOpen=!1,tooltip.remove()}element.bind(openEventName,function(e){scope.$apply(show)}),edns.mobile.isMobileDevice()?$(window).on(closeEventName,closeSimpleTooltip):element.bind(closeEventName,closeSimpleTooltip),scope.$on("$destroy",function(){$(window).off(closeEventName,closeSimpleTooltip)})}}}]),window.angular.module("edoNewUX").directive("edGoogleTranslateBlock",function(){return{restrict:"A",scope:{isDisabled:"=edGoogleTranslateBlock"},link:{post:function($scope,el,attrs){!function(isDisabled){if(isDisabled){var htmlNode=document.getElementsByTagName("html")[0];htmlNode.setAttribute("translate","no")}}($scope.isDisabled)}}}}),function(angular){angular.module("edoNewUX").constant("USERSTATE",{USER_LOGGEDIN_SECONDS:"-30",SUCCESS:"0",USER_LOGGEDIN:"-3",TOO_MANY_USERS:"-4",SERVICE_FAILED:"-5",PLT_NOT_ALLOWED:"-6",INACTIVE_LICENSE:"-7"})}(angular),function(angular){angular.module("edoNewUX").constant("COURSE_CONSTANT",{COURSE_META_PATH:"Runtime/Metadata/Courses/",COURSE_IMAGES_PATH:"Runtime/Graphics/Courses/C_",COURSE_UNIT_IMAGES_PATH:"Runtime/Graphics/Units/U_",COURSE_GRAMMAR:"6",IGNORED_SUBJECT:"Story"}).constant("NODE_TYPE_CONSTANT",{COURSE:1,UNIT:2,LESSON:3,STEP:4,TASK:5}).constant("COURSE_TEST_TYPE_CONSTANT",{MIDTERM:2,FINAL:3}).constant("STEP_TYPE_CONSTANT",{TEST:"Test"})}(angular);
//# sourceMappingURL=AngJSAppModule.min.js.map
