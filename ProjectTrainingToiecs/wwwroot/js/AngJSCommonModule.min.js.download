!function(angular){var appDependencies=function(){var appDependencies=["pascalprecht.translate"];if(0<$("html.siteLogin").length)appDependencies=appDependencies.concat(["ui.bootstrap","ui.router","ngTinyScrollbar"]);else{var isMobileDevice=edns.mobile.isMobileDevice();isMobileDevice?setEnvironment(isMobileDevice,"ngTouch","supportedMobiles"):setEnvironment(isMobileDevice,"ngTinyScrollbar","notSupportedMobiles")}return appDependencies;function setEnvironment(isMobile,appDependencyModuleName,documentClassName){window.supportedMobiles=isMobile,appDependencies.push(appDependencyModuleName),angular.element(document.querySelector("html")).addClass(documentClassName)}}();!function(app){app.config(["$translateProvider",function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:"Languages/",suffix:".json"})}]).run(["$rootScope","storageService","$window",function($rootScope,storageService,$window){bLoadExternalLanguageJSON||(!function($window){var eventMethod=$window.addEventListener?"addEventListener":"attachEvent";function toeicToEdNotifications(notification){var msgJson=JSON.parse(notification).TOEIC_TO_ED;switch(msgJson.sender){case"TOEIC":switch(msgJson.msg.name){case"TestSubmitted":var testTypes={unitTest:2,courseTest:3};switch(msgJson.msg.data.testTypeId){case testTypes.unitTest:storageService.remove("toeicInformation","notSubmittedTest"),$rootScope.$emit("toeicUnitTestSubmitted",{testId:msgJson.msg.data.testId,grade:msgJson.msg.data.grade});break;case testTypes.courseTest:$rootScope.$emit("toeicCourseTestSubmitted",{testId:msgJson.msg.data.testId,grade:msgJson.msg.data.grade})}break;case"TestNotSubmitted":var testTypes={unitTest:2,courseTest:3};switch(msgJson.msg.data.testTypeId){case testTypes.unitTest:storageService.set("toeicInformation",msgJson.msg.data.testId,"notSubmittedTest")}}}}(0,$window[eventMethod])("attachEvent"==eventMethod?"onmessage":"message",function(e){var key=e.message?"message":"data",notification=e[key];console.log("event: "+notification),notification&&-1<notification.toString().indexOf("TOEIC_TO_ED")&&toeicToEdNotifications(notification)},!1)}($window),$rootScope.root=Root.substring(0,Root.length-1),$rootScope.isStudentRole="1"!=storageService.get("Student","StudentPlatform"),bLoadExternalLanguageJSON=!0)}]).config(["$sceDelegateProvider",function($sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["self"])}])}(angular.module("common",appDependencies))}(window.angular),function(angular){angular.module("common").constant("COMMON",{SERVICE_URL:"WebApi/",INSTITUTION_SERVICE_URL:"WebApi/Institution/",canContinueCourseTest:!0}).constant("ASSESSMENTS_TEST_CONSTANT",{TOEICONLINE:1,MIDTERM:2,COURSETEST:3,TOEIC_ONLINE_TEST_URL:"http://ets.toeiciponline.com",TOEIC_BRIDGE_TEST_URL:"http://ets.toeicbridgeonline.com",TOEIC_ONLINE_TEST_NAME:"TOEIC® Listening and Reading test",TOEIC_BRIDGE_TEST_NAME:"TOEIC Bridge™ test"})}(angular),window.angular.module("common").factory("asyncDataOnce",["$q",function($q){return function(){}}]),function(angular){angular.module("common").service("APITokenInterceptor",["$q",function($q){this.request=function(config){return config.url=edns.appToken.api.url.set(config.url),edns.appToken.api.header.add(config.url,config.headers),config},this.response=function(response){return 200===response.status&&edns.appToken.api.ajaxComplete(response.headers,response.status),response},this.responseError=function(response){if(401===response.status){var continueOn401APIs=["Auth/CheckUserLogin","Auth/Logout"];if(url=response.config.url,!continueOn401APIs.some(function(v){return url.includes(v)}))return edns.appToken.api.ajaxUnAuth(),$q(function(){return null})}var url;return response}}]).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("APITokenInterceptor")}])}(angular),window.angular.module("common").factory("pubSubService",["$rootScope",function($rootScope){var namedListeners=[];function unsubscribe(eventName){namedListeners.splice(namedListeners.indexOf(eventName),1)}return{subscribe:function(scope,eventName,callback){var listener=$rootScope.$on(eventName,function(){callback.apply(this,arguments)});namedListeners.push(listener),scope.$on("$destroy",listener),scope.$on("$destroy",function(){unsubscribe.call(this,eventName)})},unsubscribe:unsubscribe,notify:function(eventName,payload){$rootScope.$emit(eventName,payload)}}}]),function(angular){angular.module("common").service("userInfo",["$q","storageService",function($q,storageService){var communityKey_key="Community",communityKeysToUpdateIfNotNull=["Entry","SeePrAnswers","CurFeature","domain"];return{getAuthData:function(loginData){return loginData.UserInfo?{token:loginData.UserInfo.Token,doneOptIn:loginData.UserInfo.DoneOptIn}:null},updateCommunity:function(data){var dataNullablesOverwritten=function(data){return communityKeysToUpdateIfNotNull.forEach(function(key){data[key]=null===data[key]?storageService.get("Community",key):data[key]}),data}((obj=data,InstitutionProperties=obj.InstitutionProperties,delete obj.InstitutionProperties,Object.entries(InstitutionProperties).forEach(function(keyValue){obj[keyValue[0]]=keyValue[1]}),obj));var obj,InstitutionProperties;subKeysToEncode=[],storageService.setPartialEncode("Community",dataNullablesOverwritten,subKeysToEncode)},isShowCourseLicenseExpiration:function(){return"1"===storageService.get(communityKey_key,"ShowCourseLicenseExpiration")}}}])}(angular),window.angular.module("common").service("sitenavNotificationsService",["$rootScope","$http","COMMON","storageService","assessmentsService","pubSubService",function($rootScope,$http,COMMON,storageService,assessmentsService,pubSubService){function AssessmentNotifications(type){var canContinue=COMMON.canContinueCourseTest;function setCount(that,count){saveToLocalStorage(that.count=count),pubSubService.notify("assessmentsChanged",that)}function saveToLocalStorage(count){storageService.set("totalTests",count.toString())}function setPLTDone(that){setPLT(that,!0)}function setPLT(that,didPLT){setCompositeCookie("Student","PTT",didPLT?"1":"0"),that.didPLT=didPLT}return{init:function(){var that,totalTests,count;that=this,totalTests=storageService.get("totalTests"),count=isNaN(totalTests)?0:parseInt(totalTests,10),setCount(that,count)},count:void 0,type:type,didPLT:void 0,getCountFromServer:function(){var that=this;assessmentsService.getAvailableTestsCount(assessmentsService.canContinueCourseTest).then(function(result){(function(that,result){-1===result.data.toString().indexOf("<")&&setCount(that,result.data)}).call(null,that,result)})},setCount:setCount,setPLT:setPLT,setPLTDone:setPLTDone,onStartedTest:function(that,args){canContinue||"CT"==args.testType&&setCount(that,that.count-1)},onNotCompletedTest:function(that,args){},onClosedTest:function(that,args){"CT"==args.testType?function(that,args){if(canContinue)reassignOnLowScore||setCount(that,that.count-1);else{var reassignOnLowScore=function(testStatus){var reassignOnLowScore=!1;switch(testStatus){case"-1":case"-3":case"0":break;case"1":reassignOnLowScore=!0}return reassignOnLowScore}(args.testStatus);reassignOnLowScore&&setCount(that,that.count+1)}}(that,args):function(that){!0!==that.didPLT&&setCount(that,that.count-1),setPLTDone(that)}(that)},addCount:function(count){this.count+=count,saveToLocalStorage(count),pubSubService.notify("assessmentsChanged",this)}}}function AssignmentsNotifications(type){function setCount(that,count){(function(count){storageService.set("Student",count,"totalAssignments")})(that.count=count),pubSubService.notify("assignmentsChanged",that)}return{init:function(){},count:void 0,type:type,getCountFromServer:function(){var urlBase,that=this;(urlBase=COMMON.SERVICE_URL,$http.get(urlBase+"Ping/GetTotalERaterPending")).then(function(result){(function(that,result){-1===result.data.toString().indexOf("<")&&setCount(that,result.data)}).call(null,that,result)})},setCount:setCount}}function inboxNotifications(type){function setCount(that,count){(function(count){storageService.set("Student",count,"totalInbox")})(that.count=count),pubSubService.notify("inboxChanged",that)}return{init:function(){var that,totalTests,count;that=this,totalTests=storageService.get("Student","totalInbox"),count=isNaN(totalTests)?0:parseInt(totalTests,10),setCount(that,count),function(that){$rootScope.$on("HPLoaded",function(that){var urlBase;(storageService.get("Student","StudentID"),urlBase=COMMON.SERVICE_URL,$http.get(urlBase+"Ping/GetNewInboxMessagesCount/")).then(function(result){(function(that,result){-1===result.data.toString().indexOf("<")&&setCount(that,result.data)}).call(null,that,result)})}.bind(that))}(this),function(that){var eventMethod=window.addEventListener?"addEventListener":"attachEvent";(0,window[eventMethod])("attachEvent"==eventMethod?"onmessage":"message",function(e){var key=e.message?"message":"data",notification=e[key];"inboxOpened"===notification&&that.setCount(that,0)},!1)}(this)},count:void 0,type:type,setCount:setCount,getCount:function(that){pubSubService.notify("inboxChanged",that)}}}return{siteNav:function(){var notifications=[],factories=[{type:"assessments",factory:AssessmentNotifications},{type:"assignments",factory:AssignmentsNotifications},{type:"inbox",factory:inboxNotifications}];function get(type){return notifications.filter(function(v){return v.type===type})[0]}return{notifications:notifications,set:function(type){if(void 0!==(notif=get(type)))return notif;var notif=factories.filter(function(v){return type===v.type})[0].factory.call(null,type);return notifications.push(notif),notif.init.call(notif),notif},get:get,countAlerts:function(){return notifications.reduce(function(acc,val){return acc+(val.count?val.count:0)},0)}}}()}}]),function(angular){angular.module("common").service("siteNavService",["$http","COMMON","storageService","assessmentsService","$filter","$rootScope","applicationVariablesBL",function($http,COMMON,storageService,assessmentsService,$filter,$rootScope,applicationVariablesBL){function goToTestInLA(){$rootScope.$emit("closeMyAssessmentsModal"),edns.navigator.removeLAGotoPath(),window.location=edns.testEnvironment.testEnvironmentUrl}var _siteNavService,_navOpened=storageService.get("navOpened"),_testOpen=!1,homeUrl=function(){return"home"!=$rootScope.currentPage?$rootScope.root+"/"+storageService.get("Community","alias")+"#/home":"javascript:void(0)"},addToOpenPopupsStorage=function(openedWinName){var openpopupsWin=storageService.get("openpopupsWin");angular.equals({},openpopupsWin)&&(openpopupsWin=[]),-1==openpopupsWin.indexOf(openedWinName)&&(openpopupsWin.push(openedWinName),storageService.set("openpopupsWin",openpopupsWin))},getOpenedWindow=function(winName){if(window.openPopups&&0<window.openPopups.length&&0<Object.getOwnPropertyNames(window.openPopups[0]).length){for(var i=0;i<window.openPopups.length;i++)if(window.openPopups[i].name==winName)return window.openPopups[i]}else{var openpopupsWin=storageService.get("openpopupsWin");for(i=0;i<openpopupsWin.length;i++)if(openpopupsWin[i]==winName){var newWin=window.open("",winName);return window.openPopups.push(newWin),newWin}}},receiveTestMessage=function(message){"testOpen"==message.data&&(_testOpen=!0)},prepareCourseTest=function(address,winName,winParameters,isRun,TestType){setCompositeCookie("Student","CT","-1"),setCompositeCookie("Student","TT",TestType),openTest(address,winName,winParameters,isRun)},openTest=function(address,winName,winParameters,isRun){_siteNavService.goToOldSite(address,winName,"&NoHeader",winParameters,!0),isRun&&$rootScope.$broadcast("CloseAllModals")},closeTestArea=function(e,message){$(".learning__W").addClass("learning__W--closing"),edns.testEnvironment.deleteCookieLocaltorage(),edns.navigator.removeLAGotoPath();var url=message.url?message.url:homeUrl();window.location.href=url};return $.subscribe("TestArea-SiteNav",closeTestArea),{tabsManager:function(address,winName){if(window.openPopups)for(var i=0;i<window.openPopups.length;i++)if(window.openPopups[i].closed)window.openPopups.splice(i,1);else if(-1!=getParameterByName(window.openPopups[i],"source").indexOf(address))return;return address},goToOldSite:function(address,winName,urlParameters,winParameters,goToInternalClassicEDO){if(localStorage.getItem("ClassicEdoURL"))onClassicEdoURLReady(address,winName,urlParameters,winParameters,goToInternalClassicEDO);else{var onClassicEdoURLReadyBound=onClassicEdoURLReady.bind(this,address,winName,urlParameters,winParameters,goToInternalClassicEDO);applicationVariablesBL.get(["ClassicEdoURL"]).then(function(data){localStorage.setItem("ClassicEdoURL",data.ClassicEdoURL),onClassicEdoURLReadyBound()})}function onClassicEdoURLReady(address,winName,urlParameters,winParameters,goToInternalClassicEDO){var url=void 0===goToInternalClassicEDO?localStorage.getItem("ClassicEdoURL")+"Runtime/"+address+urlParameters:"";location.origin||(location.origin=location.protocol+"//"+location.host),""!=urlParameters&&null!=urlParameters&&""!=url&&(url+=urlParameters),""==url&&(url=Root+"ClassicEDO/Runtime/"+address+urlParameters),url=-1!=location.pathname.indexOf("Runtime")?"../ClassicSite.aspx?source="+url:"ClassicSite.aspx?source="+url,null==winParameters&&(winParameters=""),url+="?Student="+encodeURIComponent("^StudentID*"+getCompositeCookie("Student","StudentID")+"^Language*"+getCompositeCookie("Student","Language")+"^LangSupLevel*"+getCompositeCookie("Student","LangSupLevel")+"^UserType*s"),url+="&Community="+encodeURIComponent("^CurFeature*Forum^IID*"+getCompositeCookie("Community","IID")+"^domain*"+getCompositeCookie("Community","domain")+"^Ins*^CMPN*^CMPT*^CURRENTYEAR*2020^CurFeature*Forum");var path=null;0<(url+="&resPathRoot="+encodeURIComponent(GetCookie("resPathRoot"))).indexOf("forum/forumsHome.aspx")?path="forum/forumsHome.aspx":0<url.indexOf("Support/Inbox.aspx")&&(path="Support/Inbox.aspx"),null!==path&&(url=url.replace(path,"SetCookie.aspx"),url+="&url="+path);var openedWin=window.open(url,winName,winParameters);window.openPopups&&window.openPopups.push(openedWin),addToOpenPopupsStorage(winName)}},goToClassicSiteFolder:function(address,winName,urlParameters,winParameters){var url="";location.origin||(location.origin=location.protocol+"//"+location.host),""!=urlParameters&&null!=urlParameters&&""!=url&&(url+=urlParameters),""==url&&(url=Root+"ClassicEDO/Runtime/"+address+urlParameters),url=-1!=location.pathname.indexOf("Runtime")?"../ClassicSite.aspx?source="+url:"ClassicSite.aspx?source="+url,null==winParameters&&(winParameters="");var openedWin=window.open(url,winName,winParameters);window.openPopups&&window.openPopups.push(openedWin),addToOpenPopupsStorage(winName)},openTestsInOldSite:function(address,winName,TestType,$totalSeconds,autoOpen,testStarted){this.tabsManager(address,winName);_siteNavService=this;var isRun=!1;if(bIE?winParameters="title=no,status=no,scrollbars=no,toolbar=no,fullscreen=yes":winParameters="width="+screen.width+",height="+screen.height+",left=0,top=0,resizable=no,title=no,status=no,toolbar=no","PlacementTest"==winName){var PTTO=getCompositeCookie("Community","PTTO"),studentId=JSON.parse(localStorage.getItem("Student")).StudentID,PLTLanguage=JSON.parse(localStorage.getItem("Student")).PLTLanguage;if("0"==PTTO||""==studentId)address+="&language="+PLTLanguage+"&studentId="+studentId,$rootScope.$broadcast("CloseAllModals");else{var PTTaken=getCompositeCookie("Student","PTT");if(null==PTTaken)return void assessmentsService.hasPlacementTest().then(function(res){return res.data?(address="",void(autoOpen||alert($filter("translate")("328")))):(address+="&language="+PLTLanguage+"&studentId="+studentId,$rootScope.$broadcast("CloseAllModals"),void _siteNavService.goToOldSite(address,winName,"&NoHeader",winParameters,!0))});if("0"!=PTTaken)return void(autoOpen||alert($filter("translate")("328")));address+="&language="+PLTLanguage+"&studentId="+studentId}openTest(address,winName,winParameters,isRun)}if("CourseTest"==winName){var strConfMsg=$filter("translate")("313"),strTTName="3"==TestType?"Final Course Test":"Mid-Term Course Test";if(strConfMsg=strConfMsg.replace(/<test>/g,strTTName),!(isRun=testStarted||confirm(strConfMsg)))return-1;address+="?language="+JSON.parse(localStorage.getItem("Student")).PLTLanguage,window.addEventListener("message",receiveTestMessage,!1);var CTWin=getOpenedWindow(winName);CTWin?(CTWin.postMessage("checkOpenTests","*"),setTimeout(function(){_testOpen?(CTWin.focus(),$rootScope.$broadcast("CloseAllModals"),_testOpen=!1):prepareCourseTest(address,winName,winParameters,isRun,TestType)},500)):prepareCourseTest(address,winName,winParameters,isRun,TestType)}},goToInstitutionPage:function(address,winName,urlParameters,winParameters){var url="";location.origin||(location.origin=location.protocol+"//"+location.host),""!=urlParameters&&null!=urlParameters&&(url+=urlParameters),""==url&&(url=address+urlParameters),null==winParameters&&(winParameters=""),window.openPopups.push(window.open(url,winName,winParameters))},getNavStatus:function(){return _navOpened},setNavStatus:function(opened){storageService.set("navOpened",opened),_navOpened=opened},homeUrl:homeUrl,openTestsInLA:function(testType,isContinue,autoOpen){_siteNavService=this;if("1"==testType){var PTTO=getCompositeCookie("Community","PTTO"),studentId=JSON.parse(localStorage.getItem("Student")).StudentID;if("0"==PTTO||""==studentId);else{var PTTaken=getCompositeCookie("Student","PTT");if(null==PTTaken)return void assessmentsService.hasPlacementTest().then(function(res){return res.data?isContinue?void 0:void(autoOpen||alert($filter("translate")("328"))):($rootScope.$broadcast("CloseAllModals"),void goToTestInLA())});if("0"==PTTaken);else if(!isContinue)return void(autoOpen||alert($filter("translate")("328")))}goToTestInLA()}if("2"==testType||"3"==testType){var strConfMsg=$filter("translate")("313");if(strConfMsg=strConfMsg.replace(/<test>/g,"test"),!isContinue&&!confirm(strConfMsg))return-1;goToTestInLA()}},isInTestEnvironment:function(){return edns.testEnvironment.isInTestEnvironment},tryCloseTestArea:function(){$.publish("SiteNav-TestArea",{action:"tryCloseTestArea",payload:{closeReason:"closeByX"}})},closeTestArea:closeTestArea,setIsContinueAndGoToTestInLA:function(isContinue){var IID=storageService.get("Community","IID"),studentID=storageService.get("Student","StudentID"),userName=storageService.get("Student","UserName"),lang=sharedGetLang();setCompositeCookie("PLTExternal","IID",IID),setCompositeCookie("PLTExternal","studentId",studentID),setCompositeCookie("PLTExternal","UserName",encodeURIComponent(userName)),setCompositeCookie("PLTExternal","Lang",lang),setCompositeCookie("PLTExternal","Continue",isContinue);var token=getCompositeCookie("Student","Token");token&&edns.appToken.set(token),goToTestInLA()},goToTestInLA:goToTestInLA}}])}(angular),function(angular){angular.module("common").factory("storageService",[function(){var get=function(mainKey,subKey){var obj=JSON.parse(localStorage.getItem(mainKey))||{};return void 0===subKey?obj:obj[subKey]},set=function(mainKey,value,subKey,withoutCookie){var obj;void 0===subKey?(obj=value,withoutCookie||(angular.isObject(value)?setObjectAsCookie(mainKey,value):setCookie(mainKey,value))):((obj=JSON.parse(localStorage.getItem(mainKey))||{})[subKey]=value,withoutCookie||setCompositeCookie(mainKey,subKey,value)),localStorage.setItem(mainKey,JSON.stringify(obj))},setObjectAsCookie=function(mainKey,values){angular.forEach(values,function(val,key){setCompositeCookie(mainKey,key,val)})},setCookie=function(mainKey,values){DelCookie(mainKey),document.cookie=mainKey+"="+values+"; path=/"},session={get:function(mainKey,subKey){var obj=JSON.parse(sessionStorage.getItem(mainKey))||{};return void 0===subKey?obj:obj[subKey]},set:function(mainKey,value,subKey){var obj;void 0===subKey?obj=value:(obj=JSON.parse(sessionStorage.getItem(mainKey))||{})[subKey]=value,sessionStorage.setItem(mainKey,JSON.stringify(obj))},remove:function(mainKey,subKey){if(void 0===subKey)sessionStorage.removeItem(mainKey);else{var obj=JSON.parse(sessionStorage.getItem(mainKey))||{};delete obj[subKey],sessionStorage.setItem(mainKey,JSON.stringify(obj))}}};return{get:get,set:set,remove:function(mainKey,subKey){if(void 0===subKey)localStorage.removeItem(mainKey),DelCookie(mainKey);else{var obj=JSON.parse(localStorage.getItem(mainKey))||{};delete obj[subKey],localStorage.setItem(mainKey,JSON.stringify(obj)),setCompositeCookie(mainKey,subKey,"")}},clearAll:function(includeCookies){localStorage.clear(),includeCookies&&document.cookie.split(";").forEach(function(c){document.cookie=c.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")})},DelCookie:DelCookie,getCookieAsJSON:function(mainKey){var cookieValue,jsonCookie={},values=GetCookie(mainKey);if(!values)return values;var valuesArr=values.substring(1).split("^");return angular.forEach(valuesArr,function(val,key){cookieValue=val.split("*"),jsonCookie[cookieValue[0]]=cookieValue[1]}),jsonCookie},setCookie:setCookie,getCookie:getCompositeCookie,session:{get:session.get,set:session.set,remove:session.remove},local:{get:get,set:set},setPartialEncode:function(mainKey,value,subKeysToEncode){angular.isObject(value)&&(function(mainKey,values,subKeysToEncode){angular.forEach(values,function(val,key){subKeysToEncode.find(function(v){return v===key})?setCompositeCookie(mainKey,key,val):setCompositeCookieNoEncode(mainKey,key,val)})}(mainKey,value,subKeysToEncode),localStorage.setItem(mainKey,JSON.stringify(value)))}}}])}(window.angular),window.angular.module("common").service("onBoardingService",["$http","$rootScope","COMMON","storageService",function($http,$rootScope,COMMON,storageService){var srv=this;srv.areaId,srv.getAreasStates=function(areaId){return srv.areasStates=JSON.parse(storageService.get("onBoarding","states")),srv.areasStates[areaId]},srv.getAllAreasScreens=function(promise){$http.get($rootScope.root+"/Config/onBoardingAreas.json").then(function(response){srv.areasScreens=response.data,storageService.set("onBoarding",JSON.stringify(response.data),"screens",!0),promise&&promise()})},srv.setAreaState=function(){setStorage(!0);var urlBase=COMMON.SERVICE_URL;return $http.get(urlBase+"Help/SetOnBoardingState/"+srv.areaId+"/"+!0)},srv.getAreaById=function(areaId){return srv.areaId=areaId,srv.areasScreens[areaId]},setStorage=function(state){srv.areasStates[srv.areaId]=state,storageService.set("onBoarding",JSON.stringify(srv.areasStates),"states",!0)}}]),function(angular){angular.module("common").service("authServiceBL",["$rootScope","$q","$state","storageService","authService","loginService","userInfo","loginService","$filter",function($rootScope,$q,$state,storageService,authService,loginService,userInfo,loginService,$filter){return{login:function(userName,password){var IID=JSON.parse(localStorage.getItem("Community")).IID;loginService.setTempStudentSource("");var communityVer=storageService.get("Community").CommunityVersion;authService.login(userName,password,IID,communityVer).then(function(result){if(result.data){var authData=userInfo.getAuthData(result.data);null!==authData&&authData.token&&setToken(authData.token),null!==authData&&!0!==authData.doneOptIn?($rootScope.userCredentials={username:userName,password:password,IID:IID},$rootScope.showOptIn=!0,$state.go("optIn")):loginService.afterTryAuthenticate(userName,password,IID)(result)}})},setToken:setToken};function setToken(token){token&&edns.appToken.set(token)}}])}(angular),function(angular){angular.module("common").factory("authService",["$http","COMMON","$q","edSettingsService",function($http,COMMON,$q,edSettingsService){var currentUser;return{login:function(userName,password,IID,communityVer){var finalUrl=COMMON.SERVICE_URL+"Auth",authData={UserName:userName,InstitutionId:IID,Password:password,CommunityVersion:communityVer};return $http.post(finalUrl,authData)},setOptIn:function(userName,password,IID){var optinData={UserName:userName,InstitutionId:IID,Password:password},finalUrl=COMMON.SERVICE_URL+"OptIn/SetUserOptIn";return $http.post(finalUrl,optinData)},logout:function(){var finalUrl=COMMON.SERVICE_URL+"Auth/Logout";return $http.get(finalUrl)},isLoggedIn:function(){var finalUrl=COMMON.SERVICE_URL+"Auth/CheckUserLogin",defer=$q.defer();return edSettingsService.initAPIs().then(function(){$http.get(finalUrl).then(function(d){defer.resolve(d)})}),defer.promise},ping:function(){var finalUrl=COMMON.SERVICE_URL+"Ping/Ping";return $http.put(finalUrl)},pingEndSession:function(userId,markArr,visitedItems){var finalUrl=COMMON.SERVICE_URL+"PingEndSession/"+userId;return Root&&(finalUrl=Root+finalUrl),$http({url:finalUrl,dataType:"json",method:"PUT",data:{markArr:markArr,visitedItems:visitedItems},headers:{"Content-Type":"application/json"}})},checkLogout:function(userId){var finalUrl=COMMON.SERVICE_URL+"Auth/CheckUserLogin";return $http.get(finalUrl)},sendForgottenPassword:function(userName,IID){var finalUrl=COMMON.SERVICE_URL+"Auth/SendForgottenPassword/"+userName+"/"+IID;return $http.get(finalUrl)},getCurrentUser:function(){return currentUser},setCurrentUser:function(user){currentUser=user},getClassicEdoEntryPointUrl:function(target){for(var cookie,key,val,params=["url="+encodeURIComponent(target)],i=0,arr=document.cookie.split("; ");i<arr.length;i++)if(2===(cookie=arr[i].split("=")).length)switch(key=cookie[0].toLowerCase(),val=cookie[1],key){case"user":params.push("Student="+encodeURIComponent("^"+val.replace("userId","StudentID")));break;case"community":params.push("Community="+encodeURIComponent("^"+val)),params.push("resPathRoot=")}return localStorage.getItem("ClassicEdoURL")+"/runtime/SetCookie.aspx?"+params.join("&")},checkSession:function(){var finalUrl=COMMON.SERVICE_URL+"Ping/KeepAlive";return $http.put(finalUrl)},forceLogin:function(IID,userName,password,communityVer){var finalUrl=COMMON.SERVICE_URL+"Auth/ForceLogin/",authData={UserName:userName,InstitutionId:IID,Password:password,CommunityVersion:communityVer};return $http.post(finalUrl,authData)}}}])}(angular),function(angular){angular.module("common").factory("edSettingsService",[function(){return{initAPIs:function(){return edns.appToken.api.init()}}}])}(angular),function(angular){angular.module("common").factory("langService",["$translate","$log","storageService",function($translate,$log,storageService){var translateLanguageCode=sharedTranslateLanguageCode,getLang=sharedGetLang;var setRTLMode=function(lang){"heb"===lang||"ara"===lang?(angular.element(document.querySelector("head")).append('<link id="rtlCss" href="Css/layoutRtl.css" rel="stylesheet">'),storageService.set("isRtlMode",!0)):(storageService.set("isRtlMode",!1),function(filename,filetype){for(var targetelement="js"==filetype?"script":"css"==filetype?"link":"none",targetattr="js"==filetype?"src":"css"==filetype?"href":"none",allsuspects=document.getElementsByTagName(targetelement),i=allsuspects.length;0<=i;i--)allsuspects[i]&&null!=allsuspects[i].getAttribute(targetattr)&&-1!=allsuspects[i].getAttribute(targetattr).indexOf(filename)&&allsuspects[i].parentNode.removeChild(allsuspects[i])}("layoutRtl.css","css"))};function setSpecificLang(langCode,promise){setRTLMode(langCode),$translate.use(translateLanguageCode(langCode)).then(function(data){null!=promise&&promise()})}return $.subscribe("setSpecificLang",function(e,langCode,onChange){setSpecificLang(langCode,onChange)}),{getLang:getLang,setLang:function(promise){setSpecificLang(getLang(),promise)}}}])}(angular),function(angular){angular.module("common").service("activityService",["$http","COMMON",function($http,COMMON){return{login:function(userId,userName){var date=(new Date).getTimezoneOffset()/-60;logActionAngular("Login",userId,"UserName:"+userName+";LocalTimezone:"+date)},courseChange:function(courseId){logActionAngular("Course_Change",courseId)},unitChange:function(unitId){logActionAngular("Unit_Change",unitId)},lessonChange:function(lessonId){logActionAngular("Lesson_Change",lessonId)},logout:function(){logActionAngular("Logout")}}}])}(angular),angular.module("common").factory("institutionService",["$http","storageService","$rootScope","COMMON",function($http,storageService,$rootScope,COMMON){var gettingDataFromServer=!1;return{getInstitutionInfo:function(domain,institutionName,debugMode){var urlBase=COMMON.SERVICE_URL,apiFucionName="Institution/GetInstitutionInfo/"+domain+"/"+institutionName+"/"+debugMode;return $http.get(urlBase+apiFucionName)},getDataFromServer:function(institutionId){var urlBase=COMMON.SERVICE_URL,apiFucionName="Institution/GetInstitutionsData/"+institutionId;return $http.get(urlBase+apiFucionName)},setData:function(){if((InstitutionsDataStorage=storageService.session.get("InstitutionsData"))&&!angular.equals(InstitutionsDataStorage,{})||!1!==gettingDataFromServer)$rootScope.$broadcast("InstitutionsDataLoaded");else{var IID=storageService.get("Community","IID");gettingDataFromServer=!0,this.getDataFromServer(IID).success(function(data){gettingDataFromServer=!1,data&&storageService.session.set("InstitutionsData",data),data&&"undefined"!==data.displaySiteNav&&$rootScope.$broadcast("InstitutionsDataLoaded")})}var InstitutionsDataStorage},gettingDataFromServer:gettingDataFromServer}}]),window.angular.module("common").factory("whiteLabelService",[function(){return{getWhiteLabel:edns.whiteLabel.getWhiteLabel}}]),window.angular.module("common").factory("mediaPathService",["$http","$rootScope","COMMON",function($http,$rootScope,COMMON){return{getMediaPath:function(iid){return $http.get(COMMON.INSTITUTION_SERVICE_URL+"getMediaPath/"+iid)}}}]),function(angular){angular.module("common").service("schedulerDALService",["$q","$http","$rootScope","COMMON","storageService",function($q,$http,$rootScope,COMMON,storageService){var urlBase=COMMON.SERVICE_URL;return{getPlanForElement:function(userId,elementId,planId,elementType,isFakeData){var defer,url;if(defer=$q.defer(),planId<0&&isFakeData)url=Root+"config/schedulerFakeData.json";else{url="WebApi/Scheduler/GetNotificationsAsync/"+elementType+"/"+planId+"/"+ +elementId}return $http.get(url).success(function(data){defer.resolve(data)}).error(function(data){console.log("Failed to get scheduler data"),defer.resolve(null)}),defer.promise},getCoursesInPlans:function(userId,planId){var defer;defer=$q.defer();return $http.get("WebApi/Scheduler/GetCoursesInPlansAsync").success(function(data){defer.resolve(data)}).error(function(data){console.log('Failed to get scheduler "CoursesInPlans"'),defer.resolve(null)}),defer.promise},getSchedulerAssignedCourses:function(){var qsParams=0===Object.keys(storageService.get("Scheduler")).length?"/true":"",url=urlBase+"Scheduler/GetSchedulerAssignedCourses"+qsParams;return $http.get(url)}}}])}(angular),window.angular.module("common").factory("schedulerService",["$q","$rootScope","schedulerDALService","storageService",function($q,$rootScope,schedulerDALService,storageService){var maxItemsInRow=3,elementTypes={Course:1,Unit:2,Lesson:4,MTT:8,FT:16},measureKindSymbols={1:"%",2:"%",3:"Hrs.",4:"%"},targetAction=(edns.scheduler.measureKind,{0:"Assign",1:"Unassign"}),measureKindL10n=[{elementType:1,id:2,k:"1302"},{elementType:1,id:3,k:"1301"},{elementType:1,id:4,k:"1303"},{elementType:2,id:2,k:"1305"},{elementType:2,id:3,k:"1304"},{elementType:2,id:4,k:"1306"},{elementType:8,id:2,k:"1302"},{elementType:8,id:3,k:"1301"},{elementType:8,id:4,k:"1307"},{elementType:16,id:4,k:"1308"},{elementType:1,id:1,k:"0a"},{elementType:2,id:1,k:"0b"},{elementType:4,id:1,k:"0c"},{elementType:8,id:1,k:"0d"},{elementType:16,id:1,k:"0e"}],measuresTitleL10n=[{elementType:[1],measuresId:[1,2,3,4],targetAction:1,nplurals:1,k:"1330"},{elementType:[1],measuresId:[1,2,3,4],targetAction:1,nplurals:2,k:"1330"},{elementType:[1],measuresId:[1],targetAction:0,nplurals:1,k:"1331"},{elementType:[1],measuresId:[2,3,4],targetAction:0,nplurals:1,k:"1332"},{elementType:[1],measuresId:[2,3,4],targetAction:0,nplurals:2,k:"1333"},{elementType:[2],measuresId:[1,2,3,4],targetAction:1,nplurals:1,k:"1319",lak:"1318"},{elementType:[2],measuresId:[1,2,3,4],targetAction:1,nplurals:2,k:"1319",lak:"1318"},{elementType:[2],measuresId:[1],targetAction:0,nplurals:1,k:"1320"},{elementType:[2],measuresId:[2,3,4],targetAction:0,nplurals:1,k:"1321"},{elementType:[2],measuresId:[2,3,4],targetAction:0,nplurals:2,k:"1322"},{elementType:[8,16],measuresId:[2,3,4],targetAction:0,nplurals:1,k:"1400"},{elementType:[8,16],measuresId:[2,3,4],targetAction:0,nplurals:2,k:"1401"},{elementType:[8,16],measuresId:[1,2,3,4],targetAction:0,nplurals:1,k:"1402"},{elementType:[8,16],measuresId:[1,2,3,4],targetAction:0,nplurals:2,k:"1403"}];return{isScheduler:edns.scheduler.isScheduler,addLockReason:function(course,elementType){var defer=$q.defer(),courseId=course.NodeId,coursePlanMetaData=function(courseId){var courseMetaData,courses=storageService.get("Courses");if((courseMetaData=_.find(courses,function(v){return v.CourseId==courseId}))&&courseMetaData.coursePlan&&courseMetaData.coursePlan.PlanId){var coursePlanMetaData={planId:courseMetaData.coursePlan.PlanId};return courseMetaData.coursePlan.StartDate&&(coursePlanMetaData.planDate=courseMetaData.coursePlan.StartDate),coursePlanMetaData}}(courseId);if(coursePlanMetaData){var userId=getCompositeCookie("Student","StudentID"),planDate=coursePlanMetaData.planDate,onPlanForCourseSuccess=function(course,prepareConditionsForMappers,verboseConditions,elementType,planDate,defer){return function(res){if(_.isObject(res)){var conditions=prepareConditionsForMappers(res,elementType),verbConditions=verboseConditions(conditions,planDate);!function(course,conditions){var addConditionsToCourseNode=function(conditions){return function(node){var conditionsForNode=_.find(conditions,function(v){return v.targetId==node.NodeId});return null!=conditionsForNode&&(conditionsForNode.measures=prepareRulesForDisplay(conditionsForNode.measures),node.lockReason=conditionsForNode),node}}(conditions);addConditionsToCourseNode(course),course.Children.map(addConditionsToCourseNode)}(course,verbConditions)}defer.resolve(course)}}(course,prepareConditionsForMappers,verboseConditions,elementType,planDate,defer);schedulerDALService.getPlanForElement(userId,courseId,coursePlanMetaData.planId,elementType,!1).then(onPlanForCourseSuccess)}else defer.resolve(course);return defer.promise},addCoursesInPlans:function(courses){var defer;return defer=$q.defer(),edns.scheduler.isScheduler()&&function(courses){return!!_.find(courses,function(v){return v.coursePlan})}(courses)?function(courses){var defer,userId=getCompositeCookie("Student","StudentID");defer=$q.defer();var onCoursesInPlans=function(courses,getCourseCondition,prepareRulesForDisplay,getPlansStartDateByPlanId){return function(data){var dataPlanStart=getPlansStartDateByPlanId(courses,data),conditions=getCourseCondition(dataPlanStart);return _.values(data).forEach(function(v){var courseInCourses=_.find(courses,function(c){return v.CourseId===c.CourseId});courseInCourses||(courseInCourses={CourseId:v.CourseId,courseName:v.ElementName,IsLocked:!(0!==v.Action)},courses.splice(v.Sequence-1,0,courseInCourses));var conditionsForCourse=_.find(conditions,function(v){return v.targetId==courseInCourses.CourseId});null!=conditionsForCourse&&(conditionsForCourse.measures=prepareRulesForDisplay(conditionsForCourse.measures),courseInCourses.lockReason=conditionsForCourse)}),courses}}(courses,getCourseCondition,prepareRulesForDisplay,getPlansStartDateByPlanId);return schedulerDALService.getCoursesInPlans(userId).then(function(data){var coursesWithLocks=onCoursesInPlans(data);defer.resolve(coursesWithLocks)}),defer.promise}(courses).then(function(data){defer.resolve(data)}):defer.resolve(courses),defer.promise},isTimeBased:edns.scheduler.isTimeBased,formatTimeBasedData:edns.scheduler.formatTimeBasedData,elementTypes:elementTypes,parseUpcommingTestConditions:function(res,elementType){var elementType=elementTypes.FT,verbCond=verboseConditions(prepareConditionsForMappers(res,elementType),null)[0];return verbCond.measures=prepareRulesForDisplay(verbCond.measures),verbCond},getElementTypeByAssessment:function(foo){},getVisualProgress:edns.scheduler.getVisualProgress,userHasPlan:edns.scheduler.userHasPlan,execUserPlan:edns.scheduler.execUserPlan,setHasDateConditionFlag:function(hasDateConditionFlag){storageService.set("Scheduler",hasDateConditionFlag,"hasDateCondition")},hasDateCondition:function(){return storageService.get("Scheduler","hasDateCondition")},refreshAfterExecUserPlan:function(userPlanData){var needRefresh=!1,testsCount=0;for(var key in userPlanData.CoursePlans)val=userPlanData.CoursePlans[key],0<val.AffectedElements.length&&(needRefresh=needRefresh||null!=_.find(val.AffectedElements,function(element){return element.ElementType==elementTypes.Unit||element.ElementType==elementTypes.Course}),val.AffectedElements.map(function(element){return element.ElementType==elementTypes.MT||element.ElementType==elementTypes.FT})&&testsCount++);return needRefresh&&$rootScope.$broadcast("scheduler",{refreshAfterExecUserPlan:!0}),testsCount},isUpcomingTestIsRepeat:function(conditions){return null!=conditions&&void 0!==conditions.Operand&&3===conditions.Operand}};function getCourseCondition(res){return verboseConditions(prepareConditionsForMappers(res,elementTypes.Course),null)}function prepareConditionsForMappers(conditions,elementType){var lockReasons=[];for(var key in conditions){var condition=conditions[key].Condition,res={};res.targetId=key,res.elementType=elementType,res.targetAction=conditions[key].Action,isDate(condition)?res.measures=formatDateCondition(condition):res.measures=formatAchvimentConditions(condition),res.planStart=conditions[key].planStart,lockReasons.push(res)}return lockReasons;function formatDateCondition(condition){return[{id:1,value:condition.Duedate,operandId:3,refElementType:1}]}function formatAchvimentConditions(conditions,resRef){var res=resRef||[];if(hasChildren(conditions))formatAchvimentConditions(conditions.AndCond,res);else if(resRef)for(var key in conditions){var condition=conditions[key];hasChildren(condition)?formatAchvimentConditions(condition.AndCond,res):res.push(formatAchvimentCondition(condition))}else res.push(formatAchvimentCondition(conditions));return res}function hasChildren(condition){return!!condition.AndCond}function formatAchvimentCondition(condition){var measure={};return measure.operandId=condition.Operand,measure.value=condition.Value,measure.id=condition.MeasureKind,measure.refElementType=condition.RefId.ElementType,measure}function isDate(condition){return!!condition.Duedate}}function prepareRulesForDisplay(measures){var displayData_colsInRow=4===measures.length?2:3,measuresArrChunked=_.chunk(measures,displayData_colsInRow);return edns.utils.addItemsToArrayOfArrays(measuresArrChunked,maxItemsInRow,{title:"",data:"",percent:!1})}function verboseConditions(conditions,planDate){return conditions.map(function(condition){var res={};res.measures=condition.measures.map(function(measure,i){return measure.measureKindSymbol=measureKindSymbols[measure.id],measure.title=_.find(measureKindL10n,function(mk){return mk.id==measure.id&&mk.elementType===measure.refElementType}).k,measure.data=measure.value,edns.scheduler.isMeasureTimeBased(measure.id)&&(measure.timeUntilAssign=edns.scheduler.getTimeUntilAssign(Date.now(),measure.value)),measure});var n,l10ns,measures,l10nsForElementType=_.filter(measuresTitleL10n,function(l){return-1<l.elementType.indexOf(condition.elementType)}),pluralFormFunc=(n=condition.measures.length,function(v){return v.nplurals==(1===n?1:2)}),l10nsForElementTypePlural=_.filter(l10nsForElementType,pluralFormFunc),l10nsForElementTypePluralAction=_.filter(l10nsForElementTypePlural,function(v){return v.targetAction===condition.targetAction}),flatMeasuresIds=_.map(res.measures,"id"),l10n=(l10ns=l10nsForElementTypePluralAction,measures=flatMeasuresIds,_.find(l10ns,function(v){return 0<_.intersection(v.measuresId,measures).length}));return res.title=l10n.k,res.targetId=condition.targetId,res.planStart=planDate||condition.planStart,res.displayMeasuresArray=targetAction[condition.targetAction]===targetAction[0],res.unassigned=!(1!==condition.targetAction),void 0!==l10n.lak&&(res.learningAreaTitle=l10n.lak),res})}function getPlansStartDateByPlanId(courses,data){var coursesWithPlans=_.filter(courses,function(v){return void 0!==v.coursePlan}),dataWithStartDateArray=_.values(data).map(function(v){return v.planStart=_.find(coursesWithPlans,function(c){return!!c.coursePlan&&c.coursePlan.PlanId===v.PlanId}).coursePlan.StartDate,v});return _.mapValues(_.keyBy(dataWithStartDateArray,"CourseId"))}}]),function(angular){angular.module("common").service("assessmentsDALTOEICService",["$http","$rootScope","storageService",function($http,$rootScope,storageService){var toeicInformation=storageService.get("toeicInformation"),Root=toeicInformation.toeicServicesURL+"/",config={headers:{"Edusoft-SessionKey":toeicInformation.toeicSessionKey}},urlBase=Root+"LearningService.svc/script/";return{GetUserTests:function(userCourses){var url=urlBase+"GetUserTests?userCourses=["+userCourses.toString()+"]";return $http.get(url,config)},GetUserTestResultsRange:function(userCourses){var url=urlBase+"GetUserTestResultsRange?userCourses=["+userCourses.toString()+"]";return $http.get(url,config)},getCourseTestMap:function(){var url=$rootScope.root+"/Runtime/TOEIC/Metadata/courseTests/CT_GradeToRange.json";return $http.get(url)}}}])}(angular),function(angular){angular.module("common").service("assessmentsBLEDService",["$rootScope","$filter","$interval","$q","ASSESSMENTS_TEST_CONSTANT","storageService","siteNavService","schedulerService","assessmentsBLSharedService","assessmentsService",function($rootScope,$filter,$interval,$q,ASSESSMENTS_TEST_CONSTANT,storageService,siteNavService,schedulerService,assessmentsBLSharedService,assessmentsService,schedulerService){var TOEFL_SPTests=null,proficentyTests={tests:[{id:"989026380",testName:"TOEFL Junior� Standard Practice Test"},{id:"989026740",testName:"TOEFL Primary� Step 2 Practice Test"},{id:"989026622",testName:"TOEFL Primary� Step 1 Practice Test"},{id:"989027084",testName:"TOEFL ITP� Level 1 Practice Test"},{id:"989026860",testName:"TOEFL ITP� Level 2 Practice Test"}]};return{getTests:function(){var defer=$q.defer();return assessmentsService.getTests().then(function(res){if(200===res.status){var parseProficencyBound=function(tests,key){return tests[key].forEach(function(v){var profTest=proficentyTests.tests.find(function(pt){return pt.id==v.TestId});void 0!==profTest&&(v.proficency=!0,v.TestName="",v.CourseName=profTest.testName),void 0!==v.TestId&&delete v.TestId}),key}.bind(null,res.data);Object.keys(res.data).map(parseProficencyBound).forEach(function(v){res.data[v]=formatTOEFLCourseName(res.data[v]),res.data[v]=res.data[v].map(function(test){if(test.TestURL&&test.TestKey){var url=test.TestURL+"/?authKey="+test.TestKey;test.TestURL=url}return test})}),function(TOEFL_SPTests){var defer=$q.defer();return hasSPTest()?assessmentsService.getTOEFLCoursesData(TOEFL_SPTests,defer).then(function(res){if(res){TOEFL_SPTests=res.TOEFL_SPTests;var toeflSpeakingTests=[],assignedCourses=JSON.parse(localStorage.getItem("Courses"));if(assignedCourses){var testBase={TestName:"",metadata:{toeflSpeakingTest:!0}};toeflSpeakingTests=assignedCourses.filter(function(v){return isCourseHasTOEFLCourseTest(TOEFL_SPTests,v)}).map(function(v){var test=JSON.parse(JSON.stringify(testBase)),toeflConsts=getTOEFLDataByEDCourseId(TOEFL_SPTests,v.CourseId);return test.metadata.speakingPracticeTestCourseId=toeflConsts.toeflCourseId,test.TestName=edns.toefl.addItalicsForToefl(toeflConsts.testName,!0),test})}}defer.resolve({st:toeflSpeakingTests,TOEFL_SPTests:TOEFL_SPTests})}):defer.resolve({st:[],TOEFL_SPTests:TOEFL_SPTests}),defer.promise}(TOEFL_SPTests).then(function(sptData){sptData.st.forEach(function(v){res.data.AvailableTest.push(v)}),TOEFL_SPTests=sptData.TOEFL_SPTests,defer.resolve(res)})}else console.log("Error in getTests."),defer.resolve(null)}),defer.promise},getTestsResult:function(){var defer=$q.defer(),ishasSPTest=hasSPTest();ishasSPTest?assessmentsService.getTOEFLCoursesData().then(function(res){TOEFL_SPTests=res.TOEFL_SPTests,getTestsResultAndResolve(ishasSPTest,defer)}):getTestsResultAndResolve(ishasSPTest,defer);return defer.promise;function getTestsResultAndResolve(ishasSPTest,defer){assessmentsService.getTestsResult(ishasSPTest).then(function(res){res.data.forEach(function(v){var profTest=proficentyTests.tests.find(function(pt){return pt.id==v.TestId});void 0!==profTest&&(v.proficency=!0,v.TestName="",v.CourseName=profTest.testName),void 0!==v.TestId&&delete v.TestId}),res.data=formatTOEFLCourseName(res.data),ishasSPTest&&(res.data=res.data.map(function(test){if(test.TestId){var toeflConsts=getTOEFLDataByTOEFLCourseId(TOEFL_SPTests,test.TestId);toeflConsts&&(test.metadata={speakingPracticeTestCourseId:toeflConsts.toeflCourseId},test.CourseName="",test.TestName=edns.toefl.addItalicsForToefl(toeflConsts.testName,!0))}return test})),defer.resolve(res)})}},saveCTUserStateToDB:saveCTUserStateToDB,getUpcomingTests:function(res,onUpcomingTestChanged,schedulerService){var upcomingTests=res;return upcomingTests.forEach(function(tr){if(tr.Conditions){var nofitication=[{Action:0,Condition:tr.Conditions}];tr.lockReason=schedulerService.parseUpcommingTestConditions(nofitication,16),tr.isSchedulerTimeBased=schedulerService.isTimeBased(tr.lockReason),tr.isSchedulerTimeBased&&(tr.ToStartTime=new Date(tr.lockReason.measures[0][0].value)-Date.now())}-1<tr.TestName.toLowerCase().indexOf("toeic")&&(tr.TestName=tr.TestLicenseId===ASSESSMENTS_TEST_CONSTANT.TOEICONLINE?$filter("translate")("369"):$filter("translate")("370")),tr.timespan=TimeSpan.FromSeconds(Math.ceil(tr.ToStartTime/1e3));var e=new Date((new Date).getTime()+tr.timespan.totalMilliseconds()),day=assessmentsBLSharedService.paddchar(e.getDate()),month=assessmentsBLSharedService.paddchar(1+e.getMonth());tr.date=day+"/"+month+"/"+e.getFullYear(),-1<tr.TestName.toLowerCase().indexOf("toeic")&&(30<=e.getSeconds()&&e.setMinutes(e.getMinutes()+1),e.setSeconds(0),tr.hour=assessmentsBLSharedService.paddchar(e.getHours().toString())+":"+assessmentsBLSharedService.paddchar(e.getMinutes().toString())),$interval(function(){tr.timespan.subtractSeconds(1),tr.timespan.totalSeconds()<=0&&-1<tr.timespan.totalSeconds()&&onUpcomingTestChanged()},1e3)}),{upcomingTests:upcomingTests,upcomingTestsCount:res.length}},getAvailableTests:function(res,onAvailiableTestsChanged,isShowTimer){var maximumDaysOfAvailableTest=storageService.get("Community","MaximumDaysOfAvailableTest"),hasTestStarted=!1,totalTests=(tests=res=(res=assessmentsService.filterCanContinueTest(res)).filter(function(test){return!(function(test){return 1==test.ImpTypeFeatureId}(test)&&!0===edns.testEnvironment.testEnvInLA&&function(test){return 1===test.PLTSchemaVersion}(test))}),tests.filter(notToeflSpeakingTest).filter(isTestNotStarted).filter(notUnlimitedPLTIsDone).length),didPLT=isDidPLT(res);var tests;$rootScope.$emit("assesmentsOpened",{totalTests:totalTests,didPLT:didPLT});var myTimers=[],availableTests=res;availableTests.forEach(function(tr,i){-1<tr.TestName.toLowerCase().indexOf("toeic")&&(tr.toeic=!0,tr.TestName=tr.ImpTypeFeatureId===ASSESSMENTS_TEST_CONSTANT.TOEICONLINE?$filter("translate")("369"):$filter("translate")("370")),tr.metadata&&tr.metadata.toeflSpeakingTest||(tr.TestStarted&&(hasTestStarted=!0),tr.timespan=TimeSpan.FromSeconds(Math.ceil(tr.RemainingTime/1e3)),tr.index=i,tr.$totalSeconds=0,tr.days=0==tr.timespan.days()?null:tr.timespan.days(),tr.hours=tr.timespan.hours(),1==tr.hours.toString().length&&(tr.hours="0"+tr.hours),tr.minutes=tr.timespan.minutes(),1==tr.minutes.toString().length&&(tr.minutes="0"+tr.minutes),tr.seconds=tr.timespan.seconds(),1==tr.seconds.toString().length&&(tr.seconds="0"+tr.seconds),0<tr.timespan.totalSeconds()&&(myTimers[i]=$interval(function(){if(null!==tr){if(tr.timespan.subtractSeconds(1),tr.$totalSeconds<tr.timespan.totalSeconds()){var sumOfSeconnds=tr.timespan.totalSeconds()-tr.$totalSeconds;0!=tr.$totalSeconds&&tr.timespan.subtractSeconds(sumOfSeconnds)}else tr.$totalSeconds=tr.timespan.totalSeconds();if(tr.$totalSeconds=tr.timespan.totalSeconds(),(tr.timespan.totalSeconds()<=0||tr.$totalSeconds<=0)&&isShowTimer(tr))return clearInterval(myTimers[tr.index].$$intervalId),void onAvailiableTestsChanged();tr.days=0==tr.timespan.days()?null:tr.timespan.days(),tr.hours=tr.timespan.hours(),1==tr.hours.toString().length&&(tr.hours="0"+tr.hours),tr.minutes=tr.timespan.minutes(),1==tr.minutes.toString().length&&(tr.minutes="0"+tr.minutes),tr.seconds=tr.timespan.seconds(),1==tr.seconds.toString().length&&(tr.seconds="0"+tr.seconds),tr.days>=maximumDaysOfAvailableTest&&(tr.seconds=null)}},1e3)),tr.days>=maximumDaysOfAvailableTest&&(tr.seconds=null))});hasTestStarted&&saveCTUserStateToDB();return{tests:availableTests,availableTestsCount:res.length,showAvailableTestsTable:0<res.length}},startTest:function(TestType,testName,url,testStarted,metadata){if(-1<testName.toLowerCase().indexOf("toeic"))return window.open(url),void $rootScope.$broadcast("CloseAllModals");if(metadata&&metadata.speakingPracticeTestCourseId){var toeflConsts=getTOEFLDataByTOEFLCourseId(TOEFL_SPTests,metadata.speakingPracticeTestCourseId),url=toeflConsts.testPath+"?CID="+metadata.speakingPracticeTestCourseId+"&lang="+getToeflSpeakingLang(toeflConsts),winName="toeflSpeakingTest";return edns.utils.popupWins.openWindow(url,winName,null),void $rootScope.$broadcast("CloseAllModals")}var address="",winName="";switch(TestType){case 2:case 3:address="CourseTest/CTIntro.aspx",winName="CourseTest";break;default:address="PlacementTest/PlacementIntro.aspx?pOnline=true",winName="PlacementTest"}siteNavService.openTestsInOldSite(address,winName,TestType,null,null,testStarted)},startTestInLA:function(test){if(-1<test.TestName.toLowerCase().indexOf("toeic")&&test.TestURL)return window.open(test.TestURL),void $rootScope.$broadcast("CloseAllModals");if(test.metadata&&test.metadata.speakingPracticeTestCourseId){var toeflConsts=getTOEFLDataByTOEFLCourseId(TOEFL_SPTests,test.metadata.speakingPracticeTestCourseId),url=toeflConsts.testPath+"?CID="+test.metadata.speakingPracticeTestCourseId+"&lang="+getToeflSpeakingLang(toeflConsts);return edns.utils.popupWins.openWindow(url,"toeflSpeakingTest",null),void $rootScope.$broadcast("CloseAllModals")}var CourseName,TestName,isContinue=test.TestStarted;TestName=test.proficency?(CourseName="",test.CourseName):(CourseName=test.CourseName,test.TestName);var CourseId=test.CourseId||"-1",TestType=test.ImpTypeFeatureId||"-1";storageService.set("TestEnv",CourseName,"CourseName",!0),storageService.set("TestEnv",TestName,"TestName",!0),storageService.set("TestEnv",isContinue,"Continue",!0),storageService.set("TestEnv",CourseId,"CourseId",!0),storageService.set("TestEnv",TestType,"TestType",!0),siteNavService.openTestsInLA(TestType,isContinue)},isDisplayUpcommingTestDate:function(upTest){return!(upTest.lockReason||!upTest.date)||!!upTest.lockReason&&!!upTest.isSchedulerTimeBased},isDisplayUpcommingTestLock:function(upTest){return upTest.lockReason&&!upTest.isSchedulerTimeBased},getToeflSpeakingTests:function(){var assignedCourses=JSON.parse(localStorage.getItem("Courses")),testBase={TestName:"",metadata:{toeflSpeakingTest:!0}};return toeflSpeakingTests=assignedCourses.filter(isCourseHasTOEFLCourseTest.bind(this,TOEFL_SPTests)).map(function(v){var test=JSON.parse(JSON.stringify(testBase)),toeflConsts=getTOEFLDataByEDCourseId(TOEFL_SPTests,v.CourseId);return test.metadata.speakingPracticeTestCourseId=toeflConsts.toeflCourseId,test.TestName=edns.toefl.addItalicsForToefl(toeflConsts.testName,!0),test}),toeflSpeakingTests},getTOEFLSpeakingFeedBackURL:function(metadata){var toeflConsts=getTOEFLDataByTOEFLCourseId(TOEFL_SPTests,metadata.CourseId),CID=toeflConsts.toeflCourseId,lang=getToeflSpeakingLang(toeflConsts);return toeflConsts.feedbackPath+"?courseType=PC&CID="+CID+"&lang="+lang},isShowTimer:function(avTest){if(avTest.toeic)return!0;return 1!==avTest.ImpTypeFeatureId||2==avTest.PLTSchemaVersion&&0==avTest.UnlimitedTest}};function saveCTUserStateToDB(){assessmentsService.saveUserStateToDB(!0,!0,!1)}function notToeflSpeakingTest(test){return!(test.metadata&&!0===test.metadata.toeflSpeakingTest)}function isTestNotStarted(test){return!test.TestStarted}function notUnlimitedPLTIsDone(test){return!function(test){return isPLT(test)&&test.UnlimitedTest&&test.DidTest}(test)}function isDidPLT(tests){var test,pltTest=tests.find(isPLT);return pltTest?2==pltTest.PLTSchemaVersion?(test=pltTest).UnlimitedTest?test.DidTest:test.TestStarted:pltTest.DidTest:null}function isPLT(test){return 1==test.ImpTypeFeatureId}function hasSPTest(){var noSpeakingPracticeTest=JSON.parse(localStorage.getItem("Community")).NoSpeakingPracticeTest;return!(noSpeakingPracticeTest&&"1"===noSpeakingPracticeTest)}function getToeflSpeakingLang(toefl){var availLangs=toefl.langs,userLang=sharedGetLang(),TOEFLMappedLang=availLangs.filter(function(v){return v[userLang]});return 0<TOEFLMappedLang.length?TOEFLMappedLang[0][userLang]:"eng"}function formatTOEFLCourseName(data){return data.forEach(function(vv){vv.CourseName&&(vv.CourseName=edns.toefl.wrapFromTOEFLToReg(vv.CourseName))}),data}function isCourseHasTOEFLCourseTest(TOEFL_SPTests,v){return null!==getTOEFLDataByEDCourseId(TOEFL_SPTests,v.CourseId)}function getTOEFLDataByEDCourseId(TOEFL_SPTests,courseId){var tests=TOEFL_SPTests.filter(function(spt){return 0<spt.edCourseIds.filter(function(v){return v===courseId}).length});return 0<tests.length?tests[0]:null}function getTOEFLDataByTOEFLCourseId(TOEFL_SPTests,courseId){var tests=TOEFL_SPTests.filter(function(spt){return spt.toeflCourseId===courseId});return 0<tests.length?tests[0]:null}}])}(angular),function(angular){angular.module("common").service("assessmentsBLTOEICService",["$q","$filter","$rootScope","$modal","storageService","assessmentsDALTOEICService",function($q,$filter,$rootScope,$modal,storageService,assessmentsDALTOEICService){if(edns.toeic.isToeic)var toeicInformation=storageService.get("toeicInformation"),testTypes=(toeicInformation.toeicDistributorId,{989011001:{localizedName:"502",numbering:""},989010001:{localizedName:"502",numbering:""},40653:{localizedName:"503",numbering:""},143541:{localizedName:"503",numbering:""},1539e3:{localizedName:"503",numbering:"I"},154e4:{typeId:5,localizedName:"503",numbering:"II"},989053976:{typeId:3,localizedName:"502",numbering:""},989054594:{typeId:4,localizedName:"503",numbering:""}}),assignedCourses=null,userCoursesMap=null,_userCourses=null,CTMappingData=null,CTMappingDataDeferreds=[],isGettingCTMapping=!1,lastProgressCourseId=null,failMessage={messageTxt:$filter("translate")("1213"),btnTxt:$filter("translate")("312")};return{isToeic:edns.toeic.isToeic,GetUserTests:function(userCourses){userCourses||(userCourses=_userCourses);return assessmentsDALTOEICService.GetUserTests(userCourses)},getAssignedCourses:getAssignedCourses,formatUserTests:function(courses){var res=[];return courses.forEach(function(v){v.Value.forEach(function(vv){vv.courseId=v.Key,vv.testName=getLocalizedTestName(vv.courseTestId,v.Key,vv.testName),res.push(vv)})}),res},formatUserTestsRes:function(courses){var res=[];return courses.forEach(function(v){v.UserTests.forEach(function(vv){vv.courseId=v.CourseId,vv.courseTest.testName=getLocalizedTestName(vv.courseTest.courseTestId,vv.courseId,vv.testName),res.push(vv)})}),res},startTest:function(failmessage,testId,testType,courseId){var TICourseMetadata=toeicInformation.toeicEDCoursesMappers.find(function(v){return v.toeicId==courseId}).metadata,isBridge=TICourseMetadata&&TICourseMetadata.isBridge;edns.toeic.gotoCourseTest(testId,testType,courseId,isBridge,failMessage)}.bind(null,failMessage),GetUserTestResultsRange:function(){_userCourses||setAssignedCourses();return assessmentsDALTOEICService.GetUserTestResultsRange(_userCourses)},GetCourseResultsRange:function(EDCourseId){userCoursesMap||setAssignedCourses();var TOEICCourseId=_.find(userCoursesMap,function(v){return v.CourseId==EDCourseId}).toeicId;return assessmentsDALTOEICService.GetUserTestResultsRange(TOEICCourseId)},updateTestState:function(TOEICAsyncCallsresolved,testResults,availableTests){if(0!==TOEICAsyncCallsresolved)return testResults},viewToeicTestResults:function(failmessage,testId,courseId){edns.toeic.gotoCourseTestViewResults(testId,courseId,failmessage)}.bind(null,failMessage),getCourseTestScoreRange:function(testId,skill,grade){var defer;defer=$q.defer(),CTMappingData?defer.resolve(getCTRange(testId,skill,grade)):(CTMappingDataDeferreds.push(function(){defer.resolve(getCTRange(testId,skill,grade))}),isGettingCTMapping||(isGettingCTMapping=!0,assessmentsDALTOEICService.getCourseTestMap().then(function(res){CTMappingData=res.data,CTMappingDataDeferreds.forEach(function(deferredCBs){deferredCBs()}),isGettingCTMapping=!1})));return defer.promise},showCourseTestFullReport:function(userTestId,courseId,testId){var iframeUrl=function(userTestId,courseId,testId){var toeicCourseId=0;if(null!=lastProgressCourseId)var toeicInformation=JSON.parse(localStorage.getItem("toeicInformation")),toeicCourseId=_.find(toeicInformation.toeicEDCoursesMappers,function(mapItem){return lastProgressCourseId===mapItem.edId}).toeicId;return edns.toeic.getCourseTestFullReportURL(userTestId,courseId,testId,toeicCourseId)}(userTestId,courseId,testId);console.log(iframeUrl);$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalIframeTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware ModalForContentInIframeW toeicFullReport",backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalTitle:"",modalContent:iframeUrl,iFrameWidth:908,iFrameHeight:538,disableScrollIFrame:!1,modalWidth:450,modalHeight:650}}}});return iframeUrl},setLastProgressCourseId:function(courseId){lastProgressCourseId||(lastProgressCourseId=courseId,setAssignedCourses())}};function getLocalizedTestName(courseTestId,courseId,courseTestName){var edCourseId=_.find(toeicInformation.toeicEDCoursesMappers,function(mapItem){if(courseId===mapItem.toeicId)return mapItem}).edId,testName=_.find(JSON.parse(localStorage.getItem("Courses")),function(course){if(edCourseId===course.CourseId)return course}).courseName,testType=testTypes[courseTestId];return void 0!==testType?testName+" "+$filter("translate")(testType.localizedName)+" "+testType.numbering:courseTestName}function setAssignedCourses(){_userCourses=getAssignedCourses()}function getAssignedCourses(){return assignedCourses=storageService.get("Courses"),(userCoursesMap=assignedCourses.map(function(v){var userCourseMap=_.find(toeicInformation.toeicEDCoursesMappers,function(mapItem){if(v.CourseId===mapItem.edId)return mapItem});return v.toeicId=userCourseMap.toeicId,v})).map(function(v){return v.toeicId})}function getCTRange(testId,skill,grade){var skills,SkillName,CTTypeId=function(testIdToMapId,testId){var testMap=_.find(testIdToMapId,{id:testId});testMap||(testMap=_.find(testIdToMapId,{type:"default"}));return testMap.mapTypeId}(CTMappingData.testIdToMapTypeId,testId),CTSkillsMaps=function(CTM,CTTypeId){return _.find(CTM,{id:CTTypeId})}(CTMappingData.gradeMaps,CTTypeId).skills;return function(skillMap,grade){var isGradeBetweenGradeValues=function(grade,v){return function(v){if(grade>=v.minVal&&grade<=v.maxVal)return v}}(grade);return _.find(skillMap,isGradeBetweenGradeValues)}((skills=CTSkillsMaps,SkillName=skill,_.find(skills,{SkillName:SkillName})).map,grade)}}])}(angular),function(angular){angular.module("common").service("assessmentsBLSharedService",["storageService",function(storageService){return{paddchar:function(obj){if(obj)return 1==obj.toString().length?"0"+obj.toString():obj.toString()},isHideTestScore:function(){return!!storageService.get("Community","HideTestScore")}}}])}(angular),function(angular){angular.module("common").service("assessmentsService",["storageService","$http","COMMON",function(storageService,$http,COMMON){var TOEFLCoursesDataCall,canContinueCourseTest=COMMON.canContinueCourseTest;return{getTestsResult:function(hasSpeakingPracticeTest){var urlBase=COMMON.SERVICE_URL,apiFucionName="AssessmentsDescriptor/getTestsResult/"+(hasSpeakingPracticeTest?"true":"");return $http.get(urlBase+apiFucionName)},hasPlacementTest:function(){var urlBase=COMMON.SERVICE_URL;return $http.get(urlBase+"AssessmentsDescriptor/UserHasPlacementTest/")},getTests:function(){var student=storageService.get("Student"),community=storageService.get("Community"),scheduler=(student.StudentID,!!JSON.parse(localStorage.getItem("Community")).Scheduler),urlBase=COMMON.SERVICE_URL,apiFucionName="AssessmentsDescriptor/getTests/"+("1"==community.PlacementTestShow)+"/"+("1"==community.PTTO)+"/"+scheduler;return $http.get(urlBase+apiFucionName)},getAvailableTests:function(){var student=storageService.get("Student"),community=storageService.get("Community"),studentID=student.StudentID,urlBase=COMMON.SERVICE_URL,apiFucionName="AssessmentsDescriptor/getAvailableTests/"+("1"==community.PlacementTestShow)+"/"+("1"==community.PTTO);return $http.get(urlBase+apiFucionName+"/"+studentID)},getAvailableTestsCount:function(canContinueCourseTest){var community=storageService.get("Community"),urlBase=COMMON.SERVICE_URL,apiFucionName="AssessmentsDescriptor/getAvailableTestsCount/"+canContinueCourseTest+"/"+("1"==community.PlacementTestShow)+"/"+("1"==community.PTTO);return $http.get(urlBase+apiFucionName)},getUpcomingTests:function(){var student=storageService.get("Student"),community=storageService.get("Community"),studentID=student.StudentID,urlBase=COMMON.SERVICE_URL,apiFucionName="AssessmentsDescriptor/getUpcomingTests/"+("1"==community.PlacementTestShow)+"/"+("1"==community.PTTO);return $http.get(urlBase+apiFucionName+"/"+studentID)},saveUserStateToDB:function(doCalc,doDBSave,doRemoveCache){COMMON.SERVICE_URL;return $http.post("WebApi/PracticeManager/SaveUserStateToDB/"+doCalc+"/"+doDBSave+"/"+doRemoveCache)},deleteCTUserStateFromCache:function(){COMMON.SERVICE_URL;return $http.get("WebApi/PracticeManager/RemoveItemStateAsync/")},canContinueCourseTest:canContinueCourseTest,filterCanContinueTest:function(courses){return canContinueCourseTest?courses:courses=courses.filter(function(v){return!v.TestStarted})},getGradebookTotalGrades:function(studentId,courseId){var urlBase=COMMON.SERVICE_URL;return $http.get(urlBase+"AssessmentsDescriptor/GetGradeBookTypeScores/"+courseId)},getTOEFLCoursesData:function(){var urlBase;return(TOEFLCoursesDataCall=TOEFLCoursesDataCall||(urlBase=resPathRoot,edns.network.asyncCall(urlBase+"/Runtime/Metadata/Courses/TOEFLSpeakingTests/TOEFLSpeakingTests.json"))).get()}}}])}(angular),function(angular){angular.module("common").service("assignmentServiceDAL",["$http","COMMON",function($http,COMMON){var urlBase=COMMON.SERVICE_URL+"Assignment/";return{assignPLT:function(){var url=urlBase+"AssignPLT/";return $http.put(url)},getInstitutionCourses:function(){var url=urlBase+"GetInstitutionCourses";return $http.get(url)},learningPathGetAssignedCourses:function(){var urlBase=COMMON.SERVICE_URL;return $http.get(urlBase+"LearningPathAssignment/GetAssignedCourses")},getAssignedCourses:function(){var url=urlBase+"GetAssignedCourses";return $http.get(url)}}}])}(angular),function(angular){angular.module("common").service("assignmentServiceBL",["$q","storageService","assignmentServiceDAL","schedulerDALService",function($q,storageService,assignmentServiceDAL,schedulerDALService){var studentID=storageService.get("Student","StudentID");storageService.get("Community","IID");return{assignPLT:function(){var defer=$q.defer();return assignmentServiceDAL.assignPLT(studentID).then(function(res){res.data?res.data.PLTAssigned?defer.resolve(res.data.PLTResume):defer.resolve(null):(console.log("Error in assignPLT"),defer.resolve(null))}),defer.promise},getCourses:function(isStudentRole,cb,_status_){if(isStudentRole){var autoAssignNextCourse=JSON.parse(localStorage.getItem("Community")).AutoAssignNextCourse;1==autoAssignNextCourse?void 0!==_status_&&0==_status_?getAssignedCourses().then(applyCallback):assignmentServiceDAL.learningPathGetAssignedCourses().then(applyCallback):getAssignedCourses().then(applyCallback)}else assignmentServiceDAL.getInstitutionCourses().then(applyCallback);function applyCallback(res){cb.call(null,res)}}};function getAssignedCourses(){return function(){var scheduler=0|JSON.parse(localStorage.getItem("Community")).Scheduler;1!=scheduler||null==localStorage.getItem("Scheduler")||edns.scheduler.userHasPlan()||(scheduler=0);return scheduler=void 0!==scheduler&&0!=scheduler}()?schedulerDALService.getSchedulerAssignedCourses():assignmentServiceDAL.getAssignedCourses()}}])}(angular),window.angular.module("common").factory("notificationsService",["storageService",function(storageService){return{systemCheck:function(storageService){var alertsTotal=0,hasAlerts=!1;return{checkAlerts:function(){var mediaType;hasAlerts="true"===sessionStorage.getItem("MediaAlertMenuNotification")&&(alertsTotal=0,!!(alertsTotal+=(mediaType="SR",!parseInt(storageService.getCookie("Media",mediaType),10))))},hasAlerts:function(){return hasAlerts},getAlertsTotal:function(){return alertsTotal}}}(storageService)}}]),function(angular){angular.module("common").factory("acuityZoomScheduleService",["$http","COMMON",function($http,COMMON){return{GetAcuityTeacherForStudent:function(studentId){var urlBase=COMMON.SERVICE_URL+"AcuityZoom/";return $http({cache:!0,url:urlBase+"GetAcuityTeacherForStudent/"+studentId,method:"GET"})},GetStudentAppointments:function(studentId){var urlBase=COMMON.SERVICE_URL+"AcuityZoom/";return $http({cache:!1,url:urlBase+"GetStudentAppointments/"+studentId,method:"GET"})}}}])}(angular),function(angular){angular.module("common").service("notificationsCenterDALService",["$http","$rootScope","storageService",function($http,$rootScope,storageService){return{hasNotificationsCenterMessages:function(){var studentID=storageService.get("Student","StudentID"),url="asdasdasd/api/hasNotificationsCenterMessages/"+studentID;return $http.get(url)}}}])}(angular),function(angular){angular.module("common").service("onlineSessionsBLDALService",["$http","storageService","$q","COMMON",function($http,storageService,$q,COMMON){var urlBase=COMMON.SERVICE_URL+"OnlineSessions/",InstitutionProperty="OnlineSessions";return{hasUpcomingOnlineSessions:function(){var defer=$q.defer();hasInstitutionProperty()||defer.resolve(null);return(url=urlBase+"GetUserOnlineSessionsCount",$http.get(url)).then(function(res){res.data&&defer.resolve(0<res.data)}),defer.promise;var url},get:function(){var defer=$q.defer();hasInstitutionProperty()||defer.resolve(null);return(url=urlBase+"GetUserOnlineSessionList",$http.get(url)).then(function(res){res.data&&defer.resolve(res.data.map(formatDates))}),defer.promise;var url},hasInstitutionProperty:hasInstitutionProperty};function hasInstitutionProperty(){return!!storageService.get("Community",InstitutionProperty)}function formatDates(v){return v.startDate=formatDate(v.StartTime),v.endDate=formatDate(v.EndTime),v}function formatDate(v){var d=new Date(v+"+00:00");return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][d.getDay()]+" "+d.getDate()+"/"+(d.getMonth()+1)+" "+(padZeros(d.getHours(),2)+":"+padZeros(d.getMinutes(),2))+" "+("(UTC"+function(v){var diffInMin=-1*v.getTimezoneOffset(),hours=Math.floor(diffInMin/60),minutes=diffInMin%60;return(0<=diffInMin?"+":"-")+padZeros(hours,2)+":"+padZeros(minutes,2)}(d)+")")}function padZeros(number,length){for(var str=""+number;str.length<length;)str="0"+str;return str}}])}(angular),window.angular.module("common").controller("lockPopoverCtrl",["$rootScope","$scope","$filter","schedulerService",function($rootScope,$scope,$filter,schedulerService){var ctrl=this;ctrl.scope=$scope,ctrl.lockReason=$scope.data.lockReason,ctrl.isTimeBased=!1,ctrl.availiableOn="",function(){if(ctrl.isTimeBased=schedulerService.isTimeBased(ctrl.lockReason),ctrl.isTimeBased){var formattedTimeBasedData=schedulerService.formatTimeBasedData(ctrl.lockReason);ctrl.timePartsUntilAssign=formattedTimeBasedData.timePartsUntilAssign,ctrl.remainingPercentageProgressBar=formattedTimeBasedData.remainingPercentageProgressBar,ctrl.availiableOn=formattedTimeBasedData.availiableOn}ctrl.title=$filter("translate")(ctrl.lockReason.title,{availiableOn:ctrl.availiableOn}),$rootScope.$on("$translateChangeSuccess",function(event,current,previous){ctrl.title=$filter("translate")(ctrl.lockReason.title,{availiableOn:ctrl.availiableOn})})}()}]),function(angular){angular.module("common").controller("assessmentsCtrl",["$q","schedulerService","$scope","$rootScope","assessmentsService","$timeout","$modal","assessmentsBLSharedService","assessmentsBLEDService","assessmentsBLTOEICService","schedulerService",function($q,schedulerService,$scope,$rootScope,assessmentsService,$timeout,$modal,assessmentsBLSharedService,assessmentsBLEDService,assessmentsBLTOEICService,schedulerService){$scope.counter=0,$scope.onTimeout=function(){$scope.counter++,mytimeout=$timeout($scope.onTimeout,1e3)};var mytimeout=$timeout($scope.onTimeout,1e3);$scope.stop=function(){$timeout.cancel(mytimeout)};var ctrl=this,scope=$scope;scope.availableTestsCount=0,scope.upcomingTestsCount=0,scope.testResultsCount=0,scope.showAvailableTestsTable=!1,scope.showUpcomingTestsTable=!1,scope.showTestResultsTable=!1,ctrl.testResults=[],ctrl.availableTests=[],ctrl.upcomingTests=[],ctrl.isToeic=!1,ctrl.isDisplayUpcommingTestDate=assessmentsBLEDService.isDisplayUpcommingTestDate,ctrl.isDisplayUpcommingTestLock=assessmentsBLEDService.isDisplayUpcommingTestLock,ctrl.hideTestScore=assessmentsBLSharedService.isHideTestScore(),ctrl.testEnvInLA=edns.testEnvironment.testEnvInLA,ctrl.init=function(){if($rootScope.isStudentRole){getCompositeCookie("Community","SpeakingPracticeTest");if(assessmentsBLTOEICService.isToeic){ctrl.isToeic=!0,$rootScope.$on("toeicCourseTestSubmitted",function(e,args){});var userTests=JSON.parse(localStorage.getItem("toeicInformation")).userTests;function setUserTests(userTests){ctrl.availableTests=assessmentsBLTOEICService.formatUserTests(userTests),scope.availableTestsCount=ctrl.availableTests.length,scope.showAvailableTestsTable=!!(0<scope.availableTestsCount),0}userTests?setUserTests(userTests):assessmentsBLTOEICService.GetUserTests().then(function(tests){tests.data.d&&setUserTests(tests.data.d)}),assessmentsBLTOEICService.GetUserTestResultsRange().then(function(testsRes){testsRes.data.d&&(ctrl.testResults=assessmentsBLTOEICService.formatUserTestsRes(testsRes.data.d),scope.testResultsCount=ctrl.testResults.length,0)})}else{function getTest(){assessmentsBLEDService.getTests().then(function(res){if(null!==res){var upcomingTestsNotRepeat=function(res){return _.filter(res.data.UpcomingTest,function(ut){return!schedulerService.isUpcomingTestIsRepeat(ut.Conditions)})}(res),availableTests=assessmentsBLEDService.getAvailableTests(res.data.AvailableTest,ctrl.init,assessmentsBLEDService.isShowTimer);ctrl.availableTests=availableTests.tests,scope.availableTestsCount=availableTests.availableTestsCount,scope.showAvailableTestsTable=availableTests.showAvailableTestsTable;var upcomingTests=assessmentsBLEDService.getUpcomingTests(upcomingTestsNotRepeat,onUpcomingTestChanged,schedulerService);ctrl.upcomingTests=upcomingTests.upcomingTests,scope.upcomingTestsCount=upcomingTests.upcomingTestsCount}})}function onUpcomingTestChanged(){scope.showUpcomingTestsTable=!1,scope.showTestResultsTable=!1,ctrl.init()}assessmentsBLEDService.getTestsResult().then(function(res){-1<res.headers()["content-type"].indexOf("json")?(ctrl.testResults=res.data,scope.testResultsCount=res.data.length):console.log("Error in getTestsResult, got a non-json response")}),schedulerService.userHasPlan()&&schedulerService.hasDateCondition()?schedulerService.execUserPlan(null,!1).then(getTest):getTest()}}},ctrl.startTest=function(TestType,testName,url,$totalSeconds,testStarted,metadata,$event){assessmentsBLEDService.startTest(TestType,testName,url,testStarted,metadata)},ctrl.startTestInLA=function(test,$event){assessmentsBLEDService.startTestInLA(test)},ctrl.startToeicTest=function(testId,testType,courseId,$event){$event&&$event.preventDefault(),assessmentsBLTOEICService.startTest(testId,testType,courseId),$scope.$emit("closeMyAssessmentsModal")},ctrl.viewToeicTestResults=function(testId,courseId,$event){$event&&$event.preventDefault(),assessmentsBLTOEICService.viewToeicTestResults(testId,courseId),$scope.$emit("closeMyAssessmentsModal")},ctrl.viewToeicFullReport=function(userTestId,courseId,testId){iframeUrl=assessmentsBLTOEICService.showCourseTestFullReport(userTestId,courseId,testId),$scope.$emit("closeMyAssessmentsModal")},ctrl.openSpeakingPracticeTestScore=function(test){var url=assessmentsBLEDService.getTOEFLSpeakingFeedBackURL({CourseId:test.metadata.speakingPracticeTestCourseId}),lastCurrentPage=$rootScope.currentPage;$rootScope.currentPage="toeflSpeakingTestReview",$scope.$on("modalClosed",function(){$rootScope.currentPage=lastCurrentPage,edns.ping.closeOnLogout.modals.remove(ctrl.toeflSpeakingTestReviewModalInstance)}),ctrl.toeflSpeakingTestReviewModalInstance=$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalIframeTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware ModalForContentInIframeW toeflSPReviewModal",backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalTitle:"",modalContent:$rootScope.root+url,iFrameWidth:920,iFrameHeight:560}}}}),$rootScope.$broadcast("closeMyAssessmentsModal"),edns.ping.closeOnLogout.modals.add(ctrl.toeflSpeakingTestReviewModalInstance)},ctrl.showAvailableTests=function(){scope.showAvailableTestsTable?scope.showAvailableTestsTable=!1:(scope.showAvailableTestsTable=!0,scope.showUpcomingTestsTable=!1,scope.showTestResultsTable=!1)},ctrl.showUpcomingTests=function(){scope.showUpcomingTestsTable?scope.showUpcomingTestsTable=!1:(scope.showUpcomingTestsTable=!0,scope.showAvailableTestsTable=!1,scope.showTestResultsTable=!1)},ctrl.showTestResults=function(){scope.showTestResultsTable?scope.showTestResultsTable=!1:(scope.showTestResultsTable=!0,scope.showAvailableTestsTable=!1,scope.showUpcomingTestsTable=!1)},ctrl.convertToeicTestDate=function(dateString){return dateString.match(/\d+/g)[0]},ctrl.isShowTimer=assessmentsBLEDService.isShowTimer,ctrl.init()}])}(angular),function(angular){var commonModule=window.angular.module("common");commonModule&&commonModule.controller("siteNavCtrl",["$scope","$rootScope","$state","storageService","$translate","$filter","$modal","$location","siteNavService","$interval","authService","institutionService","assessmentsService","sitenavNotificationsService","pubSubService","schedulerService","assignmentServiceBL",function($scope,$rootScope,$state,storageService,$translate,$filter,$modal,$location,siteNavService,$interval,authService,institutionService,assessmentsService,sitenavNotificationsService,pubSubService,schedulerService,assignmentServiceBL){var ctrl=this;function ping(){if(!localStorage.getItem("ATPreviewMode")){var userId=getCompositeCookie("Student","StudentID");null==userId?($interval.cancel(pingInterval),checkSessionInterval&&$interval.cancel(checkSessionInterval),-1==location.href.toLowerCase().indexOf("/login")&&(location.href=$rootScope.root+"/"+getCompositeCookie("Community","alias")+"#/Login")):$rootScope.showLoginViews||authService.ping(userId).then(function(response){if(response.data&&response.data.SessionEnds&&onSessionTimeout(),response.data&&response.data.ThreeMinutesBeforeSessionEnds){window.postMessage("ThreeMinutesBeforeSessionEnds","*");var markArr=localStorage.getItem("markArr"),visitedItems=localStorage.getItem("visitedItems");""!=markArr&&""!=visitedItems&&authService.pingEndSession(userId,markArr,visitedItems).then(function(){localStorage.setItem("markArr",""),localStorage.setItem("visitedItems","")})}})}}$rootScope.navOpened=!!siteNavService.getNavStatus(),$scope.enableOverlay="Learning"===$rootScope.currentPage,$scope.buttonTitle,$rootScope.isStudentRole="1"!=storageService.get("Student","StudentPlatform"),ctrl.myAssignmentModal,ctrl.isDisabled=!1,ctrl.alertsCount=0,ctrl.isLearningArea=!(void 0===window.isLearningArea||!window.isLearningArea),ctrl.isInTestEnvironment=$rootScope.isInTestEnvironment=!!siteNavService.isInTestEnvironment(),ctrl.edns=edns,$scope.IsTablet=bMobile,ctrl.showItemsByInst={sitemenu__itemHome:!ctrl.isLearningArea,sitemenu__itemInstPage:!0,sitemenu__itemCommunity:!0,sitemenu__itemMyAssignments:!0,sitemenu__itemTests:!0,sitemenu__itemMessages:!0,sitemenu__itemGrammarBook:!0,sitemenu__itemAboutUs:!1},ctrl.hideItemsInLearningArea={sitemenu__itemInstPage:!1,sitemenu__itemCommunity:!1,sitemenu__itemTests:!1,sitemenu__itemAboutUs:!0},$scope.openGrammarBook=function(){$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalIframeTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware ModalForContentInIframeW grammerBookModal",backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalTitle:"Grammar Book",modalContent:$rootScope.root+"/Runtime/GrammarBook/GrammarBook.aspx",modalWidth:450,modalHeight:650}}}})},$scope.openAboutUs=function(){$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware aboutUsModal",backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalTitle:"",modalContent:$rootScope.root+"/Templates/shared/aboutUs.html",controller:"footerCtrl",modalWidth:700,modalHeight:370}}}})};var pingInterval=$interval(ping,edns.appToken.api.getPingInterval());function checkSession(){localStorage.getItem("ATPreviewMode")||authService.checkSession()}ping();var checkSessionDelay=edns.appToken.api.getCheckSessionDelay();if(checkSessionDelay){var checkSessionInterval=$interval(checkSession,checkSessionDelay);$rootScope.$on("userLogout",function(){$interval.cancel(pingInterval),$interval.cancel(checkSessionInterval)}),checkSession()}function onSessionTimeout(){if(localStorage.setItem("closed","true"),$rootScope.isLogedin=!1,$interval.cancel(pingInterval),checkSessionInterval&&$interval.cancel(checkSessionInterval),edns.appToken.remove(),storageService.DelCookie("Student"),""==$location.path()){storageService.setCookie("stateBeforeLogin","stateBeforeLogin");var cDomain=storageService.get("Community","CannonicalDomain")||"",community=edns.domains.isHostedDomain(cDomain)?"":getCompositeCookie("Community","alias");location.href=$rootScope.root+"/"+community+"#/SessionTimeout"}else $location.path("/SessionTimeout")}function hideNavItemsByInst(){var InstitutionsDataStorage=storageService.session.get("InstitutionsData");InstitutionsDataStorage&&InstitutionsDataStorage.displaySiteNav&&(ctrl.showItemsByInst=$.extend(ctrl.showItemsByInst,InstitutionsDataStorage.displaySiteNav)),InstitutionsDataStorage&&InstitutionsDataStorage.learningAsAng&&"learning"===$rootScope.currentPage.toLowerCase()&&(ctrl.showItemsByInst=$.extend(ctrl.showItemsByInst,ctrl.hideItemsInLearningArea))}function onLoginSucceeded(){$rootScope.loginSucceededSiteNav=!1,ctrl.notif.assessments.getCountFromServer(),1==storageService.get("Community","AutoAssignCourseByPLTResults")&&$rootScope.isStudentRole&&(edns.testEnvironment.testEnvInLA?assignmentServiceBL.assignPLT().then(function(res){null!==res&&siteNavService.setIsContinueAndGoToTestInLA(res)}):siteNavService.openTestsInOldSite("PlacementTest/PlacementIntro.aspx?pOnline=true","PlacementTest",0,null,!0)),edns.testEnvironment.testEnvInLA&&null!==getCompositeCookie("PLTExternal","IID")&&$rootScope.isStudentRole&&siteNavService.goToTestInLA()}institutionService.setData(),hideNavItemsByInst(),ctrl.notif||(ctrl.notif={},pubSubService.subscribe($scope,"assessmentsChanged",function(event,payload){ctrl.notif.assessments=payload,ctrl.alertsCount=sitenavNotificationsService.siteNav.countAlerts()}),ctrl.notif.assessments=sitenavNotificationsService.siteNav.set("assessments"),pubSubService.subscribe($scope,"assignmentsChanged",function(event,payload){ctrl.notif.assignments=payload,ctrl.alertsCount=sitenavNotificationsService.siteNav.countAlerts()}),ctrl.notif.assignments=sitenavNotificationsService.siteNav.set("assignments"),ctrl.notif.inbox=sitenavNotificationsService.siteNav.set("inbox"),pubSubService.subscribe($scope,"inboxChanged",function(event,payload){ctrl.notif.inbox.count=payload.count,ctrl.notif.inbox.uiCount=99<ctrl.notif.inbox.count?"99+":ctrl.notif.inbox.count,ctrl.alertsCount=sitenavNotificationsService.siteNav.countAlerts()}),ctrl.notif.inbox.getCount(ctrl.notif.inbox)),ctrl.getTotalTests=function(){},$scope.$parent.$on("InstitutionsDataLoaded",function(){hideNavItemsByInst()}),$scope.GoToOldUxPage=function(address,winName){if($rootScope.isStudentRole||"inbox"!==winName){localStorage.setItem("bFromPromtion",!1);var url=siteNavService.tabsManager(address,winName);url&&siteNavService.goToOldSite(url,winName,"")}},$scope.navigateCommunity=function(){window.location.href=$rootScope.root+"/"+getCompositeCookie("Community","alias")+"#/community"},$scope.navigateHome=function(e){if(e.preventDefault(),"Learning"==$rootScope.currentPage){if("undefined"!=typeof learningArea){var lsPlayer=learningArea.getLessonPlayer();if(lsPlayer&&lsPlayer.taskWarning){if(!confirm(lsPlayer.taskWarning))return;lsPlayer.taskWarning=null}}else if(courseManager&&courseManager.lsPlayer&&courseManager.lsPlayer.taskWarning){if(!confirm(courseManager.lsPlayer.taskWarning))return;courseManager.lsPlayer.taskWarning=null}for(var i=0;i<openPopups.length;i++)openPopups[i]&&openPopups[i].closed}void 0===window.InTest||1!=InTest?window.location.href=siteNavService.homeUrl():(document.dispatchEvent(document.navigationRequested),document.addEventListener("NavigationConfirmed",function(){window.location.href=siteNavService.homeUrl()}))},$scope.toggleSiteMenu=function(e){$rootScope.navOpened=!$rootScope.navOpened,siteNavService.setNavStatus($rootScope.navOpened),$scope.updateButtonTitle(),e.preventDefault()},$scope.showTooltip="",$scope.hoverIn=function(el){$scope.showTooltip=el},$scope.hoverOut=function(){$scope.showTooltip=""},$scope.updateButtonTitle=function(){$scope.buttonTitle=!0===$rootScope.navOpened?"148":"149"},$scope.openInstPage=function(){var currentRoot=$rootScope.root.replace("https","http"),address=currentRoot+"/Runtime/InstitutionPage/Institution.html?root="+currentRoot,url=siteNavService.tabsManager(address,"institutionPage");url&&siteNavService.goToInstitutionPage(url,"InstitutionPage","","location=1,status=1,scrollbars=0,width=710,height=455,left=100,top=100")},$scope.openAssessments=function(){$rootScope.currentPage="Assesments",$scope.$on("modalClosed",function(){$rootScope.currentPage=$location.path().replace("/","")||"Learning",edns.ping.closeOnLogout.modals.remove(ctrl.assessmentsModalInstance)}),ctrl.assessmentsModalInstance=$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware assesmentsModal",backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalTitle:$filter("translate")("126"),modalContent:$rootScope.root+"/Templates/assessments.html",controller:"assessmentsCtrl",modalWidth:450,modalHeight:650}}}}),edns.ping.closeOnLogout.modals.add(ctrl.assessmentsModalInstance)},$rootScope.$on("closeMyAssessmentsModal",function(){ctrl.assessmentsModalInstance&&(ctrl.assessmentsModalInstance.close(),$rootScope.currentPage=null,edns.ping.closeOnLogout.modals.remove(ctrl.assessmentsModalInstance))}),ctrl.openMyAssignments=function(){if($rootScope.isStudentRole){var modalParentEl=0<$(".home__IW").length?$(".home__IW"):$("body");$rootScope.currentPage="Assignments",ctrl.myAssignmentModal=edns.modalManager.custom({iFrameUrl:"/Runtime/MyRecordings/MyRecordings.html?fromTMS=0",iFrameHeight:710,iFrameWidth:1024,showCloseBtn:!1,windowClass:"myAssignmentsModal",$modalParentEl:modalParentEl})}},ctrl.closeMyAssignments=function(){$rootScope.currentPage=$location.path().replace("/","")||"Learning",$scope.$apply(),ctrl.myAssignmentModal.close()},ctrl.closeTestEnv=function(){siteNavService.tryCloseTestArea()},$scope.openModal=function(modalName){var contentFileName,modalCssWrapperName;switch(modalName="my_assessments"===modalName?"assesments":modalName){case"my_assessments":contentFileName=$rootScope.root+"/Runtime/bootstrapMyAssessments.html",modalCssWrapperName="myAssessmentModal";break;case"assesments":contentFileName=$rootScope.root+"/Runtime/Context/general/modal_placeholder_assesments_o1.png",modalCssWrapperName="assesmentModal"}$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalIframeTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware ModalForContentInIframeW "+modalCssWrapperName,keyboard:!1,resolve:{pageParams:function(){return{modalContent:contentFileName,modalWidth:530,modalHeight:650}}}})},setTimeout($scope.updateButtonTitle,200),$rootScope.$on("navStatus",function(e,args){$rootScope.navOpened=args.opened,siteNavService.setNavStatus($rootScope.navOpened)}),!0===$rootScope.loginSucceededSiteNav&&onLoginSucceeded(),$rootScope.$on("loginSucceeded",function(e,args){onLoginSucceeded()}),$scope.$on("$destroy",function(){$rootScope.onHPLoadEventHandler(),startedTestEH(),notCompletedTestEH(),completedTestEH()}),$rootScope.onHPLoadEventHandler=$rootScope.$on("HPLoaded",function(e,args){checkAssignmentsNotifications()}),$rootScope.$on("eraterFeedbackClosed",function(e,args){checkAssignmentsNotifications()}),$rootScope.$on("assignmentsNotification",function(e,args){ctrl.notif.assignments.setCount(ctrl.notif.assignments,args.readyUnvisited),$scope.$apply()}),$rootScope.$on("assesmentsOpened",function(e,args){null!==args.didPLT&&ctrl.notif.assessments.setPLT(ctrl.notif.assessments,args.didPLT),setTestsNotification(args.totalTests)});var startedTestEH=$scope.$on("startedTest",function(e,args){ctrl.notif.assessments.onStartedTest(ctrl.notif.assessments,args)}),notCompletedTestEH=$scope.$on("notCompletedTest",function(e,args){ctrl.notif.assessments.onNotCompletedTest(ctrl.notif.assessments,args)}),completedTestEH=$scope.$on("completedTest",function(e,args){ctrl.notif.assessments.onClosedTest(ctrl.notif.assessments,args),!ctrl.isLearningArea&&edns.scheduler.userHasPlan()&&"home"!==$state.current.name.toLowerCase()&&schedulerService.execUserPlan(null,!0).then(execUserPlanNotify)});function execUserPlanNotify(data){var testsCount=schedulerService.refreshAfterExecUserPlan(data);0<testsCount&&sitenavNotificationsService.siteNav.set("assessments").addCount(testsCount)}var checkAssignmentsNotifications=function(){ctrl.notif.assignments.getCountFromServer()},setTestsNotification=function(count){ctrl.notif.assessments.setCount(ctrl.notif.assessments,count)};$.subscribe("LANav--closed",function(){ctrl.isDisabled=!1,$scope.$apply()}),$.subscribe("LANav--opened",function(){ctrl.isDisabled=!0,$scope.$apply()}),$.subscribe("closeTestEnv",siteNavService.tryCloseTestArea),$.subscribe("sessionTimeout",onSessionTimeout),window.removeEventListener("sessionTimeout",onSessionTimeout,!1),window.addEventListener("sessionTimeout",onSessionTimeout,!1),$rootScope.$emit("navLoaded"),setTimeout(function(){$.publish("navLoaded")},200)}])}(),window.angular.module("common").controller("footerCtrl",["$scope","$modal","$rootScope","$filter","$sce","langService","$state","whiteLabelService",function($scope,$modal,$rootScope,$filter,$sce,langService,$state,whiteLabelService){var ctrl=this;$scope.configData=null,$scope.community=JSON.parse(localStorage.getItem("Community")),whiteLabelService.getWhiteLabel().then(function(wl){if($scope.configData=wl.footer,void 0!==wl.footer.Exceptions&&0<wl.footer.Exceptions.length)for(var i=0,len=wl.footer.Exceptions.length;i<len;i++)if($scope.community.IID===wl.footer.Exceptions[i].institutionId){$scope.configData=wl.footer.Exceptions[i].configData;break}$scope.show=function(scope){var notice_link,notice_title,modalContent;switch(scope.link.URL){case"#privacy":notice_link="PrivacyStatement",notice_title="5",modalContent=$rootScope.root+"/Localization/"+notice_link+"/"+$scope.community.InstLang+"/"+notice_link+".htm";break;case"#legal":notice_link="LegalNotices",notice_title="4",modalContent=$rootScope.root+"/Localization/"+notice_link+"/"+$scope.community.InstLang+"/"+notice_link+".htm";break;case"#legalTOEIC":notice_link="LegalNotices.html",notice_title="Terms Governing Use of and Access to the TOEIC OLPC Site",modalContent=$rootScope.root+"/Runtime/customIncludes/TOEIC/"+notice_link;break;default:return}$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"footerModal",resolve:{pageParams:function(){return{modalTitle:$filter("translate")(notice_title),modalContent:modalContent}}}})},$scope.getURL=function(obj){return"#privacy"==obj.link.URL||"#legal"==obj.link.URL||"#legalTOEIC"==obj.link.URL?"javascript:void(0)":$filter("whiteLabel")(obj.link.URL)},langService.setLang(),$scope.getCopyrights=function(){return $scope.configData.copyright=$scope.configData.copyright.replace("<year>",$scope.configData.year),$scope.configData.copyright=$filter("translate")($scope.configData.copyright),$scope.configData.copyright=$filter("whiteLabel")($scope.configData.copyright),$scope.configData.rightsTranslated=$filter("translate")($scope.configData.rights),$scope.configData.rightsTranslated=$filter("whiteLabel")($scope.configData.rightsTranslated),$('a[href*="mailto"]').removeAttr("ng-click"),$sce.trustAsHtml($scope.configData.copyright+" "+$scope.configData.rightsTranslated)},ctrl.getPrintDate=function(){function paddZero(val){return val<10?"0"+val:val}var d=new Date;return paddZero(d.getDate())+"/"+paddZero(d.getMonth()+1)+"/"+d.getFullYear()},ctrl.showFooterDate=function(){return $state.is("MyProgress")}})}]),function(angular){var onBoardingController=function($scope,$rootScope,$filter,$timeout,storageService,onBoardingService){var ctrl=this;function isOnBoardingAvailable(){return"home"===$rootScope.currentPage&&!$rootScope.unAssigned}function startOnBoardingProcess(){ctrl.HideWalkthroughOnFirstEntrance||(ctrl.firstTime=!0,ctrl.show=!0,$timeout(function(){ctrl.startSlides()},4))}function showSystemCheck(){$rootScope.$emit("showSystemCheck")}_onBoardSevice=onBoardingService,ctrl.slide=null,ctrl.resizefunction=null,ctrl.scrollFunction=null,ctrl.midClickScrollFunction=null,ctrl.directiveEventsRegistered=!1,ctrl.isRtl=!1,ctrl.HideWalkthroughOnFirstEntrance=!1,$scope.$on("$stateChangeSuccess",function(){$rootScope.$broadcast("onBoardingAvailableChanged",{isBoardingAvailable:isOnBoardingAvailable()})}),$scope.$on("isBoardingAvailable",function(){$rootScope.$broadcast("onBoardingAvailableChanged",{isBoardingAvailable:isOnBoardingAvailable()})}),$rootScope.$broadcast("onBoardingAvailableChanged",{isBoardingAvailable:isOnBoardingAvailable()}),ctrl.load=function(areaId){if(!window.newVersionmsg&&(ctrl.firstTime=!1,ctrl.show=!1,!$rootScope.unAssigned&&areaId)){ctrl.areaId=null!=areaId?areaId:ctrl.areaId;var area=onBoardingService.getAreaById(ctrl.areaId);ctrl.screens=JSON.parse(JSON.stringify(area.slides)),ctrl.reset=area.reset,ctrl.areaState=onBoardingService.getAreasStates(ctrl.areaId);ctrl.HideWalkthroughOnFirstEntrance=!!+storageService.get("Community","HideWalkthroughOnFirstEntrance"),null==ctrl.areaState&&$rootScope.isStudentRole?(localStorage.getItem("viewVersionMessage"),startOnBoardingProcess()):(localStorage.getItem("viewVersionMessage"),showSystemCheck()),localStorage.setItem("viewVersionMessage",!1)}},$rootScope.$on("loadOnboarding",function(event,data){ctrl.load(data)}),$rootScope.$on("openOnboarding",function(){ctrl.firstTime&&ctrl.load(ctrl.areaId),ctrl.show=!0,ctrl.startSlides()}),ctrl.startSlides=function(){if(ctrl.isRtl=!0===storageService.get("isRtlMode"),ctrl.current=0,ctrl.firstTime||"true"!=ctrl.screens[ctrl.current].welcome||ctrl.screens.splice(ctrl.current,1),bMobile&&(ctrl.screens=ctrl.screens.filter(function(slide){return"true"!==slide.skipOnMobile})),showSlide(),edns.mobile.isMobileDevice()){var deviceWidth="device-width";edns.mobile.isMobileIos()&&("Learning"===$rootScope.currentPage?(jQuery("body").css({"min-width":"0",width:"auto"}),deviceWidth="1024px"):jQuery("body").css({"min-width":"0",width:"auto"})),$("#restictViewport").remove(),$("head").append('<meta id="restictViewport" name="viewport" content="width='+deviceWidth+', initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />')}ctrl.UIShow()},showSlide=function(){var slide=ctrl.screens[ctrl.current],noElem;slide.removeIfNotExist&&($.each(slide.removeIfNotExist,function(index,value){if($(value).length<1)return!(noElem=!0)}),noElem&&(ctrl.screens.splice(ctrl.current,1),slide=ctrl.screens[ctrl.current]));slide.actionBefore&&eval("("+slide.actionBefore+")()"),ctrl.slide=slide,ctrl.setNextText(),ctrl.slideInstructions=slide.text},ctrl.next=function(){ctrl.current!==ctrl.screens.length-1?(ctrl.current++,showSlide()):ctrl.close()},ctrl.back=function(){0!==ctrl.current&&(ctrl.current--,showSlide())},ctrl.setNextText=function(){ctrl.current!==ctrl.screens.length-1?ctrl.nextTxt=$filter("translate")("344"):ctrl.nextTxt=$filter("translate")("345")},ctrl.close=function(){ctrl.firstTime&&onBoardingService.setAreaState(),""!=ctrl.reset&&eval("("+ctrl.reset+")()"),ctrl.show=!1,ctrl.UIHide(),showSystemCheck()},ctrl.triggerResourceContextTools=function(selector,eventName){ctrl.triggerEventWithPosition(selector,eventName,0,0),$(".learning__RASegmantationTools").css("left",$(".learning__RASegmantationTools").position().left+$(".learning__RASegmantationTools").width()/2)},ctrl.triggerEventWithPosition=function(selector,eventName,paddingX,paddingY){var $el=$(selector),offset=$el.offset();paddingX=paddingX||0,paddingY=paddingY||0;var event=jQuery.Event(eventName,{which:1,pageX:offset.left+paddingX,pageY:offset.top+paddingY,clientX:offset.left+paddingX,clientY:offset.top+paddingY});$el.trigger(event)},noSlideElem=function(slide){var noElem;return slide.removeIfNotExist&&$.each(slide.elementSelectors,function(index,value){if($(value).length<1)return!(noElem=!0)}),noElem},ctrl.stopProp=function(e){e.stopPropagation()},ctrl.UIShow=function(){$("html, body").addClass("OBOpen"),$(".home__IW").height(),$(".home__IW").wrap('<div class="home__W onBoardingW"></div>'),$(".home__W").css("height",$(window).innerHeight()+"px"),$(document).keydown(KBArrows)},ctrl.UIHide=function(){$("html, body").removeClass("OBOpen"),$(".home__IW").unwrap(),$(".home__IW").css("height",""),$(window).off("resize",ctrl.resizefunction),$(window).off("OnBoarding_redrawCanvas"),(bMobile?"scroll touchmove":"scroll touchmove mousewheel").split(" ").forEach(function(v,i){window.removeEventListener(v,ctrl.scrollFunction)}),bMobile||$(window).off("mousedown",ctrl.midClickScrollFunction),!(ctrl.directiveEventsRegistered=!1)===bMobile&&0<$("#restictViewport").length&&($("#restictViewport").remove(),$("body").css("min-width","").css("width",""),$("head").append('<meta id="restictViewport" name="viewport" content="width=device-width, user-scalable=yes" />')),$(document).unbind("keydown",KBArrows)},KBArrows=function(e){switch(e.which){case 39:$(".onBoarding__next").trigger("click");break;case 37:0<ctrl.current&&$(".onBoarding__back").trigger("click");break;default:return}e.preventDefault()};var screens=storageService.get("onBoarding","screens");null==screens?onBoardingService.getAllAreasScreens(function(){onBoardingService.areaId&&ctrl.load(onBoardingService.areaId)}):onBoardingService.areasScreens=JSON.parse(screens)};angular.module("common").controller("onBoardingCtrl",["$scope","$rootScope","$filter","$timeout","storageService","onBoardingService",onBoardingController])}(window.angular),window.angular.module("common").filter("whiteLabel",[function(){return function(input){if(void 0===input)return"";var chkVal,data=edns.whiteLabel.whiteLabelData;for(var prop in data){var token="<"+prop+">";if(-1<input.indexOf(token))if("companyMail"!==prop)input=input.replace(token,data[prop]);else{var instMail=(chkVal=void 0,"undefined"===(chkVal=getCompositeCookie("Community","ContactLink"))||null===chkVal||""===chkVal?"":chkVal.replace("mailto:",""));input=""!==instMail&&instMail!=data[prop]?input.replace(token,instMail):input.replace(token,data[prop])}}return input}}]),window.angular.module("common").controller("ModalInstanceCtrl",["$scope","$sce","$modalInstance","pageParams","$rootScope","langService","storageService","$location",function($scope,$sce,$modalInstance,pageParams,$rootScope,langService,storageService){$rootScope.modalTitle=pageParams.modalTitle,$scope.modalContent=pageParams.modalContent,$scope.data=pageParams.data,$scope.disableScroll=pageParams.disableScroll,$scope.disableScrollIFrame=(pageParams.disableScrollIFrame,"yes"),$scope.modalWidth=pageParams.modalWidth,$scope.modalHeight=pageParams.modalHeight,$scope.iFrameWidth=pageParams.iFrameWidth,$scope.iFrameHeight=pageParams.iFrameHeight,$scope.modalUrl=$sce.trustAsResourceUrl($scope.modalContent),window.onmessage=function(e){if("closeModal"===e.data)$scope.close();else if("string"==typeof e.data){var key=e.data.substring(0,e.data.indexOf(":")),value=e.data.substring(e.data.indexOf(":")+1);if("FirstName"===key){var student=storageService.get("Student");student.FName=value,storageService.set("Student",student),$rootScope.firstName=value,langService.setLang(),$rootScope.$broadcast("languageUpdated"),$rootScope.$broadcast("communityUpdate")}}},$scope.$on("CloseAllModals",function(){$scope.close()}),$scope.close=function(result){"0"==getCompositeCookie("Student","RCD")?showRCD="0":showRCD="1",$modalInstance.close(result),$rootScope.modalTitle="",$rootScope.$broadcast("modalClosed"),window.explWin&&!window.explWin.closed&&window.explWin.close()},$scope.modalOpenerCtrl=pageParams.modalOpenerCtrl}]),window.angular.module("common").controller("companyPropertiesCtrl",["$scope",function($scope){var data=edns.whiteLabel.whiteLabelData;for(prop in data)$scope[prop]=data[prop]}]),function(angular){var commonModule=angular.module("common");commonModule&&commonModule.controller("settingsMenuCtrl",["$scope","$rootScope","storageService","$translate","$filter","$modal","$location","$document","authService","institutionService","notificationsService","activityService","$state","acuityZoomScheduleService","schedulerService","notificationsCenterDALService","onlineSessionsBLDALService","applicationVariablesBL","userInfo",function($scope,$rootScope,storageService,$translate,$filter,$modal,$location,$document,authService,institutionService,notificationsService,activityService,$state,acuityZoomScheduleService,schedulerService,notificationsCenterDALService,onlineSessionsBLDALService,applicationVariablesBL,userInfo){var $lessonListEl,ctrl=this;function isCourseListAvaliable(){storageService.session.get("InstitutionsData").courseListMenu&&"home"===$state.current.name.toLowerCase()&&0<ctrl.courseList.length?ctrl.courseListAvaliable=!0:ctrl.courseListAvaliable=!1}function closeSettingsMenu(runApply){$scope.itemOpen="",runApply&&$scope.$apply()}ctrl.myAssignmentModal,ctrl.systemCheck={},ctrl.isDisabled=!1,ctrl.courseList=[],$scope.callbacks={},$scope.IsTablet=bMobile,$scope.unavaiableOB=!!$scope.unavaiableOB,ctrl.courseListDisabled=!0,ctrl.courseListAvaliable=!1,ctrl.acuityOnlineLessons=!1,ctrl.onlineSessions=!1,ctrl.isLearningArea=!(void 0===window.isLearningArea||!window.isLearningArea),ctrl.isShowCourseLicenseExpiration=userInfo.isShowCourseLicenseExpiration(),ctrl.isDictionaryDisabled=function(){return window.InTest&&"dictionary"===$scope.itemOpen&&($scope.itemOpen=""),$scope.dictionaryDisabled=window.InTest,window.InTest&&$.publish("closeMenuDictionary"),$scope.dictionaryDisabled||ctrl.disableDictionarySearch},$scope.showItemsByInst={sitemenu__itemStudyPlanner:!0,sitemenu__itemNotificationCenter:!0},$scope.scrollbarOptions=scrollbarOptions={axis:"y",autoHideScrollbar:!1,alwaysShowScrollbar:1,autoExpandScrollbar:!0,advanced:{autoUpdateTimeout:5e3,updateOnContentResize:!0,autoUpdateTimeout:0,updateOnImageLoad:!1},mouseWheel:{enable:!0}},$scope.closeMenuEventName=!0===angular.element(document.querySelector("html")).hasClass("supportedMobiles")?"touchstart":"click",$scope.itemOpen="",$scope.showItem=function($event,item){$scope.itemOpen=$scope.itemOpen!==item?item:"",$event&&$event.preventDefault&&$event.preventDefault(),"dictionary"===item&&window.InTest&&edns.vendors.google.analytics.sendCustomEvent("dictionary",{enabled:!1,source:"settingsMenu"})},$scope.bMobile=bMobile,$rootScope.showItemFromOB=$scope.showItem,$.subscribe("LANav--closed",function(){ctrl.isDisabled=!1,$scope.$apply()}),$.subscribe("LANav--opened",function(){ctrl.isDisabled=!0,$scope.$apply()}),$scope.$on("onBoardingAvailableChanged",function(e,data){$scope.unavaiableOB=!data.isBoardingAvailable}),$rootScope.$broadcast("isBoardingAvailable"),$scope.$on("assignedCourses",function(e,data){ctrl.courseList=data.courses,ctrl.courseListDisabled=data.courses.length<1,isCourseListAvaliable(),ctrl.courseListAvaliable&&schedulerService.addCoursesInPlans(ctrl.courseList).then(function(data){ctrl.courseList=data}),$(".settingsMenu__courseList .settingsMenu__listCatIW").mCustomScrollbar("update")}),$rootScope.$on("$stateChangeSuccess",function(){isCourseListAvaliable(),isAcuityLinkAvaliable()}),$rootScope.$on("toggleLessons",function(e,args){closeSettingsMenu(!1)}),isCourseListAvaliable(),isAcuityLinkAvaliable(),ctrl.navigateToCourse=function(id,event,listCat,currentCourse,canNavigate){!currentCourse&&canNavigate&&($rootScope.$broadcast("navigateToCourse",{CourseId:id}),$scope.showItem(event,listCat))},$scope.updateScrollBars=function(){$scope.scrollbarOptions.propForUpdateTrigger=Date.now()},$rootScope.isStudentRole="1"!=storageService.get("Student","StudentPlatform"),$scope.closeSettingsMenu=function($event,isCloseDictionaryAlso){if(!1===function(target){return!!($(target).attr("class")&&0<$(target).attr("class").indexOf("settingsMenu__listCat"))}($event.target||$event.srcElement)&&""!==$scope.itemOpen){if("dictionary"===$scope.itemOpen&&!0!==isCloseDictionaryAlso)return;closeSettingsMenu()}},$document.bind($scope.closeMenuEventName,function($event){$event.target&&$event.target.className&&-1==($event.target.className+"").indexOf("onBoarding")&&$scope.closeSettingsMenu($event)}),($lessonListEl=$(".learning__lessonsNavButtonW"))&&$lessonListEl.on($scope.closeMenuEventName,function(event){$scope.closeSettingsMenu(event,!0)}),$scope.$root.stopProp=function(event){event&&event.stopPropagation?event.stopPropagation():(event=window.event).cancelBubble=!0},$scope.openOnboarding=function(unavaiableOB){if(!unavaiableOB)if($rootScope.$$listeners.openOnboarding)$rootScope.$emit("openOnboarding");else{var OBscope=angular.element(document.getElementById("onBoadingDiv")).scope();OBscope&&OBscope.$apply(function(){OBscope.OBCtrl.load(),OBscope.$emit("openOnboarding")})}},$scope.getCssClass=function(){return $scope.unavaiableOB?"settingsMenu__listItem_OnBoarding--disabled settingsMenu__listItem--disabled":""};document.location.pathname.indexOf("Template.html")<0&&document.location.pathname.toLowerCase().indexOf("learningarea")<0&&$(document).off("NavigationRequested").on("NavigationRequested",function(event){localStorage.removeItem("viewBeforeSystemCheck"),frBox=new FrameBoxObj("MsgPage.html?saveState=no&url=false&test=no",320,210,function(){document.dispatchEvent(document.navigationConfirmed)})}),$scope.beforeLogout=function(keepModalOpen){if($rootScope.isStudentRole){if("Learning"===$rootScope.currentPage)if("undefined"!=typeof courseManager&&courseManager.lsPlayer&&courseManager.lsPlayer.taskWarning){if(!confirm(courseManager.lsPlayer.taskWarning))return}else if("undefined"!=typeof learningArea){var lsPlayer=learningArea.getLessonPlayer();if(lsPlayer&&lsPlayer.taskWarning&&!confirm(lsPlayer.taskWarning))return}var loginUrl=storageService.get("Community","link")?storageService.get("Community","link"):Root+storageService.get("Community","alias")+"#/login";$scope.siteNavigate(loginUrl,keepModalOpen)}},$scope.logout=function(url,keepModalOpen){keepModalOpen||window.top.postMessage("closeModal","*"),logLesson(JSON.parse(localStorage.getItem("TLlessonID")),JSON.parse(localStorage.getItem("TLcourseID")),"E");var sessionId=storageService.get("Activity","SessionID");if(activityService.logout(),edns.navigator.removeLAGotoPath(),"Ext"==storageService.get("Student","LoginType"))"Learning"===$rootScope.currentPage&&("undefined"!=typeof learningArea&&learningArea?learningArea.getLessonPlayer().dispose():courseManager&&courseManager.lsPlayer&&courseManager.lsPlayer.dispose()),authService.logout($rootScope.root).then(function(){$rootScope.$broadcast("userLogout"),edns.toeic.isToeic?edns.toeic.logoff().then(goToBeforeLoginPage):goToBeforeLoginPage()});else{if(void 0!==sessionId&&storageService.remove("Activity"),storageService.remove("Student"),"1"==getCompositeCookie("Community","PostLogInActivity")){function StopExecution(){Error.apply(this,arguments),this.name="StopExecution"}throw StopExecution.prototype=Object.create(Error.prototype),localStorage.setItem("closed","true"),window.location.replace(Root+"D111/PLALO"),new StopExecution("Stop further js execution")}setTimeout(function(){localStorage.setItem("closed","true"),window.location.href=url},150)}};var goToBeforeLoginPage=function(){url=storageService.get("Community","link"),edns.appToken.remove(),storageService.clearAll(!0),$.publish("ExtLoginloggedOut"),localStorage.setItem("closed","true"),url?window.location.href=url:window.close()},confirmLogoutInTestEH=function(event){frBox=new FrameBoxObj("MsgPage.html?saveState=no&url=false&test=no",320,210,function(){window.TempTest=!1,(-1<event.data.url.indexOf("login")||storageService.get("Student","LoginType"))&&$scope.logout(event.data.url,event.data.keepModalOpen)})};$scope.siteNavigate=function(url,keepModalOpen){1==window.InTest?($(document).off("NavigationConfirmed",confirmLogoutInTestEH),$(document).on("NavigationConfirmed",{url:url,keepModalOpen:keepModalOpen},confirmLogoutInTestEH),(-1!==url.indexOf("login")||storageService.get("Student","LoginType"))&&document.dispatchEvent(document.navigationRequested)):(document.dispatchEvent(document.navigationRequested),$(document).on("NavigationConfirmed",function(){localStorage.removeItem("viewBeforeSystemCheck"),$scope.logout(url,keepModalOpen)}))},$.subscribe("showMobileQR",$scope.beforeLogout.bind(this,!0)),modalParentEl=0<$(".home__IW").length?$(".home__IW"):$("body");window.syschekModal;function checkSysAlertCookie(){notificationsService.systemCheck.checkAlerts(),ctrl.systemCheck.alertTotal=notificationsService.systemCheck.getAlertsTotal(),ctrl.systemCheck.showAlert=notificationsService.systemCheck.hasAlerts()}function updateHasUpcomingOnlineSessions(e,hasSessions){ctrl.hasUpcomingOnlineSessions=hasSessions}function hideNavItemsByInst(){var InstitutionsDataStorage=storageService.session.get("InstitutionsData");InstitutionsDataStorage&&(InstitutionsDataStorage.displaySiteNav&&($scope.showItemsByInst=$.extend($scope.showItemsByInst,InstitutionsDataStorage.displaySiteNav)),InstitutionsDataStorage.learningAsAng&&$.subscribe("openLesssonList",function(event){$scope.closeSettingsMenu(event,!0)}),isCourseListAvaliable())}function isAcuityLinkAvaliable(){if("home"===$state.current.name.toLowerCase()){var acuityZoomSchedule=storageService.get("acuityZoomSchedule");if(acuityZoomSchedule&&acuityZoomSchedule.acuityTeacherForStudent){var acuityTeacherForStudent=JSON.parse(acuityZoomSchedule.acuityTeacherForStudent);ctrl.acuityOnlineLessons=!!acuityTeacherForStudent.CalendarId,ctrl.acuityOnlineLessons&&registerAcuityModalClose()}else if("1"==storageService.get("Community","AcuityZoom")){var userId=getCompositeCookie("Student","StudentID");acuityZoomScheduleService.GetAcuityTeacherForStudent(userId).then(function(res){null!==res.data&&res.data.CalendarId&&(ctrl.acuityOnlineLessons=!0,res.data.UserName=res.data.UserName,res.data.Password=res.data.Password,storageService.set("acuityZoomSchedule",JSON.stringify(res.data),"acuityTeacherForStudent",!0),registerAcuityModalClose())})}}else ctrl.acuityOnlineLessons=!1}function registerAcuityModalClose(){$rootScope.$on("closeAcuityZoomScheduleModal",function(e,args){ctrl.AcuityZoomScheduleModalInstance.close()})}function isVideoTurorialsEnabled(){return"VideoTutorials"!==$state.current.name&&!ctrl.isLearningArea}$scope.doSystemCheck=function($event){switch($rootScope.currentPage){case"home":localStorage.setItem("viewBeforeSystemCheck","/"+$rootScope.currentPage);break;default:localStorage.removeItem("viewBeforeSystemCheck")}var url=Root+"Runtime/SysCheck/SysCheck.htm?PW=1";modalParentEl=0<$(".home__IW").length?$(".home__IW"):$("body"),window.syschekModal=edns.modalManager.custom({iFrameUrl:url,iFrameHeight:450,iFrameWidth:520,windowClass:"SystemCheck",$modalParentEl:modalParentEl,closeCallbackAfter:function(){$rootScope.$broadcast("checkSysAlertCookie")}})},checkSysAlertCookie(),$scope.$on("checkSysAlertCookie",function(){checkSysAlertCookie(),$scope.$apply()}),ctrl.hasNotificationsCenterMessages=!0,$scope.showNotificationCenter=function($event,$parameterScope){$rootScope.isStudentRole&&"Home"===$state.$current.name&&ctrl.hasNotificationsCenterMessages&&(location.href=$rootScope.root+"NCView/SHN?ShowAll=true")},ctrl.notificationsCenterMessagesDisabled=function(){return 0==("Home"===$state.$current.name&&ctrl.hasNotificationsCenterMessages)||!1===$rootScope.isStudentRole},$rootScope.$on("HPLoaded",function(){}),ctrl.onlineSessions=onlineSessionsBLDALService.hasInstitutionProperty(),ctrl.hasUpcomingOnlineSessions=!1,ctrl.onlineSessions&&!ctrl.isLearningArea&&onlineSessionsBLDALService.hasUpcomingOnlineSessions().then(function(hasSessions){updateHasUpcomingOnlineSessions(0,hasSessions)}),$rootScope.$on("hasUpcomingOnlineSessions",updateHasUpcomingOnlineSessions),$rootScope.$on("closeOnlineSessionsModal",function(e,args){ctrl.onlineSessionsModalInstance.close()}),ctrl.showOnlineSessions=function(){!ctrl.isLearningArea&&$rootScope.isStudentRole&&(ctrl.onlineSessionsModalInstance=$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware onlineSessionsModal",backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalTitle:$filter("translate")("1245"),modalContent:$rootScope.root+"/Templates/Shared/onlineSessions.html",controller:"onlineSessionsCtrl"}}}}))},$scope.showStudyPlanner=function($event,$parameterScope){if($rootScope.isStudentRole){if("Learning"===$rootScope.currentPage)return $scope.itemOpen="personal",void $scope.stopProp($event);$scope.itemOpen="",$rootScope.$broadcast("CloseAllModals");var userId=getCompositeCookie("Student","StudentID"),userType=getCompositeCookie("Student","UserType");applicationVariablesBL.get(["ClassicEdoURL"]).then(function(data){localStorage.setItem("ClassicEdoURL",data.ClassicEdoURL),$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalIframeTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware ModalForContentInIframeW ModalflexWidth studyPlanerModal",backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalTitle:"Study Planner",modalContent:localStorage.getItem("ClassicEdoURL")+"Runtime/SetCookie.aspx?Community="+encodeURIComponent("^IID*"+getCompositeCookie("Community","IID"))+"&Student="+encodeURIComponent("^StudentID*"+getCompositeCookie("Student","StudentID")+"^Language*"+getCompositeCookie("Student","Language")+"^LangSupLevel*"+getCompositeCookie("Student","LangSupLevel")+"^UserType*s")+"&resPathRoot="+encodeURIComponent(GetCookie("resPathRoot"))+"&url="+encodeURIComponent(localStorage.getItem("ClassicEdoURL")+"Runtime/StudyPlaner/miniReport.aspx?UserId="+userId+"&UserType="+userType),iFrameWidth:260,iFrameHeight:230}}}})})}},institutionService.setData(),hideNavItemsByInst(),$scope.$parent.$on("InstitutionsDataLoaded",function(e){hideNavItemsByInst()}),$scope.toggleDictionary=function($event){$scope.dictionaryOpen=!$scope.dictionaryOpen,$event.cancelBubble=!0},$scope.openDictionary=function(){ctrl.isDictionaryDisabled()||(bMobile?setTimeout(function(){OnDicClick(1)},750):OnDicClick(1),dictionaryOpen=!1,$scope.itemOpen="")},$scope.openDictionaryWithKey=function(e){13!=e.which||ctrl.isDictionaryDisabled()||(OnDicClick(1),dictionaryOpen=!1,$scope.itemOpen="")},$.subscribe("dictionary",function(e,data){data&&data.disableDictionarySearch&&(ctrl.disableDictionarySearch=data.disableDictionarySearch.value)}),$scope.showMyProfile=function($event){if("Learning"===$rootScope.currentPage||!1===$rootScope.isStudentRole)return $scope.itemOpen="personal",void $scope.stopProp($event);$scope.itemOpen="",$rootScope.$broadcast("CloseAllModals");var runtimeUrl=-1<location.href.toLowerCase().indexOf("runtime")?"/":"";$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalIframeTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware ModalForContentInIframeW myProfileModal",backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalTitle:"MyProfile",modalContent:($rootScope.root.endsWith("/")?$rootScope.root:$rootScope.root+"/")+runtimeUrl+"Runtime/MyProfile/MyProfile.html",modalWidth:530,modalHeight:650}}}}).result.finally(function(){location.reload()}),$scope.$watch(function(){return angular.element(document.querySelector("body")).attr("class")},function(){angular.element(document.querySelector(".myProfileModal")).length<1?angular.element(document.querySelector("body")).removeClass("modal-myProfile"):angular.element(document.querySelector("body")).addClass("modal-myProfile")})},ctrl.openAcuityZoomSchedule=function(){$rootScope.currentPage="AcuityZoomSchedule",$scope.$on("modalClosed",function(){$rootScope.currentPage=$location.path().replace("/","")||"Learning"}),ctrl.AcuityZoomScheduleModalInstance=$modal.open({templateUrl:$rootScope.root+"/Templates/Shared/bootstrapModalTmpl.html",controller:"ModalInstanceCtrl",size:"lg",windowClass:"rtlAware acuityZoomScheduleModal",backdrop:"static",keyboard:!1,resolve:{pageParams:function(){return{modalTitle:$filter("translate")("1179"),modalContent:$rootScope.root+"/Templates/Shared/acuityZoomSchedule.html",controller:"acuityZoomScheduleCtrl"}}}})},ctrl.gotoVideoTutorials=function(e){isVideoTurorialsEnabled()&&$state.go("VideoTutorials")},ctrl.isVideoTutorialsAvailable=function(){return!("1"===storageService.get("Community","HideVideoTutorials"))},ctrl.getVideoTutorialsCssClass=function(){return isVideoTurorialsEnabled()?"":"settingsMenu__listItem_videoTutorials--disabled settingsMenu__listItem--disabled"},$rootScope.$emit("menuLoaded"),setTimeout(function(){$.publish("menuLoaded")},100)}]).directive("edoStopPropDic",function(){return{controller:["$scope","$element","$attrs",function($scope,$element,$attrs){function onTouchStart(event){$scope.$apply(function(){$scope.$root.stopProp(event)})}$element.bind("touchstart",onTouchStart),$element.bind("click",onTouchStart)}]}}).directive("edoStopPropSettings",function(){return{controller:["$scope","$element","$attrs",function($scope,$element,$attrs){$element.bind("touchstart",function(event){$scope.$apply(function(){$scope.$root.stopProp(event)})})}]}})}(window.angular),function(angular){var commonModule=window.angular.module("common");commonModule&&commonModule.controller("acuityZoomScheduleCtrl",["$scope","$rootScope","$translate","$filter","acuityZoomScheduleService","storageService",function($scope,$rootScope,$translate,$filter,acuityZoomScheduleService,storageService){var ctrl=this;function setCalendarUrl(res){var acuityApiStudentHiddenFieldId,InstitutionsDataStorage=storageService.session.get("InstitutionsData");InstitutionsDataStorage&&InstitutionsDataStorage.acuityApiStudentHiddenFieldId&&(acuityApiStudentHiddenFieldId=InstitutionsDataStorage.acuityApiStudentHiddenFieldId);var paramsString=[["firstName",storageService.get("Student","FName")],["lastName",storageService.get("Student","LName")],["owner",res.data.OwnerId],["calendarID",res.data.CalendarId],["field:"+acuityApiStudentHiddenFieldId,storageService.get("Student","StudentID")]].map(function(v){return v[0]+"="+v[1]}).join("&");ctrl.teacherCalendarUrl="https://app.acuityscheduling.com/schedule.php?"+encodeURI(paramsString)}function bindAppointments(res){var data,dayNames;ctrl.appointments=(data=res.data,dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],data.forEach(function(v,i){var d=new Date(v.DateTime);v.date=dayNames[d.getDay()]+" "+d.getDate()+"/"+(d.getMonth()+1),v.time=padZeros(d.getHours(),2)+":"+padZeros(d.getMinutes(),2);var location,zoomURL=(location=v.ZoomLink).indexOf("http")<0?"":location.split(" ").filter(function(v){return-1<v.toLowerCase().indexOf("http")});v.zoomURL=0<zoomURL.length?zoomURL[0]:"",v.timezoneOffset=v.DateTime.substr(19),v.Duration=v.Duration.toString()}),data.sort(function(prev,current){return new Date(prev.DateTime)-new Date(current.DateTime)}))}function padZeros(number,length){for(var str=""+number;str.length<length;)str="0"+str;return str}ctrl.appointments=[],ctrl.studentId=storageService.get("Student","StudentID"),function(){var acuityZoomSchedule=storageService.get("acuityZoomSchedule");if(acuityZoomSchedule&&acuityZoomSchedule.acuityTeacherForStudent){var acuityTeacherForStudent=JSON.parse(acuityZoomSchedule.acuityTeacherForStudent);setCalendarUrl({data:acuityTeacherForStudent})}else acuityZoomScheduleService.GetAcuityTeacherForStudent(ctrl.studentId).then(setCalendarUrl),console.log('Failed to read cache of "acuityTeacherForStudent"')}(),acuityZoomScheduleService.GetStudentAppointments(ctrl.studentId).then(bindAppointments),ctrl.gotoUrl=function(url,winName,closeModal){window.open(url,name),closeModal&&$rootScope.$broadcast("closeAcuityZoomScheduleModal")}}])}(),function(angular){var commonModule=window.angular.module("common");commonModule&&commonModule.controller("onlineSessionsCtrl",["$scope","$rootScope","$filter","onlineSessionsBLDALService",function($scope,$rootScope,$filter,onlineSessionsBLDALService){var ctrl=this;function bind(sessions){ctrl.sessions=sessions,ctrl.hasSessions=!!(sessions&&0<sessions.length),ctrl.title=ctrl.hasSessions?$filter("translate")("1239"):$filter("translate")("1240"),$rootScope.$emit("hasUpcomingOnlineSessions",ctrl.hasSessions)}ctrl.sessions=[],ctrl.title="",onlineSessionsBLDALService.get().then(bind),ctrl.gotoUrl=function(url,winName,closeModal){window.open(url,winName),closeModal&&$rootScope.$broadcast("closeOnlineSessionsModal")}}])}(),function(angular){var OBDrv={};function loadMask(elSelectors){var canvas,ctx,width,height;canvas=document.getElementById("onBoarding__canvasW"),width=window.innerWidth+100,height=window.innerHeight+100,canvas.width=width,canvas.height=height,(ctx=canvas.getContext("2d")).fillStyle="rgba(0,0,0, 0.8)",ctx.fillRect(0,0,canvas.width,canvas.height),ctx.save(),$.each(elSelectors,function(index,value){$(elSelectors[index]).length<1||$.each($(elSelectors[index]),function(idx,val){var tempOffset,elOffset={top:0,left:0},mask={dimentions:{width:0,height:0},position:{top:0,left:0}},$el=$($(elSelectors[index])[idx]);$el.length<1||!1!==$el.is(":visible")&&(mask.dimentions.width=$el.outerWidth(),mask.dimentions.height=$el.outerHeight(),tempOffset=$el.offset(),elOffset.top=tempOffset.top-$(document).scrollTop(),elOffset.left=tempOffset.left-$(document).scrollLeft(),mask.position.top=elOffset.top,mask.position.left=elOffset.left,function(mask){var canvas,ctx;canvas=document.getElementById("onBoarding__canvasW"),(ctx=canvas.getContext("2d")).clearRect(mask.position.left,mask.position.top,mask.dimentions.width,mask.dimentions.height),ctx.strokeStyle="rgba(255,255,255,0.2)",ctx.lineWidth=7,ctx.strokeRect(mask.position.left-3.5,mask.position.top-3.5,mask.dimentions.width+7,mask.dimentions.height+7),ctx.save()}(mask))})})}function preventScroll(e){return e.preventDefault(),e.stopPropagation(),!1}function preventMiddleClick(e){2===e.which&&preventScroll(e)}function makeSlide(slide){var bubbleType;OBDrv.slide=slide,bubbleType=slide.bubbleType,$(".onBoarding__instrunctionsOW").attr("class",$(".onBoarding__instrunctionsOW").attr("class").split(" ").filter(function(val){return val.indexOf("onBoarding__instrunctionsOW--")<0}).join(" ")),"intro"===bubbleType?$(".onBoarding__instrunctionsOW").addClass("onBoarding__instrunctionsOW--intro"):"wide"===bubbleType&&$(".onBoarding__instrunctionsOW").addClass("onBoarding__instrunctionsOW--wide"),function(slide){$(".home__W").scrollTop(0);var scrollToPadding=slide.scrollToPadding?parseFloat(slide.scrollToPadding):0;slide.scrollTo?$(".home__W").scrollTop($(slide.scrollTo).offset().top-75-scrollToPadding):$(".home__W").scrollTop($(slide.alignToEl).offset().top-75-scrollToPadding)}(slide),function(slide){var string,arrowPointAt="";if("none"===slide.arrowType||"center"===slide.bubblePosition.side)$(".onBoarding__arrow").addClass("hide");else{switch(slide.bubblePosition.side){case"top":arrowPointAt="Down";break;case"bottom":arrowPointAt="Up";break;case"left":arrowPointAt="Right";break;case"right":arrowPointAt="Left"}$(".onBoarding__arrow").removeClass("hide").attr("class",$(".onBoarding__arrow").attr("class").split(" ").filter(function(val){return val.indexOf("onBoarding__arrow--position")<0}).join(" ")).addClass("onBoarding__arrow--position"+((string=slide.arrowType).charAt(0).toUpperCase()+string.slice(1))+"_point"+arrowPointAt),!0===OBDrv.isRtl&&"true"!==slide.bubblePosition.disableRtl?$(".onBoarding__arrow").addClass("onBoarding__arrow--rtlArrow"):$(".onBoarding__arrow").removeClass("onBoarding__arrow--rtlArrow")}}(slide),function(slide){var elPos={top:0,left:0},alignToEl=$(slide.alignToEl);if(alignToEl.length<1)return;switch(slide.bubblePosition.side){case"center":elPos.left=($(window).width()-$(".onBoarding__instrunctionsOW").outerWidth())/2,elPos.top=($(window).height()-$(".onBoarding__instrunctionsOW").outerHeight())/2;break;case"right":!1===OBDrv.isRtl||"true"===slide.bubblePosition.disableRtl?elPos.left=alignToEl.offset().left+alignToEl.outerWidth()+ +slide.bubblePosition.padding.left:elPos.left=alignToEl.offset().left-$(".onBoarding__instrunctionsOW").outerWidth()-+slide.bubblePosition.padding.left,elPos.top=alignToEl.position().top+ +slide.bubblePosition.padding.top;break;case"left":!1===OBDrv.isRtl||"true"===slide.bubblePosition.disableRtl?elPos.left=alignToEl.offset().left-$(".onBoarding__instrunctionsOW").outerWidth()+ +slide.bubblePosition.padding.left:elPos.left=alignToEl.offset().left+alignToEl.outerWidth()+-slide.bubblePosition.padding.left,elPos.top=alignToEl.position().top+ +slide.bubblePosition.padding.top;break;case"top":!1===OBDrv.isRtl||"true"===slide.bubblePosition.disableRtl?elPos.left=alignToEl.offset().left+ +slide.bubblePosition.padding.left:elPos.left=alignToEl.offset().left+alignToEl.outerWidth()-$(".onBoarding__instrunctionsOW").outerWidth()-slide.bubblePosition.padding.left,elPos.top=alignToEl.offset().top-$(window).scrollTop()-$(".onBoarding__instrunctionsOW").outerHeight()+ +slide.bubblePosition.padding.top;break;case"bottom":!1===OBDrv.isRtl||"true"===slide.bubblePosition.disableRtl?elPos.left=alignToEl.offset().left+ +slide.bubblePosition.padding.left:elPos.left=alignToEl.offset().left+alignToEl.outerWidth()-$(".onBoarding__instrunctionsOW").outerWidth()-slide.bubblePosition.padding.left,elPos.top=alignToEl.position().top+$(".home__userBar").outerHeight()+alignToEl.outerHeight()+ +slide.bubblePosition.padding.top}$(".onBoarding__instrunctionsOW").css({left:elPos.left+"px",top:elPos.top+"px"})}(slide),setTimeout(function(){loadMask(slide.elementSelectors),void 0!==slide.alignToElAtEnd&&$("html, body").scrollTop($(slide.alignToElAtEnd).offset().top-100)},4)}function lazyMakeSlide(){var func,wait,immediate,timeout,args,context,timestamp,later;null!==OBDrv.slide&&(func=makeSlide(OBDrv.slide),wait=100,later=function(){var last=(new Date).getTime()-timestamp;last<wait&&0<=last?timeout=setTimeout(later,wait-last):(timeout=null,immediate||(func.apply(context,args),timeout||(context=args=null)))})}OBDrv.slide=null,OBDrv.isRtl=!1;angular.module("common").directive("onboardingUi",["$rootScope","COMMON",function($rootScope,COMMON){return{restrict:"A",link:function(scope,element,attrs,controllers){scope.$watch("OBCtrl.slide",function(newValue,oldValue){newValue&&(OBDrv.isRtl=scope.$parent.OBCtrl.isRtl,makeSlide(scope.$parent.OBCtrl.slide),!1===scope.$parent.OBCtrl.directiveEventsRegistered&&(scope.$parent.OBCtrl.resizefunction=lazyMakeSlide,scope.$parent.OBCtrl.scrollFunction=preventScroll,scope.$parent.OBCtrl.midClickScrollFunction=preventMiddleClick,$(window).on("resize",lazyMakeSlide),(bMobile?"scroll touchmove":"scroll touchmove mousewheel").split(" ").forEach(function(v,i){window.addEventListener(v,preventScroll,{passive:!1})}),bMobile||$(window).on("mousedown",preventMiddleClick),$(window).on("OnBoarding_redrawCanvas",function(){makeSlide(scope.$parent.OBCtrl.slide)}),scope.$parent.OBCtrl.directiveEventsRegistered=!0))},!0)},templateUrl:$rootScope.root+"/templates/shared/onBoardingTmpl.html"}}])}(window.angular),window.angular.module("common").directive("edTitle",[function(){return{restrict:"A",scope:{edTitle:"&"},link:function($scope,element,attributes){element.attr("title",$scope.edTitle())},controller:["$scope",function($scope){}]}}]),window.angular.module("common").directive("edCoursesDropdown",["$rootScope","$filter","$timeout","userInfo",function($rootScope,$filter,$timeout,userInfo){return{restrict:"E",replace:!1,templateUrl:$rootScope.root+"/Templates/shared/coursesDropDown.html?v=5.1",scope:{courses:"=",scrollbarOptions:"=",onItemClick:"&onItemClick",stopProp:"&stopProp",showLicenseExpiration:"="},controllerAs:"coursesDropDownCtrl",bindToController:!0,controller:["$scope",function($scope){var ctrl=this;ctrl.addItalicsForToefl=edns.toefl.addItalicsForToefl,ctrl.getTitle=function(name,isLocked,licenseExpiration){var courseName=name+(isLocked?" ("+$filter("translate")("31")+")":""),licExpr="";return licenseExpiration&&ctrl.showLicenseExpiration&&(licExpr="\rExpires: "+licenseExpiration.split("T")[0]),courseName+licExpr}}]}}]),window.angular.module("common").directive("toeicCourseTestResultRange",["$rootScope","$filter","assessmentsBLTOEICService",function($rootScope,$filter,assessmentsBLTOEICService){return{restrict:"E",replace:!1,templateUrl:$rootScope.root+"/Templates/toeicCourseTestResultRange.html",scope:{courseTestData:"="},controllerAs:"toeicCTrrCtrl",bindToController:!0,controller:["$scope","assessmentsBLTOEICService",function($scope,assessmentsBLTOEICService){var ctrl=this;ctrl.dataReady=!1,function(){switch(ctrl.title=ctrl.courseTestData.title,ctrl.courseTestData.type){case"reading":ctrl.title=$filter("translate")("1214"),ctrl.skill="readingScore";break;case"listening":ctrl.title=$filter("translate")("1215"),ctrl.skill="listeningScore"}assessmentsBLTOEICService.getCourseTestScoreRange(ctrl.courseTestData.courseTestId,ctrl.skill,ctrl.courseTestData.grade).then(function(range){$scope.range=ctrl.range=range,ctrl.dataReady=!0;var canvasEl=$scope.element.getElementsByTagName("canvas")[0],resize_parentWidthFn=$scope.toeicCTrrCtrl.courseTestData.resize_parentWidthFn||function(){return canvasEl.parentNode.parentNode.clientWidth};if(createRangeGraph(canvasEl,5,495,range.minRange,range.maxRange,resize_parentWidthFn),!$rootScope["lazy_createRangeGraph_"+$scope.$id]){var createRangeGraphBound=createRangeGraph.bind(null,canvasEl,5,495,range.minRange,range.maxRange,resize_parentWidthFn);$rootScope["lazy_createRangeGraph_"+$scope.$id]=debounce(createRangeGraphBound,50),$(window).on("resize",$rootScope["lazy_createRangeGraph_"+$scope.$id])}function createRangeGraph(canvasEl,minRange,maxRange,CTMinRange,CTMmaxRange,resize_parentWidthFn){var rangeStartX,rangeEndX,rangeToGraphRatio,parentWidth=resize_parentWidthFn(),elWidth=parentWidth||280,canvas=canvasEl;canvas.width=elWidth,canvas.height=30,ctx=canvas.getContext("2d"),yCoor=7.5,minRangeTxtWidth=Math.ceil(ctx.measureText(minRange).width),maxRangeTxtWidth=22,rangeStartX=minRangeTxtWidth+5,rangeEndX=elWidth-(maxRangeTxtWidth+5),drawAvailRange(minRange,0,"11px Verdana"),drawAvailRange(maxRange,elWidth-maxRangeTxtWidth,"11px Verdana"),drawLine(rangeStartX,rangeEndX,yCoor,1,"#b4b4b4");var graphRangeMin=rangeStartX+5,graphRangeMax=rangeEndX-5,CTLineStart=(CTMinRange-minRange)*(rangeToGraphRatio=(graphRangeMax-graphRangeMin)/(maxRange-minRange))+graphRangeMin,CTLineEnd=CTMmaxRange*rangeToGraphRatio+graphRangeMin;drawCircle(CTLineStart,yCoor,5,"#005734"),drawCircle(CTLineEnd,yCoor,5,"#005734");var CTLineLength=CTLineEnd-CTLineStart;function drawLegend(minRange,CTMinRange,CTMmaxRange,CTLineStart,lineWidth,yCoor,rangeFont,textColor){var text=CTMinRange;text+=minRange!==CTMmaxRange?"-"+CTMmaxRange:"";var rangeCenterX=lineWidth/2+CTLineStart,textW=ctx.measureText(text).width;xCoor=rangeCenterX-textW/2,ctx.font="bold "+rangeFont,ctx.fillStyle=textColor,ctx.fillText(text,xCoor,yCoor+3)}function drawLine(startX,endX,yCoor,lineWidth,lineColor){ctx.beginPath(),ctx.moveTo(startX,yCoor),ctx.lineTo(endX,yCoor),ctx.lineWidth=lineWidth,ctx.strokeStyle=lineColor,ctx.stroke()}function drawAvailRange(text,xCoor,rangeFont){ctx.font=rangeFont,ctx.fillStyle="#757575",ctx.fillText(text,xCoor,yCoor+3)}function drawCircle(xCoor,yCoor,radius,color){ctx.beginPath(),ctx.arc(xCoor,yCoor,radius,0,2*Math.PI,!1),ctx.fillStyle=color,ctx.fill()}drawLine(CTLineStart,CTLineEnd,yCoor,1,"#005734"),drawLegend(minRange,CTMinRange,CTMmaxRange,CTLineStart,CTLineLength,20,"11px Verdana","#626262"),ctx.save()}$scope.$on("$destroy",function(){$(window).off("resize",$rootScope["lazy_createRangeGraph_"+$scope.$id]),$rootScope["lazy_createRangeGraph_"+$scope.$id]=null})})}()}],link:function($scope,element){$scope.element=element[0]}}}]),window.angular.module("common").directive("edRepeatEnd",["$rootScope",function(){return{link:function(scope,element,attrs){scope.$last&&scope.$root.$broadcast(attrs.edRepeatEnd)}}}]),function(angular){angular.module("common").service("applicationVariablesDAL",["COMMON","$http",function(COMMON,$http){var getCall,urlBase=COMMON.SERVICE_URL+"AppSettings/";return{get:function(varsNums,options,onAjaxSuccess){return(getCall=getCall||function(varsNums,options,onAjaxSuccess){var url=urlBase+"?keys="+varsNums.join(",");return edns.network.asyncCall(url,options,onAjaxSuccess)}(varsNums,options,onAjaxSuccess)).get()}}}])}(angular),function(angular){angular.module("common").service("applicationVariablesBL",["$q","applicationVariablesDAL",function($q,applicationVariablesDAL){var AppVarsEnum=[{key:"1",val:"TmsHost"},{key:"2",val:"ResPathRoot"},{key:"3",val:"ClassicEdoURL"}],appVarsStorageKey="appVars",appVars={};return function(appVars,AppVarsEnum){allEnumKeys(AppVarsEnum).forEach(function(v){var key,storageVal;storageVar=(key=v,null!==(storageVal=JSON.parse(sessionStorage.getItem(appVarsStorageKey)))?storageVal[key]:null),storageVar||(appVars[v]=storageVar)})}(appVars,AppVarsEnum),{get:function(varsList){var defer=$q.defer();if(0<varsList.map(function(key){return appVars[key]}).filter(function(v){return!v}).length){var allKeys=allEnumKeys(AppVarsEnum),transformFnBound=function(AppVarsEnum,data){var vars={};return data.forEach(function(kv){var keyName=AppVarsEnum.find(function(v){return v.key==kv.Key}).val;vars[keyName]=kv.Value}),vars}.bind(null,AppVarsEnum),setToStorageBound=function(appVarsStorageKey,transformFn,data){var dataObj=transformFn(data);sessionStorage.setItem(appVarsStorageKey,JSON.stringify(dataObj))}.bind(null,appVarsStorageKey,transformFnBound);applicationVariablesDAL.get(allKeys,{},setToStorageBound).then(function(d){defer.resolve(transformFnBound(d))})}else defer.resolve(appVars);return defer.promise}};function allEnumKeys(AppVarsEnum){return AppVarsEnum.map(function(v){return v.key})}}])}(angular);
//# sourceMappingURL=AngJSCommonModule.min.js.map
